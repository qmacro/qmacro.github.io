<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Speeding up your UI5 app with a Component preload file</title>
    <meta name="description" content="Reserving the right to be wrong.">
    <link rel="stylesheet" href="/blog/css/index.css">
    <link rel="stylesheet" href="/blog/css/prism-base16-monokai.dark.css">
    <link rel="alternate" href="/blog/feed/feed.xml" type="application/atom+xml" title="DJ Adams">
    <link rel="alternate" href="/blog/feed/feed.json" type="application/json" title="DJ Adams">
    <link href="https://unpkg.com/prismjs@1.20.0/themes/prism-okaidia.css" rel="stylesheet">
  </head>
  <body>
    <header>
      <h1 class="home"><a href="/blog/">DJ Adams</a></h1>
      <ul class="nav">
        <li class="nav-item"><a href="/blog/">Home</a></li>
        <li class="nav-item"><a href="/blog/about/">About</a></li>
        <li class="nav-item"><a href="/blog/posts/">Archive</a></li>
        <li class="nav-item"><a href="/blog/tags/">Tags</a></li>
      </ul>
    </header>

    <main class="tmpl-post">
      <h1>Speeding up your UI5 app with a Component preload file</h1>

<time datetime="2015-07-17">17 Jul 2015</time><a href="/blog/tags/grunt/" class="post-tag">grunt</a><a href="/blog/tags/openui5/" class="post-tag">openui5</a><a href="/blog/tags/performance/" class="post-tag">performance</a><a href="/blog/tags/preload/" class="post-tag">preload</a>

<p><strong><a href="/2015/07/04/30-days-of-ui5/">30 Days of UI5</a> — Day 14 by <a href="http://jmurray.me/">John Murray</a></strong></p>
<p>In this post we’ll be looking at how you can speed up the load times of your UI5 applications by using a Component preload file. Those of you who are familiar with SAP Fiori applications will probably already know what a Component preload file is, however those of you who aren’t will almost definitely have all seen a reference to this file before. This file is referenced in an error message that appears in the console whenever you load a UI5 app, which is lacking a Component preload file.</p>
<p><img src="/blog/img/2018/02/Screen-Shot-2015-07-14-at-20.54.47-624x31.png" alt="Chrome preload error"></p>
<p><strong>So just what is this preload file and why should I care?</strong></p>
<p>The preload file is essentially all of the files which make up your application, so that’s the Component itself, Controllers, Views, Fragments and so on, all compressed and inserted into one file, the preload file. If this file exists then UI5 will only load that file, and it won’t load of all of the other various files which it ordinarily would have done. The error we saw earlier is caused because UI5 looks for a preload file early in the execution flow, but of course did not find one, and so carried on loading all of the files individually.</p>
<p>Now that we’ve cleared up what the file actually is, and why that error appears, just why should exactly should we worry about it? After all we’ve ignored that error up until now and all our apps have worked just fine. Well, the reason we should care is that it dramatically decreases page load time. This is due to the app only having to make one call to get the preload file, rather than all of the individual calls for each file, but also because in the preload file the code is “minified”, which means the file size is also very small relative to the full size individual files. This is especially important when developing UI5 applications which are to be used over a mobile data connection, where size has a very large impact on initial load performance. As an anecdotal example, on the simple UI5 app which I have just created a preload file for my initial load time went from 8-9 seconds down to 3-4 seconds, which is tremendous improvement!</p>
<p><strong>Sounds great! So how can I make a preload file for my UI5 app?</strong></p>
<p>For this next section you will need to have installed on your machine <a href="https://nodejs.org/">NodeJS</a>, <a href="https://www.npmjs.com/">npm</a> and <a href="http://gruntjs.com/">Grunt</a>. If you don’t know how to install and use these things then do <a href="http://twitter.com/johnbmurray">reach out to me on Twitter</a>.</p>
<p>After you have all of the above installed, you’ll need to create a <code>package.json</code> file in your UI5 app’s root directory. Open the file up and paste in the contents below and don’t forget to edit them accordingly:</p>
<pre class="language-javascript"><code class="language-javascript"><span class="token punctuation">{</span><br>  <span class="token string-property property">"name"</span><span class="token operator">:</span> <span class="token string">"barcode-test"</span><span class="token punctuation">,</span><br>  <span class="token string-property property">"version"</span><span class="token operator">:</span> <span class="token string">"0.0.1"</span><span class="token punctuation">,</span><br>  <span class="token string-property property">"description"</span><span class="token operator">:</span> <span class="token string">""</span><span class="token punctuation">,</span><br>  <span class="token string-property property">"main"</span><span class="token operator">:</span> <span class="token string">"index.html"</span><span class="token punctuation">,</span><br>  <span class="token string-property property">"author"</span><span class="token operator">:</span> <span class="token string">"John Murray"</span><span class="token punctuation">,</span><br>  <span class="token string-property property">"license"</span><span class="token operator">:</span> <span class="token string">"Apache License, Version 2.0"</span><span class="token punctuation">,</span><br>  <span class="token string-property property">"devDependencies"</span><span class="token operator">:</span> <span class="token punctuation">{</span><br>    <span class="token string-property property">"grunt"</span><span class="token operator">:</span> <span class="token string">"^0.4.5"</span><br>  <span class="token punctuation">}</span><br><span class="token punctuation">}</span></code></pre>
<p>After creating and saving this file, install the <a href="https://github.com/SAP/grunt-openui5">Grunt OpenUI5 tools</a> which are made by the UI5 team at SAP. To install these tools open a terminal session in your UI5 root directory and run this command ‘npm install grunt-openui5 –save-dev’. This will download and install the tools, and also add them to the “devDependencies” section of your ‘package.json’ file.</p>
<p>Next, again in the UI5 app root directory, create a file called ‘Gruntfile.js’. Into this file copy and paste the contents below, and we’ll go through what it all means in a moment.</p>
<pre class="language-javascript"><code class="language-javascript">module<span class="token punctuation">.</span><span class="token function-variable function">exports</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">grunt</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br><br>  <span class="token comment">// Project configuration.</span><br>  grunt<span class="token punctuation">.</span><span class="token function">initConfig</span><span class="token punctuation">(</span><span class="token punctuation">{</span><br>    <span class="token literal-property property">pkg</span><span class="token operator">:</span> grunt<span class="token punctuation">.</span>file<span class="token punctuation">.</span><span class="token function">readJSON</span><span class="token punctuation">(</span><span class="token string">'package.json'</span><span class="token punctuation">)</span><span class="token punctuation">,</span><br>    <span class="token literal-property property">openui5_preload</span><span class="token operator">:</span> <span class="token punctuation">{</span><br>      <span class="token literal-property property">component</span><span class="token operator">:</span> <span class="token punctuation">{</span><br>        <span class="token literal-property property">options</span><span class="token operator">:</span> <span class="token punctuation">{</span><br>          <span class="token literal-property property">resources</span><span class="token operator">:</span> <span class="token punctuation">{</span><br>            <span class="token literal-property property">cwd</span><span class="token operator">:</span> <span class="token string">''</span><span class="token punctuation">,</span><br>            <span class="token literal-property property">prefix</span><span class="token operator">:</span> <span class="token string">''</span><span class="token punctuation">,</span><br>            <span class="token literal-property property">src</span><span class="token operator">:</span> <span class="token punctuation">[</span><br>              <span class="token string">'webapp/**/*.js'</span><span class="token punctuation">,</span><br>              <span class="token string">'webapp/**/*.fragment.html'</span><span class="token punctuation">,</span><br>              <span class="token string">'webapp/**/*.fragment.json'</span><span class="token punctuation">,</span><br>              <span class="token string">'webapp/**/*.fragment.xml'</span><span class="token punctuation">,</span><br>              <span class="token string">'webapp/**/*.view.html'</span><span class="token punctuation">,</span><br>              <span class="token string">'webapp/**/*.view.json'</span><span class="token punctuation">,</span><br>              <span class="token string">'webapp/**/*.view.xml'</span><span class="token punctuation">,</span><br>              <span class="token string">'webapp/**/*.properties'</span><br>            <span class="token punctuation">]</span><br>          <span class="token punctuation">}</span><span class="token punctuation">,</span><br>          <span class="token literal-property property">dest</span><span class="token operator">:</span> <span class="token string">''</span><span class="token punctuation">,</span><br>          <span class="token literal-property property">compress</span><span class="token operator">:</span> <span class="token boolean">true</span><br>        <span class="token punctuation">}</span><span class="token punctuation">,</span><br>        <span class="token literal-property property">components</span><span class="token operator">:</span> <span class="token boolean">true</span><br>      <span class="token punctuation">}</span><br>    <span class="token punctuation">}</span><br>  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><br>  grunt<span class="token punctuation">.</span><span class="token function">loadNpmTasks</span><span class="token punctuation">(</span><span class="token string">'grunt-openui5'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><br><span class="token punctuation">}</span></code></pre>
<p>This is quite a simple example but it will suffice in most use cases. What we are doing here first of all is reading in the ‘package.json’ file created earlier which provides the dependency list. Then we are setting the configuration options for ‘openui5_preload’ which is the specific tool we are going to be using from the OpenUI5 toolset.</p>
<ul>
<li>The ‘cwd’ parameter allows you to provide a base directory for finding the files and the ‘prefix’ parameter lets you prefix all files with a path of your choosing; in this instance we are not using either of these parameters so we are leaving them blank.</li>
<li>The ‘src’ parameter lets you provide an array of paths, which it will use to try and match files in your directory and then for those matches it will minify and add them to the preload. I have all of my UI5 application files within a subdirectory called ‘webapp’ which is why my paths all begin with ‘webapp’. I have all my UI5 files located in this directory because I can then keep all of my other files and folders such as ‘node_modules’, PhoneGap config files, IDE folders, etc back in the root directory. I do this because it allows me to use this simple “get everything” approach you see above in the ‘src’ without worrying about accidentally including non-UI5 app files.</li>
<li>The ‘dest’ parameter specifies the path to the destination you wish to save the preload file. In this case we just want to save it in the same place as the <code>Component.js</code> file and therefore can leave it blank.</li>
<li>The ‘compress’ parameter sets whether or not you wish to minify the files as well as add them to the preload file. I would personally recommend always setting this to ‘true’ unless you have a good reason not to.</li>
<li>The ‘components’ parameter here with a value of ‘true’ sets the tool to automatically find all components and create a preload for each.</li>
</ul>
<p>Finally, we load the ‘grunt-openui5′ toolkit from the plugin as previously installed and specified in ‘package.json’.</p>
<p><em>For the full documentation and parameter list I’d recommend looking at the <a href="https://github.com/SAP/grunt-openui5">Grunt OpenUI5 tools</a> GitHub page.</em></p>
<p>That’s all the configuration set up, now it’s time to generate our preload file! Fire up a terminal session in the same directory as your ‘Gruntfile.js’ and run the following command ‘grunt openui5_preload’ and you should see the following output along with a ‘Component-preload.js’ file alongside your ‘Component.js’ file.</p>
<p><img src="/blog/img/2018/02/Screen-Shot-2015-07-15-at-00.48.10-624x88.png" alt="preload generation output"></p>
<p><strong>Final thoughts</strong></p>
<p>Congratulations, you’ve just made your first preload file and are now well on the way to creating even better apps with UI5!</p>

<hr>
<ul><li>Next: <a href="/blog/2015/18/7/the-ui5-support-tool-help-yourself/">The UI5 Support Tool - Help Yourself!</a></li><li>Previous: <a href="/blog/2015/16/7/multi-language-support-out-of-the-box-ui5-s-pedigree/">Multi language support out of the box - UI5&#39;s pedigree</a></li>
</ul>

    </main>

    <footer></footer>

    <!-- Current page: /blog/2015/17/7/speeding-up-your-ui5-app-with-a-component-preload-file/ -->
  </body>
</html>
