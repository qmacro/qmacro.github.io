<!doctype html><html lang="en"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1"><link rel="canonical" href="https://qmacro.org/2021/09/15/using-functions-more/"><link href="/assets/main.05e665c4602227b0048e.css" rel="stylesheet"><link rel="preconnect" href="https://fonts.gstatic.com"><link href="https://fonts.googleapis.com/css2?family=IBM+Plex+Sans&display=swap" rel="stylesheet"><title>Using functions more | DJ Adams</title><link rel="icon" type="“image/x-icon”" href="/images/favicon.ico"><meta property="og:title" content="Using functions more"><meta property="og:site_name" content="DJ Adams"><meta property="og:type" content="website"><meta property="og:url" content="https://qmacro.org/2021/09/15/using-functions-more/"><meta name="twitter:card" content="summary_large_image"><meta name="twitter:creator" content="@qmacro"><meta name="description" content="Using functions more 15 Sep 2021 | 2 min read Using functions more in my shell seems to bring benefits. Here&#39;s an example. Bash functions..."><meta property="og:description" content="Using functions more 15 Sep 2021 | 2 min read Using functions more in my shell seems to bring benefits. Here&#39;s an example. Bash functions..."><meta name="description" content="Using functions more 15 Sep 2021 | 2 min read Using functions more in my shell seems to bring benefits. Here&#39;s an example. Bash functions..."><meta property="og:image" content="https://qmacro.org/images/DJA-head.png"><meta name="twitter:image" content="https://qmacro.org/images/DJA-head.png"><script src="https://cdn.jsdelivr.net/npm/mermaid/dist/mermaid.min.js"></script><script>mermaid.initialize({startOnLoad:true});</script></head><body><div class="layout-wrapper"><header class="header"><div class="header__content"><h1 class="site-title"><a href="/">DJ Adams</a></h1><nav class="nav"><ul class="nav__list"><li class="nav-item"><a href="/about">About Me</a></li><li class="nav-item"><a href="/talks">Talks</a></li><li class="nav-item"><a href="/blog">Blog</a></li><li class="nav-item"><a href="/feed.xml">Feed</a></li></ul></nav></div></header><main class="main"><article class="post"><header class="post__header"><h1>Using functions more</h1><div class="post__details"><time datetime="2021-09-15">15 Sep 2021 </time><span>| </span><span>2 min read</span></div></header><main class="post__content"><p>Using functions more in my shell seems to bring benefits. Here's an example.</p><p>Bash functions seem to sit in a sweet spot between aliases and full blown scripts. I've defined a number of functions in my dotfiles which are all useful. Unlike aliases, they can take parameters and have greater scope for doing things; unlike scripts, they run in the context of the current shell which means, for example, that I can set a value in a variable during the course of a function's execution and it's available directly afterwards, in the same shell session.</p><p>Anyway, in the context of thinking about functions more, I decided to write a &quot;wrapper&quot; around one of the CLI tools I'm using a lot at the moment, the btp CLI, i.e. the command line tool for administration of resources and services on the SAP Business Technology Platform (BTP). If you want to learn more about the btp CLI and, indirectly, about BTP, have a look at the corresponding SAP Tech Bytes series of blog posts, starting with <a href="https://blogs.sap.com/2021/09/01/sap-tech-bytes-btp-cli-installation/">SAP Tech Bytes: btp CLI - installation</a>, and <a href="https://github.com/SAP-samples/sap-tech-bytes/tree/2021-09-01-btp-cli">the associated branch in the SAP Tech Bytes repo on GitHub</a>.</p><p>The btp CLI, like other tools that manage cloud-based resources, is quite verbose in its output; partly because it needs to impart a lot of information, and partly because cloud resources, being &quot;cattle, not pets&quot;, have identities that are more likely to be long GUIDs than short human-friendly names. For more on this, see this post in my <a href="https://blogs.sap.com/tag/mondaymorningthoughts/">Monday morning thoughts</a> series: <a href="https://blogs.sap.com/2018/04/09/monday-morning-thoughts-a-cloud-native-smell/">A cloud-native smell</a>.</p><p>So when invoking the btp CLI with an action to look at the hierarchy of directories and subaccounts in a global account, the output tends to wrap around, like this:</p><p><img src="/images/2021/09/hierarchy-wrapped.png" alt="hierarchy information, wrapped"></p><p>But with a simple wrapper function, I can have this a lot cleaner; granted, if there's something at the end of the long lines that I'm interested in, then I won't be able to use this, but it's usually information at the start of the lines that's important to me.</p><p>Here's a wrapper function for the btp CLI that I've just started to use:</p><pre class="language-bash"><code class="language-bash"><span class="token function-name function">btp</span> <span class="token punctuation">(</span><span class="token punctuation">)</span><br><span class="token punctuation">{</span><br>    <span class="token keyword">if</span> <span class="token punctuation">[</span><span class="token punctuation">[</span> <span class="token variable">$1</span> <span class="token operator">=</span>~ ^<span class="token punctuation">(</span>get<span class="token operator">|</span>list<span class="token punctuation">)</span>$ <span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token keyword">then</span><br>        <span class="token string">"<span class="token environment constant">$HOME</span>/bin/btp"</span> <span class="token string">"<span class="token variable">$@</span>"</span> <span class="token operator">|</span> trunc<br>    <span class="token keyword">else</span><br>        <span class="token string">"<span class="token environment constant">$HOME</span>/bin/btp"</span> <span class="token string">"<span class="token variable">$@</span>"</span><br>    <span class="token keyword">fi</span><br><span class="token punctuation">}</span></code></pre><p>When I use <code>btp</code> to display information, with the <code>get</code> or <code>list</code> actions, this will run the real btp CLI, passing it whatever arguments I passed to the function (i.e. in <code>$@</code>), piping the output to the <code>cut</code> command where I use the <code>-c</code> option to tell it to only output characters from column 1, up to however many columns the current terminal has (which can be determined with <code>tput cols</code>).</p><blockquote><p>For those of you who are #HandsOnSAPDev pioneers, you may recognise this, as we encapsulated <code>cut -c 1-$(tput cols)</code> as <code>trunc</code>.</p></blockquote><p>Now, running that same command, the output looks like this:</p><p><img src="/images/2021/09/hierarchy-clean.png" alt="hierarchy information, clean"></p><p>It's early days, but I quite like the way I can use the power of functions like this.</p></main><aside class="post__aside"><div class="post__tags"><a href="/tags/autodidactics/">#autodidactics</a> <a href="/tags/shell/">#shell</a></div><style>.utterances {
  margin-left: inherit !important;
}</style><script src="https://utteranc.es/client.js" repo="qmacro/qmacro.github.io" issue-term="title" crossorigin="anonymous" async></script><nav class="post__pagination"><a href="/2021/10/14/sourcing-vs-executing-in-bash/"><span>←</span> <span>Sourcing vs executing in Bash</span> </a><a href="/2021/09/12/improving-shell-fu-with-practice/"><span>Improving shell fu with practice</span> <span>→</span></a></nav></aside></article></main><footer class="footer"><div class="footer__content"><ul class="hero__social-links"><li><a href="https://github.com/qmacro" target="_blank" rel="noopener noreferrer">GitHub</a></li><li><a href="https://www.youtube.com/djadams-qmacro" target="_blank" rel="noopener noreferrer">YouTube</a></li><li><a href="https://twitter.com/qmacro" target="_blank" rel="noopener noreferrer">Twitter</a></li><li><a href="/feed.xml" target="_blank" rel="noopener noreferrer">RSS</a></li></ul></div></footer></div><script src="/assets/main.31d6cfe0d16ae931b73c.js"></script></body></html>