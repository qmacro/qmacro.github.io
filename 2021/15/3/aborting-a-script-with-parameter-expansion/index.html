<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Aborting a script with parameter expansion</title>
    <meta name="description" content="Reserving the right to be wrong.">
    <link rel="stylesheet" href="/blog/css/index.css">
    <link rel="stylesheet" href="/blog/css/prism-base16-monokai.dark.css">
    <link rel="alternate" href="/blog/feed/feed.xml" type="application/atom+xml" title="DJ Adams">
    <link rel="alternate" href="/blog/feed/feed.json" type="application/json" title="DJ Adams">
    <link href="https://unpkg.com/prismjs@1.20.0/themes/prism-okaidia.css" rel="stylesheet">
  </head>
  <body>
    <header>
      <h1 class="home"><a href="/blog/">DJ Adams</a></h1>
      <ul class="nav">
        <li class="nav-item"><a href="/blog/">Home</a></li>
        <li class="nav-item"><a href="/blog/about/">About</a></li>
        <li class="nav-item"><a href="/blog/posts/">Archive</a></li>
        <li class="nav-item"><a href="/blog/tags/">Tags</a></li>
      </ul>
    </header>

    <main class="tmpl-post">
      <h1>Aborting a script with parameter expansion</h1>

<time datetime="2021-03-15">15 Mar 2021</time><a href="/blog/tags/autodidactics/" class="post-tag">autodidactics</a><a href="/blog/tags/shell/" class="post-tag">shell</a>

<p><em>Use the :? form of shell parameter expansion to abort a script if a required parameter value is not set.</em></p>
<p>I'm attracted to the somewhat arcane details of <a href="https://www.gnu.org/software/bash/manual/html_node/Shell-Expansions.html">Bash shell expansions</a> and it was while looking up something completely different (more on that another time) that I decided to re-read the <a href="https://www.gnu.org/software/bash/manual/html_node/Shell-Parameter-Expansion.html">parameter expansion</a> section of the GNU Bash manual.</p>
<p>In many of my scripts, like a good shell scripting citizen I check to ensure that there's a value for a parameter I want to use, and if there isn't, I abort with a message. In this case, abort implies returning a non-zero code, indicating failure.</p>
<p>The most recent example is in a little script that I've started to use to retrieve the image related to a YouTube live stream episode; this requires the YouTube video ID. The relevant part of this <a href="https://github.com/qmacro/dotfiles/blob/master/scripts/getepisodeimage"><code>getepisodeimage</code></a> script currently looks like this:</p>
<pre class="language-bash"><code class="language-bash"><span class="token comment"># Requires YouTube video ID</span><br><span class="token builtin class-name">readonly</span> <span class="token assign-left variable">id</span><span class="token operator">=</span><span class="token variable">$1</span><br><br><span class="token keyword">if</span> <span class="token punctuation">[</span> -z <span class="token string">"<span class="token variable">$id</span>"</span> <span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token keyword">then</span><br>  <span class="token builtin class-name">echo</span> <span class="token string">"Usage: <span class="token variable">$scriptname</span> &lt;YOUTUBE VIDEO ID>"</span><br>  <span class="token builtin class-name">exit</span> <span class="token number">1</span><br><span class="token keyword">fi</span></code></pre>
<p>(And yes, before you say it, I could have saved myself the execution of a binary by replacing the <code>[ ... ]</code> with <code>[[ ... ]]</code>. If you're curious, see <a href="https://qmacro.org/autodidactics/2020/08/21/open-square-bracket/">The open square bracket [ is an executable</a>.)</p>
<p>Anyway, rather than test for the emptiness of the value of the <code>id</code> parameter (with <code>-z</code>), in a standalone <code>if ... fi</code> section, I could have used the following shell parameter expansion pattern:</p>
<pre class="language-bash"><code class="language-bash"><span class="token variable">${parameter<span class="token operator">:?</span>word}</span></code></pre>
<p>The description for this is as follows:</p>
<blockquote>
<p>If parameter is null or unset, the expansion of word (or a message to that effect if word is not present) is written to the standard error and the shell, if it is not interactive, exits. Otherwise, the value of parameter is substituted.</p>
</blockquote>
<p>I've written about another shell parameter expansion pattern before (see <a href="https://qmacro.org/autodidactics/2020/09/27/shell-parameter-expansion-with-+/">Shell parameter expansion with :+ is useful</a>) but I'd forgotten about this one.</p>
<p>Using this pattern, I can replace the code above with this:</p>
<pre class="language-bash"><code class="language-bash"><span class="token builtin class-name">readonly</span> <span class="token assign-left variable">id</span><span class="token operator">=</span><span class="token variable">${1<span class="token operator">:?</span>Usage<span class="token operator">:</span> $scriptname &lt;YOUTUBE VIDEO ID>}</span></code></pre>
<p>Much more succinct - I like it!</p>

<hr>
<ul><li>Next: <a href="/blog/2021/25/3/a-new-journal-experiment-thinking-aloud/">A new journal experiment - Thinking Aloud</a></li><li>Previous: <a href="/blog/2021/7/2/fzf-the-basics-part-2-search-results/">fzf - the basics part 2 - search results</a></li>
</ul>

    </main>

    <footer></footer>

    <!-- Current page: /blog/2021/15/3/aborting-a-script-with-parameter-expansion/ -->
  </body>
</html>
