<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Session switching with the tmux menu</title>
    <meta name="description" content="Reserving the right to be wrong.">
    <link rel="stylesheet" href="/blog/css/index.css">
    <link rel="stylesheet" href="/blog/css/prism-base16-monokai.dark.css">
    <link rel="alternate" href="/blog/feed/feed.xml" type="application/atom+xml" title="DJ Adams">
    <link rel="alternate" href="/blog/feed/feed.json" type="application/json" title="DJ Adams">
    <link href="https://unpkg.com/prismjs@1.20.0/themes/prism-okaidia.css" rel="stylesheet">
  </head>
  <body>
    <header>
      <h1 class="home"><a href="/blog/">DJ Adams</a></h1>
      <ul class="nav">
        <li class="nav-item"><a href="/blog/">Home</a></li>
        <li class="nav-item"><a href="/blog/about/">About</a></li>
        <li class="nav-item"><a href="/blog/posts/">Archive</a></li>
        <li class="nav-item"><a href="/blog/tags/">Tags</a></li>
      </ul>
    </header>

    <main class="tmpl-post">
      <h1>Session switching with the tmux menu</h1>

<time datetime="2021-08-12">12 Aug 2021</time><a href="/blog/tags/autodidactics/" class="post-tag">autodidactics</a><a href="/blog/tags/tmux/" class="post-tag">tmux</a>

<p><em>Here's a way to get a simple session switcher in <code>tmux</code> using a popup menu.</em></p>
<p>I was looking at Waylon Walker's <a href="https://waylonwalker.com/tmux-fzf-session-jump/">tmux fzf session jumper</a> recently, and really liked it, so much so that I dug into the incantations that he shared, resulting in a new post on this autodidactics blog: <a href="https://qmacro.org/autodidactics/2021/08/06/tmux-output-formatting/">tmux output formatting</a>.</p>
<p>Anyway, I was still thinking about session switching yesterday, and randomly came across this Reddit post: <a href="https://www.reddit.com/r/tmux/comments/ot77fx/how_to_bring_up_context_menu_without_mouse/">how to bring up context menu without a mouse</a>. I'd seen the context menu before, by accidentally triggering it with the right mouse button, and it looks something like this:</p>
<p><img src="/blog/img/2021/08/context-menu.png" alt="context menu"></p>
<p>It was <a href="https://www.reddit.com/r/tmux/comments/ot77fx/how_to_bring_up_context_menu_without_mouse/h6tfadp/?utm_source=reddit&amp;utm_medium=web2x&amp;context=3">the comment by user Coffee_24_7</a> that really got me thinking - turns out that this type of menu can be called up with one of the myriad <code>tmux</code> commands, one which I hadn't yet come across: <code>display-menu</code>.</p>
<h2 id="building-a-context-menu" tabindex="-1">Building a context menu <a class="direct-link" href="#building-a-context-menu" aria-hidden="true">#</a></h2>
<p>I thought that using a context menu like this to present a list of sessions to switch to would be fun and teach me more about the <code>display-menu</code> command. Basically I just wanted to have the menu display the sessions I had, and when I'd selected one, switch me to it. So, this is what I did.</p>
<p>The first part of the <code>tmux</code> man page for the <code>display-menu</code> command looks like this:</p>
<blockquote>
<p>display-menu [-O] [-c target-client] [-t target-pane] [-T title] [-x position] [-y position] name key command</p>
</blockquote>
<blockquote>
<p>Display a menu on target-client.  target-pane gives the target for any commands run from the menu.</p>
</blockquote>
<blockquote>
<p>A menu is passed as a series of arguments: first the menu item name, second the key shortcut (or empty for none) and third the command to run when the menu item is chosen.  The name and command are formats, see the FORMATS and STYLES sections.  If the name begins with a hyphen (-), then the item is disabled (shown dim) and may not be chosen.  The name may be empty for a separator line, in which case both the key and command should be omitted.</p>
</blockquote>
<blockquote>
<p>-T is a format for the menu title (see FORMATS).</p>
</blockquote>
<p>So it looked like I would need something like this to have three sessions listed, with shortcut keys 1-3, and commands to switch to the selected one:</p>
<pre class="language-shell"><code class="language-shell">tmux display-menu <span class="token punctuation">\</span><br>  writing  <span class="token number">1</span> <span class="token string">'switch-client -t writing'</span> <span class="token punctuation">\</span><br>  dotfiles <span class="token number">2</span> <span class="token string">'switch-client -t dotfiles'</span> <span class="token punctuation">\</span><br>  focus    <span class="token number">3</span> <span class="token string">'switch-client -t focus'</span></code></pre>
<p>(The session names in this example are actually the permanent sessions I use right now.)</p>
<h3 id="listing-the-sessions" tabindex="-1">Listing the sessions <a class="direct-link" href="#listing-the-sessions" aria-hidden="true">#</a></h3>
<p>From the <a href="https://qmacro.org/autodidactics/2021/08/06/tmux-output-formatting/">tmux output formatting</a> post we already know how to do this. The basic <code>tmux list-sessions</code> command produces something like this:</p>
<pre><code>dotfiles: 2 windows (created Thu Aug 12 10:06:53 2021)
focus: 1 windows (created Wed Aug 11 10:44:18 2021)
writing: 1 windows (created Wed Aug 11 10:46:21 2021) (attached)
</code></pre>
<p>To get just the session names, I can supply a format with the <code>-F</code> option, like this (specifying <code>#S</code> for &quot;session name&quot;):</p>
<pre class="language-shell"><code class="language-shell">tmux list-sessions -F <span class="token string">'#S'</span></code></pre>
<p>This produces:</p>
<pre><code>dotfiles
focus
writing
</code></pre>
<h3 id="creating-the-input" tabindex="-1">Creating the input <a class="direct-link" href="#creating-the-input" aria-hidden="true">#</a></h3>
<p>For each of the menu entries, three values are needed - the session name, an incrementing identifier (which becomes the single key to press for selection), and the <code>switch-client</code> command to switch to the selected session. There are many ways to turn this list of sessions into something like this; I'm going to use <code>awk</code> here, for these reasons:</p>
<ul>
<li>I like <code>awk</code> and its history</li>
<li>it has a nice <code>NR</code> built-in variable that holds the record number being processed, and I can use it for the incrementing identifier</li>
<li>I can set <code>ORS</code>, the Output Record Separator (which is usually a newline), to a space, to avoid having to use something like <code>tr</code> or <code>paste</code> to bring everything onto one line afterwards</li>
</ul>
<p>The invocation now becomes:</p>
<pre class="language-shell"><code class="language-shell">tmux list-sessions -F <span class="token string">'#S'</span> <span class="token punctuation">\</span><br><span class="token operator">|</span> <span class="token function">awk</span> <span class="token string">'BEGIN {ORS=" "} {print $1, NR, "\"switch-client -t", $1 "\""}'</span></code></pre>
<p>This produces:</p>
<pre><code>dotfiles 1 &quot;switch-client -t dotfiles&quot; focus 2 &quot;switch-client -t focus&quot; writing 3 &quot;switch-client -t writing&quot;
</code></pre>
<h3 id="using-the-input-for-the-menu" tabindex="-1">Using the input for the menu <a class="direct-link" href="#using-the-input-for-the-menu" aria-hidden="true">#</a></h3>
<p>Now I can just pass that entire output, via the venerable <code>xargs</code>, to <code>tmux</code>'s <code>display-menu</code> command. While I'm at it, I'll use the <code>-T</code> option to supply a title for the top of the menu display.</p>
<p>This is what the invocation finally becomes:</p>
<pre class="language-shell"><code class="language-shell">tmux list-sessions -F <span class="token string">'#S'</span> <span class="token punctuation">\</span><br><span class="token operator">|</span> <span class="token function">awk</span> <span class="token string">'BEGIN {ORS=" "} {print $1, NR, "\"switch-client -t", $1 "\""}'</span> <span class="token punctuation">\</span><br><span class="token operator">|</span> <span class="token function">xargs</span> tmux display-menu -T <span class="token string">"Switch session"</span></code></pre>
<p>It's worth putting this in a script, so I have done: <a href="https://github.com/qmacro/dotfiles/commit/68ba9c0934b8c77af44ae9581171577225298814"><code>session-menu</code></a>.</p>
<h3 id="bind-the-menu-to-a-key" tabindex="-1">Bind the menu to a key <a class="direct-link" href="#bind-the-menu-to-a-key" aria-hidden="true">#</a></h3>
<p>The final touch in this learning experiment is to bind this invocation to a key in <code>tmux</code>, so that I can quickly invoke it. I'll choose &quot;prefix Ctrl-s&quot;, which means the line I need to <a href="https://github.com/qmacro/dotfiles/commit/a8b70a3e247590275eef8de23aa7ceb9da043d46">add to my config</a> looks like this:</p>
<pre><code>bind-key C-s run-shell session-menu
</code></pre>
<p>And with this in place, I can invoke the session switch menu popup very comfortably - this is what it looks like:</p>
<p><img src="/blog/img/2021/08/session-switch-menu.png" alt="session switch menu"></p>
<p>If I decide I don't want to switch sessions after all, I can just dismiss the menu with the standard key <code>q</code> (this is also in the <code>display-menu</code> part of the <code>tmux</code> man page).</p>
<hr>
<p>So there you have it. I do love <code>fzf</code> and all the things it can do, but it's worth spending some time on this native <code>tmux</code> feature. There's more to it, as well - for example, you can add separators and disabled items (like the ones in the first screenshot in this post) - but this will do me nicely for now. Happy multiplexing!</p>

<hr>
<ul><li>Next: <a href="/blog/2021/22/8/today-s-til-trio/">Today&#39;s TIL trio</a></li><li>Previous: <a href="/blog/2021/6/8/tmux-output-formatting/">tmux output formatting</a></li>
</ul>

    </main>

    <footer></footer>

    <!-- Current page: /blog/2021/12/8/session-switching-with-the-tmux-menu/ -->
  </body>
</html>
