<p><em>Having something to help me write better Dockerfiles is useful. Here's what I did to set up a Dockerfile linter in my development environment.</em></p>
<p>I'm writing more Dockerfiles, not least because I'm using a <a href="https://github.com/qmacro/dotfiles/tree/main/devcontainer">development container</a> for 95% of my daily work, but also because the dockerisation of tools and environments appeals to me greatly. I came across <a href="https://github.com/hadolint/hadolint">hadolint</a> which is a Dockerfile linter written in Haskell (hence the name, I guess).</p>
<p>I'm a <a href="https://qmacro.org/2021/05/19/supporting-developers-with-sponsorship/">big fan</a> of <a href="https://github.com/koalaman/shellcheck">shellcheck</a> (see the post <a href="https://qmacro.org/2020/10/05/improving-my-shell-scripting/">Improving my shell scripting</a>) and the structured way it communicates the information, warning and error messages with codes in a standard format (SCnnnn). So I was immediately attracted to <code>hadolint</code> in two ways - first, that it referenced <a href="https://github.com/koalaman/shellcheck">shellcheck</a>, but mostly because it implemented and managed its own <a href="https://github.com/hadolint/hadolint#rules">rules</a> in a very similar way - each of them with a code in a standard format (DLnnnn) and individually documented too, just like <code>shellcheck</code>.</p>
<p>There are different points in your workflow that you can integrate such a tool - these are nicely described in a dedicated <a href="https://github.com/hadolint/hadolint/blob/master/docs/INTEGRATION.md">integration</a> page. I wanted to have the linting happen in my editor, and am already using the <a href="https://github.com/dense-analysis/ale">Asynchronous Linting Engine</a> so it was quite straightforward. Here's what I did:</p>
<h2 id="install-hadolint" tabindex="-1">Install hadolint <a class="direct-link" href="#install-hadolint" aria-hidden="true">#</a></h2>
<p>I installed <code>hadolint</code> with Homebrew on my macOS host, and by pulling down the latest binary in the Dockerfile for my development container. It's a single executable, which is quite neat. I may look into using <code>hadolint</code> as a Docker image instead, although I didn't at this stage because of various reasons (mostly involving a recently introduced security policy on this work laptop that automatically stops the SSH daemon, rendering the <a href="https://qmacro.org/2021/06/12/remote-access-to-docker-on-my-synology-nas/">secure remote access to my Docker engine</a> useless. But that's a story for another time).</p>
<h2 id="set-up-hadolint-as-a-linter" tabindex="-1">Set up hadolint as a linter <a class="direct-link" href="#set-up-hadolint-as-a-linter" aria-hidden="true">#</a></h2>
<p>I already use various tools for linting my content - <code>shellcheck</code>, <code>yamllint</code> and <a href="https://qmacro.org/2021/05/14/notes-on-markdown-linting-part-2/">markdownlint</a>, and have configuration set up for that, so I just <a href="https://github.com/qmacro/dotfiles/commit/a2a3439956dc0eba7b6e8bc2e44eec0411284110">added <code>hadolint</code> to the list</a>, which now looks like this:</p>
<pre class="language-vim"><code class="language-vim"><span class="token keyword">let</span> g<span class="token punctuation">:</span>ale_linters <span class="token operator">=</span> <span class="token punctuation">{</span><br>      \ <span class="token string">'sh'</span><span class="token punctuation">:</span>         <span class="token punctuation">[</span><span class="token string">'shellcheck'</span><span class="token punctuation">,</span> <span class="token string">'language_server'</span><span class="token punctuation">]</span><span class="token punctuation">,</span><br>      \ <span class="token string">'yaml'</span><span class="token punctuation">:</span>       <span class="token punctuation">[</span><span class="token string">'yamllint'</span><span class="token punctuation">]</span><span class="token punctuation">,</span><br>      \ <span class="token string">'markdown'</span><span class="token punctuation">:</span>   <span class="token punctuation">[</span><span class="token string">'markdownlint'</span><span class="token punctuation">]</span><span class="token punctuation">,</span><br>      \ <span class="token string">'dockerfile'</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">'hadolint'</span><span class="token punctuation">]</span><span class="token punctuation">,</span><br>      \ <span class="token punctuation">}</span></code></pre>
<p>Because I sometimes create Dockerfiles with different names, I also added a new section to my Vim configuration telling it that these files are also to be treated as Dockerfiles:</p>
<pre class="language-vim"><code class="language-vim">augroup filetypes<br>  au<span class="token operator">!</span><br>  <span class="token builtin">autocmd</span> BufNewFile<span class="token punctuation">,</span>BufRead Dockerfile<span class="token operator">*</span> <span class="token keyword">set</span> <span class="token keyword">filetype</span><span class="token operator">=</span>dockerfile<br>augroup END</code></pre>
<p>Now I get lovely warnings and errors in the left hand column so that I can improve:</p>
<p><img src="/blog/img/2021/12/hadolint.png" alt="warnings and errors in my editor from hadolint"></p>
<p>In case you're wondering, the message details are shown at the bottom of my editor when I select the lines, and they are (in order):</p>
<ul>
<li><a href="https://github.com/hadolint/hadolint/wiki/DL3007">DL3007</a> Using latest is prone to errors if the image will ever update. Pin the version explicitly to a release tag.</li>
<li><a href="https://github.com/hadolint/hadolint/wiki/DL4000">DL4000</a> MAINTAINER is deprecated.</li>
<li><a href="https://github.com/hadolint/hadolint/wiki/DL4006">DL4006</a> Set the SHELL option -o pipefail before RUN with a pipe in</li>
</ul>
<p>All very helpful - thanks <code>hadolint</code>!</p>
