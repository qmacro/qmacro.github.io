<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>The open square bracket [ is an executable</title>
    <meta name="description" content="Reserving the right to be wrong.">
    <link rel="stylesheet" href="/blog/css/index.css">
    <link rel="stylesheet" href="/blog/css/prism-base16-monokai.dark.css">
    <link rel="alternate" href="/blog/feed/feed.xml" type="application/atom+xml" title="DJ Adams">
    <link rel="alternate" href="/blog/feed/feed.json" type="application/json" title="DJ Adams">
    <link href="https://unpkg.com/prismjs@1.20.0/themes/prism-okaidia.css" rel="stylesheet">
  </head>
  <body>
    <header>
      <h1 class="home"><a href="/blog/">DJ Adams</a></h1>
      <ul class="nav">
        <li class="nav-item"><a href="/blog/">Home</a></li>
        <li class="nav-item"><a href="/blog/about/">About</a></li>
        <li class="nav-item"><a href="/blog/posts/">Archive</a></li>
        <li class="nav-item"><a href="/blog/tags/">Tags</a></li>
      </ul>
    </header>

    <main class="tmpl-post">
      <h1>The open square bracket [ is an executable</h1>

<time datetime="2020-08-21">21 Aug 2020</time><a href="/blog/tags/autodidactics/" class="post-tag">autodidactics</a><a href="/blog/tags/unix/" class="post-tag">unix</a>

<p><em>In a shell script, the <code>[</code> symbol is not syntax, it's an executable</em></p>
<p>In my <a href="https://www.youtube.com/watch?v=Ct-uiu3RRZs">live stream episode</a> this morning I added to a function so that it looked like this:</p>
<pre class="language-shell"><code class="language-shell"><span class="token function-name function">getservicekey</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>  <span class="token builtin class-name">local</span> <span class="token assign-left variable">instance</span><span class="token operator">=</span><span class="token variable">${1}</span><br>  <span class="token builtin class-name">local</span> <span class="token assign-left variable">servicekey</span><span class="token operator">=</span><span class="token variable">${2}</span><br>  <span class="token builtin class-name">local</span> <span class="token function">file</span><br>  <span class="token assign-left variable">file</span><span class="token operator">=</span><span class="token string">"<span class="token variable">${instance}</span>-<span class="token variable">${servicekey}</span>.json"</span><br>  <span class="token keyword">if</span> <span class="token punctuation">[</span> -r <span class="token string">"<span class="token variable">${file}</span>"</span> <span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token keyword">then</span><br>    <span class="token function">cat</span> <span class="token string">"<span class="token variable">${file}</span>"</span><br>  <span class="token keyword">else</span><br>    cf service-key <span class="token string">"<span class="token variable">${instance}</span>"</span> <span class="token string">"<span class="token variable">${servicekey}</span>"</span> <span class="token operator">|</span> <span class="token function">sed</span> <span class="token string">'1,2d'</span><br>  <span class="token keyword">fi</span><br><span class="token punctuation">}</span></code></pre>
<p>Looking at that condition <code>if [ -r &quot;${file}&quot; ]</code> one would think that the <code>[ ... ]</code> part is just some shell syntax to glue things together (to contain the expression under evaluation), part of the family of symbols including double quotes, semicolons and others.</p>
<p>But no. In a wonderfully quirky way, <code>[</code> is actually a command, an executable. I remember seeing an odd character in my <code>/bin/</code> directory a while back:</p>
<pre><code>▶ ls /bin
[               dash            expr            ln              pwd             sync
bash            date            hostname        ls              rm              tcsh
cat             dd              kill            mkdir           rmdir           test
chmod           df              ksh             mv              sh              unlink
cp              echo            launchctl       pax             sleep           wait4path
csh             ed              link            ps              stty            zsh
</code></pre>
<p>Check out that <code>[</code> entry!</p>
<p>Turns out that <code>[</code> is a synonym for <code>test</code>. You can ask for the manual page for <code>[</code> and you get something that covers <code>[</code> and <code>test</code>:</p>
<pre class="language-shell"><code class="language-shell">▶ <span class="token function">man</span> <span class="token punctuation">[</span><br><br>NAME<br>     test, <span class="token punctuation">[</span> -- condition evaluation utility<br><br>SYNOPSIS<br>     <span class="token builtin class-name">test</span> expression<br>     <span class="token punctuation">[</span> expression <span class="token punctuation">]</span><br><br>DESCRIPTION<br>     The <span class="token builtin class-name">test</span> utility evaluates the expression and, <span class="token keyword">if</span> it evaluates to true, returns a zero<br>     <span class="token punctuation">(</span>true<span class="token punctuation">)</span> <span class="token builtin class-name">exit</span> status<span class="token punctuation">;</span> otherwise it returns <span class="token number">1</span> <span class="token punctuation">(</span>false<span class="token punctuation">)</span>.  If there is no expression, <span class="token builtin class-name">test</span> also<br>     returns <span class="token number">1</span> <span class="token punctuation">(</span>false<span class="token punctuation">)</span>.<br><br>     <span class="token punctuation">..</span>.</code></pre>
<p>Indeed, if you compare the two files <code>/bin/[</code> and <code>/bin/test</code>, they're the same.</p>
<p>The <code>if</code> statement above can be rewritten with the <code>test</code> synonym like this: <code>if test -r &quot;${file}&quot;</code>, but now I know that <code>[</code> is an actual executable, I'll take great delight in using it more.</p>
<p>Post Script: As well as being an executable, <code>[</code> is also built in to many shells these days, so incurs no performance penalty on use that an external command would otherwise do.</p>

<hr>
<ul><li>Next: <a href="/blog/2020/25/8/you-can-mask-sensitive-hostnames-with-wildcards-and-host-aliases/">You can mask sensitive hostnames with wildcards and host aliases</a></li><li>Previous: <a href="/blog/2020/16/8/why-we-have-bin-and-usr-bin/">Why we have /bin/ and /usr/bin/</a></li>
</ul>

    </main>

    <footer></footer>

    <!-- Current page: /blog/2020/21/8/the-open-square-bracket-is-an-executable/ -->
  </body>
</html>
