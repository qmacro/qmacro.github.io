<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>&#39;Coffeeshop&#39; - lightweight HTTP-based pubsub</title>
    <meta name="description" content="Reserving the right to be wrong.">
    <link rel="stylesheet" href="/blog/css/index.css">
    <link rel="stylesheet" href="/blog/css/prism-base16-monokai.dark.css">
    <link rel="alternate" href="/blog/feed/feed.xml" type="application/atom+xml" title="DJ Adams">
    <link rel="alternate" href="/blog/feed/feed.json" type="application/json" title="DJ Adams">
    <link href="https://unpkg.com/prismjs@1.20.0/themes/prism-okaidia.css" rel="stylesheet">
  </head>
  <body>
    <header>
      <h1 class="home"><a href="/blog/">DJ Adams</a></h1>
      <ul class="nav">
        <li class="nav-item"><a href="/blog/">Home</a></li>
        <li class="nav-item"><a href="/blog/about/">About</a></li>
        <li class="nav-item"><a href="/blog/posts/">Archive</a></li>
        <li class="nav-item"><a href="/blog/tags/">Tags</a></li>
      </ul>
    </header>

    <main class="tmpl-post">
      <h1>&#39;Coffeeshop&#39; - lightweight HTTP-based pubsub</h1>

<time datetime="2009-07-27">27 Jul 2009</time><a href="/blog/tags/appengine/" class="post-tag">appengine</a><a href="/blog/tags/coffeeshop/" class="post-tag">coffeeshop</a><a href="/blog/tags/http/" class="post-tag">http</a><a href="/blog/tags/icf/" class="post-tag">icf</a><a href="/blog/tags/pubsub/" class="post-tag">pubsub</a><a href="/blog/tags/rest/" class="post-tag">rest</a><a href="/blog/tags/sap/" class="post-tag">sap</a>

<p>‘<em><a href="http://wiki.github.com/qmacro/coffeeshop">Coffeeshop</a></em>‘ is a lightweight, REST-orientated HTTP-based publish/subscribe implementation that I’ve been working on for the last few days. It is a culmination of:</p>
<ul>
<li>an <a href="http://www.pipetree.com/jabber/jep-0024.html">early</a> and long-standing interest in pubsub</li>
<li>a fascination with using HTTP properly, i.e. as an application protocol, not a transport protocol</li>
<li>an excuse to experiment in the area of <a href="http://blog.webhooks.org/">webhooks<br>
</a></li>
<li>a desire to learn more about Google’s <a href="http://code.google.com/appengine/">App Engine</a> as a cloud platform, and more specifically as an HTTP runtime platform, much like SAP’s Internet Communication Framework (ICF)</li>
</ul>
<p>There seems to be a growing interest in pubsub and webhooks; one recent article in particular – “<a href="http://dashes.com/anil/2009/07/the-pushbutton-web-realtime-becomes-real.html">The Pushbutton Web: Realtime Becomes Real</a>” conveys a lot of the ideas behind these concepts.</p>
<p>With <a href="http://wiki.github.com/qmacro/coffeeshop"><em>coffeeshop</em></a>, entities — Channels, Subscribers and Messages — are resources, with URLs. You interact with entities using the appropriate HTTP methods. The implementation, being HTTP, is both browser-based (human-facing), and agent-based (program-facing). You can navigate the resources with your web-browser. You can interact with the resources with <a href="http://curl.haxx.se/">cURL</a>, <a href="http://search.cpan.org/~gaas/libwww-perl-5.830/bin/lwp-request">POST</a>, or your favourite HTTP library.</p>
<p>Here’s a simple example:</p>
<blockquote>
<h1 id="create-channel:-greater-echo-&quot;test-channel&quot;-or-post-se-http:giant:8888channel-post-http:giant:8888channel-greater-201-created-location:-channel5-greater-add-to-channel-a-new-subscriber-with-greater-a-callback-resource-of-http:atom:8081subscriberalpha-greater-**echo-&quot;namealphaandresourcehttp:giant:8081subscriberalpha&quot;-**-greater-or-post-se-http:giant:8888channel1subscriber-post-http:giant:8888channel1subscriber-greater-201-created-location:-channel1subscriber2-greater-publish-a-message-to-the-channel-greater-echo-&quot;hello-world&quot;-or-post-se-http:giant:8888channel1-post-http:giant:8888channel1-greater-302-moved-temporarily-location:-http:giant:8888channel1messageahfxbwfjcm8ty29mzmvlc...rgida" tabindex="-1">Create Channel: &gt; <strong>echo &quot;Test Channel&quot; | POST -Se <a href="http://giant:8888/channel/">http://giant:8888/channel/</a></strong> POST <a href="http://giant:8888/channel/">http://giant:8888/channel/</a> --&gt; 201 Created Location: /channel/5/ &gt; # Add to Channel a new Subscriber with &gt; # a callback resource of <a href="http://atom:8081/subscriber/alpha">http://atom:8081/subscriber/alpha</a> &gt; **echo &quot;name=alpha&amp;resource=http://giant:8081/subscriber/alpha&quot; ** &gt; <strong>| POST -Se <a href="http://giant:8888/channel/1/subscriber/">http://giant:8888/channel/1/subscriber/</a></strong> POST <a href="http://giant:8888/channel/1/subscriber/">http://giant:8888/channel/1/subscriber/</a> --&gt; 201 Created Location: /channel/1/subscriber/2/ &gt; # Publish a Message to the Channel &gt; <strong>echo &quot;hello, world&quot; | POST -Se <a href="http://giant:8888/channel/1/">http://giant:8888/channel/1/</a></strong> POST <a href="http://giant:8888/channel/1/">http://giant:8888/channel/1/</a> --&gt; 302 Moved Temporarily Location: <a href="http://giant:8888/channel/1/message/ahFxbWFjcm8tY29mZmVlc%5B...%5DRgIDA">http://giant:8888/channel/1/message/ahFxbWFjcm8tY29mZmVlc[...]RgIDA</a> <a class="direct-link" href="#create-channel:-greater-echo-&quot;test-channel&quot;-or-post-se-http:giant:8888channel-post-http:giant:8888channel-greater-201-created-location:-channel5-greater-add-to-channel-a-new-subscriber-with-greater-a-callback-resource-of-http:atom:8081subscriberalpha-greater-**echo-&quot;namealphaandresourcehttp:giant:8081subscriberalpha&quot;-**-greater-or-post-se-http:giant:8888channel1subscriber-post-http:giant:8888channel1subscriber-greater-201-created-location:-channel1subscriber2-greater-publish-a-message-to-the-channel-greater-echo-&quot;hello-world&quot;-or-post-se-http:giant:8888channel1-post-http:giant:8888channel1-greater-302-moved-temporarily-location:-http:giant:8888channel1messageahfxbwfjcm8ty29mzmvlc...rgida" aria-hidden="true">#</a></h1>
</blockquote>
<p>As you can see from this example, POSTing to the Channel container resource</p>
<p>/channel/</p>
<p>creates a new Channel, POSTing to the Channel 1 subscriber container resource</p>
<p>/channel/1/subscriber/</p>
<p>creates a new Subscriber, and POSTing to the Channel 1 channel resource</p>
<p>/channel/1/</p>
<p>creates a new Message, which is delivered to the Channel’s Subscribers. The resource returned to a Message POST is that Message’s unique address</p>
<p>/channel/1/message/ahFxbWFjcm8tY29mZmVlc[...]RgIDA</p>
<p>where the details of that Message, including the Delivery status(es), can be seen.</p>
<p>For more information on the resources and methods, have a look at the <a href="http://wiki.github.com/qmacro/coffeeshop/resourceplan">ResourcePlan</a> page.</p>
<p>I’m using Google App Engine’s <a href="http://googleappengine.blogspot.com/2009/06/new-task-queue-api-on-google-app-engine.html">Task Queue API</a> to have the Messages delivered to their (webhook-alike) endpoints <strong>asynchronously</strong>.</p>
<p>The code is early and rough, and <a href="http://wiki.github.com/qmacro/coffeeshop">available on github</a>. You can download it and try it out for yourself locally or create an app on App Engine cloud domain <a href="http://appspot.com">appspot.com</a>. I’ll probably publish a public-facing instance of this implementation in the next few days. All comments and feedback appreciated.</p>
<p>One last thing: I know of at least a couple of HTTP-based pubsub implementations: <a href="http://code.google.com/p/pubsubhubbub/">pubsubhubbub</a>, and <a href="http://watercoolr.nuklei.com/">Watercoolr</a>. Both are great, but for me, the former is a little complex (and ATOM-orientated), whereas the latter I thought could be more RESTian in its approach (hence <a href="http://wiki.github.com/qmacro/coffeeshop"><em>coffeeshop</em></a>).</p>

<hr>
<ul><li>Next: <a href="/blog/2009/28/7/first-coffeeshop-demo-screencast/">First coffeeshop demo screencast</a></li><li>Previous: <a href="/blog/2009/29/6/information-vs-behaviour/">Information vs Behaviour</a></li>
</ul>

    </main>

    <footer></footer>

    <!-- Current page: /blog/2009/27/7/coffeeshop-lightweight-http-based-pubsub/ -->
  </body>
</html>
