<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>An HTTP connector for Tarpipe: &#39;tarbridge&#39;</title>
    <meta name="description" content="Reserving the right to be wrong.">
    <link rel="stylesheet" href="/blog/css/index.css">
    <link rel="stylesheet" href="/blog/css/prism-base16-monokai.dark.css">
    <link rel="alternate" href="/blog/feed/feed.xml" type="application/atom+xml" title="DJ Adams">
    <link rel="alternate" href="/blog/feed/feed.json" type="application/json" title="DJ Adams">
    <link href="https://unpkg.com/prismjs@1.20.0/themes/prism-okaidia.css" rel="stylesheet">
  </head>
  <body>
    <header>
      <h1 class="home"><a href="/blog/">DJ Adams</a></h1>
      <ul class="nav">
        <li class="nav-item"><a href="/blog/">Home</a></li>
        <li class="nav-item"><a href="/blog/about/">About</a></li>
        <li class="nav-item"><a href="/blog/posts/">Archive</a></li>
        <li class="nav-item"><a href="/blog/tags/">Tags</a></li>
      </ul>
    </header>

    <main class="tmpl-post">
      <h1>An HTTP connector for Tarpipe: &#39;tarbridge&#39;</h1>

<time datetime="2009-04-24">24 Apr 2009</time><a href="/blog/tags/bridge/" class="post-tag">bridge</a><a href="/blog/tags/email/" class="post-tag">email</a><a href="/blog/tags/http/" class="post-tag">http</a><a href="/blog/tags/smtp/" class="post-tag">smtp</a><a href="/blog/tags/tarbridge/" class="post-tag">tarbridge</a><a href="/blog/tags/tarpipe/" class="post-tag">tarpipe</a>

<p>One thing that Tarpipe would really benefit from is a connector that would enable an HTTP request (I’m thinking of POST, here) to be made on an arbitrary resource (URL). This is something that <a href="http://getsatisfaction.com/tarpipe/topics/a_rest_connector">other people have already mentioned</a> — and the Tarpipe folks are certainly working on it.</p>
<p>I couldn’t wait, however, and thought I’d have a bit of fun building an HTTP connector. I don’t have access to Tarpipe’s sources, so I had to go a roundabout route. Tarpipe has a Mailer connector, which enables emails to be sent from within a workflow. So I built a very simple email-to-HTTP-POST mechanism ‘tarbridge’. This way, you can use the Mailer connector to send an email like this:</p>
<pre><code>Recipient: tarbridge+&lt;token&gt;@pipetree.com
 Subject: the URL to POST to and an optional content-type
 Body: the payload of the HTTP POST
</code></pre>
<p>and an HTTP POST will be made to the URL specified. You’ll even get an email reply with the HTTP response.</p>
<p>Here’s an example workflow that receives an email containing something to bookmark in Delicious. It uses the Delicious connector, and also makes an HTTP POST to a little test application (running on a local devserver version of the excellent <a href="http://code.google.com/appengine/">Google AppEngine</a>, fwiw) via tarbridge.</p>
<p><img src="/blog/img/2009/04/tarpipebridgetest1-300x134.jpg" alt="image"></p>
<p>The Subject of the email contains the URL to make the HTTP POST to. By default the Content-Type will be set to application/x-www-form-urlencoded, but you can override this by specifying a different content type (here I’ve specified text/plain) as a second parameter in the Subject.</p>
<p>The addressee of the email is ‘tarbridge+<some token>@pipetree.com’. I’ve used this approach so I can control what goes through this tarbridge mechanism. A token is associated with an email address, to which the HTTP response is sent in reply.</p>
<p>The body of the email is what’s send as the payload in the HTTP request.</p>
<p>So sending this email to the Tarpipe workflow above:</p>
<p>From: DJ Adams <a href="mailto:dj@pipetree.com">dj@pipetree.com</a> To: <a href="mailto:bury69xxxx@tarpipe.net">bury69xxxx@tarpipe.net</a> Subject: <a href="http://blog.tarpipe.com">http://blog.tarpipe.com</a> Tarpipe blog</p>
<p>results in this Delicious entry:</p>
<p><img src="/blog/img/2009/04/tarpipeblogurlondelicious-300x196.png" alt="image"></p>
<p>and this email sent, via the Mailer connector, to the tarbridge mechanism:</p>
<pre><code>To: tarbridge+token@pipetree.com Subject: http://www.pipetree.com:8888/feed/ text/plain From: tarpipe mailer &lt;mailer@tarpipe.net&gt; http://blog.tarpipe.com http://del.icio.us/url/95948a42d8777b46278d4da333345473
</code></pre>
<p>which in turn results in an HTTP POST being made like this:</p>
<pre><code>POST /feed/ HTTP/1.1 User-Agent: tarbridge/0.1 libwww-perl/5.812 Host: www.pipetree.com:8888 Content-Type: text/plain [...] http://blog.tarpipe.com http://del.icio.us/url/95948a42d8777b46278d4da333345473
</code></pre>
<p>The result of the HTTP POST is emailed back like this:</p>
<pre><code>Subject: Re: http://www.pipetree.com:8888/feed/ text/plain To: DJ Adams &lt;dj.adams@pobox.com&gt; From: tarbridge+token@pipetree.com

HTTP/1.0 201 Created Date: Fri, 24 Apr 2009 10:06:55 GMT Location: http://www.pipetree.com:8888/feed/test-feed-1/agtmZWVkYnVpbGRlc[...] [...]
</code></pre>
<p>So if you were really crazy you could even feed that response back into the Tarpipe loop, using a second workflow (hmm, Tarpipe could do with a string parsing connector too :-)</p>
<p>The tarbridge mechanism is just a little Perl script that’s triggered via <a href="http://www.procmail.org">Procmail</a>. I’m running <a href="http://www.ubuntu.com">Ubuntu</a> on <a href="http://pipetree.com">pipetree.com</a> so it was just a question of configuring <a href="http://www.postfix.org">Postfix</a> to use Procmail for delivery, and writing a .procmailrc rule like this:</p>
<p>:0 c | ~/handler.pl 2&gt;&gt; ~/tarbridge.log</p>
<p>If you’re interested in trying this out using my (pipetree) instance of this tarbridge, please email me and I’ll set you up with a token. Usual caveats apply. And remember, this is only in lieu of a real HTTP connector which I hope is coming soon from Tarpipe!</p>

<hr>
<ul><li>Next: <a href="/blog/2009/25/4/sap-everywhere/">SAP everywhere!</a></li><li>Previous: <a href="/blog/2009/21/4/tarpipe-com-programming-2-0/">tarpipe.com - Programming 2.0?</a></li>
</ul>

    </main>

    <footer></footer>

    <!-- Current page: /blog/2009/24/4/an-http-connector-for-tarpipe-tarbridge/ -->
  </body>
</html>
