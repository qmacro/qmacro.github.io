<!doctype html><html lang="en"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1"><link rel="canonical" href="https://qmacro.org/blog/posts/2024/03/12/iso-content-for-common-cap-types/"><link rel="alternate" type="application/atom+xml" title="DJ's Weblog - Feed" href="https://qmacro.org/feed.xml"><link href="/assets/main.bed7db4098e5e4fe9224.css" rel="stylesheet"><link rel="preconnect" href="https://fonts.gstatic.com"><link href="https://fonts.googleapis.com/css2?family=IBM+Plex+Sans&display=swap" rel="stylesheet"><title>ISO content for common CAP types | DJ Adams</title><link rel="icon" type="“image/x-icon”" href="/images/favicon.ico"><meta property="og:title" content="ISO content for common CAP types"><meta property="og:site_name" content="DJ Adams"><meta property="og:type" content="website"><meta property="og:url" content="https://qmacro.org/blog/posts/2024/03/12/iso-content-for-common-cap-types/"><meta name="description" content="ISO content for common CAP types 12 Mar 2024 | 14 min read There&#39;s an NPM package that provides default content based on the ISO..."><meta property="og:description" content="ISO content for common CAP types 12 Mar 2024 | 14 min read There&#39;s an NPM package that provides default content based on the ISO..."><meta name="description" content="ISO content for common CAP types 12 Mar 2024 | 14 min read There&#39;s an NPM package that provides default content based on the ISO..."><meta property="og:image" content="https://qmacro.org/images/site-image.png"><script src="https://cdn.jsdelivr.net/npm/mermaid/dist/mermaid.min.js"></script><script>mermaid.initialize({startOnLoad:true});</script><script async src="https://www.googletagmanager.com/gtag/js?id=G-4WQKBG0L4Y"></script><script>window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());

      gtag('config', 'G-4WQKBG0L4Y');</script></head><body><div class="layout-wrapper"><header class="header"><div class="header__content"><h1 class="site-title"><a href="/">DJ Adams</a></h1><nav class="nav"><ul class="nav__list"><li class="nav-item"><a href="/about">About Me</a></li><li class="nav-item"><a href="/blog">Blog</a></li><li class="nav-item"><a href="/feed.xml">Feed</a></li></ul></nav></div></header><main class="main"><article class="post"><header class="post__header"><h1>ISO content for common CAP types</h1><div class="post__details"><time datetime="2024-03-12">12 Mar 2024 </time><span>| </span><span>14 min read</span></div></header><main class="post__content"><p>There's an NPM package that provides default content based on the ISO specifications for CAP common types for countries, languages, currencies and timezones. In this post I explore what that package is and how it works. The post is quite long, mostly because I fell down a rabbit hole and was stuck there for quite a while. Hopefully though it's something you might enjoy. Happy exploring!</p><p>Update 15 Mar 2024: In this morning's Hands-on SAP Dev live stream we added this feature to our test project, so you can <a href="https://www.youtube.com/live/8BMASRcs0Hg?si=OvCZdO8McwwWBL5R&amp;t=2567">see this whole thing in action</a>.</p><p><a name="background"></a></p><h1>Background</h1><p>Earlier this month in <a href="https://www.youtube.com/watch?v=kgycosxv9aQ">part 7</a> of our <a href="https://www.youtube.com/playlist?list=PL6RpkC85SLQBHPdfHQ0Ry2TMdsT-muECx">back to basics Hands-on SAP Dev live stream series on CAP Node.js</a>, we added a new element <code>countryOfBirth</code> to the <code>Authors</code> entity definition, so that our simple <code>services.cds</code> looked like this:</p><pre class="language-cds"><code class="language-cds"><span class="token using keyword">using</span> { cuid, Country } <span class="token from keyword">from</span> '@sap/cds/common';<br><br><span class="token keyword">service</span> bookshop {<br>  <span class="token keyword">entity</span> Books : cuid {<br>    title: <span class="token type builtin">String</span>;<br>  }<br>  <span class="token keyword">entity</span> Authors : cuid {<br>    name: <span class="token type builtin">String</span>;<br>    countryOfBirth: Country;<br>  }<br>}</code></pre><p>This resulted in the generation of lots of DDL for a persistence layer, based on the definition of that <code>Country</code> type, which, in <code>@sap/cds/common</code>, looks like this (and I've also included here the definitions that are used to describe that type):</p><pre class="language-cds"><code class="language-cds"><span class="token cqlkeywords keyword">type</span> Country : <span class="token association-composition keyword">Association to sap</span>.common.Countries;<br><br><span class="token keyword">context</span> sap.common {<br><br>  <span class="token keyword">entity</span> Countries : CodeList {<br>    <span class="token cqlkeywords keyword">key</span> code : <span class="token type builtin">String(3)</span> <span class="token annotation important">@(title</span> : '{i18n>CountryCode}');<br>  }<br><br>  <span class="token keyword">aspect</span> CodeList <span class="token annotation important">@(</span><br>    cds.autoexpose,<br>    cds.persistence.skip : 'if-unused'<br>  ) {<br>    name  : localized <span class="token type builtin">String(255)</span>  <span class="token annotation important">@title</span> : '{i18n>Name}';<br>    descr : localized <span class="token type builtin">String(1000)</span> <span class="token annotation important">@title</span> : '{i18n>Description}';<br>  }<br><br>}</code></pre><p>As a result of referring to the <code>Country</code> type in <code>@sap/cds/common</code>, we saw this in the output of <code>cds watch</code>:</p><pre class="language-text"><code class="language-text">[cds] - loaded model from 2 file(s):<br><br>  services.cds<br>  [...]/node_modules/@sap/cds/common.cds</code></pre><blockquote><p>See the <a href="#appendix">Appendix - loading @sap/cds/common</a> section for an explanation of why <code>[...]</code> has been used as a path prefix indicator here.</p></blockquote><h2>New entity sets</h2><p>Additionally, we saw that as well as entity sets for the <code>Books</code> and <code>Authors</code> entities, the OData service also contained two more entity sets, as we can see from the service document (which can be obtained with <code>curl localhost:4004/odata/v4/bookshop | jq .</code>):</p><pre class="language-json"><code class="language-json"><span class="token punctuation">{</span><br>  <span class="token property">"@odata.context"</span><span class="token operator">:</span> <span class="token string">"$metadata"</span><span class="token punctuation">,</span><br>  <span class="token property">"@odata.metadataEtag"</span><span class="token operator">:</span> <span class="token string">"W/\"l+enQJd57takPctEB4NIbv/1U6KLaLMKeKijx7AfnOo=\""</span><span class="token punctuation">,</span><br>  <span class="token property">"value"</span><span class="token operator">:</span> <span class="token punctuation">[</span><br>    <span class="token punctuation">{</span><br>      <span class="token property">"name"</span><span class="token operator">:</span> <span class="token string">"Books"</span><span class="token punctuation">,</span><br>      <span class="token property">"url"</span><span class="token operator">:</span> <span class="token string">"Books"</span><br>    <span class="token punctuation">}</span><span class="token punctuation">,</span><br>    <span class="token punctuation">{</span><br>      <span class="token property">"name"</span><span class="token operator">:</span> <span class="token string">"Authors"</span><span class="token punctuation">,</span><br>      <span class="token property">"url"</span><span class="token operator">:</span> <span class="token string">"Authors"</span><br>    <span class="token punctuation">}</span><span class="token punctuation">,</span><br>    <span class="token punctuation">{</span><br>      <span class="token property">"name"</span><span class="token operator">:</span> <span class="token string">"Countries"</span><span class="token punctuation">,</span><br>      <span class="token property">"url"</span><span class="token operator">:</span> <span class="token string">"Countries"</span><br>    <span class="token punctuation">}</span><span class="token punctuation">,</span><br>    <span class="token punctuation">{</span><br>      <span class="token property">"name"</span><span class="token operator">:</span> <span class="token string">"Countries_texts"</span><span class="token punctuation">,</span><br>      <span class="token property">"url"</span><span class="token operator">:</span> <span class="token string">"Countries_texts"</span><br>    <span class="token punctuation">}</span><br>  <span class="token punctuation">]</span><br><span class="token punctuation">}</span></code></pre><p>as well as in the CAP server landing page:</p><p><img src="/images/2024/03/cap-server-landing-page.png" alt="The CAP server landing page showing the Books, Authors and Countries entity sets"></p><blockquote><p>For those of you wondering why <code>Countries_texts</code> is not listed in the CAP server landing page, there's an interesting reason, but that's a story for another time.</p></blockquote><h2>What about the data?</h2><p>The response to an OData query operation on the <code>Countries</code> entity set looked, however, like this:</p><pre class="language-json"><code class="language-json"><span class="token punctuation">{</span><br>  <span class="token property">"@odata.context"</span><span class="token operator">:</span> <span class="token string">"$metadata#Countries"</span><span class="token punctuation">,</span><br>  <span class="token property">"value"</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><br><span class="token punctuation">}</span></code></pre><p>No data.</p><p>On the one hand, that's understandable, we haven't supplied any. But on the other hand (and like the discussion which took place at the time mentioned) it would be great to have that data. Not only for the <code>Country</code> type, but also for the other CAP <a href="https://cap.cloud.sap/docs/cds/common#code-types">common reuse types</a> Currency, Language and Timezone.</p><p>After all, that data is standard, predictable and pretty much static. It's also something that we all take for granted in R/3 systems, for example, in these tables (and their related <code>-T</code> suffixed language-dependent siblings):</p><ul><li><code>T005</code> (countries)</li><li><code>TCUR</code> (currencies)</li><li><code>T002</code> (languages)</li><li><code>TTZZ</code> (timezones)</li></ul><p>In the out-of-the-box provisions from CAP, we don't have this data. But we do have the data in the form of a standard installable NPM package!</p><p>I'd totally forgotten about this, which is why I failed to mention it while we were discussing the question. So as a penance (not sure whether to me as the writer of this post, or to you as the reader, sorry) I'm writing up the details here now.</p><h1>NPM package @sap/cds-common-content</h1><p>The NPM package <a href="https://www.npmjs.com/package/@sap/cds-common-content">@sap/cds-common-content</a> <em>&quot;holds default content based on the ISO specification&quot;</em> for these exact types. Bingo!</p><p>The simplest way to make use of this package is to add it to your project:</p><pre class="language-shell"><code class="language-shell"><span class="token function">npm</span> <span class="token function">add</span> @sap/cds-common-content</code></pre><p>and then add a <code>using</code> directive in your CDS, such as:</p><pre class="language-cds"><code class="language-cds"><span class="token using keyword">using</span> <span class="token from keyword">from</span> '@sap/cds-common-content';</code></pre><blockquote><p>I prefer the semantics of invoking <code>npm add</code> over <code>npm install</code>, but as <code>add</code> is just an alias for <code>install</code>, it's all the same under the <code>npm</code> hood anyway.</p></blockquote><p>This all seems quite straightforward. So let's now move away from the customised bookshop project from the live stream series and start with a super simple example project, where we'll see how easy it is to get the data to appear. And it will seem like magic! Then we'll dig in to how it actually works, which will help us understand that bit more about how CAP works. And that's always a bonus, right?</p><h2>Simple example</h2><p>So, moving away from the authors and books in the previous <code>services.cds</code> file, we'll start with a brand new CAP project for this simple example, so you can follow along too if you want.</p><h3>Initialising a new CAP project with tiny-sample</h3><p>While initialising the new project, we'll use the <code>--add</code> option to request the addition of the &quot;tiny-sample&quot; facet which gives us a super simple service exposing a single <code>Books</code> entity, complete with a couple of data records supplied in a CSV file.</p><p>Here's an example of doing that, with the use of the <code>tree</code> command at the end to show the contents of the new project directory (excluding the hidden files):</p><pre class="language-shell"><code class="language-shell"><span class="token comment"># /home/user/work/scratch</span><br><span class="token punctuation">;</span> cds init <span class="token parameter variable">--add</span> tiny-sample iso-data-test<br>Creating new CAP project <span class="token keyword">in</span> ./iso-data-test<br><br>Adding feature <span class="token string">'nodejs'</span><span class="token punctuation">..</span>.<br>Adding feature <span class="token string">'tiny-sample'</span><span class="token punctuation">..</span>.<br><br>Successfully created project. Continue with <span class="token string">'cd iso-data-test'</span><span class="token builtin class-name">.</span><br>Find samples on https://github.com/SAP-samples/cloud-cap-samples<br>Learn about next steps at https://cap.cloud.sap<br><span class="token comment"># /home/user/work/scratch</span><br><span class="token punctuation">;</span> <span class="token builtin class-name">cd</span> iso-data-test/<br><span class="token comment"># /home/user/work/scratch/iso-data-test</span><br><span class="token punctuation">;</span> tree <span class="token parameter variable">-F</span><br><span class="token builtin class-name">.</span><br><span class="token operator">|</span>-- README.md<br><span class="token operator">|</span>-- app/<br><span class="token operator">|</span>-- db/<br><span class="token operator">|</span>   <span class="token operator">|</span>-- data/<br><span class="token operator">|</span>   <span class="token operator">|</span>   <span class="token variable"><span class="token variable">`</span>-- my.bookshop-Books.csv<br><span class="token operator">|</span>   <span class="token variable">`</span></span>-- data-model.cds<br><span class="token operator">|</span>-- package.json<br><span class="token variable"><span class="token variable">`</span>-- srv/<br>    <span class="token variable">`</span></span>-- cat-service.cds<br><br><span class="token number">5</span> directories, <span class="token number">5</span> files<br><span class="token comment"># /home/user/work/scratch/iso-data-test</span><br><span class="token punctuation">;</span></code></pre><blockquote><p>The <code>-F</code> option tells <code>tree</code> to use standard symbols to signify special files, as I want to highlight directories with a trailing <code>/</code>. This <code>-F</code> works in a similar way to the same-named option with the <code>ls</code> command.</p></blockquote><p>The persistence layer definitions in <code>db/data-model.cds</code> look like this:</p><pre class="language-cds"><code class="language-cds"><span class="token keyword">namespace</span> my.bookshop;<br><br><span class="token keyword">entity</span> Books {<br>  <span class="token cqlkeywords keyword">key</span> ID : <span class="token type builtin">Integer</span>;<br>  title  : <span class="token type builtin">String</span>;<br>  stock  : <span class="token type builtin">Integer</span>;<br>}</code></pre><p>and the service layer definitions in <code>srv/cat-service.cds</code> look like this:</p><pre class="language-cds"><code class="language-cds"><span class="token using keyword">using</span> my.bookshop <span class="token cqlkeywords keyword">as</span> my <span class="token from keyword">from</span> '../db/data-model';<br><br><span class="token keyword">service</span> CatalogService {<br>    <span class="token annotation important">@readonly</span> <span class="token keyword">entity</span> Books <span class="token cqlkeywords keyword">as</span> <span class="token cdl-keyword keyword">projection</span> <span class="token cqlkeywords keyword">on</span> my.Books;<br>}</code></pre><p>Nothing unexpected there, all nice and straightforward.</p><h3>Basic output from cds watch</h3><p>Starting the CAP server up at this point, we see (amongst other log lines):</p><pre class="language-text"><code class="language-text">[cds] - loaded model from 2 file(s):<br><br>  srv/cat-service.cds<br>  db/data-model.cds<br><br>[cds] - connect to db > sqlite { database: ':memory:' }<br>  > init from db/data/my.bookshop-Books.csv<br>/> successfully deployed to in-memory database.</code></pre><p>And the service document at <code>http://localhost:4004/odata/v4/catalog</code> looks like this:</p><pre class="language-json"><code class="language-json"><span class="token punctuation">{</span><br>  <span class="token property">"@odata.context"</span><span class="token operator">:</span> <span class="token string">"$metadata"</span><span class="token punctuation">,</span><br>  <span class="token property">"@odata.metadataEtag"</span><span class="token operator">:</span> <span class="token string">"W/\"8PKoOs3VhYwQoFzBoQObhMsFJJa5jpD1GLFcWZG9r60=\""</span><span class="token punctuation">,</span><br>  <span class="token property">"value"</span><span class="token operator">:</span> <span class="token punctuation">[</span><br>    <span class="token punctuation">{</span><br>      <span class="token property">"name"</span><span class="token operator">:</span> <span class="token string">"Books"</span><span class="token punctuation">,</span><br>      <span class="token property">"url"</span><span class="token operator">:</span> <span class="token string">"Books"</span><br>    <span class="token punctuation">}</span><br>  <span class="token punctuation">]</span><br><span class="token punctuation">}</span></code></pre><p>So far so good.</p><p>We've covered this in the <a href="https://www.youtube.com/playlist?list=PL6RpkC85SLQBHPdfHQ0Ry2TMdsT-muECx">back to basics series</a> but it's worth re-iterating here too ... the reason why we see these two files specifically:</p><pre class="language-text"><code class="language-text">srv/cat-service.cds<br>db/data-model.cds</code></pre><p>listed in the sources for the CDS model being served (see the &quot;loaded model from 2 file(s)&quot; message in the log output above), is that they're in some specially named directories (<code>db/</code> and <code>srv/</code>) that form part of CAP's convention-over-configuration approach to doing the right thing by developers. On startup, the server will automatically look in certain &quot;well-known&quot; locations for CDS definitions. What are these &quot;well-known&quot; locations?</p><p>You can ask to see them like this:</p><pre class="language-shell"><code class="language-shell">cds <span class="token function">env</span> folders</code></pre><p>which emits:</p><pre class="language-text"><code class="language-text">{ db: 'db/', srv: 'srv/', app: 'app/' }</code></pre><p>In fact, there's another environment value which it's possible to query, and that is <code>roots</code>:</p><pre class="language-shell"><code class="language-shell">cds <span class="token function">env</span> roots</code></pre><p>and the value returned:</p><pre class="language-text"><code class="language-text">[ 'db/', 'srv/', 'app/', 'schema', 'services' ]</code></pre><p>contains these three directory names, plus two special filenames <code>services</code> and <code>schema</code>, which we can interpret as <code>services.cds</code> and <code>schema.cds</code> respectively.</p><p>💡 This is incidentally why, in the simple <a href="https://github.com/qmacro/capb2b">capb2b</a> project we're using for the early episodes in the back to basics series, simply <a href="https://github.com/qmacro/capb2b/blob/aac1f7304e3d0884cfe837c3b0bbd4e6bf98a848/services.cds">putting all our content into a file called services.cds</a> works!</p><h3>Adding an element with the Country type</h3><p>Now to start moving towards the use of the <code>Country</code> type.</p><p>First, let's add an element to the <code>Books</code> entity definition to show where a book was published. We'll do this (and other enhancements in this experiment) in a separate CDS file, to remind ourselves of how well thought out and capable the CDS language and compilation process is.</p><p>In a new file, let's call it <code>db/publicationinfo.cds</code>, let's add this:</p><pre class="language-cds"><code class="language-cds"><span class="token using keyword">using</span> <span class="token from keyword">from</span> './data-model';<br><span class="token using keyword">using</span> { Country } <span class="token from keyword">from</span> '@sap/cds/common';<br><br><span class="token keyword">extend</span> my.bookshop.Books with {<br>    publishedIn: Country;<br>}</code></pre><ul><li>The first <code>using</code> directive just imports the definitions from the existing <code>db/data-model.cds</code> file, i.e. the <code>Books</code> entity in the <code>my.bookshop</code> namespace. With this first <code>using</code> directive we can then refer to the <code>my.bookshop.Books</code> entity, as we do with the <code>extend</code> directive shortly.</li><li>The second <code>using</code> directive is to bring in the definition of the <a href="https://cap.cloud.sap/docs/cds/common#type-country">Country reuse type</a> from <code>@sap/cds/common</code>. This is so we can use this <code>Country</code> type to describe the new element we're adding to the <code>my.bookshop.Books</code> entity.</li><li>Then in the <code>extend</code> directive we can simply add the new <code>publishedIn</code> element and define it as having the <code>Country</code> type. We already know about how this type is defined from the <a href="#background">background section</a> earlier.</li></ul><p>As the CAP server is still running in &quot;watch&quot; mode, things restart and now we see something like this:</p><pre class="language-text"><code class="language-text">[cds] - loaded model from 4 file(s):<br><br>  srv/cat-service.cds<br>  db/publicationinfo.cds<br>  [...]/node_modules/@sap/cds/common.cds<br>  db/data-model.cds<br><br>[cds] - connect using bindings from: { registry: '~/.cds-services.json' }<br>[cds] - connect to db > sqlite { database: ':memory:' }<br>  > init from db/data/my.bookshop-Books.csv<br>/> successfully deployed to in-memory database.</code></pre><p>The log output here shows us that there are two new files in the list from which the model has been loaded:</p><pre class="language-text"><code class="language-text">db/publicationinfo.cds<br>[...]/node_modules/@sap/cds/common.cds</code></pre><p>What's happened of course is that a new file, <code>publicationinfo.cds</code>, is discovered in the well-known <code>db/</code> directory. So that is loaded and added to the overall model compilation. And within that file, the <code>using { Country } from '@sap/cds/common';</code> directive causes the corresponding file from that (built-in) NPM package <code>@sap/cds/common</code> to be loaded too. Nice!</p><p>And now the CAP server has restarted, serving the new enhanced overall model, we see with a request like this:</p><pre class="language-shell"><code class="language-shell"><span class="token function">curl</span> <span class="token parameter variable">-s</span> localhost:4004/odata/v4/catalog <span class="token operator">|</span> jq <span class="token builtin class-name">.</span></code></pre><p>that the OData service document now sports the <code>Countries</code> and <code>Countries_texts</code> entity sets too (because, briefly, <code>sap.common.Countries</code> is defined as an entity in <code>[...]/node_modules/@sap/cds/common.cds</code> and therefore is exposed as an entity set in the OData service):</p><pre class="language-json"><code class="language-json"><span class="token punctuation">{</span><br>  <span class="token property">"@odata.context"</span><span class="token operator">:</span> <span class="token string">"$metadata"</span><span class="token punctuation">,</span><br>  <span class="token property">"@odata.metadataEtag"</span><span class="token operator">:</span> <span class="token string">"W/\"2n4HnZUJly4q6xyptJ6+4ZptvIICSUNdpk6NYX73bGY=\""</span><span class="token punctuation">,</span><br>  <span class="token property">"value"</span><span class="token operator">:</span> <span class="token punctuation">[</span><br>    <span class="token punctuation">{</span><br>      <span class="token property">"name"</span><span class="token operator">:</span> <span class="token string">"Books"</span><span class="token punctuation">,</span><br>      <span class="token property">"url"</span><span class="token operator">:</span> <span class="token string">"Books"</span><br>    <span class="token punctuation">}</span><span class="token punctuation">,</span><br>    <span class="token punctuation">{</span><br>      <span class="token property">"name"</span><span class="token operator">:</span> <span class="token string">"Countries"</span><span class="token punctuation">,</span><br>      <span class="token property">"url"</span><span class="token operator">:</span> <span class="token string">"Countries"</span><br>    <span class="token punctuation">}</span><span class="token punctuation">,</span><br>    <span class="token punctuation">{</span><br>      <span class="token property">"name"</span><span class="token operator">:</span> <span class="token string">"Countries_texts"</span><span class="token punctuation">,</span><br>      <span class="token property">"url"</span><span class="token operator">:</span> <span class="token string">"Countries_texts"</span><br>    <span class="token punctuation">}</span><br>  <span class="token punctuation">]</span><br><span class="token punctuation">}</span></code></pre><p>Again. So far, so good.</p><h3>Starting to look at the data</h3><p>We have some books data, courtesy of the two CSV records that came as part of the &quot;tiny-sample&quot; facet, which we can see with:</p><pre class="language-shell"><code class="language-shell"><span class="token function">curl</span> <span class="token parameter variable">-s</span> localhost:4004/odata/v4/catalog/Books <span class="token operator">|</span> jq <span class="token builtin class-name">.</span></code></pre><p>which returns this entity set response:</p><pre class="language-json"><code class="language-json"><span class="token punctuation">{</span><br>  <span class="token property">"@odata.context"</span><span class="token operator">:</span> <span class="token string">"$metadata#Books"</span><span class="token punctuation">,</span><br>  <span class="token property">"value"</span><span class="token operator">:</span> <span class="token punctuation">[</span><br>    <span class="token punctuation">{</span><br>      <span class="token property">"ID"</span><span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span><br>      <span class="token property">"title"</span><span class="token operator">:</span> <span class="token string">"Wuthering Heights"</span><span class="token punctuation">,</span><br>      <span class="token property">"stock"</span><span class="token operator">:</span> <span class="token number">100</span><span class="token punctuation">,</span><br>      <span class="token property">"publishedIn_code"</span><span class="token operator">:</span> <span class="token null keyword">null</span><br>    <span class="token punctuation">}</span><span class="token punctuation">,</span><br>    <span class="token punctuation">{</span><br>      <span class="token property">"ID"</span><span class="token operator">:</span> <span class="token number">2</span><span class="token punctuation">,</span><br>      <span class="token property">"title"</span><span class="token operator">:</span> <span class="token string">"Jane Eyre"</span><span class="token punctuation">,</span><br>      <span class="token property">"stock"</span><span class="token operator">:</span> <span class="token number">500</span><span class="token punctuation">,</span><br>      <span class="token property">"publishedIn_code"</span><span class="token operator">:</span> <span class="token null keyword">null</span><br>    <span class="token punctuation">}</span><br>  <span class="token punctuation">]</span><br><span class="token punctuation">}</span></code></pre><blockquote><p>Those eagle-eyed amongst you might be wondering about the <code>publishedIn_code</code> property. That's one that's been auto-generated as a result of CAP's excellent <a href="https://cap.cloud.sap/docs/guides/domain-modeling#associations">managed associations</a> constructs.</p><p>Here, specifically, it comes from the combination of the <code>Country</code> type used to describe the <code>publishedIn</code> element:</p><pre class="language-cds"><code class="language-cds"><span class="token keyword">extend</span> my.bookshop.Books with {<br>    publishedIn: Country;<br>}</code></pre><p>and the very definition of <code>Country</code> which is a <a href="https://cap.cloud.sap/docs/guides/domain-modeling#managed-1-associations">managed &quot;to-one&quot; association</a> as we have already seen:</p><pre class="language-cds"><code class="language-cds"><span class="token cqlkeywords keyword">type</span> Country : <span class="token association-composition keyword">Association to sap</span>.common.Countries;</code></pre><p>This results in, amongst other things, a foreign-key relationship being needed, and being realised via the construction of a property for this, made up of the names of the two elements in the relationship, i.e.</p><ul><li><code>publishedIn</code> (the new element in <code>my.bookshop.Books</code>)</li><li><code>code</code> (the key element in <code>sap.common.Countries</code>)</li></ul><p>joined with an <code>_</code> underscore character to become <code>publishedIn_code</code>.</p></blockquote><p>However, we don't yet have any country data. Requesting the equivalent entity set like this:</p><pre class="language-shell"><code class="language-shell"><span class="token function">curl</span> <span class="token parameter variable">-s</span> localhost:4004/odata/v4/catalog/Countries <span class="token operator">|</span> jq <span class="token builtin class-name">.</span></code></pre><p>returns a rather sad and empty looking entity set:</p><pre class="language-json"><code class="language-json"><span class="token punctuation">{</span><br>  <span class="token property">"@odata.context"</span><span class="token operator">:</span> <span class="token string">"$metadata#Countries"</span><span class="token punctuation">,</span><br>  <span class="token property">"value"</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><br><span class="token punctuation">}</span></code></pre><p>So ... <code>@sap/cds-common-content</code> to the rescue!</p><h3>Using @sap/cds-common-content</h3><p>Like we saw earlier, this can be brought into the project simply by adding it as a package. So let's do that now:</p><pre class="language-shell"><code class="language-shell"><span class="token function">npm</span> <span class="token function">add</span> @sap/cds-common-content</code></pre><p>After seeing output like this:</p><pre class="language-text"><code class="language-text">added 115 packages, and audited 116 packages in 17s<br><br>21 packages are looking for funding<br>  run `npm fund` for details<br><br>found 0 vulnerabilities</code></pre><p>we see that <code>package.json</code> now has the package listed in the <code>dependencies</code> section:</p><pre class="language-json"><code class="language-json"><span class="token punctuation">{</span><br>  <span class="token property">"name"</span><span class="token operator">:</span> <span class="token string">"iso-data-test"</span><span class="token punctuation">,</span><br>  <span class="token property">"version"</span><span class="token operator">:</span> <span class="token string">"1.0.0"</span><span class="token punctuation">,</span><br>  <span class="token property">"description"</span><span class="token operator">:</span> <span class="token string">"A simple CAP project."</span><span class="token punctuation">,</span><br>  <span class="token property">"repository"</span><span class="token operator">:</span> <span class="token string">"&lt;Add your repository here>"</span><span class="token punctuation">,</span><br>  <span class="token property">"license"</span><span class="token operator">:</span> <span class="token string">"UNLICENSED"</span><span class="token punctuation">,</span><br>  <span class="token property">"private"</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span><br>  <span class="token property">"dependencies"</span><span class="token operator">:</span> <span class="token punctuation">{</span><br>    <span class="token property">"@sap/cds"</span><span class="token operator">:</span> <span class="token string">"^7"</span><span class="token punctuation">,</span><br>    <span class="token property">"@sap/cds-common-content"</span><span class="token operator">:</span> <span class="token string">"^1.4.0"</span><span class="token punctuation">,</span><br>    <span class="token property">"express"</span><span class="token operator">:</span> <span class="token string">"^4"</span><br>  <span class="token punctuation">}</span><span class="token punctuation">,</span><br>  <span class="token property">"devDependencies"</span><span class="token operator">:</span> <span class="token punctuation">{</span><br>    <span class="token property">"@cap-js/sqlite"</span><span class="token operator">:</span> <span class="token string">"^1"</span><br>  <span class="token punctuation">}</span><span class="token punctuation">,</span><br>  <span class="token property">"scripts"</span><span class="token operator">:</span> <span class="token punctuation">{</span><br>    <span class="token property">"start"</span><span class="token operator">:</span> <span class="token string">"cds-serve"</span><br>  <span class="token punctuation">}</span><br><span class="token punctuation">}</span></code></pre><p>and the rest of the dependencies have been installed too (through a more general NPM install side-effect) - we can see this with <code>npm list</code>; here's an example invocation:</p><pre class="language-shell"><code class="language-shell"><span class="token punctuation">;</span> <span class="token function">npm</span> list<br>iso-data-test@1.0.0 /home/user/work/scratch/iso-data-test<br>+-- @cap-js/sqlite@1.5.1<br>+-- @sap/cds-common-content@1.4.0<br>+-- @sap/cds@7.7.2<br>`-- express@4.18.3</code></pre><p>So now, to actually make use of this package and what it brings, we have to add a <code>using</code> directive, as we saw earlier.</p><p>Let's add that to the <code>db/publicationinfo.cds</code> file, like this:</p><pre class="language-cds"><code class="language-cds"><span class="token using keyword">using</span> <span class="token from keyword">from</span> './data-model';<br><span class="token using keyword">using</span> { Country } <span class="token from keyword">from</span> '@sap/cds/common';<br><span class="token using keyword">using</span> <span class="token from keyword">from</span> '@sap/cds-common-content';<br><br><span class="token keyword">extend</span> my.bookshop.Books with {<br>    publishedIn: Country;<br>}</code></pre><p><a name="explosion"></a> As the CAP server is still running in &quot;watch&quot; mode, it restarts, and 💥 what an explosion of log output!</p><pre class="language-text"><code class="language-text">[cds] - loaded model from 6 file(s):<br><br>  srv/cat-service.cds<br>  db/publicationinfo.cds<br>  node_modules/@sap/cds-common-content/index.cds<br>  db/data-model.cds<br>  node_modules/@sap/cds-common-content/db/index.cds<br>  node_modules/@sap/cds/common.cds<br><br>[cds] - connect using bindings from: { registry: '~/.cds-services.json' }<br>[cds] - connect to db > sqlite { url: ':memory:' }<br>  > init from node_modules/@sap/cds-common-content/db/data/sap-common-Countries_texts_zh_TW.csv<br>  > init from node_modules/@sap/cds-common-content/db/data/sap-common-Countries_texts_zh_CN.csv<br>  > init from node_modules/@sap/cds-common-content/db/data/sap-common-Countries_texts_tr.csv<br>  > init from node_modules/@sap/cds-common-content/db/data/sap-common-Countries_texts_th.csv<br>  > init from node_modules/@sap/cds-common-content/db/data/sap-common-Countries_texts_sv.csv<br>  > init from node_modules/@sap/cds-common-content/db/data/sap-common-Countries_texts_ru.csv<br>  > init from node_modules/@sap/cds-common-content/db/data/sap-common-Countries_texts_ro.csv<br>  > init from node_modules/@sap/cds-common-content/db/data/sap-common-Countries_texts_pt.csv<br>  > init from node_modules/@sap/cds-common-content/db/data/sap-common-Countries_texts_pl.csv<br>  > init from node_modules/@sap/cds-common-content/db/data/sap-common-Countries_texts_no.csv<br>  > init from node_modules/@sap/cds-common-content/db/data/sap-common-Countries_texts_nl.csv<br>  > init from node_modules/@sap/cds-common-content/db/data/sap-common-Countries_texts_ms.csv<br>  > init from node_modules/@sap/cds-common-content/db/data/sap-common-Countries_texts_ko.csv<br>  > init from node_modules/@sap/cds-common-content/db/data/sap-common-Countries_texts_ja.csv<br>  > init from node_modules/@sap/cds-common-content/db/data/sap-common-Countries_texts_it.csv<br>  > init from node_modules/@sap/cds-common-content/db/data/sap-common-Countries_texts_hu.csv<br>  > init from node_modules/@sap/cds-common-content/db/data/sap-common-Countries_texts_fr.csv<br>  > init from node_modules/@sap/cds-common-content/db/data/sap-common-Countries_texts_fi.csv<br>  > init from node_modules/@sap/cds-common-content/db/data/sap-common-Countries_texts_es_MX.csv<br>  > init from node_modules/@sap/cds-common-content/db/data/sap-common-Countries_texts_es.csv<br>  > init from node_modules/@sap/cds-common-content/db/data/sap-common-Countries_texts_en.csv<br>  > init from node_modules/@sap/cds-common-content/db/data/sap-common-Countries_texts_de.csv<br>  > init from node_modules/@sap/cds-common-content/db/data/sap-common-Countries_texts_da.csv<br>  > init from node_modules/@sap/cds-common-content/db/data/sap-common-Countries_texts_cs.csv<br>  > init from node_modules/@sap/cds-common-content/db/data/sap-common-Countries_texts_ar.csv<br>  > init from node_modules/@sap/cds-common-content/db/data/sap-common-Countries.csv<br>  > init from db/data/my.bookshop-Books.csv<br>/> successfully deployed to in-memory database.</code></pre><p>Wow! What's more, we now have country data in the <code>Countries</code> entity set:</p><pre class="language-shell"><code class="language-shell"><span class="token function">curl</span> <span class="token parameter variable">-s</span> <span class="token string">'localhost:4004/odata/v4/catalog/Countries?$top=5'</span> <span class="token punctuation">\</span><br>  <span class="token operator">|</span> jq <span class="token builtin class-name">.</span></code></pre><pre class="language-shell"><code class="language-shell"><span class="token punctuation">{</span><br>  <span class="token string">"@odata.context"</span><span class="token builtin class-name">:</span> <span class="token string">"<span class="token variable">$metadata</span>#Countries"</span>,<br>  <span class="token string">"value"</span><span class="token builtin class-name">:</span> <span class="token punctuation">[</span><br>    <span class="token punctuation">{</span><br>      <span class="token string">"name"</span><span class="token builtin class-name">:</span> <span class="token string">"Andorra"</span>,<br>      <span class="token string">"descr"</span><span class="token builtin class-name">:</span> <span class="token string">"Andorra"</span>,<br>      <span class="token string">"code"</span><span class="token builtin class-name">:</span> <span class="token string">"AD"</span><br>    <span class="token punctuation">}</span>,<br>    <span class="token punctuation">{</span><br>      <span class="token string">"name"</span><span class="token builtin class-name">:</span> <span class="token string">"Utd Arab Emir."</span>,<br>      <span class="token string">"descr"</span><span class="token builtin class-name">:</span> <span class="token string">"United Arab Emirates"</span>,<br>      <span class="token string">"code"</span><span class="token builtin class-name">:</span> <span class="token string">"AE"</span><br>    <span class="token punctuation">}</span>,<br>    <span class="token punctuation">{</span><br>      <span class="token string">"name"</span><span class="token builtin class-name">:</span> <span class="token string">"Afghanistan"</span>,<br>      <span class="token string">"descr"</span><span class="token builtin class-name">:</span> <span class="token string">"Afghanistan"</span>,<br>      <span class="token string">"code"</span><span class="token builtin class-name">:</span> <span class="token string">"AF"</span><br>    <span class="token punctuation">}</span>,<br>    <span class="token punctuation">{</span><br>      <span class="token string">"name"</span><span class="token builtin class-name">:</span> <span class="token string">"Antigua/Barbuda"</span>,<br>      <span class="token string">"descr"</span><span class="token builtin class-name">:</span> <span class="token string">"Antigua and Barbuda"</span>,<br>      <span class="token string">"code"</span><span class="token builtin class-name">:</span> <span class="token string">"AG"</span><br>    <span class="token punctuation">}</span>,<br>    <span class="token punctuation">{</span><br>      <span class="token string">"name"</span><span class="token builtin class-name">:</span> <span class="token string">"Anguilla"</span>,<br>      <span class="token string">"descr"</span><span class="token builtin class-name">:</span> <span class="token string">"Anguilla"</span>,<br>      <span class="token string">"code"</span><span class="token builtin class-name">:</span> <span class="token string">"AI"</span><br>    <span class="token punctuation">}</span><br>  <span class="token punctuation">]</span><br><span class="token punctuation">}</span></code></pre><p>That's fab. But. What's going on? Where is this coming from? How does this work?</p><h3>Digging in to what's happening</h3><p>Let's take a bit of time to figure out how this is all working, and why we now have country data.</p><p>We added a single line to the CDS model:</p><pre class="language-cds"><code class="language-cds"><span class="token using keyword">using</span> <span class="token from keyword">from</span> '@sap/cds-common-content';</code></pre><p>What did the addition of this line actually do to cause that explosion of change and the appearance of ISO country data?</p><p>Well, our first clue is the extra entries that now are appearing in the list of files from which the CDS model is constructed:</p><pre class="language-text"><code class="language-text">[cds] - loaded model from 6 file(s):<br><br>  srv/cat-service.cds<br>  db/publicationinfo.cds<br>  node_modules/@sap/cds-common-content/index.cds<br>  db/data-model.cds<br>  node_modules/@sap/cds-common-content/db/index.cds<br>  node_modules/@sap/cds/common.cds</code></pre><p>Working through them, we first see our base files:</p><pre class="language-text"><code class="language-text">srv/cat-service.cds<br>db/data-model.cds</code></pre><p>We also see the two extra files that were picked up once we added the <code>db/publicationinfo.cds</code> file which itself summoned the <code>@sap/cds/common</code> content:</p><pre class="language-text"><code class="language-text">db/publicationinfo.cds<br>node_modules/@sap/cds/common.cds</code></pre><blockquote><p>At this point I've stopped being deliberately vague (with <code>[...]</code>) about the specific location of the files in <code>node_modules/</code>, because it's worth highlighting here something that has changed. The <code>npm add</code> action just before caused the rest of the packages (defined in <code>package.json</code>) to be installed in the project. This means that there's now a project-local <code>node_modules/</code> directory containing everything that this project needs, including all the <code>@sap</code> prefixed NPM packages.</p><p>A quick <code>tree -F -L 3</code> shows the directory structure containing those resources (I've removed some of the output for brevity):</p><pre class="language-text"><code class="language-text">./<br>|-- README.md<br>|-- app/<br>|-- db/<br>|   |-- data/<br>|   |   `-- my.bookshop-Books.csv<br>|   |-- data-model.cds<br>|   `-- publicationinfo.cds<br>|-- node_modules/<br>|   |-- @cap-js/<br>|   |   |-- cds-types/<br>|   |   |-- db-service/<br>|   |   `-- sqlite/<br>|   |-- @sap/<br>|   |   |-- cds/<br>|   |   |-- cds-common-content/<br>|   |   |-- cds-compiler/<br>|   |   |-- cds-fiori/<br>|   |   `-- cds-foss/<br>|   |-- ...<br>|   `-- yaml/<br>|       |-- LICENSE<br>|       |-- README.md<br>|       |-- bin.mjs*<br>|       |-- browser/<br>|       |-- dist/<br>|       |-- package.json<br>|       `-- util.js<br>|-- package-lock.json<br>|-- package.json<br>`-- srv/<br>    `-- cat-service.cds</code></pre><p>So this means that the <code>@sap/cds/common</code> package is being loaded now from the project-local set of packages, i.e. in <code>node_modules/</code> relative to the project directory (i.e. <code>./node_modules/</code>) and not the global NPM package area any more.</p><p>This in turn means that the full (relative) path to this file now in the list is clean and short(er):</p><pre class="language-text"><code class="language-text">node_modules/@sap/cds/common.cds</code></pre></blockquote><p>OK, so we know why these four of the six files are being loaded, and where from:</p><pre class="language-text"><code class="language-text">srv/cat-service.cds<br>db/data-model.cds<br>db/publicationinfo.cds<br>node_modules/@sap/cds/common.cds</code></pre><p>So what about the other two in the list:</p><pre class="language-text"><code class="language-text">node_modules/@sap/cds-common-content/index.cds<br>node_modules/@sap/cds-common-content/db/index.cds</code></pre><p>which are now also being brought in to construct the model?</p><p>Well, given the &quot;cds-common-content&quot; that appears in the path of these files, we can be pretty certain that they're related to this single line we just added:</p><pre class="language-cds"><code class="language-cds"><span class="token using keyword">using</span> <span class="token from keyword">from</span> '@sap/cds-common-content';</code></pre><p>so what is actually happening here?</p><p>Well, if we look a bit deeper inside the <code>@sap/cds-common-content</code> package, like this:</p><pre class="language-shell"><code class="language-shell">tree <span class="token parameter variable">-F</span> <span class="token parameter variable">-L</span> <span class="token number">2</span> node_modules/@sap/cds-common-content</code></pre><p>there's a bit of a clue in the output, especially if we're familiar with CAP's <a href="https://cap.cloud.sap/docs/guides/extensibility/composition">Reuse and Compose</a> concepts:</p><pre class="language-text"><code class="language-text">node_modules/@sap/cds-common-content/<br>|-- CHANGELOG.md<br>|-- LICENSE<br>|-- README.md<br>|-- db/<br>|   |-- index.cds<br>|   `-- data/<br>|-- index.cds<br>`-- package.json<br><br>3 directories, 6 files<br></code></pre><p>Look at those <code>index.cds</code> files. The <a href="https://cap.cloud.sap/docs/guides/extensibility/composition#index-cds">Using index.cds Entry Points</a> section of the Reuse and Compose section of the Capire documentation says this, in the context of a <code>using</code> directive like we have here (i.e. <code>using from '@sap/cds-common-content';</code>):</p><p><em>&quot;The <code>using from</code> statements assume that the imported packages provide <code>index.cds</code> in their roots as <a href="https://cap.cloud.sap/docs/guides/extensibility/composition#entry-points">public entry points</a>, which they do.&quot;</em></p><p>So, that means that the <code>using</code> directive will cause this file:</p><pre class="language-text"><code class="language-text">node_modules/@sap/cds-common-content/index.cds</code></pre><p>to also be loaded and its CDS contents added into the overall model construction. So what's in this file? This:</p><pre class="language-cds"><code class="language-cds"><span class="token using keyword">using</span> <span class="token from keyword">from</span> './db';</code></pre><p>🐇 <a href="https://en.wikipedia.org/wiki/Alice%27s_Adventures_in_Wonderland">Curiouser and curiouser</a>!</p><p>So let's now follow <em>this</em> <code>using</code> directive, the resource reference within which should be interpreted as local to the containing <code>index.cds</code> file, i.e. we're now going to follow this path to <code>./db/</code>, which <em>also</em> contains an <code>index.cds</code>:</p><pre class="language-text"><code class="language-text">node_modules/@sap/cds-common-content/<br>|-- CHANGELOG.md<br>|-- LICENSE<br>|-- README.md<br>|-- db/<br>|   |-- index.cds  &lt;--------------------+<br>|   `-- data/                           |<br>|-- index.cds  -- using from './db'; ---+<br>`-- package.json</code></pre><p>So what's in <code>./db/index.cds</code>? This:</p><pre class="language-cds"><code class="language-cds"><span class="token using keyword">using</span> sap.common.Languages <span class="token from keyword">from</span> '@sap/cds/common';<br><span class="token using keyword">using</span> sap.common.Countries <span class="token from keyword">from</span> '@sap/cds/common';<br><span class="token using keyword">using</span> sap.common.Currencies <span class="token from keyword">from</span> '@sap/cds/common';<br><span class="token using keyword">using</span> sap.common.Timezones <span class="token from keyword">from</span> '@sap/cds/common';</code></pre><p>Ooh!</p><p>What is the effect of doing this? Well it has a direct effect and a sort of side-effect too.</p><p>The direct effect is that all four entity definitions referenced in this <code>./db/index.cds</code> file, that is to say these four:</p><ul><li><code>sap.common.Languages</code></li><li><code>sap.common.Countries</code></li><li><code>sap.common.Currencies</code></li><li><code>sap.common.Timezones</code></li></ul><p>are added to the overall model.</p><p>But the side-effect is that the <code>./db/data/</code> directory here also becomes a candidate location for the automatic <a href="https://cap.cloud.sap/docs/guides/databases#providing-initial-data">provision of initial data</a>!</p><p>And what's in that <code>./db/data/</code> directory? Let's have a look:</p><pre class="language-shell"><code class="language-shell"><span class="token function">ls</span> node_modules/@sap/cds-common-content/db/data/</code></pre><p>Lots and lots of CSV files (I've cut the list down to just a few here):</p><pre class="language-text"><code class="language-text">./                                     sap-common-Languages_texts_cs.csv<br>../                                    sap-common-Languages_texts_da.csv<br>sap-common-Countries.csv               sap-common-Languages_texts_de.csv<br>sap-common-Countries_texts.csv         sap-common-Languages_texts_en.csv<br>sap-common-Countries_texts_ar.csv      sap-common-Languages_texts_es.csv<br>sap-common-Countries_texts_zh_CN.csv   sap-common-Timezones_texts_cs.csv<br>sap-common-Countries_texts_zh_TW.csv   sap-common-Timezones_texts_da.csv<br>sap-common-Currencies.csv              sap-common-Timezones_texts_de.csv<br>sap-common-Currencies_texts.csv        sap-common-Timezones_texts_el.csv<br>sap-common-Currencies_texts_ar.csv     sap-common-Timezones_texts_en.csv<br>...</code></pre><p>And we know what happens with initial data, for those entities whose namespaced-names match up with CSV filenames in directories such as these - the data is automatically imported to become data for those entities!</p><p>Notice too that for each of the four entities, there is a single CSV file containing the core data, and multiple CSV files for the corresponding <a href="https://cap.cloud.sap/docs/guides/localized-data#declaring-localized-data">localized</a> elements, in accompanying <code>_texts*</code> suffixed files.</p><p>Here's one example, for the <code>sap.common.Countries</code> entity. A neat list of the intial CSV data files for this entity can be retrieved with:</p><pre class="language-shell"><code class="language-shell"><span class="token builtin class-name">cd</span> node_modules/@sap/cds-common-content/db/data/ <span class="token punctuation">\</span><br>  <span class="token operator">&amp;&amp;</span> <span class="token function">ls</span> <span class="token parameter variable">-1</span> sap-common-Countries*.csv</code></pre><p>which produces:</p><pre class="language-text"><code class="language-text">sap-common-Countries.csv<br>sap-common-Countries_texts.csv<br>sap-common-Countries_texts_ar.csv<br>sap-common-Countries_texts_cs.csv<br>sap-common-Countries_texts_da.csv<br>sap-common-Countries_texts_de.csv<br>sap-common-Countries_texts_en.csv<br>sap-common-Countries_texts_es.csv<br>sap-common-Countries_texts_es_MX.csv<br>sap-common-Countries_texts_fi.csv<br>sap-common-Countries_texts_fr.csv<br>sap-common-Countries_texts_hu.csv<br>sap-common-Countries_texts_it.csv<br>sap-common-Countries_texts_ja.csv<br>sap-common-Countries_texts_ko.csv<br>sap-common-Countries_texts_ms.csv<br>sap-common-Countries_texts_nl.csv<br>sap-common-Countries_texts_no.csv<br>sap-common-Countries_texts_pl.csv<br>sap-common-Countries_texts_pt.csv<br>sap-common-Countries_texts_ro.csv<br>sap-common-Countries_texts_ru.csv<br>sap-common-Countries_texts_sv.csv<br>sap-common-Countries_texts_th.csv<br>sap-common-Countries_texts_tr.csv<br>sap-common-Countries_texts_zh_CN.csv<br>sap-common-Countries_texts_zh_TW.csv</code></pre><p>We can see the three groups of files for <code>sap.common.Countries</code>:</p><ul><li>the single core data file <code>sap-common-Countries.csv</code> containing values for the <code>code</code>, <code>name</code> and <code>descr</code> fields (in English as default).</li><li>the single core localized data file <code>sap-common-Countries_texts.csv</code> - where the filename is not specific to an explicit locale - containing values for the <code>locale</code>, <code>code</code>, <code>name</code> and <code>descr</code> field. The language specific content is English by default.</li><li>the multiple language-specific localized data files <code>sap-common-Countries_texts_&lt;locale-identifier&gt;.csv</code> containing the same data as the core localized file but with the texts translated into the language indicated by the locale-identifier in the file name.</li></ul><p>You'll likely remember seeing a list of all these CSV files in the <a href="#explosion">explosion of output</a> from the running CAP server earlier.</p><p>And what's the outcome of this?</p><p>To find out, let's expand the core books data now to include values for the new <code>publishedIn_code</code> field at the persistence layer, so that the content of <code>db/data/my.bookshop-Books.csv</code> now looks like this:</p><pre class="language-csv"><code class="language-csv"><span class="token value">ID;title;stock;publishedIn_code</span><br><span class="token value">1;Wuthering Heights;100;DE</span><br><span class="token value">2;Jane Eyre;500;HU</span></code></pre><blockquote><p>Yes I know Wuthering Heights wasn't published in Germany, nor was Jane Eyre published in Hungary, but thank you for wondering about that.</p></blockquote><p>Now, NOT ONLY (μέν) can we follow navigation properties to see the publication countries for our books, like this (note the country names &quot;Germany&quot; and &quot;Hungary&quot;):</p><pre class="language-shell"><code class="language-shell"><span class="token function">curl</span> <span class="token punctuation">\</span><br>    <span class="token parameter variable">--silent</span> <span class="token punctuation">\</span><br>    <span class="token parameter variable">--url</span> <span class="token string">'localhost:4004/odata/v4/catalog/Books?$expand=publishedIn'</span> <span class="token punctuation">\</span><br>  <span class="token operator">|</span> jq <span class="token builtin class-name">.</span></code></pre><p>to get this:</p><pre class="language-json"><code class="language-json"><span class="token punctuation">{</span><br>  <span class="token property">"@odata.context"</span><span class="token operator">:</span> <span class="token string">"$metadata#Books(publishedIn())"</span><span class="token punctuation">,</span><br>  <span class="token property">"value"</span><span class="token operator">:</span> <span class="token punctuation">[</span><br>    <span class="token punctuation">{</span><br>      <span class="token property">"ID"</span><span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span><br>      <span class="token property">"title"</span><span class="token operator">:</span> <span class="token string">"Wuthering Heights"</span><span class="token punctuation">,</span><br>      <span class="token property">"stock"</span><span class="token operator">:</span> <span class="token number">100</span><span class="token punctuation">,</span><br>      <span class="token property">"publishedIn_code"</span><span class="token operator">:</span> <span class="token string">"DE"</span><span class="token punctuation">,</span><br>      <span class="token property">"publishedIn"</span><span class="token operator">:</span> <span class="token punctuation">{</span><br>        <span class="token property">"name"</span><span class="token operator">:</span> <span class="token string">"Germany"</span><span class="token punctuation">,</span><br>        <span class="token property">"descr"</span><span class="token operator">:</span> <span class="token string">"Germany"</span><span class="token punctuation">,</span><br>        <span class="token property">"code"</span><span class="token operator">:</span> <span class="token string">"DE"</span><br>      <span class="token punctuation">}</span><br>    <span class="token punctuation">}</span><span class="token punctuation">,</span><br>    <span class="token punctuation">{</span><br>      <span class="token property">"ID"</span><span class="token operator">:</span> <span class="token number">2</span><span class="token punctuation">,</span><br>      <span class="token property">"title"</span><span class="token operator">:</span> <span class="token string">"Jane Eyre"</span><span class="token punctuation">,</span><br>      <span class="token property">"stock"</span><span class="token operator">:</span> <span class="token number">500</span><span class="token punctuation">,</span><br>      <span class="token property">"publishedIn_code"</span><span class="token operator">:</span> <span class="token string">"HU"</span><span class="token punctuation">,</span><br>      <span class="token property">"publishedIn"</span><span class="token operator">:</span> <span class="token punctuation">{</span><br>        <span class="token property">"name"</span><span class="token operator">:</span> <span class="token string">"Hungary"</span><span class="token punctuation">,</span><br>        <span class="token property">"descr"</span><span class="token operator">:</span> <span class="token string">"Hungary"</span><span class="token punctuation">,</span><br>        <span class="token property">"code"</span><span class="token operator">:</span> <span class="token string">"HU"</span><br>      <span class="token punctuation">}</span><br>    <span class="token punctuation">}</span><br>  <span class="token punctuation">]</span><br><span class="token punctuation">}</span></code></pre><p>BUT ALSO (δέ) we can ask for this information in our own language (locale)! Here's an example, requesting the same resource but with a different locale (French), via standard HTTP headers:</p><blockquote><p>I'm fond of the <a href="http://www.jowillmott.co.uk/simpleguide/notes/%CE%BC%CE%AD%CE%BD%E2%80%A6%CE%B4%CE%AD...">strong particle pairing</a> of μέν ... δέ which I first learned about as an important construct in Ancient Greek, and I find myself often using the (English) equivalent (&quot;not only ... but also&quot;).</p></blockquote><pre class="language-shell"><code class="language-shell"><span class="token function">curl</span> <span class="token punctuation">\</span><br>    <span class="token parameter variable">--silent</span> <span class="token punctuation">\</span><br>    <span class="token parameter variable">--header</span> <span class="token string">'Accept-Language: fr'</span> <span class="token punctuation">\</span><br>    <span class="token parameter variable">--url</span> <span class="token string">'localhost:4004/odata/v4/catalog/Books?$expand=publishedIn'</span> <span class="token punctuation">\</span><br>  <span class="token operator">|</span> jq <span class="token builtin class-name">.</span></code></pre><p>The representation of the resource requested is now different, in that the names of the countries are now in French (&quot;Allemagne&quot; and &quot;Hungarie&quot;):</p><pre class="language-json"><code class="language-json"><span class="token punctuation">{</span><br>  <span class="token property">"@odata.context"</span><span class="token operator">:</span> <span class="token string">"$metadata#Books(publishedIn())"</span><span class="token punctuation">,</span><br>  <span class="token property">"value"</span><span class="token operator">:</span> <span class="token punctuation">[</span><br>    <span class="token punctuation">{</span><br>      <span class="token property">"ID"</span><span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span><br>      <span class="token property">"title"</span><span class="token operator">:</span> <span class="token string">"Wuthering Heights"</span><span class="token punctuation">,</span><br>      <span class="token property">"stock"</span><span class="token operator">:</span> <span class="token number">100</span><span class="token punctuation">,</span><br>      <span class="token property">"publishedIn_code"</span><span class="token operator">:</span> <span class="token string">"DE"</span><span class="token punctuation">,</span><br>      <span class="token property">"publishedIn"</span><span class="token operator">:</span> <span class="token punctuation">{</span><br>        <span class="token property">"name"</span><span class="token operator">:</span> <span class="token string">"Allemagne"</span><span class="token punctuation">,</span><br>        <span class="token property">"descr"</span><span class="token operator">:</span> <span class="token string">"Allemagne"</span><span class="token punctuation">,</span><br>        <span class="token property">"code"</span><span class="token operator">:</span> <span class="token string">"DE"</span><br>      <span class="token punctuation">}</span><br>    <span class="token punctuation">}</span><span class="token punctuation">,</span><br>    <span class="token punctuation">{</span><br>      <span class="token property">"ID"</span><span class="token operator">:</span> <span class="token number">2</span><span class="token punctuation">,</span><br>      <span class="token property">"title"</span><span class="token operator">:</span> <span class="token string">"Jane Eyre"</span><span class="token punctuation">,</span><br>      <span class="token property">"stock"</span><span class="token operator">:</span> <span class="token number">500</span><span class="token punctuation">,</span><br>      <span class="token property">"publishedIn_code"</span><span class="token operator">:</span> <span class="token string">"HU"</span><span class="token punctuation">,</span><br>      <span class="token property">"publishedIn"</span><span class="token operator">:</span> <span class="token punctuation">{</span><br>        <span class="token property">"name"</span><span class="token operator">:</span> <span class="token string">"Hongrie"</span><span class="token punctuation">,</span><br>        <span class="token property">"descr"</span><span class="token operator">:</span> <span class="token string">"Hongrie"</span><span class="token punctuation">,</span><br>        <span class="token property">"code"</span><span class="token operator">:</span> <span class="token string">"HU"</span><br>      <span class="token punctuation">}</span><br>    <span class="token punctuation">}</span><br>  <span class="token punctuation">]</span><br><span class="token punctuation">}</span></code></pre><p>C'est vraiment magnifique!</p><p>Of course, one wouldn't often use an explicit <code>Accept-Language</code> header in an HTTP request, but think of what headers your browser sends by default when making requests, and think of what your French colleague's browser might send. Exactly!</p><h1>Wrapping up</h1><p>OK, I think I've reached a point where I can now safely escape this rabbit hole of discovery. The bottom line is that there is a standard NPM package available that provides actual ISO data for the four CAP reuse types. You've learned how to use it, and what it provides. Moreover, you've learned how it provides what it does, and what goes on behind the scenes. That, hopefully, has given you a tiny bit more insight into the wonders of CAP.</p><p>And there's still so much more to discover. Until next time!</p><hr><p><a name="appendix"></a></p><h1>Appendix - loading @sap/cds/common</h1><p>In the Background section earlier, the output of <code>cds watch</code> showed this line:</p><pre class="language-text"><code class="language-text">  [...]/node_modules/@sap/cds/common.cds</code></pre><p>The reason I included a <code>[...]</code> &quot;prefix&quot; was to signify that there will be a different path shown depending on whether an <code>npm install</code> of the project dependencies (which include <code>@sap/cds</code>) has been executed, or not.</p><p>If an <code>npm install</code> has been executed, then there will be a project-local <code>node_modules/</code> directory, and the <code>@sap/cds/common</code> resource will have been loaded from within there, i.e.</p><pre class="language-text"><code class="language-text">./node_modules/@sap/cds/common.cds</code></pre><p>If an <code>npm install</code> hasn't been executed, and we're running the CAP server from the NPM <a href="https://github.com/qmacro/capb2b/blob/20f9cebefd63f9d897eeb47b53634fd7416653b5/.devcontainer/Dockerfile#L11">globally installed</a> <code>@sap/cds-dk</code> package, then it will have been loaded from that globally installed package location, and look something like this (depending on what your NPM global package management directory setup looks like):</p><pre class="language-text"><code class="language-text">../../usr/local/share/npm-global/lib/<br>  node_modules/@sap/cds-dk/<br>  node_modules/@sap/cds/common.cds</code></pre><blockquote><p>This location value would typically be shown in a single line; I've split the value up over a few lines purely for readability.</p></blockquote><p>You can find out where your (normally globally installed) <code>@sap/cds-dk</code> package is, using the <code>cds env</code> command:</p><pre class="language-shell"><code class="language-shell">cds <span class="token function">env</span> _home_cds-dk</code></pre><p>In the context of this particular dev container in which I'm working, this is the value that is emitted:</p><pre class="language-text"><code class="language-text">'/usr/lib/node_modules/@sap/cds-dk/'</code></pre></main><aside class="post__aside"><div class="post__tags"><a href="/tags/cap/">#cap</a> <a href="/tags/iso/">#iso</a></div><style>.utterances {
  margin-left: inherit !important;
}</style><script src="https://utteranc.es/client.js" repo="qmacro/qmacro.github.io" issue-term="title" crossorigin="anonymous" async></script><nav class="post__pagination"><a href="/blog/posts/2024/03/22/curating-a-collection-of-jq-functions/"><span>←</span> <span>Curating a collection of jq functions</span> </a><a href="/blog/posts/2024/02/28/quick-conversion-of-multiple-values-using-with_entries-in-jq/"><span>Quick conversion of multiple values using with_entries in jq</span> <span>→</span></a></nav></aside></article></main><footer class="footer"><div class="footer__content"><ul class="hero__social-links"><li><a rel="me" href="https://github.com/qmacro" target="_blank" rel="noopener noreferrer">GitHub</a></li><li><a rel="me" href="https://www.youtube.com/djadams-qmacro" target="_blank" rel="noopener noreferrer">YouTube</a></li><li><a rel="me" href="https://www.linkedin.com/in/djadams/" target="_blank" rel="noopener noreferrer">LinkedIn</a></li><li><a rel="me" href="https://hachyderm.io/@qmacro" target="_blank" rel="noopener noreferrer">Mastodon</a></li><li><a href="/feed.xml" target="_blank" rel="noopener noreferrer">RSS</a></li></ul></div></footer></div><script src="/assets/main.31d6cfe0d16ae931b73c.js"></script></body></html>