<!doctype html><html lang="en"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1"><link rel="canonical" href="https://qmacro.org/blog/posts/2024/08/24/using-lazydocker-with-ssh-based-remote-contexts/"><link rel="alternate" type="application/atom+xml" title="DJ's Weblog - Feed" href="https://qmacro.org/feed.xml"><link href="/assets/main.7884d8f8e9dd86c3b137.css" rel="stylesheet"><link rel="preconnect" href="https://fonts.gstatic.com"><link href="https://fonts.googleapis.com/css2?family=IBM+Plex+Sans&display=swap" rel="stylesheet"><title>Using lazydocker with SSH-based remote contexts | DJ Adams</title><link rel="icon" type="“image/x-icon”" href="/images/favicon.ico"><meta property="og:title" content="Using lazydocker with SSH-based remote contexts"><meta property="og:site_name" content="DJ Adams"><meta property="og:type" content="website"><meta property="og:url" content="https://qmacro.org/blog/posts/2024/08/24/using-lazydocker-with-ssh-based-remote-contexts/"><meta name="description" content="Using lazydocker with SSH-based remote contexts 24 Aug 2024 | 2 min read A quick hack to work around the current issue with lazydocker and..."><meta property="og:description" content="Using lazydocker with SSH-based remote contexts 24 Aug 2024 | 2 min read A quick hack to work around the current issue with lazydocker and..."><meta name="description" content="Using lazydocker with SSH-based remote contexts 24 Aug 2024 | 2 min read A quick hack to work around the current issue with lazydocker and..."><meta property="og:image" content="https://qmacro.org/images/site-image.png"><script src="https://cdn.jsdelivr.net/npm/mermaid/dist/mermaid.min.js"></script><script>mermaid.initialize({startOnLoad:true});</script><script async src="https://www.googletagmanager.com/gtag/js?id=G-4WQKBG0L4Y"></script><script>window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());

      gtag('config', 'G-4WQKBG0L4Y');</script></head><body><div class="layout-wrapper"><header class="header"><div class="header__content"><h1 class="site-title"><a href="/">DJ Adams</a></h1><nav class="nav"><ul class="nav__list"><li class="nav-item"><a href="/about">About Me</a></li><li class="nav-item"><a href="/blog">Blog</a></li><li class="nav-item"><a href="/feed.xml">Feed</a></li></ul></nav></div></header><main class="main"><article class="post"><header class="post__header"><h1>Using lazydocker with SSH-based remote contexts</h1><div class="post__details"><time datetime="2024-08-24">24 Aug 2024 </time><span>| </span><span>2 min read</span></div></header><main class="post__content"><p>A quick hack to work around the current issue with <code>lazydocker</code> and SSH-based remote Docker context definitions.</p><p>I've used the excellent <a href="https://github.com/jesseduffield/lazydocker">lazydocker</a> before, but only occasionally, reverting to the <code>docker</code> CLI for most of my monitoring work. I thought I'd start using it again and learn more about it. While I can (and have) run <code>lazydocker</code> <a href="https://github.com/jesseduffield/lazydocker?tab=readme-ov-file#docker">as a Docker container</a> I wanted to run it locally in the Linux container of my Chromebook and connect remotely to my Docker engines running on various machines.</p><blockquote><p>If you are going to run <code>lazydocker</code> <a href="https://github.com/jesseduffield/lazydocker?tab=readme-ov-file#docker">as a Docker container</a> then I recommend you build the image yourself (the <code>Dockerfile</code> is in the repo) as the <a href="https://hub.docker.com/r/lazyteam/lazydocker">image on DockerHub</a> is rather out of date.</p></blockquote><p>I manage these remote engines via <a href="https://docs.docker.com/engine/manage-resources/contexts/">Docker contexts</a>. Running <code>docker context ls</code> here shows me this:</p><pre class="language-log"><code class="language-log">NAME         DESCRIPTION                               DOCKER ENDPOINT               <br>default      Current DOCKER_HOST based configuration   unix<span class="token operator">:</span><span class="token operator">/</span><span class="token operator">/</span><span class="token operator">/</span>var<span class="token operator">/</span>run<span class="token operator">/</span>docker<span class="token punctuation">.</span>sock   <br>docker <span class="token operator">*</span>     Docker Host on PVE LXC                    ssh<span class="token operator">:</span><span class="token operator">/</span><span class="token operator">/</span>dj<span class="token operator">@</span>docker               <br>homeops      Docker Host on homeops                    ssh<span class="token operator">:</span><span class="token operator">/</span><span class="token operator">/</span>dj<span class="token operator">@</span>homeops              <br>kkhw42xrfy   M2 Air                                    ssh<span class="token operator">:</span><span class="token operator">/</span><span class="token operator">/</span>user<span class="token operator">@</span>kkhw42xrfy      <br>synology     Docker Host on Synology NAS               ssh<span class="token operator">:</span><span class="token operator">/</span><span class="token operator">/</span>dj<span class="token operator">@</span>synology</code></pre><blockquote><p>If you're interested in finding out how to define and use these contexts, see the post <a href="/blog/posts/2021/06/12/remote-access-to-docker-on-my-synology-nas/">Remote access to Docker on my Synology NAS</a>.</p></blockquote><p>Currently there are some issues with <code>lazydocker</code> correctly using the SSH-based remote addresses - see for example <a href="https://github.com/jesseduffield/lazydocker/issues/510">issue 510</a> which, while closed, describes exactly what I experience even with the latest release, <a href="https://github.com/jesseduffield/lazydocker/pull/511#issuecomment-2139493861">as does another user</a>. I have no doubt that this will be sorted soon, but in the meantime I decided to set up a workaround, based on the fact that the <code>DOCKER_HOST</code> environment variable is correctly evaluated (see <a href="https://github.com/jesseduffield/lazydocker/pull/464">feat(docker): Honor the host specified in current docker context</a>) even if the host info in the context is not.</p><p>If my context is set to <code>docker</code>, for example, like this:</p><pre class="language-shell"><code class="language-shell"><span class="token function">docker</span> context <span class="token builtin class-name">set</span> <span class="token function">docker</span></code></pre><p>then if I start <code>lazydocker</code> I get an error:</p><p><em>Docker event stream returned error: error during connect: Get &quot;http://dj%40docker/v1.25/events&quot;: dial tcp: lookup dj@docker: no such host</em></p><p>However, if I set <code>DOCKER_HOST</code> before the invocation, like this:</p><pre class="language-shell"><code class="language-shell"><span class="token assign-left variable">DOCKER_HOST</span><span class="token operator">=</span>ssh://dj@docker lazydocker</code></pre><p>then <code>lazydocker</code> connects successfully.</p><blockquote><p>The context name <code>docker</code> here might be slightly confusing - it's because that's what I called the LXC container I set up on Proxmox for running a Docker engine.</p></blockquote><p>I can use <code>docker context inspect</code> to look into the details of the context, which look like this:</p><pre class="language-json"><code class="language-json"><span class="token punctuation">[</span><br>    <span class="token punctuation">{</span><br>        <span class="token property">"Name"</span><span class="token operator">:</span> <span class="token string">"docker"</span><span class="token punctuation">,</span><br>        <span class="token property">"Metadata"</span><span class="token operator">:</span> <span class="token punctuation">{</span><br>            <span class="token property">"Description"</span><span class="token operator">:</span> <span class="token string">"Docker Host on PVE LXC"</span><br>        <span class="token punctuation">}</span><span class="token punctuation">,</span><br>        <span class="token property">"Endpoints"</span><span class="token operator">:</span> <span class="token punctuation">{</span><br>            <span class="token property">"docker"</span><span class="token operator">:</span> <span class="token punctuation">{</span><br>                <span class="token property">"Host"</span><span class="token operator">:</span> <span class="token string">"ssh://dj@docker"</span><span class="token punctuation">,</span><br>                <span class="token property">"SkipTLSVerify"</span><span class="token operator">:</span> <span class="token boolean">false</span><br>            <span class="token punctuation">}</span><br>        <span class="token punctuation">}</span><span class="token punctuation">,</span><br>        <span class="token property">"TLSMaterial"</span><span class="token operator">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span><br>        <span class="token property">"Storage"</span><span class="token operator">:</span> <span class="token punctuation">{</span><br>            <span class="token property">"MetadataPath"</span><span class="token operator">:</span> <span class="token string">"/home/qmacro/.docker/contexts/meta/d548..."</span><span class="token punctuation">,</span><br>            <span class="token property">"TLSPath"</span><span class="token operator">:</span> <span class="token string">"/home/qmacro/.docker/contexts/tls/d548..."</span><br>        <span class="token punctuation">}</span><br>    <span class="token punctuation">}</span><br><span class="token punctuation">]</span></code></pre><p>And using the <code>--format</code> option of <code>docker context inspect</code> like this:</p><pre class="language-shell"><code class="language-shell"><span class="token function">docker</span> context inspect <span class="token parameter variable">--format</span> <span class="token string">'{{.Endpoints.docker.Host}}'</span></code></pre><p>I can get the SSH-based host value <code>ssh://dj@docker</code> which I can then set in <code>DOCKER_HOST</code> and invoke <code>lazydocker</code>.</p><p>Putting this all together I have now an alias <code>lado</code> defined thus:</p><pre class="language-shell"><code class="language-shell"><span class="token builtin class-name">alias</span> <span class="token assign-left variable">lado</span><span class="token operator">=</span><span class="token string">"DOCKER_HOST=<span class="token variable"><span class="token variable">$(</span><span class="token function">docker</span> context inspect <span class="token parameter variable">--format</span> <span class="token string">'{{.Endpoints.docker.Host}}'</span><span class="token variable">)</span></span> lazydocker"</span></code></pre><p>which sets the appropriate value, from the current context, in <code>DOCKER_HOST</code>, and invokes <code>lazydocker</code>.</p></main><aside class="post__aside"><div class="post__tags"><a href="/tags/docker/">#docker</a> <a href="/tags/shell/">#shell</a></div><style>.utterances {
  margin-left: inherit !important;
}</style><script src="https://utteranc.es/client.js" repo="qmacro/qmacro.github.io" issue-term="title" crossorigin="anonymous" async></script><nav class="post__pagination"><a href="/blog/posts/2024/08/24/new-source-for-lxd-images-on-crostini/"><span>←</span> <span>New source for LXD images on Crostini</span> </a><a href="/blog/posts/2024/07/24/automatic-validation-in-odata-and-rest-calls-with-cap/"><span>Automatic validation in OData and REST calls with CAP</span> <span>→</span></a></nav></aside></article></main><footer class="footer"><div class="footer__content"><ul class="hero__social-links"><li><a rel="me" href="https://github.com/qmacro" target="_blank" rel="noopener noreferrer">GitHub</a></li><li><a rel="me" href="https://www.youtube.com/djadams-qmacro" target="_blank" rel="noopener noreferrer">YouTube</a></li><li><a rel="me" href="https://www.linkedin.com/in/djadams/" target="_blank" rel="noopener noreferrer">LinkedIn</a></li><li><a rel="me" href="https://hachyderm.io/@qmacro" target="_blank" rel="noopener noreferrer">Mastodon</a></li><li><a rel="me" href="https://bsky.app/profile/qmacro.bsky.social" target="_blank" rel="noopener noreferrer">Bluesky</a></li><li><a href="/feed.xml" target="_blank" rel="noopener noreferrer">RSS</a></li></ul></div></footer></div><script src="/assets/main.31d6cfe0d16ae931b73c.js"></script></body></html>