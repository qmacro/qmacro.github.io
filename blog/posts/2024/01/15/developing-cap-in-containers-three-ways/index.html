<!doctype html>
<html lang="en">
	<head>
		<meta charset="utf-8">
		<meta name="viewport" content="width=device-width, initial-scale=1.0">
		<title>Developing CAP in containers - three ways</title>
		<meta name="description" content="Reserving the right to be wrong.">
		<link rel="alternate" href="/feed/feed.xml" type="application/atom+xml" title="DJ Adams">
		<link rel="icon" type="image/x-icon" href="/images/favicon.ico">

      <meta property="og:title" content="Developing CAP in containers - three ways">
        <meta property="og:site_name" content="DJ Adams">
          <meta property="og:image" content="/images/site-image.png">
        <meta property="og:description" content="Reserving the right to be wrong.">
        <meta property="og:url" content="https://qmacro.org/blog/posts/2024/01/15/developing-cap-in-containers-three-ways/">
		
		
		
		<style>/* This is an arbitrary CSS string added to the bundle */
/* Defaults */
:root {
	--font-family: -apple-system, system-ui, sans-serif;
	--font-family-monospace: Consolas, Menlo, Monaco, Andale Mono WT, Andale Mono, Lucida Console, Lucida Sans Typewriter, DejaVu Sans Mono, Bitstream Vera Sans Mono, Liberation Mono, Nimbus Mono L, Courier New, Courier, monospace;
}

/* Theme colors */
:root {
	--color-gray-20: #e0e0e0;
	--color-gray-50: #C0C0C0;
	--color-gray-90: #333;

	--background-color: #fff;

	--text-color: var(--color-gray-90);
	--text-color-link: #2884d2;
	--text-color-link-active: #15b0ed;
	--text-color-link-visited: #9f4199;

	--syntax-tab-size: 2;
}

@media (prefers-color-scheme: dark) {
	:root {
		--color-gray-20: #e0e0e0;
		--color-gray-50: #C0C0C0;
		--color-gray-90: #dad8d8;

		/* --text-color is assigned to --color-gray-_ above */
		--text-color-link: #1493fb;
		--text-color-link-active: #6969f7;
		--text-color-link-visited: #a6a6f8;

		--background-color: #15202b;
	}
}


/* Global stylesheet */
* {
	box-sizing: border-box;
}

@view-transition {
	navigation: auto;
}

html,
body {
	padding: 0;
	margin: 0 auto;
	font-family: var(--font-family);
	color: var(--text-color);
	background-color: var(--background-color);
}
html {
	overflow-y: scroll;
}
body {
	max-width: 40em;
}

/* https://www.a11yproject.com/posts/how-to-hide-content/ */
.visually-hidden:not(:focus):not(:active) {
	clip: rect(0 0 0 0);
	clip-path: inset(50%);
	height: 1px;
	overflow: hidden;
	position: absolute;
	white-space: nowrap;
	width: 1px;
}

/* Fluid images via https://www.zachleat.com/web/fluid-images/ */
img{
  max-width: 100%;
}
img[width][height] {
  height: auto;
}
img[src$=".svg"] {
  width: 100%;
  height: auto;
  max-width: none;
}
video,
iframe {
	width: 100%;
	height: auto;
}
iframe {
	aspect-ratio: 16/9;
}

p:last-child {
	margin-bottom: 0;
}
p {
	line-height: 1.5;
}

li {
	line-height: 1.5;
}

a[href] {
	color: var(--text-color-link);
}
a[href]:visited {
	color: var(--text-color-link-visited);
}
a[href]:hover,
a[href]:active {
	color: var(--text-color-link-active);
}

main,
footer {
	padding: 1rem;
}
/* main :first-child { */
/* 	margin-top: 0; */
/* } */

header {
	border-bottom: 1px dashed var(--color-gray-20);
}

#skip-link {
	text-decoration: none;
	background: var(--background-color);
	color: var(--text-color);
	padding: 0.5rem 1rem;
	border: 1px solid var(--color-gray-90);
	border-radius: 2px;
}

/* Prevent visually-hidden skip link fom pushing content around when focused */
#skip-link.visually-hidden:focus {
	position: absolute;
	top: 1rem;
	left: 1rem;
	/* Ensure it is positioned on top of everything else when it is shown */
	z-index: 999;
}

.links-nextprev {
	display: flex;
	justify-content: space-between;
	gap: .5em 1em;
	list-style: "";
	border-top: 1px dashed var(--color-gray-20);
	padding: 1em 0;
}
.links-nextprev > * {
	flex-grow: 1;
}
.links-nextprev-next {
	text-align: right;
}

table {
	margin: 1em 0;
}
table td,
table th {
	padding-right: 1em;
}

pre,
code {
	font-family: var(--font-family-monospace);
	color: seagreen;
}

pre,code[class*="language-"] {
	line-height: 1.2em !important;
	font-size: 0.93em !important;
}

pre:not([class*="language-"]) {
	margin: .5em 0;
	line-height: 1.375; /* 22px /16 */
	-moz-tab-size: var(--syntax-tab-size);
	-o-tab-size: var(--syntax-tab-size);
	tab-size: var(--syntax-tab-size);
	-webkit-hyphens: none;
	-ms-hyphens: none;
	hyphens: none;
	direction: ltr;
	text-align: left;
	white-space: pre;
	word-spacing: normal;
	word-break: normal;
	overflow-x: auto;
}
code {
	word-break: break-all;
}

/* Header */
header {
	display: flex;
	gap: 1em;
	flex-wrap: wrap;
	justify-content: space-between;
	align-items: center;
	padding: 1em;
}
.home-link {
	flex-grow: 1;
	font-size: 1em; /* 16px /16 */
	font-weight: 700;
}
.home-link:link:not(:hover) {
	text-decoration: none;
}

/* Nav */
.nav {
	display: flex;
	gap: .5em 1em;
	padding: 0;
	margin: 0;
	list-style: none;
}
.nav-item {
	display: inline-block;
}
.nav-item a[href]:not(:hover) {
	text-decoration: none;
}
.nav a[href][aria-current="page"] {
	text-decoration: underline;
}

/* Posts list */
.postlist {
	counter-reset: start-from var(--postlist-index);
	list-style: none;
	padding: 0;
}
.postlist-item {
	display: flex;
	flex-wrap: wrap;
	align-items: baseline;
	counter-increment: start-from -1;
	margin-bottom: 1em;
}
.postlist-item:before {
	display: inline-block;
	pointer-events: none;
	line-height: 100%;
	text-align: right;
	margin-left: -1.5rem;
}
.postlist-date,
.postlist-item:before {
	font-size: 0.8125em; /* 13px /16 */
	color: var(--color-gray-90);
}
.postlist-date {
	word-spacing: -0.5px;
}
.postlist-link {
	font-size: 1.1875em; /* 19px /16 */
	font-weight: 700;
	flex-basis: calc(100% - 1.5rem);
	text-underline-position: from-font;
	text-underline-offset: 0;
	text-decoration-thickness: 1px;
}
.postlist-item-active .postlist-link {
	font-weight: bold;
}

/* Tags */
.post-tag {
	display: inline-flex;
	align-items: center;
	justify-content: center;
	font-style: italic;
}

/* may want to make the description text smaller at some stage */
.post-description-list {
	font-size: 1.0em;
}

.post-description-main {
	font-style: italic;
}

.postlist-item > .post-tag {
	align-self: center;
}

/* Tags list */
.post-metadata {
	display: inline-flex;
	flex-wrap: wrap;
	gap: .5em;
	list-style: none;
	padding: 0;
	margin: 0;
}
.post-metadata time {
	margin-right: 1em;
}

blockquote {
	margin-top: 0px;
	margin-left: 0px;
	margin-bottom: 15px;
	padding-left: 15px;
	border-left: 5px solid lightgray;
}
/**
 * prism.js default theme for JavaScript, CSS and HTML
 * Based on dabblet (http://dabblet.com)
 * @author Lea Verou
 */

code[class*="language-"],
pre[class*="language-"] {
	color: black;
	background: none;
	text-shadow: 0 1px white;
	font-family: Consolas, Monaco, 'Andale Mono', 'Ubuntu Mono', monospace;
	font-size: 1em;
	text-align: left;
	white-space: pre;
	word-spacing: normal;
	word-break: normal;
	word-wrap: normal;
	line-height: 1.5;

	-moz-tab-size: 4;
	-o-tab-size: 4;
	tab-size: 4;

	-webkit-hyphens: none;
	-moz-hyphens: none;
	-ms-hyphens: none;
	hyphens: none;
}

pre[class*="language-"]::-moz-selection, pre[class*="language-"] ::-moz-selection,
code[class*="language-"]::-moz-selection, code[class*="language-"] ::-moz-selection {
	text-shadow: none;
	background: #b3d4fc;
}

pre[class*="language-"]::selection, pre[class*="language-"] ::selection,
code[class*="language-"]::selection, code[class*="language-"] ::selection {
	text-shadow: none;
	background: #b3d4fc;
}

@media print {
	code[class*="language-"],
	pre[class*="language-"] {
		text-shadow: none;
	}
}

/* Code blocks */
pre[class*="language-"] {
	padding: 1em;
	margin: .5em 0;
	overflow: auto;
}

:not(pre) > code[class*="language-"],
pre[class*="language-"] {
	background: #f5f2f0;
}

/* Inline code */
:not(pre) > code[class*="language-"] {
	padding: .1em;
	border-radius: .3em;
	white-space: normal;
}

.token.comment,
.token.prolog,
.token.doctype,
.token.cdata {
	color: slategray;
}

.token.punctuation {
	color: #999;
}

.token.namespace {
	opacity: .7;
}

.token.property,
.token.tag,
.token.boolean,
.token.number,
.token.constant,
.token.symbol,
.token.deleted {
	color: #905;
}

.token.selector,
.token.attr-name,
.token.string,
.token.char,
.token.builtin,
.token.inserted {
	color: #690;
}

.token.operator,
.token.entity,
.token.url,
.language-css .token.string,
.style .token.string {
	color: #9a6e3a;
	/* This background color was intended by the author of this theme. */
	background: hsla(0, 0%, 100%, .5);
}

.token.atrule,
.token.attr-value,
.token.keyword {
	color: #07a;
}

.token.function,
.token.class-name {
	color: #DD4A68;
}

.token.regex,
.token.important,
.token.variable {
	color: #e90;
}

.token.important,
.token.bold {
	font-weight: bold;
}
.token.italic {
	font-style: italic;
}

.token.entity {
	cursor: help;
}
/*
 * New diff- syntax
 */

pre[class*="language-diff-"] {
	--eleventy-code-padding: 1.25em;
	padding-left: var(--eleventy-code-padding);
	padding-right: var(--eleventy-code-padding);
}
.token.deleted {
	background-color: hsl(0, 51%, 37%);
	color: inherit;
}
.token.inserted {
	background-color: hsl(126, 31%, 39%);
	color: inherit;
}

/* Make the + and - characters unselectable for copy/paste */
.token.prefix.unchanged,
.token.prefix.inserted,
.token.prefix.deleted {
	-webkit-user-select: none;
	user-select: none;
	display: inline-flex;
	align-items: center;
	justify-content: center;
	padding-top: 2px;
	padding-bottom: 2px;
}
.token.prefix.inserted,
.token.prefix.deleted {
	width: var(--eleventy-code-padding);
	background-color: rgba(0,0,0,.2);
}

/* Optional: full-width background color */
.token.inserted:not(.prefix),
.token.deleted:not(.prefix) {
	display: block;
	margin-left: calc(-1 * var(--eleventy-code-padding));
	margin-right: calc(-1 * var(--eleventy-code-padding));
	text-decoration: none; /* override del, ins, mark defaults */
	color: inherit; /* override del, ins, mark defaults */
}
.utterances {
  margin-left: inherit !important;
}</style>
		

    <!-- Global site tag (gtag.js) - Google Analytics -->
    <script async="" src="https://www.googletagmanager.com/gtag/js?id=G-4WQKBG0L4Y"></script>
    

	</head>
	<body>
		<a href="#main" id="skip-link" class="visually-hidden">Skip to main content</a>

		<header>
			<a href="/" class="home-link">DJ Adams</a>
			<nav>
				<h2 class="visually-hidden" id="top-level-navigation-menu">Top level navigation menu</h2>
				<ul class="nav">
					<li class="nav-item"><a href="/">Home</a></li>
					<li class="nav-item"><a href="/about/">About</a></li>
					<li class="nav-item"><a href="/blog/">Blog</a></li>
					<li class="nav-item"><a href="/feed/feed.xml">Feed</a></li>
				</ul>
			</nav>
		</header>

		<main id="main">
			<heading-anchors>
				


<h1 id="developing-cap-in-containers-three-ways">Developing CAP in containers - three ways</h1>

<ul class="post-metadata">
	<li><time datetime="2024-01-15">15 January 2024</time></li>
	<li><a href="/tags/containers/" class="post-tag">containers</a>, </li>
	<li><a href="/tags/devcontainer/" class="post-tag">devcontainer</a>, </li>
	<li><a href="/tags/cap/" class="post-tag">cap</a>, </li>
	<li><a href="/tags/vscode/" class="post-tag">vscode</a>, </li>
	<li><a href="/tags/linux/" class="post-tag">linux</a>, </li>
	<li><a href="/tags/github/" class="post-tag">github</a>, </li>
	<li><a href="/tags/bas/" class="post-tag">bas</a></li>
</ul>

<p class="post-description-main"></p>

<p>On Friday last week we had the first <a href="https://blogs.sap.com/2020/11/09/an-overview-of-sap-developers-video-content/#shows">Hands-on SAP Dev</a> live stream of 2024, and it was the first episode in a new &quot;back to basics&quot; series on the SAP Cloud Application Programming Model (or CAP, to us humans), specifically with Node.js.</p>
<p><a href="https://www.youtube.com/watch?v=gu5r1EWSDSU"><img src="/images/2024/01/capb2b-1-thumbnail.png" alt="Back to basics with SAP CAP live stream episode 1 thumbnail"></a></p>
<p><a href="https://www.youtube.com/watch?v=gu5r1EWSDSU">https://www.youtube.com/watch?v=gu5r1EWSDSU</a></p>
<h2 id="background">Background</h2>
<p>In it we went through what's required for local development, following the guide in the <a href="https://cap.cloud.sap/docs/get-started/jumpstart">Jumpstart Development section of Capire</a> (&quot;Capire&quot; is the friendly name given to the CAP documentation).</p>
<p>Over the years I've gone through many laptop and desktop machines, with different operating systems, and installed plenty of tools. Up until recently I've also fairly regularly wiped the operating system completely on those machines and reinstalled everything, or at least reinstalled the tools that I still needed. This was because over time my machines got full of cruft and slowed me down, because I didn't always have the right version of, say, Python, or I needed to run multiple different versions of Node.js*, or something that I'd previously installed was preventing the install of something new that I needed.</p>
<p>* Yes I know about tools like <a href="https://github.com/nvm-sh/nvm">nvm</a>, and similar ones for managing multiple versions of other languages and tools, and I've used many of them. But they have always felt like a sticking plaster, rather than a solution. While I'm on this aside, I came across <a href="https://github.com/asdf-vm/asdf">asdf</a> recently which goes one step further in an attempt to be &quot;one version manager to rule them all&quot;. But I'm still only half convinced.</p>
<p>Bottom line is that as I move from project to project, from one tool requirement to another, from one language or language version to another, there's inevitably a wake of install froth, a trail of untidy and unwanted software on my machine. There has to be a better way.</p>
<p>That better way is dev containers.</p>
<p>Working inside a dev container gives me everything I need in a concise package, that I can turn on and off, start up and shut down, mess up and recreate, and share with others so that they have exactly the same environment (and versions of tools and runtimes) as me. What's more, while in most folks' ideal scenario, those dev containers run on their local machine, they're independent, and also I often run dev containers on remote machines and connect to them from my local machine.</p>
<p>Put simply, developing in a dev container is a great way to:</p>
<ul>
<li>get started with a ready-made set of tools exactly for the job</li>
<li>avoid getting distracted by the often challenging requirements of installing tools</li>
<li>use a focused environment without disturbing anything on your local (host) machine</li>
<li>experiment and risk breaking everything, because you can start again in seconds</li>
<li>share your development context with team members, for collaborative or debugging purposes</li>
</ul>
<h2 id="developing-with-cap-node-js-in-a-container">Developing with CAP Node.js in a container</h2>
<p>The list of install requirements in the <a href="https://cap.cloud.sap/docs/get-started/jumpstart">Jumpstart Development</a> section looked like an ideal situation for a dev container.</p>
<p>Especially given the context of folks joining the live stream episodes and wanting to play along, often on laptops that they don't have admin access to to install stuff, or on machines they simply don't want to install anything else on.</p>
<p>I see this often in the <a href="https://groups.community.sap.com/t5/sap-codejam/eb-p/codejam-events">SAP CodeJams that we run</a>; attendees' corporate laptops are often locked down, and it can be that a significant amount of time is spent at the start of the day just trying to get stuff installed, fighting with policies, or with the operating system, access rights, or even simply badly behaved install mechanisms. All that before getting to the real content of the day is distracting, tedious and not what anyone wants especially at the start of a new learning journey.</p>
<p>In this post I describe three ways to develop with CAP Node.js in a container context.</p>
<p><a name="adevcontainerdefinition"></a></p>
<h2 id="a-dev-container-definition">A dev container definition</h2>
<p>Two of those ways involve a dev container definition. So let's look at that first.</p>
<p>Given the <a href="https://cap.cloud.sap/docs/get-started/jumpstart">install requirements</a>, I created a <a href="https://github.com/qmacro/capb2b">small repo</a> containing essentially of a <code>.devcontainer/</code> directory, following the <a href="https://containers.dev/">containers.dev</a> approach, which, while it started as a mechanism in VS Code specifically is now an open standard*.</p>
<p>* Another example of something great, and open, that many of us use in our own editor environments, but started life originally in VS Code, is the <a href="https://en.wikipedia.org/wiki/Language_Server_Protocol">Language Server Protocol</a>, which I use in my Neovim-based editor setup. More on that another time, perhaps.</p>
<p>The entire content of the repo looks like this:</p>
<pre class="language-text" tabindex="0"><code class="language-text">../capb2b
|-- .devcontainer
|   |-- Dockerfile
|   `-- devcontainer.json
`-- README.md</code></pre>
<p>The contents of <code>devcontainer.json</code> are as follows:</p>
<pre class="language-json" tabindex="0"><code class="language-json"><span class="token punctuation">{</span>
  <span class="token property">"name"</span><span class="token operator">:</span> <span class="token string">"Back to basics - SAP CAP - dev container"</span><span class="token punctuation">,</span>
  <span class="token property">"build"</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token property">"dockerfile"</span><span class="token operator">:</span> <span class="token string">"Dockerfile"</span><span class="token punctuation">,</span>
    <span class="token property">"args"</span><span class="token operator">:</span> <span class="token punctuation">{</span> <span class="token property">"VARIANT"</span><span class="token operator">:</span> <span class="token string">"20"</span> <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token property">"customizations"</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token property">"vscode"</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token property">"extensions"</span><span class="token operator">:</span> <span class="token punctuation">[</span>
        <span class="token string">"sapse.vscode-cds"</span><span class="token punctuation">,</span>
        <span class="token string">"dbaeumer.vscode-eslint"</span><span class="token punctuation">,</span>
        <span class="token string">"humao.rest-client"</span><span class="token punctuation">,</span>
        <span class="token string">"qwtel.sqlite-viewer"</span><span class="token punctuation">,</span>
        <span class="token string">"mechatroner.rainbow-csv"</span>
      <span class="token punctuation">]</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token property">"forwardPorts"</span><span class="token operator">:</span> <span class="token punctuation">[</span> <span class="token number">4004</span> <span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token property">"remoteUser"</span><span class="token operator">:</span> <span class="token string">"node"</span>
<span class="token punctuation">}</span></code></pre>
<p>This describes what VS Code should do with regards to opening the contents of the directory, which is, briefly:</p>
<ul>
<li>create a container from the image described in the <code>Dockerfile</code></li>
<li>if that image needs to be built, then supply a build argument setting <code>VARIANT</code> to <code>20</code></li>
<li>add some extensions inside the container once it's been created and VS Code has attached to it</li>
<li>expose port 4004 from the container to the host machine (so that we can connect to a service running there, from the browser on our host (i.e. <code>http://localhost:4004</code>)</li>
<li>run the container as the user <code>node</code>*</li>
</ul>
<p>* This is rather than the user <code>root</code>, which is less desirable, for security reasons. Note that the base image for the container needs to have this <code>node</code> user already created (and in the case of the base image here, it is, as can be seen from <a href="https://github.com/devcontainers/images/blob/main/src/javascript-node/.devcontainer/Dockerfile">its definition</a>).</p>
<p>The dev container image itself is described in <code>Dockerfile</code> thus:</p>
<pre class="language-dockerfile" tabindex="0"><code class="language-dockerfile"><span class="token comment"># syntax=docker/dockerfile:1</span>

<span class="token instruction"><span class="token keyword">ARG</span> VARIANT=<span class="token string">"20"</span></span>
<span class="token instruction"><span class="token keyword">FROM</span> mcr.microsoft.com/vscode/devcontainers/javascript-node:0-<span class="token variable">${VARIANT}</span></span>

<span class="token comment"># Install some generally useful tools</span>
<span class="token instruction"><span class="token keyword">RUN</span> apt-get update &amp;&amp; apt-get -y install --no-install-recommends curl git sqlite3</span>

<span class="token comment"># Install SAP CAP SDK globally</span>
<span class="token instruction"><span class="token keyword">USER</span> node</span>
<span class="token instruction"><span class="token keyword">RUN</span> npm install -g @sap/cds-dk</span>
<span class="token instruction"><span class="token keyword">WORKDIR</span> /home/node</span></code></pre>
<p>The base image from which this one is made is a <a href="https://hub.docker.com/_/microsoft-devcontainers-javascript-node">Node.js Development Container Image</a>, specifically (via the default value for the <code>VARIANT</code> arg):</p>
<pre class="language-text" tabindex="0"><code class="language-text">mcr.microsoft.com/devcontainers/javascript-node:20</code></pre>
<p>The 20 refers to the Node.js major version. This <code>VARIANT</code> is the same build argument referenced in the <code>devcontainer.json</code> file.</p>
<p>So going back to the install list in the <a href="https://cap.cloud.sap/docs/get-started/jumpstart">Jumpstart Development</a> section, that's Node.js taken care of.</p>
<p>On top of that base some core tools are installed:</p>
<ul>
<li><code>git</code>, for source code control (also listed)</li>
<li><code>sqlite3</code>, because at some stage we'll probably want to look inside the files that are used as the default SQLite-based persistence store in development</li>
<li><code>curl</code>, of course (&quot;because curl&quot;)</li>
</ul>
<p>Finally the CAP development kit, in the form of the NPM package <a href="https://www.npmjs.com/package/@sap/cds-dk">@sap/cds-dk</a>, is installed (globally, with the <code>-g</code> option, but remember that's just globally within a given container image). This gives us access to the <code>cds</code> command, which is a multi-faceted tool essential for CAP development.</p>
<p>The only other item on the list is &quot;Java and Maven&quot; but of course that's not relevant here for Node.js flavoured CAP.</p>
<p>So that's everything needed.</p>
<h2 id="the-three-approaches">The three approaches</h2>
<p>As I mentioned before, two approaches involve this dev container definition. One is local, the other one is remote. I'll describe the local approach first.</p>
<p><a name="vscodeanddockerdesktop"></a></p>
<h3 id="with-vs-code-and-docker-desktop">With VS Code and Docker Desktop</h3>
<p>VS Code is available for pretty much all platforms. As is Docker Desktop. And, in the continued context of avoiding installation of tools locally, I would say that these two are exceptions. I mean, my main editor is of course (Neo)vim, inside my <a href="/blog/posts/2024/01/09/a-seeimple-jq-repl-with-tmux-bash-vim-and-entr/">terminal-based IDE</a> but if I were to use a more graphical IDE I'd want it running locally and directly on the host OS (as I like my terminal emulator to run locally). And I see Docker Desktop in a similar way to how I see a VM manager like VirtualBox or VMWare Fusion, for example. An extension of the host OS.</p>
<p>Anyway, I digress, and not for the first time. Talking of digressions, I'm not going to go into Docker Desktop, licencing, and alternatives (such as Podman Desktop) here. That's a topic for another time.</p>
<p>So, here's how it works. With the contents of the <a href="https://github.com/qmacro/capb2b">repo</a> locally, I start VS Code locally on my macOS host, and open that directory. And this is what happens:</p>
<p><img src="/images/2024/01/vscode-open-folder.gif" alt="Opening directory in VS Code"></p>
<p>You can see that:</p>
<ul>
<li>VS Code recognises the <code>.devcontainer/</code> directory within the directory just opened, and consequently offers the &quot;Reopen in Container&quot; option</li>
<li>a container based on the image described in that <code>.devcontainer/</code> directory is created and VS Code connects to it</li>
<li>VS Code indicates this remote connection in the bottom left (first displaying &quot;Opening remote&quot; and then &quot;Dev Container: Back to basics - SAP CAP&quot;*)</li>
</ul>
<p>* Yes, this description is from the <code>name</code> property in the <code>devcontainer.json</code> file.</p>
<p>After opening a terminal in VS Code, we can see the shell prompt which indicates that:</p>
<ul>
<li>the shell in the terminal is Bash</li>
<li>the operating system is Linux</li>
<li>we are running as user <code>node</code></li>
<li>the <code>git</code>, <code>curl</code> and <code>cds</code> commands are available</li>
</ul>
<p>By inspecting various Docker resources, we can see what's happened behind the scenes.</p>
<p>First, there's a new image <code>vsc-capb2b-main-72ec...</code>:</p>
<pre class="language-shell" tabindex="0"><code class="language-shell"><span class="token punctuation">;</span> <span class="token function">docker</span> image <span class="token function">ls</span>
REPOSITORY                 TAG       IMAGE ID    
newdev                     latest    117d08c98a2b
vsc-capb2b-main-72ec00<span class="token punctuation">..</span>.  latest    dd71ceb116fb
codejam                    latest    7fb76bf1a160</code></pre>
<p>This image is indeed the one built according to the instructions in <code>.devcontainer/</code> as we can see from the image's metadata:</p>
<pre class="language-shell" tabindex="0"><code class="language-shell"><span class="token punctuation">;</span> <span class="token function">docker</span> image inspect dd71 <span class="token punctuation">\</span>
  <span class="token operator">|</span> jq <span class="token string">'first.Config.Labels["devcontainer.metadata"] | fromjson'</span>
<span class="token punctuation">[</span>
  <span class="token punctuation">{</span>
    <span class="token string">"..."</span><span class="token builtin class-name">:</span> <span class="token string">"..."</span>,
  <span class="token punctuation">}</span>,
  <span class="token punctuation">{</span>
    <span class="token string">"customizations"</span><span class="token builtin class-name">:</span> <span class="token punctuation">{</span>
      <span class="token string">"vscode"</span><span class="token builtin class-name">:</span> <span class="token punctuation">{</span>
        <span class="token string">"extensions"</span><span class="token builtin class-name">:</span> <span class="token punctuation">[</span>
          <span class="token string">"sapse.vscode-cds"</span>,
          <span class="token string">"dbaeumer.vscode-eslint"</span>,
          <span class="token string">"humao.rest-client"</span>,
          <span class="token string">"qwtel.sqlite-viewer"</span>,
          <span class="token string">"mechatroner.rainbow-csv"</span>
        <span class="token punctuation">]</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>,
    <span class="token string">"remoteUser"</span><span class="token builtin class-name">:</span> <span class="token string">"node"</span>,
    <span class="token string">"forwardPorts"</span><span class="token builtin class-name">:</span> <span class="token punctuation">[</span>
      <span class="token number">4004</span>
    <span class="token punctuation">]</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">]</span></code></pre>
<p>From this image a container has been created, and to which VS Code has connected:</p>
<pre class="language-shell" tabindex="0"><code class="language-shell"><span class="token punctuation">;</span> <span class="token function">docker</span> container <span class="token function">ls</span>
CONTAINER ID   IMAGE                      COMMAND                  CREATED        
16c6e1a6b28f   vsc-capb2b-main-72ec00<span class="token punctuation">..</span>.  <span class="token string">"/bin/sh -c 'echo Co…"</span>   <span class="token number">5</span> minutes ago
0b286ef3c7cf   newdev                     <span class="token string">"tmux -u"</span>                <span class="token number">2</span> days ago    
f29a13b910be   alpine/socat               <span class="token string">"socat tcp-listen:23…"</span>   <span class="token number">2</span> days ago     </code></pre>
<p>There's plenty of interesting detail to see when we inspect this container, but for now let's just limit it to having a look for mounts:</p>
<pre class="language-shell" tabindex="0"><code class="language-shell"><span class="token punctuation">;</span> <span class="token function">docker</span> container inspect 16c6 <span class="token operator">|</span> jq <span class="token string">'first.HostConfig.Mounts'</span>
<span class="token punctuation">[</span>
  <span class="token punctuation">{</span>
    <span class="token string">"Type"</span><span class="token builtin class-name">:</span> <span class="token string">"bind"</span>,
    <span class="token string">"Source"</span><span class="token builtin class-name">:</span> <span class="token string">"/Users/I347491/work/scratch/capb2b-main"</span>,
    <span class="token string">"Target"</span><span class="token builtin class-name">:</span> <span class="token string">"/workspaces/capb2b-main"</span>,
    <span class="token string">"Consistency"</span><span class="token builtin class-name">:</span> <span class="token string">"cached"</span>
  <span class="token punctuation">}</span>,
  <span class="token punctuation">{</span>
    <span class="token string">"Type"</span><span class="token builtin class-name">:</span> <span class="token string">"volume"</span>,
    <span class="token string">"Source"</span><span class="token builtin class-name">:</span> <span class="token string">"vscode"</span>,
    <span class="token string">"Target"</span><span class="token builtin class-name">:</span> <span class="token string">"/vscode"</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">]</span></code></pre>
<p>We can see we have a bind mount of the directory we opened in VS Code, i.e. the <code>capb2b-main/</code> directory, which makes sense, as we want to access resources in there from within the container.</p>
<pre class="language-text" tabindex="0"><code class="language-text">+---------------------------------- host (macOS) -------+
| /Users/                                               |
|   |                                                   |
|   +- I347491/                                         |
|       |                                               |
|       +- work/                                        |
|           |                                           |
|           +- scratch/                                 |
|               |                                       |
|    +--------  +- capb2b-main/                         |
|    |              |                                   |
|    |              +- .devcontainer/                   |
|    |              +- README.md                        |
|    |                                                  |
|  bind mount                                           |
|    |                                                  |
|    |                                                  |
|    |          +------------- container (Linux) --+    |
|    |          | /workspaces/                     |    |
|    |          |   |                              |    |
|    +------------> +- capb2b-main/                |    |
|               |                                  |    |
|               +----------------------------------+    |
|                                                       |
+-------------------------------------------------------+</code></pre>
<p>Moreover, it wouldn't make sense to store our CAP app resources inside the container as they'd be lost if the container was removed. Notice that the value of the <code>Target</code> property in this bind mount, <code>/workspaces/capb2b-main</code>, matches the directory we're in, shown in the shell prompt in the terminal in VS Code:</p>
<pre class="language-text" tabindex="0"><code class="language-text">node ➜ /workspaces/capb2b-main $</code></pre>
<p>There's another mount, this time a volume mount. This has caused a volume to be created, which we can see thus:</p>
<pre class="language-shell" tabindex="0"><code class="language-shell"><span class="token punctuation">;</span> <span class="token function">docker</span> volume <span class="token function">ls</span>
DRIVER    VOLUME NAME
<span class="token builtin class-name">local</span>     vscode</code></pre>
<p>But what's in it? Well, we can see where this volume is mounted (in the <code>Target</code> property), so, in the terminal still running in VS Code, let's have a brief look:</p>
<pre class="language-shell" tabindex="0"><code class="language-shell"><span class="token function">node</span> ➜ /workspaces/capb2b-main $ tree <span class="token parameter variable">-L</span> <span class="token number">3</span> /vscode
/vscode
└── vscode-server
    ├── bin
    │   └── linux-arm64
    └── extensionsCache
        ├── dbaeumer.vscode-eslint-2.4.2
        ├── humao.rest-client-0.25.1
        ├── mechatroner.rainbow-csv-3.11.0
        ├── qwtel.sqlite-viewer-0.3.13
        └── sapse.vscode-cds-7.5.0

<span class="token number">4</span> directories, <span class="token number">5</span> files</code></pre>
<p>That makes sense - it looks like VS Code uses this volume to store VS Code specific resources, such as the VS Code server components, and a cache for the extensions. Nice!</p>
<p>So at this point we can happily develop CAP apps and services, on our local machine, without having to have installed any CAP specific or peripheral tools locally on the host. We're inside a container, but the files we create in building our app are safe on the host-local file system.</p>
<p>We can see this as follows. If we initiate a new CAP project in the container, in the terminal inside VS Code, then we end up with a new directory containing the core files and directories for a Node.js CAP project (<code>app</code>, <code>srv</code> and <code>db</code> directories, plus a <code>package.json</code> file):</p>
<pre class="language-shell" tabindex="0"><code class="language-shell"><span class="token function">node</span> ➜ /workspaces/capb2b-main $ cds init bookshop
Creating new CAP project <span class="token keyword">in</span> ./bookshop

Adding feature <span class="token string">'nodejs'</span><span class="token punctuation">..</span>.

Successfully created project. Continue with <span class="token string">'cd bookshop'</span><span class="token builtin class-name">.</span>
Find samples on https://github.com/SAP-samples/cloud-cap-samples
Learn about next steps at https://cap.cloud.sap
<span class="token function">node</span> ➜ /workspaces/capb2b-main $ <span class="token builtin class-name">cd</span> bookshop/
<span class="token function">node</span> ➜ /workspaces/capb2b-main/bookshop $ <span class="token function">ls</span> <span class="token parameter variable">-l</span>
total <span class="token number">8</span>
drwxr-xr-x <span class="token number">2</span> <span class="token function">node</span> <span class="token function">node</span>  <span class="token number">64</span> Jan <span class="token number">15</span> 09:46 app
drwxr-xr-x <span class="token number">2</span> <span class="token function">node</span> <span class="token function">node</span>  <span class="token number">64</span> Jan <span class="token number">15</span> 09:46 db
-rw-r--r-- <span class="token number">1</span> <span class="token function">node</span> <span class="token function">node</span> <span class="token number">348</span> Jan <span class="token number">15</span> 09:46 package.json
-rw-r--r-- <span class="token number">1</span> <span class="token function">node</span> <span class="token function">node</span> <span class="token number">675</span> Jan <span class="token number">15</span> 09:46 README.md
drwxr-xr-x <span class="token number">2</span> <span class="token function">node</span> <span class="token function">node</span>  <span class="token number">64</span> Jan <span class="token number">15</span> 09:46 srv</code></pre>
<p>And outside of the container, in the host macOS environment, we can also see these files locally:</p>
<pre class="language-shell" tabindex="0"><code class="language-shell">~ % <span class="token builtin class-name">cd</span> ~/work/scratch/capb2b-main
capb2b-main % <span class="token function">ls</span> <span class="token parameter variable">-l</span> bookshop
total <span class="token number">16</span>
-rw-r--r--@ <span class="token number">1</span> I347491  staff  <span class="token number">675</span> <span class="token number">15</span> Jan 09:46 README.md
drwxr-xr-x  <span class="token number">2</span> I347491  staff   <span class="token number">64</span> <span class="token number">15</span> Jan 09:46 app
drwxr-xr-x  <span class="token number">2</span> I347491  staff   <span class="token number">64</span> <span class="token number">15</span> Jan 09:46 db
-rw-r--r--  <span class="token number">1</span> I347491  staff  <span class="token number">348</span> <span class="token number">15</span> Jan 09:46 package.json
drwxr-xr-x  <span class="token number">2</span> I347491  staff   <span class="token number">64</span> <span class="token number">15</span> Jan 09:46 srv</code></pre>
<p>Great!</p>
<p><a name="githubcodespaces"></a></p>
<h3 id="with-github-codespaces">With GitHub Codespaces</h3>
<p>So now we've seen the local approach with this dev container definition, it's time to turn to the remote approach. This approach doesn't need VS Code, nor does it need Docker Desktop. All you need is a browser (tho you may be pleasantly surprised to learn that you can actually combine these two approaches - read on until the end to find out how).</p>
<p>The magic of this approach lies in <a href="https://github.com/features/codespaces">GitHub Codespaces</a>.</p>
<p>In the good old days, given a repository on GitHub, all the options to work with it involved downloading the repository content somehow (via <code>git</code> or a simple ZIP file download).</p>
<p>These days, all those options are now collected within a tab labelled &quot;Local&quot;, and there's also now another tab labelled &quot;Codespaces&quot; which offers the ability to create a working environment specificially for, and containing the content of, the repo.</p>
<p>Here is what happens:</p>
<p><img src="/images/2024/01/codespace-open-repo.gif" alt="Opening repo in a GitHub Codespace"></p>
<p>Beyond not needing anything more than a browser, the crazy thing is that this is pretty much exactly the same as what we see with the VS Code and Docker Desktop approach, except that everything is remote:</p>
<ul>
<li>a container is created from the image, again, according to the instructions in <code>.devcontainer/</code></li>
<li>an instance of VS Code is made available in the browser</li>
<li>this instance of VS Code then makes a &quot;remote connection&quot; to the container</li>
</ul>
<p>The upshot is that we have pretty much the same environment as we have in our local approach!</p>
<p><a name="sapbusinessapplicationstudio"></a></p>
<h3 id="with-sap-business-application-studio">With SAP Business Application Studio</h3>
<p>Talking of simple contexts where all we need is a browser brings me onto the third approach. This is also very similar to the GitHub Codespaces approach, in that it's all remote and all you need is a browser.</p>
<p>The <a href="https://www.sap.com/uk/products/technology-platform/business-application-studio.html">SAP Business Application Studio</a> (BAS) is an IDE in the cloud. With BAS, you can manage your projects in one or more so-called Dev Spaces, similar to Codespaces, and there are different Dev Space setup flavours available depending on your development project requirements.</p>
<p>Here's an example of the creation of a Dev Space (choosing the &quot;Full Stack Cloud Application&quot; flavour in the setup means that all the tools we need for CAP development will be available) and the cloning of the repo ready to start CAP development:</p>
<p><img src="/images/2024/01/bas-clone-repo.gif" alt="Starting a new Dev Space for CAP development"></p>
<p>Interestingly, <a href="https://blogs.sap.com/2022/11/15/sap-business-application-studio-now-powered-by-code-oss/">since autumn last year</a>, the underlying tech for Dev Spaces in BAS has been <a href="https://github.com/microsoft/vscode">Code - OSS</a>, the open source flavour of VS Code. This is why the three approaches (VS Code locally, GitHub Codespaces remotely, and now here with a BAS Dev Space) all look the same. That's because effectively they are the same, underneath, from an IDE perspective.</p>
<p>So here again is another way to develop CAP apps in what is effectively a container. The actual underlying mechanism may be slightly different, but the effect is the same, in that you don't have to install anything locally on your host machine.</p>
<h2 id="bonus-vs-code-and-codespaces">Bonus: VS Code and Codespaces</h2>
<p>In the <a href="#githubcodespaces">section on GitHub Codespaces</a> earlier, I mentioned in passing that it is actually possible to combine the local and remote approaches. Before I finish this post, I'll show that in action here.</p>
<p>Given a GitHub Codespace, it's not only possible to open that in the browser, as we saw earlier, but it's also possible to connect to it ... from VS Code running locally on your host. This is both obvious when you think about the underlying technology in use here, but at the same time it's sort of mind blowing that this is a thing. At least to me. Anyway, here it is in action:</p>
<p><img src="/images/2024/01/open-codespace-in-vscode.gif" alt="Opening a GitHub Codespace in VS Code"></p>
<p>What's happening here is that there's a <a href="https://marketplace.visualstudio.com/items?itemName=GitHub.codespaces">GitHub Codespaces extension</a> that I also now have installed in my local VS Code. This works in a similar way to the <a href="https://marketplace.visualstudio.com/items?itemName=ms-vscode-remote.remote-containers">Dev Containers</a> extension. In order for this to work the first time I tried it, I had to go through an authentication step which securely connected my VS Code to GitHub, via the <a href="https://vscode.github.com/">GitHub for VS Code</a> connected application (you don't see this step in the video above).</p>
<p>Visually it's almost the same too, except for the fact that the after the remote indicator (in the bottom left of VS Code) shows &quot;Opening remote&quot;, the final status is slightly different:</p>
<ul>
<li>VS Code and Docker Desktop: &quot;Dev Containers: Back to basics: SAP CAP&quot;</li>
<li>VS Code and GitHub Codespaces: &quot;Codespaces: redesigned potato*&quot;</li>
</ul>
<p>* The generated name of the Codespace is &quot;redesigned potato&quot;.</p>
<p>Of course, you can also start the connection from within VS Code, i.e. reach out to the remote container (Codespace) using the extension. Here's a quick demo of that in action:</p>
<p><img src="/images/2024/01/vscode-connect-to-codespace.gif" alt="Initiating a connection to a GitHub Codespace from VS Code"></p>
<h2 id="wrapping-up">Wrapping up</h2>
<p>All in all, the possibilities of container based development are, in my humble opinion, pretty excellent. I am also keeping a close eye on the <a href="https://containers.dev/">containers.dev initiative</a> plus various related projects, such as <a href="https://devpod.sh/">DevPod</a>, which I learned about in the <a href="https://www.youtube.com/watch?v=rvu2b0PiTR4">Open Source Dev Containers with DevPod</a> live stream episode on Bret Fisher's YouTube channel.</p>
<p>If you want to get started developing CAP apps and services, I would strongly recommend you look into using a container based setup, and take any one of the approaches outlined here.</p>
<p>Happy developing!</p>



<script src="https://utteranc.es/client.js" repo="qmacro/qmacro.github.io" issue-term="title" crossorigin="anonymous" async=""></script>

<ul class="links-nextprev"><li class="links-nextprev-prev">← Previous<br> <a href="/blog/posts/2024/01/09/battlestation-2024/">Battlestation 2024</a></li><li class="links-nextprev-next">Next →<br><a href="/blog/posts/2024/01/22/accuracy-and-precision-in-language/">Accuracy and precision in language</a></li>
</ul>

			</heading-anchors>
		</main>

		<!-- This page `/blog/posts/2024/01/15/developing-cap-in-containers-three-ways/` was built on 2026-01-06T07:40:23.835Z -->
		<script type="module" src="/dist/t-8sxMV3B9.js"></script>
	</body>
</html>
