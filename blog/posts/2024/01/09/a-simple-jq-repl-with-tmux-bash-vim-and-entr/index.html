<!doctype html><html lang="en"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1"><link rel="canonical" href="https://qmacro.org/blog/posts/2024/01/09/a-simple-jq-repl-with-tmux-bash-vim-and-entr/"><link rel="alternate" type="application/atom+xml" title="DJ's Weblog - Feed" href="https://qmacro.org/feed.xml"><link href="/assets/main.bed7db4098e5e4fe9224.css" rel="stylesheet"><link rel="preconnect" href="https://fonts.gstatic.com"><link href="https://fonts.googleapis.com/css2?family=IBM+Plex+Sans&display=swap" rel="stylesheet"><title>A simple jq REPL with tmux, bash, vim and entr | DJ Adams</title><link rel="icon" type="“image/x-icon”" href="/images/favicon.ico"><meta property="og:title" content="A simple jq REPL with tmux, bash, vim and entr"><meta property="og:site_name" content="DJ Adams"><meta property="og:type" content="website"><meta property="og:url" content="https://qmacro.org/blog/posts/2024/01/09/a-simple-jq-repl-with-tmux-bash-vim-and-entr/"><meta name="description" content="A simple jq REPL with tmux, bash, vim and entr 09 Jan 2024 | 2 min read In this quick post I show a simple JSON dataset explorer that gives..."><meta property="og:description" content="A simple jq REPL with tmux, bash, vim and entr 09 Jan 2024 | 2 min read In this quick post I show a simple JSON dataset explorer that gives..."><meta name="description" content="A simple jq REPL with tmux, bash, vim and entr 09 Jan 2024 | 2 min read In this quick post I show a simple JSON dataset explorer that gives..."><meta property="og:image" content="https://qmacro.org/images/site-image.png"><script src="https://cdn.jsdelivr.net/npm/mermaid/dist/mermaid.min.js"></script><script>mermaid.initialize({startOnLoad:true});</script><script async src="https://www.googletagmanager.com/gtag/js?id=G-4WQKBG0L4Y"></script><script>window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());

      gtag('config', 'G-4WQKBG0L4Y');</script></head><body><div class="layout-wrapper"><header class="header"><div class="header__content"><h1 class="site-title"><a href="/">DJ Adams</a></h1><nav class="nav"><ul class="nav__list"><li class="nav-item"><a href="/about">About Me</a></li><li class="nav-item"><a href="/blog">Blog</a></li><li class="nav-item"><a href="/feed.xml">Feed</a></li></ul></nav></div></header><main class="main"><article class="post"><header class="post__header"><h1>A simple jq REPL with tmux, bash, vim and entr</h1><div class="post__details"><time datetime="2024-01-09">09 Jan 2024 </time><span>| </span><span>2 min read</span></div></header><main class="post__content"><p>In this quick post I show a simple JSON dataset explorer that gives me a multi-line filter editor.</p><p>When it comes to exploring and processing JSON data, jq is my goto language. And for exploring, I will either just want to browse the entire JSON dataset, or filter with simple jq expressions.</p><h2>Browsing</h2><p>For browsing, I have a simple script <a href="https://github.com/qmacro/dotfiles/blob/main/scripts/jl">jl</a> (short for &quot;jq | less&quot;) which just uses the appropriate options to send a colourised pretty printed version of the JSON through <code>less</code>:</p><pre class="language-shell"><code class="language-shell"><span class="token shebang important">#!/usr/bin/env bash</span><br><br><span class="token comment"># JSON less</span><br><span class="token comment"># This is a script so that I can use it in lf</span><br>jq <span class="token parameter variable">-C</span> <span class="token builtin class-name">.</span> <span class="token operator">&lt;</span> <span class="token string">"<span class="token variable">$1</span>"</span> <span class="token operator">|</span> <span class="token function">less</span> <span class="token parameter variable">-R</span></code></pre><h2>Filtering and exploring</h2><p>For exploring, I often reach for <a href="https://sr.ht/~gpanders/ijq/">interactive jq</a>, which I love. There are similar Web-based tools, and both <code>ijq</code> and these Web-based tools follow the same three-window pattern:</p><ul><li>input: the source JSON</li><li>filter: my jq expression</li><li>output: the resulting JSON</li></ul><p>Most of these tools only give you a single filter line to enter your expression. For 80% of the time, that's perfectly fine, and I find myself enjoying the ease of exploration that <code>ijq</code> offers (see <a href="/tags/ijq">these posts on ijq</a>).</p><h3>jqte</h3><p>Sometimes though I find myself wanting a bit more space in the &quot;filter&quot; window, so I can use it more as a REPL, or at least as a multi-line filter editor, which, as a bonus, then gives me great syntax highlighting thanks to <a href="https://github.com/flurie/tree-sitter-jq">this TreeSitter plugin for jq</a> and linting thanks to <a href="https://github.com/wader/jq-lsp">this jq LSP server</a>.</p><p>My &quot;IDE&quot; is my terminal, and I run <code>bash</code> shells inside <code>tmux</code> (inside a dev container) and make use of the command line and all that the UNIX pipeline and large set of small tools has to offer. To that end, I have cobbled together a quick &quot;jq tmux based explorer&quot; <a href="https://github.com/qmacro/dotfiles/blob/main/scripts/jqte">jqte</a> which I can use to explore a JSON dataset.</p><p>Here's a short demo of it in action. The context in which I invoke <code>jqte products.json</code> is my IDE, i.e. I'm within my main <code>tmux</code> session:</p><p><img src="/images/2024/01/jqte.gif" alt="screencast"></p><p>It opens up a new <code>tmux</code> window with three panes (1, 2 and 3), as also described in the script itself:</p><pre class="language-text"><code class="language-text">+---------------------+----------------------+<br>| output              | original JSON data   |<br>|                     |                      |<br>|                     |                      |<br>|                     |                      |<br>|          1          |          2           |<br>|                     |                      |<br>|                     |                      |<br>|                     +----------------------|<br>|                     | filter               |<br>|                     |                      |<br>|                     |          3           |<br>|                     |                      |<br>+---------------------+----------------------+</code></pre><p>I'm placed directly into the &quot;filter&quot; pane which is a <code>neovim</code> session editing a temporary file that represents my jq filter, where the identity function <code>.</code> is specified as a starting point.</p><p>Every time I modify the filter the entire jq filter is applied to the source JSON and the result is displayed, in the &quot;output&quot; pane. This is achieved by the combination of a vim <code>autocmd</code> and the super useful <a href="https://github.com/eradman/entr">entr</a>.</p><p>When I'm done, I can close the entire <code>jqte</code> session using <code>tmux</code>'s normal &quot;kill-window&quot; facility which I invoke with <code>&lt;prefix&gt;&amp;</code>.</p></main><aside class="post__aside"><div class="post__tags"><a href="/tags/jq/">#jq</a> <a href="/tags/shell/">#shell</a> <a href="/tags/cli/">#cli</a> <a href="/tags/terminal/">#terminal</a> <a href="/tags/bash/">#bash</a> <a href="/tags/tmux/">#tmux</a> <a href="/tags/entr/">#entr</a> <a href="/tags/vim/">#vim</a></div><style>.utterances {
  margin-left: inherit !important;
}</style><script src="https://utteranc.es/client.js" repo="qmacro/qmacro.github.io" issue-term="title" crossorigin="anonymous" async></script><nav class="post__pagination"><a href="/blog/posts/2024/01/09/battlestation-2024/"><span>←</span> <span>Battlestation 2024</span> </a><a href="/blog/posts/2023/12/22/using-the-docker-cli-in-a-container-on-macos/"><span>Using the docker CLI in a container on macOS</span> <span>→</span></a></nav></aside></article></main><footer class="footer"><div class="footer__content"><ul class="hero__social-links"><li><a rel="me" href="https://github.com/qmacro" target="_blank" rel="noopener noreferrer">GitHub</a></li><li><a rel="me" href="https://www.youtube.com/djadams-qmacro" target="_blank" rel="noopener noreferrer">YouTube</a></li><li><a rel="me" href="https://www.linkedin.com/in/djadams/" target="_blank" rel="noopener noreferrer">LinkedIn</a></li><li><a rel="me" href="https://hachyderm.io/@qmacro" target="_blank" rel="noopener noreferrer">Mastodon</a></li><li><a href="/feed.xml" target="_blank" rel="noopener noreferrer">RSS</a></li></ul></div></footer></div><script src="/assets/main.31d6cfe0d16ae931b73c.js"></script></body></html>