<!doctype html>
<html lang="en">
	<head>
		<meta charset="utf-8">
		<meta name="viewport" content="width=device-width, initial-scale=1.0">
		<title>TASC Notes - Part 5</title>
		<meta name="description" content="Reserving the right to be wrong.">
		<link rel="alternate" href="/feed/feed.xml" type="application/atom+xml" title="DJ Adams">
		<link rel="icon" type="image/x-icon" href="/images/favicon.ico">

      <meta property="og:title" content="TASC Notes - Part 5">
        <meta property="og:site_name" content="DJ Adams">
          <meta property="og:image" content="/images/site-image.png">
        <meta property="og:description" content="Reserving the right to be wrong.">
        <meta property="og:url" content="https://qmacro.org/blog/posts/2024/12/13/tasc-notes-part-5/">
		
		
		
		<style>/* This is an arbitrary CSS string added to the bundle */
/* Defaults */
:root {
	--font-family: -apple-system, system-ui, sans-serif;
	--font-family-monospace: Consolas, Menlo, Monaco, Andale Mono WT, Andale Mono, Lucida Console, Lucida Sans Typewriter, DejaVu Sans Mono, Bitstream Vera Sans Mono, Liberation Mono, Nimbus Mono L, Courier New, Courier, monospace;
}

/* Theme colors */
:root {
	--color-gray-20: #e0e0e0;
	--color-gray-50: #C0C0C0;
	--color-gray-90: #333;

	--background-color: #fff;

	--text-color: var(--color-gray-90);
	--text-color-link: #2884d2;
	--text-color-link-active: #15b0ed;
	--text-color-link-visited: #9f4199;

	--syntax-tab-size: 2;
}

@media (prefers-color-scheme: dark) {
	:root {
		--color-gray-20: #e0e0e0;
		--color-gray-50: #C0C0C0;
		--color-gray-90: #dad8d8;

		/* --text-color is assigned to --color-gray-_ above */
		--text-color-link: #1493fb;
		--text-color-link-active: #6969f7;
		--text-color-link-visited: #a6a6f8;

		--background-color: #15202b;
	}
}


/* Global stylesheet */
* {
	box-sizing: border-box;
}

@view-transition {
	navigation: auto;
}

html,
body {
	padding: 0;
	margin: 0 auto;
	font-family: var(--font-family);
	color: var(--text-color);
	background-color: var(--background-color);
}
html {
	overflow-y: scroll;
}
body {
	max-width: 40em;
}

/* https://www.a11yproject.com/posts/how-to-hide-content/ */
.visually-hidden:not(:focus):not(:active) {
	clip: rect(0 0 0 0);
	clip-path: inset(50%);
	height: 1px;
	overflow: hidden;
	position: absolute;
	white-space: nowrap;
	width: 1px;
}

/* Fluid images via https://www.zachleat.com/web/fluid-images/ */
img{
  max-width: 100%;
}
img[width][height] {
  height: auto;
}
img[src$=".svg"] {
  width: 100%;
  height: auto;
  max-width: none;
}
video,
iframe {
	width: 100%;
	height: auto;
}
iframe {
	aspect-ratio: 16/9;
}

p:last-child {
	margin-bottom: 0;
}
p {
	line-height: 1.5;
}

li {
	line-height: 1.5;
}

a[href] {
	color: var(--text-color-link);
}
a[href]:visited {
	color: var(--text-color-link-visited);
}
a[href]:hover,
a[href]:active {
	color: var(--text-color-link-active);
}

main,
footer {
	padding: 1rem;
}
/* main :first-child { */
/* 	margin-top: 0; */
/* } */

header {
	border-bottom: 1px dashed var(--color-gray-20);
}

#skip-link {
	text-decoration: none;
	background: var(--background-color);
	color: var(--text-color);
	padding: 0.5rem 1rem;
	border: 1px solid var(--color-gray-90);
	border-radius: 2px;
}

/* Prevent visually-hidden skip link fom pushing content around when focused */
#skip-link.visually-hidden:focus {
	position: absolute;
	top: 1rem;
	left: 1rem;
	/* Ensure it is positioned on top of everything else when it is shown */
	z-index: 999;
}

.links-nextprev {
	display: flex;
	justify-content: space-between;
	gap: .5em 1em;
	list-style: "";
	border-top: 1px dashed var(--color-gray-20);
	padding: 1em 0;
}
.links-nextprev > * {
	flex-grow: 1;
}
.links-nextprev-next {
	text-align: right;
}

table {
	margin: 1em 0;
}
table td,
table th {
	padding-right: 1em;
}

pre,
code {
	font-family: var(--font-family-monospace);
	color: seagreen;
}

pre,code[class*="language-"] {
	line-height: 1.2em !important;
	font-size: 0.93em !important;
}

pre:not([class*="language-"]) {
	margin: .5em 0;
	line-height: 1.375; /* 22px /16 */
	-moz-tab-size: var(--syntax-tab-size);
	-o-tab-size: var(--syntax-tab-size);
	tab-size: var(--syntax-tab-size);
	-webkit-hyphens: none;
	-ms-hyphens: none;
	hyphens: none;
	direction: ltr;
	text-align: left;
	white-space: pre;
	word-spacing: normal;
	word-break: normal;
	overflow-x: auto;
}
code {
	word-break: break-word;
}

/* Header */
header {
	display: flex;
	gap: 1em;
	flex-wrap: wrap;
	justify-content: space-between;
	align-items: center;
	padding: 1em;
}
.home-link {
	flex-grow: 1;
	font-size: 1em; /* 16px /16 */
	font-weight: 700;
}
.home-link:link:not(:hover) {
	text-decoration: none;
}

/* Nav */
.nav {
	display: flex;
	gap: .5em 1em;
	padding: 0;
	margin: 0;
	list-style: none;
}
.nav-item {
	display: inline-block;
}
.nav-item a[href]:not(:hover) {
	text-decoration: none;
}
.nav a[href][aria-current="page"] {
	text-decoration: underline;
}

/* Posts list */
.postlist {
	counter-reset: start-from var(--postlist-index);
	list-style: none;
	padding: 0;
}
.postlist-item {
	display: flex;
	flex-wrap: wrap;
	align-items: baseline;
	counter-increment: start-from -1;
	margin-bottom: 1em;
}
.postlist-item:before {
	display: inline-block;
	pointer-events: none;
	line-height: 100%;
	text-align: right;
	margin-left: -1.5rem;
}
.postlist-date,
.postlist-item:before {
	font-size: 0.8125em; /* 13px /16 */
	color: var(--color-gray-90);
}
.postlist-date {
	word-spacing: -0.5px;
}
.postlist-link {
	font-size: 1.1875em; /* 19px /16 */
	font-weight: 700;
	flex-basis: calc(100% - 1.5rem);
	text-underline-position: from-font;
	text-underline-offset: 0;
	text-decoration-thickness: 1px;
}
.postlist-item-active .postlist-link {
	font-weight: bold;
}

/* Tags */
.post-tag {
	display: inline-flex;
	align-items: center;
	justify-content: center;
	font-style: italic;
}

/* may want to make the description text smaller at some stage */
.post-description-list {
	font-size: 1.0em;
}

.post-description-main {
	font-style: italic;
}

.postlist-item > .post-tag {
	align-self: center;
}

/* Tags list */
.post-metadata {
	display: inline-flex;
	flex-wrap: wrap;
	gap: .5em;
	list-style: none;
	padding: 0;
	margin: 0;
}
.post-metadata time {
	margin-right: 1em;
}

blockquote {
	margin-top: 0px;
	margin-left: 0px;
	margin-bottom: 15px;
	padding-left: 15px;
	border-left: 5px solid lightgray;
}
/**
 * prism.js default theme for JavaScript, CSS and HTML
 * Based on dabblet (http://dabblet.com)
 * @author Lea Verou
 */

code[class*="language-"],
pre[class*="language-"] {
	color: black;
	background: none;
	text-shadow: 0 1px white;
	font-family: Consolas, Monaco, 'Andale Mono', 'Ubuntu Mono', monospace;
	font-size: 1em;
	text-align: left;
	white-space: pre;
	word-spacing: normal;
	word-break: normal;
	word-wrap: normal;
	line-height: 1.5;

	-moz-tab-size: 4;
	-o-tab-size: 4;
	tab-size: 4;

	-webkit-hyphens: none;
	-moz-hyphens: none;
	-ms-hyphens: none;
	hyphens: none;
}

pre[class*="language-"]::-moz-selection, pre[class*="language-"] ::-moz-selection,
code[class*="language-"]::-moz-selection, code[class*="language-"] ::-moz-selection {
	text-shadow: none;
	background: #b3d4fc;
}

pre[class*="language-"]::selection, pre[class*="language-"] ::selection,
code[class*="language-"]::selection, code[class*="language-"] ::selection {
	text-shadow: none;
	background: #b3d4fc;
}

@media print {
	code[class*="language-"],
	pre[class*="language-"] {
		text-shadow: none;
	}
}

/* Code blocks */
pre[class*="language-"] {
	padding: 1em;
	margin: .5em 0;
	overflow: auto;
}

:not(pre) > code[class*="language-"],
pre[class*="language-"] {
	background: #f5f2f0;
}

/* Inline code */
:not(pre) > code[class*="language-"] {
	padding: .1em;
	border-radius: .3em;
	white-space: normal;
}

.token.comment,
.token.prolog,
.token.doctype,
.token.cdata {
	color: slategray;
}

.token.punctuation {
	color: #999;
}

.token.namespace {
	opacity: .7;
}

.token.property,
.token.tag,
.token.boolean,
.token.number,
.token.constant,
.token.symbol,
.token.deleted {
	color: #905;
}

.token.selector,
.token.attr-name,
.token.string,
.token.char,
.token.builtin,
.token.inserted {
	color: #690;
}

.token.operator,
.token.entity,
.token.url,
.language-css .token.string,
.style .token.string {
	color: #9a6e3a;
	/* This background color was intended by the author of this theme. */
	background: hsla(0, 0%, 100%, .5);
}

.token.atrule,
.token.attr-value,
.token.keyword {
	color: #07a;
}

.token.function,
.token.class-name {
	color: #DD4A68;
}

.token.regex,
.token.important,
.token.variable {
	color: #e90;
}

.token.important,
.token.bold {
	font-weight: bold;
}
.token.italic {
	font-style: italic;
}

.token.entity {
	cursor: help;
}
/*
 * New diff- syntax
 */

pre[class*="language-diff-"] {
	--eleventy-code-padding: 1.25em;
	padding-left: var(--eleventy-code-padding);
	padding-right: var(--eleventy-code-padding);
}
.token.deleted {
	background-color: hsl(0, 51%, 37%);
	color: inherit;
}
.token.inserted {
	background-color: hsl(126, 31%, 39%);
	color: inherit;
}

/* Make the + and - characters unselectable for copy/paste */
.token.prefix.unchanged,
.token.prefix.inserted,
.token.prefix.deleted {
	-webkit-user-select: none;
	user-select: none;
	display: inline-flex;
	align-items: center;
	justify-content: center;
	padding-top: 2px;
	padding-bottom: 2px;
}
.token.prefix.inserted,
.token.prefix.deleted {
	width: var(--eleventy-code-padding);
	background-color: rgba(0,0,0,.2);
}

/* Optional: full-width background color */
.token.inserted:not(.prefix),
.token.deleted:not(.prefix) {
	display: block;
	margin-left: calc(-1 * var(--eleventy-code-padding));
	margin-right: calc(-1 * var(--eleventy-code-padding));
	text-decoration: none; /* override del, ins, mark defaults */
	color: inherit; /* override del, ins, mark defaults */
}
.utterances {
  margin-left: inherit !important;
}</style>
		

    <!-- Global site tag (gtag.js) - Google Analytics -->
    <script async="" src="https://www.googletagmanager.com/gtag/js?id=G-4WQKBG0L4Y"></script>
    

	</head>
	<body>
		<a href="#main" id="skip-link" class="visually-hidden">Skip to main content</a>

		<header>
			<a href="/" class="home-link">DJ Adams</a>
			<nav>
				<h2 class="visually-hidden" id="top-level-navigation-menu">Top level navigation menu</h2>
				<ul class="nav">
					<li class="nav-item"><a href="/">Home</a></li>
					<li class="nav-item"><a href="/about/">About</a></li>
					<li class="nav-item"><a href="/blog/">Blog</a></li>
					<li class="nav-item"><a href="/feed/feed.xml">Feed</a></li>
				</ul>
			</nav>
		</header>

		<main id="main">
			<heading-anchors>
				


<h1 id="tasc-notes-part-5">TASC Notes - Part 5</h1>

<ul class="post-metadata">
	<li><time datetime="2024-12-13">13 December 2024</time></li>
	<li><a href="/tags/tasc/" class="post-tag">tasc</a>, </li>
	<li><a href="/tags/cap/" class="post-tag">cap</a>, </li>
	<li><a href="/tags/cds/" class="post-tag">cds</a>, </li>
	<li><a href="/tags/handsonsapdev/" class="post-tag">handsonsapdev</a></li>
</ul>

<p class="post-description-main"></p>

<p>These are the notes summarising what was covered in <a href="https://www.youtube.com/live/BpTDnYxoNXI">The Art and Science of CAP part 5</a>, one episode in a mini series with Daniel Hutzel to explore the philosophy, the background, the technology history and layers that support and inform the SAP Cloud Application Programming Model.</p>
<p>For all resources related to this series, see the post <a href="/blog/posts/2024/12/06/the-art-and-science-of-cap/">The Art and Science of CAP</a>.</p>
<p>This episode started with a review of the previous episode (part 4), based on the <a href="/blog/posts/2024/12/10/tasc-notes-part-4/">notes for that episode</a>.</p>
<p><a name="new-cds-repl-options"></a></p>
<h2 id="new-cds-repl-options">New cds REPL options</h2>
<p>At around <a href="https://www.youtube.com/live/BpTDnYxoNXI?t=1050">17:30</a> Daniel introduces some of his very recent development work, adding features to the cds REPL, which we'll hopefully see in the next CAP release (update: we do indeed - see the <a href="https://cap.cloud.sap/docs/releases/dec24#cds-repl-enhancements"><code>cds repl</code> enhancements</a> of the <a href="https://cap.cloud.sap/docs/releases/dec24">December 2024 release notes</a>!):</p>
<pre class="language-text" tabindex="0"><code class="language-text">-r | --run <project>
  Runs a cds server from a given CAP project folder, or module name.
  You can then access the entities and services of the running server.
  It's the same as using the repl's builtin .run command.

-u | --use <cds feature="">
  Loads the given cds feature into the repl's global context. For example,
  if you specify ql it makes the cds.ql module's methods available.
  It's the same as doing {ref,val,xpr,...} = cds.ql within the repl.</cds></project></code></pre>
<p>As the description for <code>--run</code> says, it's a shortcut for starting the REPL and then issuing <code>.run &lt;project&gt;</code>.</p>
<p>The <code>--use</code> feature is a little more intriguing, in that it will import, into the REPL's global environment, the values exported by the specified feature. Daniel shows an example for <code>cds.ql</code> which -- at least in his bleeding edge developer version -- includes new, simple utility functions <code>ref</code>, <code>val</code>, <code>xpr</code> and <code>expand</code> that make it easier to manually construct CQN representations of queries (which can otherwise be quite tricky with all the bracket notation) when working in the REPL.</p>
<p>Here are some examples:</p>
<pre class="language-javascript" tabindex="0"><code class="language-javascript">ref<span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">foo.bar</span><span class="token template-punctuation string">`</span></span> <span class="token comment">// -> { ref: [ 'foo', 'bar' ] }</span></code></pre>
<pre class="language-javascript" tabindex="0"><code class="language-javascript">val<span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">foo.bar</span><span class="token template-punctuation string">`</span></span> <span class="token comment">// -> { val: 'foo.bar' }</span></code></pre>
<pre class="language-javascript" tabindex="0"><code class="language-javascript">expand<span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">foo.bar</span><span class="token template-punctuation string">`</span></span> <span class="token comment">// -> { ref: [ 'foo', 'bar' ], expand: [ '*' ] }</span></code></pre>
<p>and even:</p>
<pre class="language-javascript" tabindex="0"><code class="language-javascript"><span class="token function">expand</span> <span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">foo.bar</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">,</span> where<span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">x&lt;11</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">,</span> orderBy <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">car</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">,</span> <span class="token punctuation">[</span> ref<span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">a</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">,</span> ref<span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">b</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">,</span> xpr<span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">a+b</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">]</span><span class="token punctuation">)</span></code></pre>
<p>which emits:</p>
<pre class="language-javascript" tabindex="0"><code class="language-javascript"><span class="token punctuation">{</span>
    <span class="token literal-property property">ref</span><span class="token operator">:</span> <span class="token punctuation">[</span> <span class="token string">'foo.bar'</span> <span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token literal-property property">where</span><span class="token operator">:</span> <span class="token punctuation">[</span> <span class="token punctuation">{</span> <span class="token literal-property property">ref</span><span class="token operator">:</span> <span class="token punctuation">[</span> <span class="token string">'x'</span> <span class="token punctuation">]</span> <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token string">'&lt;'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> <span class="token literal-property property">val</span><span class="token operator">:</span> <span class="token number">11</span> <span class="token punctuation">}</span> <span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token literal-property property">orderBy</span><span class="token operator">:</span> <span class="token punctuation">[</span> <span class="token punctuation">{</span> <span class="token literal-property property">ref</span><span class="token operator">:</span> <span class="token punctuation">[</span> <span class="token string">'car'</span> <span class="token punctuation">]</span> <span class="token punctuation">}</span> <span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token literal-property property">expand</span><span class="token operator">:</span> <span class="token punctuation">[</span>
        <span class="token punctuation">{</span> <span class="token literal-property property">ref</span><span class="token operator">:</span> <span class="token punctuation">[</span> <span class="token string">'a'</span> <span class="token punctuation">]</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token punctuation">{</span> <span class="token literal-property property">ref</span><span class="token operator">:</span> <span class="token punctuation">[</span> <span class="token string">'b'</span> <span class="token punctuation">]</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token punctuation">{</span>
            <span class="token literal-property property">xpr</span><span class="token operator">:</span> <span class="token punctuation">[</span> <span class="token punctuation">{</span> <span class="token literal-property property">ref</span><span class="token operator">:</span> <span class="token punctuation">[</span> <span class="token string">'a'</span> <span class="token punctuation">]</span> <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token string">'+'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> <span class="token literal-property property">ref</span><span class="token operator">:</span> <span class="token punctuation">[</span> <span class="token string">'b'</span> <span class="token punctuation">]</span> <span class="token punctuation">}</span> <span class="token punctuation">]</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">]</span>
<span class="token punctuation">}</span></code></pre>
<p><a name="infix-filters"></a></p>
<h2 id="infix-filters">Infix filters</h2>
<p>While building up this example, Daniel remarks that:</p>
<blockquote>
<p>&quot;CAP CDL has infix filters and so has CQN&quot;.</p>
</blockquote>
<p>I wanted to take a moment to think about this, and dig into <a href="https://cap.cloud.sap/docs/">Capire</a>, for two reasons:</p>
<ul>
<li>it was important to understood the meaning and implication of the term &quot;infix filter&quot; and recognise them at the drop of a hat</li>
<li>these two DSLs (CDL and CQN) are, at least in my mind, orthogonal to one another in a couple of dimensions:</li>
</ul>
<table>
<thead>
<tr>
<th>CDS DSLs</th>
<th>Human</th>
<th>Machine</th>
</tr>
</thead>
<tbody>
<tr>
<td>Schema</td>
<td><a href="https://cap.cloud.sap/docs/cds/cdl">CDL</a></td>
<td><a href="https://cap.cloud.sap/docs/cds/csn">CSN</a></td>
</tr>
<tr>
<td>Queries</td>
<td><a href="https://cap.cloud.sap/docs/cds/cql">CQL</a></td>
<td><a href="https://cap.cloud.sap/docs/cds/cqn">CQN</a></td>
</tr>
</tbody>
</table>
<p>... and I was curious to understand how an infix filter would be meaninfgul across the two differing pairs of DSLs.</p>
<p>So I took the DSL pair for queries first, and found the <a href="https://cap.cloud.sap/docs/cds/cql#with-infix-filters">With Infix Filters</a> section (in the <a href="https://cap.cloud.sap/docs/cds/cql">CQL</a> chapter, which makes sense as it's essentially a syntactical construct for humans, not machines), which has this example:</p>
<pre class="language-sql" tabindex="0"><code class="language-sql"><span class="token keyword">SELECT</span> books<span class="token punctuation">[</span>genre<span class="token operator">=</span><span class="token string">'Mystery'</span><span class="token punctuation">]</span><span class="token punctuation">.</span>title <span class="token keyword">from</span> Authors
 <span class="token keyword">WHERE</span> name<span class="token operator">=</span><span class="token string">'Agatha Christie'</span></code></pre>
<p>Given that the term &quot;infix&quot; implies &quot;between&quot; (as in <a href="https://en.wikipedia.org/wiki/Infix_notation">infix notation</a>), the <code>[genre='Mystery']</code> part is the infix filter in this example<a href="#footnote-1"><sup>1</sup></a>.</p>
<p>But what about infix filters in CDL? Well, you can add a filter to an association, as shown in the <a href="https://cap.cloud.sap/docs/cds/cdl#association-like-calculated-elements">Association-like calculated elements</a> section of the <a href="https://cap.cloud.sap/docs/cds/cdl">CDL</a> chapter with this example:</p>
<pre class="language-cds" tabindex="0"><code class="language-cds"><span class="token keyword">entity</span> Employees {
  addresses : <span class="token association-composition keyword">Association to many Addresses</span>;
  homeAddress = addresses [1: kind='home'];
}</code></pre>
<p>And still in a CDL context, but moving from defining to publishing, there's another example in the <a href="https://cap.cloud.sap/docs/cds/cdl#publish-associations-with-filter">Publish Associations with Filter</a> section:</p>
<pre class="language-cds" tabindex="0"><code class="language-cds"><span class="token keyword">entity</span> P_Authors <span class="token cqlkeywords keyword">as</span> <span class="token cdl-keyword keyword">projection</span> <span class="token cqlkeywords keyword">on</span> Authors {
  *,
  books[stock > 0] <span class="token cqlkeywords keyword">as</span> availableBooks
};</code></pre>
<p><a name="diving-into-query-objects"></a></p>
<h2 id="diving-into-query-objects">Diving into query objects</h2>
<p>To tie this back to what Daniel was showing in the REPL, we can resolve the CQL example above (looking for an author's books in the &quot;Mystery&quot; genre) into its canonical object representation in CQN, in the REPL, using an explicit call to <code>cds.parse.cql</code> like this:</p>
<pre class="language-log" tabindex="0"><code class="language-log"><span class="token operator">></span> cds<span class="token punctuation">.</span>parse<span class="token punctuation">.</span>cql<span class="token operator">(</span>`
<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> SELECT books<span class="token punctuation">[</span>genre<span class="token operator">=</span><span class="token string">'Mystery'</span><span class="token punctuation">]</span><span class="token punctuation">.</span>title
<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> from Authors
<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> where name<span class="token operator">=</span><span class="token string">'Agatha Christie'</span>
<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> `<span class="token operator">)</span>
<span class="token operator">{</span>
  <span class="token property">SELECT:</span> <span class="token operator">{</span>
    <span class="token property">from:</span> <span class="token operator">{</span> ref<span class="token operator">:</span> <span class="token punctuation">[</span> <span class="token string">'Authors'</span> <span class="token punctuation">]</span> <span class="token operator">}</span><span class="token punctuation">,</span>
    <span class="token property">columns:</span> <span class="token punctuation">[</span>
      <span class="token operator">{</span>
        <span class="token property">ref:</span> <span class="token punctuation">[</span>
          <span class="token operator">{</span>
            <span class="token property">id:</span> <span class="token string">'books'</span><span class="token punctuation">,</span>
            <span class="token property">where:</span> <span class="token punctuation">[</span> <span class="token operator">{</span> ref<span class="token operator">:</span> <span class="token punctuation">[</span> <span class="token string">'genre'</span> <span class="token punctuation">]</span> <span class="token operator">}</span><span class="token punctuation">,</span> <span class="token string">'='</span><span class="token punctuation">,</span> <span class="token operator">{</span> val<span class="token operator">:</span> <span class="token string">'Mystery'</span> <span class="token operator">}</span> <span class="token punctuation">]</span>
          <span class="token operator">}</span><span class="token punctuation">,</span>
          <span class="token string">'title'</span>
        <span class="token punctuation">]</span>
      <span class="token operator">}</span>
    <span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token property">where:</span> <span class="token punctuation">[</span> <span class="token operator">{</span> ref<span class="token operator">:</span> <span class="token punctuation">[</span> <span class="token string">'name'</span> <span class="token punctuation">]</span> <span class="token operator">}</span><span class="token punctuation">,</span> <span class="token string">'='</span><span class="token punctuation">,</span> <span class="token operator">{</span> val<span class="token operator">:</span> <span class="token string">'Agatha Christie'</span> <span class="token operator">}</span> <span class="token punctuation">]</span>
  <span class="token operator">}</span>
<span class="token operator">}</span></code></pre>
<p>Alternatively, and steering us back on track, we can use the literate-style &quot;query building&quot; functions similar to what Daniel did in the subsequent <code>SELECT</code> call (around <a href="https://www.youtube.com/live/BpTDnYxoNXI?t=1302">21:43</a>), like this:</p>
<pre class="language-log" tabindex="0"><code class="language-log"><span class="token operator">></span> SELECT `books<span class="token punctuation">[</span>genre<span class="token operator">=</span><span class="token string">'Mystery'</span><span class="token punctuation">]</span><span class="token punctuation">.</span>title` <span class="token punctuation">.</span>from `Authors` <span class="token punctuation">.</span>where `name<span class="token operator">=</span><span class="token string">'Agatha Christie'</span>`
Query <span class="token operator">{</span>
  <span class="token property">SELECT:</span> <span class="token operator">{</span>
    <span class="token property">from:</span> <span class="token operator">{</span> ref<span class="token operator">:</span> <span class="token punctuation">[</span> <span class="token string">'Authors'</span> <span class="token punctuation">]</span> <span class="token operator">}</span><span class="token punctuation">,</span>
    <span class="token property">columns:</span> <span class="token punctuation">[</span>
      <span class="token operator">{</span>
        <span class="token property">ref:</span> <span class="token punctuation">[</span>
          <span class="token operator">{</span>
            <span class="token property">id:</span> <span class="token string">'books'</span><span class="token punctuation">,</span>
            <span class="token property">where:</span> <span class="token punctuation">[</span> <span class="token operator">{</span> ref<span class="token operator">:</span> <span class="token punctuation">[</span> <span class="token string">'genre'</span> <span class="token punctuation">]</span> <span class="token operator">}</span><span class="token punctuation">,</span> <span class="token string">'='</span><span class="token punctuation">,</span> <span class="token operator">{</span> val<span class="token operator">:</span> <span class="token string">'Mystery'</span> <span class="token operator">}</span> <span class="token punctuation">]</span>
          <span class="token operator">}</span><span class="token punctuation">,</span>
          <span class="token string">'title'</span>
        <span class="token punctuation">]</span>
      <span class="token operator">}</span>
    <span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token property">where:</span> <span class="token punctuation">[</span> <span class="token operator">{</span> ref<span class="token operator">:</span> <span class="token punctuation">[</span> <span class="token string">'name'</span> <span class="token punctuation">]</span> <span class="token operator">}</span><span class="token punctuation">,</span> <span class="token string">'='</span><span class="token punctuation">,</span> <span class="token operator">{</span> val<span class="token operator">:</span> <span class="token string">'Agatha Christie'</span> <span class="token operator">}</span> <span class="token punctuation">]</span>
  <span class="token operator">}</span>
<span class="token operator">}</span></code></pre>
<p><a name="trying-out-an-infix-filter"></a></p>
<h3 id="trying-out-an-infix-filter">Trying out an infix filter</h3>
<p>To complete the circle and also experience for myself how it feels to instantiate queries and run them in the REPL, I took this same CQL infix example:</p>
<pre class="language-sql" tabindex="0"><code class="language-sql"><span class="token keyword">SELECT</span> books<span class="token punctuation">[</span>genre<span class="token operator">=</span><span class="token string">'Mystery'</span><span class="token punctuation">]</span><span class="token punctuation">.</span>title <span class="token keyword">from</span> Authors
 <span class="token keyword">WHERE</span> name<span class="token operator">=</span><span class="token string">'Agatha Christie'</span></code></pre>
<p>... and constructed an equivalent query on the Northbreeze dataset<a href="#footnote-2"><sup>2</sup></a>. Doing that helped me think about what is going on in this query, which is the traversal of a relationship (<code>Authors -&gt; books</code>) with a restriction on the destination entity (via an infix filter) as well as on the source entity.</p>
<p>Here's that equivalent query:</p>
<pre class="language-sql" tabindex="0"><code class="language-sql"><span class="token keyword">SELECT</span> Products<span class="token punctuation">[</span>Discontinued<span class="token operator">=</span><span class="token boolean">false</span><span class="token punctuation">]</span><span class="token punctuation">.</span>ProductName <span class="token keyword">from</span> northbreeze<span class="token punctuation">.</span>Suppliers
 <span class="token keyword">WHERE</span> CompanyName<span class="token operator">=</span><span class="token string">'Tokyo Traders'</span></code></pre>
<p>And here it is being constructed:</p>
<pre class="language-log" tabindex="0"><code class="language-log"><span class="token operator">></span> q1 <span class="token operator">=</span> cds<span class="token punctuation">.</span>parse<span class="token punctuation">.</span>cql<span class="token operator">(</span>`
<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> SELECT Products<span class="token punctuation">[</span>Discontinued<span class="token operator">=</span><span class="token boolean">false</span><span class="token punctuation">]</span><span class="token punctuation">.</span>ProductName
<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> from northbreeze<span class="token punctuation">.</span>Suppliers
<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> WHERE CompanyName<span class="token operator">=</span><span class="token string">'Tokyo Traders'</span>
<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> `<span class="token operator">)</span>
<span class="token operator">{</span>
  <span class="token property">SELECT:</span> <span class="token operator">{</span>
    <span class="token property">from:</span> <span class="token operator">{</span> ref<span class="token operator">:</span> <span class="token punctuation">[</span> <span class="token string">'northbreeze.Suppliers'</span> <span class="token punctuation">]</span> <span class="token operator">}</span><span class="token punctuation">,</span>
    <span class="token property">columns:</span> <span class="token punctuation">[</span>
      <span class="token operator">{</span>
        <span class="token property">ref:</span> <span class="token punctuation">[</span>
          <span class="token operator">{</span>
            <span class="token property">id:</span> <span class="token string">'Products'</span><span class="token punctuation">,</span>
            <span class="token property">where:</span> <span class="token punctuation">[</span> <span class="token operator">{</span> ref<span class="token operator">:</span> <span class="token punctuation">[</span> <span class="token string">'Discontinued'</span> <span class="token punctuation">]</span> <span class="token operator">}</span><span class="token punctuation">,</span> <span class="token string">'='</span><span class="token punctuation">,</span> <span class="token operator">{</span> val<span class="token operator">:</span> <span class="token boolean">false</span> <span class="token operator">}</span> <span class="token punctuation">]</span>
          <span class="token operator">}</span><span class="token punctuation">,</span>
          <span class="token string">'ProductName'</span>
        <span class="token punctuation">]</span>
      <span class="token operator">}</span>
    <span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token property">where:</span> <span class="token punctuation">[</span> <span class="token operator">{</span> ref<span class="token operator">:</span> <span class="token punctuation">[</span> <span class="token string">'CompanyName'</span> <span class="token punctuation">]</span> <span class="token operator">}</span><span class="token punctuation">,</span> <span class="token string">'='</span><span class="token punctuation">,</span> <span class="token operator">{</span> val<span class="token operator">:</span> <span class="token string">'Tokyo Traders'</span> <span class="token operator">}</span> <span class="token punctuation">]</span>
  <span class="token operator">}</span>
<span class="token operator">}</span></code></pre>
<p><a name="executing-queries"></a></p>
<h3 id="executing-queries">Executing queries</h3>
<p>Note that what's produced here is a query object (in CQN) but not something that is immediately <code>await</code>-able (see <a href="/blog/posts/2024/12/10/tasc-notes-part-4/#await">the notes from part 4</a>).</p>
<p>This is in contrast to the query object that is produced from the literate query building approach which looks like this, with an assignment to <code>q2</code><a href="#footnote-3"><sup>3</sup></a>:</p>
<pre class="language-log" tabindex="0"><code class="language-log">q2 <span class="token operator">=</span> SELECT
 <span class="token punctuation">.</span>columns<span class="token operator">(</span>`Products<span class="token punctuation">[</span>Discontinued<span class="token operator">=</span><span class="token boolean">false</span><span class="token punctuation">]</span><span class="token punctuation">.</span>ProductName`<span class="token operator">)</span>
 <span class="token punctuation">.</span>from `northbreeze<span class="token punctuation">.</span>Suppliers`
 <span class="token punctuation">.</span>where `CompanyName<span class="token operator">=</span><span class="token string">'Tokyo Traders'</span>`</code></pre>
<p>This produces the same CQN object ... but wrapped within a <code>Query</code> object:</p>
<pre class="language-log" tabindex="0"><code class="language-log">Query <span class="token operator">{</span>
  <span class="token property">SELECT:</span> <span class="token operator">{</span>
    <span class="token property">columns:</span> <span class="token punctuation">[</span>
      <span class="token operator">{</span>
        <span class="token property">ref:</span> <span class="token punctuation">[</span>
          <span class="token operator">{</span>
            <span class="token property">id:</span> <span class="token string">'Products'</span><span class="token punctuation">,</span>
            <span class="token property">where:</span> <span class="token punctuation">[</span> <span class="token operator">{</span> ref<span class="token operator">:</span> <span class="token punctuation">[</span> <span class="token string">'Discontinued'</span> <span class="token punctuation">]</span> <span class="token operator">}</span><span class="token punctuation">,</span> <span class="token string">'='</span><span class="token punctuation">,</span> <span class="token operator">{</span> val<span class="token operator">:</span> <span class="token boolean">false</span> <span class="token operator">}</span> <span class="token punctuation">]</span>
          <span class="token operator">}</span><span class="token punctuation">,</span>
          <span class="token string">'ProductName'</span>
        <span class="token punctuation">]</span>
      <span class="token operator">}</span>
    <span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token property">from:</span> <span class="token operator">{</span> ref<span class="token operator">:</span> <span class="token punctuation">[</span> <span class="token string">'northbreeze.Suppliers'</span> <span class="token punctuation">]</span> <span class="token operator">}</span><span class="token punctuation">,</span>
    <span class="token property">where:</span> <span class="token punctuation">[</span> <span class="token operator">{</span> ref<span class="token operator">:</span> <span class="token punctuation">[</span> <span class="token string">'CompanyName'</span> <span class="token punctuation">]</span> <span class="token operator">}</span><span class="token punctuation">,</span> <span class="token string">'='</span><span class="token punctuation">,</span> <span class="token operator">{</span> val<span class="token operator">:</span> <span class="token string">'Tokyo Traders'</span> <span class="token operator">}</span> <span class="token punctuation">]</span>
  <span class="token operator">}</span>
<span class="token operator">}</span></code></pre>
<p>To execute the first query object, we must pass it to <code>cds.run</code>:</p>
<pre class="language-log" tabindex="0"><code class="language-log"><span class="token operator">></span> await cds<span class="token punctuation">.</span>run<span class="token operator">(</span>q1<span class="token operator">)</span>
<span class="token punctuation">[</span>
  <span class="token operator">{</span> Products_ProductName<span class="token operator">:</span> <span class="token string">'Ikura'</span> <span class="token operator">}</span><span class="token punctuation">,</span>
  <span class="token operator">{</span> Products_ProductName<span class="token operator">:</span> <span class="token string">'Longlife Tofu'</span> <span class="token operator">}</span>
<span class="token punctuation">]</span></code></pre>
<p>but the <code>Query</code>-wrapped CQN object is directly <code>await</code>-able:</p>
<pre class="language-log" tabindex="0"><code class="language-log"><span class="token operator">></span> await q2
<span class="token punctuation">[</span>
  <span class="token operator">{</span> Products_ProductName<span class="token operator">:</span> <span class="token string">'Ikura'</span> <span class="token operator">}</span><span class="token punctuation">,</span>
  <span class="token operator">{</span> Products_ProductName<span class="token operator">:</span> <span class="token string">'Longlife Tofu'</span> <span class="token operator">}</span>
<span class="token punctuation">]</span></code></pre>
<p><a name="the-odata-v4-equivalent"></a></p>
<h3 id="the-odata-v4-equivalent">The OData V4 equivalent</h3>
<p>If you're curious to understand how this query might be represented in OData, and see the data for yourself, <a href="https://developer-challenge.cfapps.eu10.hana.ondemand.com/odata/v4/northbreeze/Suppliers?$expand=Products($select=ProductName;$filter=Discontinued%20eq%20false)&amp;$filter=CompanyName%20eq%20%27Tokyo%20Traders%27">here's the corresponding query operation</a>, shown here<a href="#footnote-4"><sup>4</sup></a> with extra whitespace to make it easier to read:</p>
<pre class="language-url" tabindex="0"><code class="language-url"><span class="token scheme">https<span class="token scheme-delimiter">:</span></span><span class="token authority"><span class="token authority-delimiter">//</span><span class="token host">developer-challenge.cfapps.eu10.hana.ondemand.com</span></span>
  /odata/v4/northbreeze
  /Suppliers
  <span class="token query"><span class="token query-delimiter">?</span><span class="token pair"><span class="token key">$expand</span>=<span class="token value">Products(</span></span></span>
    $select=ProductName;
    $filter=Discontinued eq false
  )
  &amp;$filter=CompanyName eq 'Tokyo Traders'</code></pre>
<p>This query produces this entityset result:</p>
<pre class="language-json" tabindex="0"><code class="language-json"><span class="token punctuation">{</span>
  <span class="token property">"@odata.context"</span><span class="token operator">:</span> <span class="token string">"$metadata#Suppliers(Products(ProductName,ProductID))"</span><span class="token punctuation">,</span>
  <span class="token property">"value"</span><span class="token operator">:</span> <span class="token punctuation">[</span>
    <span class="token punctuation">{</span>
      <span class="token property">"SupplierID"</span><span class="token operator">:</span> <span class="token number">4</span><span class="token punctuation">,</span>
      <span class="token property">"CompanyName"</span><span class="token operator">:</span> <span class="token string">"Tokyo Traders"</span><span class="token punctuation">,</span>
      <span class="token property">"ContactName"</span><span class="token operator">:</span> <span class="token string">"Yoshi Nagase"</span><span class="token punctuation">,</span>
      <span class="token property">"ContactTitle"</span><span class="token operator">:</span> <span class="token string">"Marketing Manager"</span><span class="token punctuation">,</span>
      <span class="token property">"Address"</span><span class="token operator">:</span> <span class="token string">"9-8 Sekimai Musashino-shi"</span><span class="token punctuation">,</span>
      <span class="token property">"City"</span><span class="token operator">:</span> <span class="token string">"Tokyo"</span><span class="token punctuation">,</span>
      <span class="token property">"Region"</span><span class="token operator">:</span> <span class="token string">"NULL"</span><span class="token punctuation">,</span>
      <span class="token property">"PostalCode"</span><span class="token operator">:</span> <span class="token string">"100"</span><span class="token punctuation">,</span>
      <span class="token property">"Country"</span><span class="token operator">:</span> <span class="token string">"Japan"</span><span class="token punctuation">,</span>
      <span class="token property">"Phone"</span><span class="token operator">:</span> <span class="token string">"(03) 3555-5011"</span><span class="token punctuation">,</span>
      <span class="token property">"Fax"</span><span class="token operator">:</span> <span class="token string">"NULL"</span><span class="token punctuation">,</span>
      <span class="token property">"HomePage"</span><span class="token operator">:</span> <span class="token string">"NULL"</span><span class="token punctuation">,</span>
      <span class="token property">"Products"</span><span class="token operator">:</span> <span class="token punctuation">[</span>
        <span class="token punctuation">{</span>
          <span class="token property">"ProductID"</span><span class="token operator">:</span> <span class="token number">10</span><span class="token punctuation">,</span>
          <span class="token property">"ProductName"</span><span class="token operator">:</span> <span class="token string">"Ikura"</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token punctuation">{</span>
          <span class="token property">"ProductID"</span><span class="token operator">:</span> <span class="token number">74</span><span class="token punctuation">,</span>
          <span class="token property">"ProductName"</span><span class="token operator">:</span> <span class="token string">"Longlife Tofu"</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">]</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">]</span>
<span class="token punctuation">}</span></code></pre>
<p><a name="cql-sql"></a></p>
<h3 id="cql-sql">CQL &gt; SQL</h3>
<p>Wrapping up this section, Daniel highlights a couple of the major enhancements to SQL that are in CQL:</p>
<ul>
<li>associations and path expressions</li>
<li>nested projections</li>
</ul>
<p>And this caused me to <a href="/blog/posts/2017/02/19/the-beauty-of-recursion-and-list-machinery/#initialrecognition">stare</a> a little bit more at the examples, such as this one:</p>
<pre class="language-sql" tabindex="0"><code class="language-sql"><span class="token keyword">SELECT</span><span class="token punctuation">.</span><span class="token keyword">from</span><span class="token identifier"><span class="token punctuation">`</span>foo.bar[where x&lt;11 order by car]{ a, b, a + b}<span class="token punctuation">`</span></span></code></pre>
<p>This underlines the <em>abstract</em> nature of CQL: have you noticed that we have been constructing CQN objects -- query objects -- with no relation (no pun intended) to real metadata? The query objects produced make little sense in that there <em>is no</em> <code>foo.bar</code>, there <em>is no</em> <code>x</code> or <code>car</code><a href="#footnote-5"><sup>5</sup></a>, and so on.</p>
<p>But that is irrelevant when working at the abstract level of the CQL/CQN DSL pairing, because it's only when the query object is sent to a database service that it gets translated into something &quot;real&quot;. And that is something quite beautiful.</p>
<p><a name="composite-services-and-mashups"></a></p>
<h2 id="composite-services-and-mashups">Composite services and mashups</h2>
<p>At around <a href="https://www.youtube.com/live/BpTDnYxoNXI?t=1455">24:15</a> Daniel picks up a thread from a previous episode in this series, and explains more about how mixins, from Aspect Oriented Programming, can be used to flatten hierarchies and bring independent services together to form a composite application.</p>
<p>How? By mashing up the services using the aspect-based power of CDL.</p>
<p>In the <a href="https://github.com/SAP-samples/cloud-cap-samples">cloud-cap-samples</a> repo, there are various CAP services in separate directories, such as <code>bookshop</code> and <code>reviews</code>.</p>
<p>There's also <code>bookstore</code> which is a composite of those two services. To have these services know about each other, the NPM <a href="https://github.com/SAP-samples/cloud-cap-samples">workspace</a> concept is used, in that the root <code>package.json</code> file includes:</p>
<pre class="language-json" tabindex="0"><code class="language-json"><span class="token property">"workspaces"</span><span class="token operator">:</span> <span class="token punctuation">[</span>
    <span class="token string">"./bookshop"</span><span class="token punctuation">,</span>
    <span class="token string">"./bookstore"</span><span class="token punctuation">,</span>
    <span class="token string">"./common"</span><span class="token punctuation">,</span>
    <span class="token string">"./data-viewer"</span><span class="token punctuation">,</span>
    <span class="token string">"./fiori"</span><span class="token punctuation">,</span>
    <span class="token string">"./hello"</span><span class="token punctuation">,</span>
    <span class="token string">"./media"</span><span class="token punctuation">,</span>
    <span class="token string">"./orders"</span><span class="token punctuation">,</span>
    <span class="token string">"./loggers"</span><span class="token punctuation">,</span>
    <span class="token string">"./reviews"</span>
<span class="token punctuation">]</span></code></pre>
<p>Note that <code>@capire/bookshop</code> and <code>@capire/reviews</code>, both available via this workspace concept in their respective directories, are declared as dependencies in <code>bookstore</code>'s <a href="https://github.com/SAP-samples/cloud-cap-samples/blob/main/bookstore/package.json">package.json</a> file:</p>
<pre class="language-json" tabindex="0"><code class="language-json"><span class="token punctuation">{</span>
  <span class="token property">"name"</span><span class="token operator">:</span> <span class="token string">"@capire/bookstore"</span><span class="token punctuation">,</span>
  <span class="token property">"version"</span><span class="token operator">:</span> <span class="token string">"1.0.0"</span><span class="token punctuation">,</span>
  <span class="token property">"dependencies"</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token property">"@capire/bookshop"</span><span class="token operator">:</span> <span class="token string">"*"</span><span class="token punctuation">,</span>
    <span class="token property">"@capire/reviews"</span><span class="token operator">:</span> <span class="token string">"*"</span><span class="token punctuation">,</span>
    <span class="token property">"..."</span><span class="token operator">:</span> <span class="token string">"*"</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token property">"..."</span><span class="token operator">:</span> <span class="token string">"..."</span>
<span class="token punctuation">}</span></code></pre>
<p>With that established, and via <code>bookstore</code>'s <a href="https://github.com/SAP-samples/cloud-cap-samples/blob/main/bookstore/index.cds">index.cds</a> file:</p>
<pre class="language-cds" tabindex="0"><code class="language-cds"><span class="token keyword">namespace</span> sap.capire.bookshop; <span class="token single-line-comment comment">//> important for reflection</span>
<span class="token using keyword">using</span> <span class="token from keyword">from</span> './srv/mashup';</code></pre>
<p>we get to <a href="https://github.com/SAP-samples/cloud-cap-samples/blob/main/bookstore/srv/mashup.cds">srv/mashup.cds</a> which is enlightening. Here's one section of it:</p>
<pre class="language-cds" tabindex="0"><code class="language-cds"><span class="token using keyword">using</span> { sap.capire.bookshop.Books } <span class="token from keyword">from</span> '@capire/bookshop';
<span class="token using keyword">using</span> { ReviewsService.Reviews } <span class="token from keyword">from</span> '@capire/reviews';
<span class="token keyword">extend</span> Books with {
  reviews : <span class="token association-composition keyword">Composition of many Reviews</span> <span class="token cqlkeywords keyword">on</span> reviews.subject = $self.ID;
  rating  : <span class="token cqlkeywords keyword">type</span> of Reviews:rating; <span class="token single-line-comment comment">// average rating</span>
  numberOfReviews : <span class="token type builtin">Integer </span><span class="token annotation important">@title</span> : '{i18n>NumberOfReviews}';
}</code></pre>
<p>This is the heart of the mashup, and very similar to the one illustrated in <a href="/blog/posts/2024/11/08/flattening-the-hierarchy-with-mixins/">Flattening the hierarchy with mixins</a>, where the <code>Books</code> entity from <code>@capire/bookshop</code>, is mashed up with the <code>Reviews</code> entity from <code>@capire/reviews</code>. Note that both these services are independent, neither of them know about each other, and neither is &quot;owned&quot; by <code>bookstore</code>.</p>
<p>But in the <em>mashup context</em> that doesn't matter, and the aspect oriented modelling is what makes this both possible, and indeed simple. After a formal introduction (<code>using</code>...) they are wired together in a single line of code declaring the <code>Composition</code>.</p>
<p>Like a dating service for domain entities.</p>
<p><a name="local-and-remote-services"></a></p>
<h2 id="local-and-remote-services">Local and remote services</h2>
<p>At around <a href="https://www.youtube.com/live/BpTDnYxoNXI?t=1701">28:21</a>, given this mashup, Daniel walks us through how these services interact with each other specifically at <em>design time</em> with <code>cds watch</code><a href="#footnote-6"><sup>6</sup></a>.</p>
<p>This is a great reminder of what we covered in the previous part, which you can find summarised in the <a href="/blog/posts/2024/12/10/tasc-notes-part-4#tight-loops-design-time-affordances-and-service-integration">Tight loops, design time affordances and service integration</a> section of the previous episode's notes. Here, <code>ReviewsService</code> and <code>OrdersService</code> are mocked at first because that CAP server is the only one running (locally, on 4004):</p>
<p><img src="/images/2024/12/mocking.png" alt="mocking"></p>
<p>but when these two services are started locally too, in separate CAP servers on 4005 and 4006 respectively, a local connection to both is possible, and made:</p>
<p><img src="/images/2024/12/connect.png" alt="connecting"></p>
<p><a name="messaging-and-grow-as-you-go"></a></p>
<h2 id="messaging-and-grow-as-you-go">Messaging and &quot;grow as you go&quot;</h2>
<p>Once the services in this &quot;bookstore&quot; constellation were all up and running, and Daniel had resolved the authorisation issue with a small but precise golden hammer, specificially and temporarily commenting out this <code>reject</code>, in <code>restrict.js</code> within the <code>libx/_runtime/common/generic/auth/</code> section of <code>@sap/cds</code> (don't do this at home, kids!):</p>
<pre class="language-javascript" tabindex="0"><code class="language-javascript">  <span class="token keyword">const</span> restrictedCount <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">_getRestrictedCount</span><span class="token punctuation">(</span>req<span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>model<span class="token punctuation">,</span> resolvedApplicables<span class="token punctuation">)</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>restrictedCount <span class="token operator">&lt;</span> unrestrictedCount<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">reject</span><span class="token punctuation">(</span>req<span class="token punctuation">,</span> <span class="token function">getRejectReason</span><span class="token punctuation">(</span>req<span class="token punctuation">,</span> <span class="token string">'@restrict'</span><span class="token punctuation">,</span> definition<span class="token punctuation">,</span> restrictedCount<span class="token punctuation">,</span> unrestrictedCount<span class="token punctuation">)</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span></code></pre>
<p>... it was time to become familiar with inter-service messaging. Which just works, out of the box, with zero configuration, in CAP's classic <a href="https://cap.cloud.sap/docs/about/#jumpstart-grow-as-you-go">grow as you go</a> approach to making the lives of developers, especially in design time, as easy as possible.</p>
<p>When Daniel entered a review on the <a href="https://vuejs.org/">Vue.js</a> based frontend served by the CAP server serving <code>ReviewsService</code> on 4005, we saw in the logs of that CAP server something like this:</p>
<pre class="language-log" tabindex="0"><code class="language-log"><span class="token operator">&lt;</span> emitting<span class="token operator">:</span> reviewed <span class="token operator">{</span> subject<span class="token operator">:</span> <span class="token string">'201'</span><span class="token punctuation">,</span> count<span class="token operator">:</span> <span class="token number">2</span><span class="token punctuation">,</span> rating<span class="token operator">:</span> <span class="token number">4.5</span> <span class="token operator">}</span></code></pre>
<p>and in the logs of the CAP server on 4004, we saw a corresponding message something like this:</p>
<pre class="language-log" tabindex="0"><code class="language-log"><span class="token operator">></span> received<span class="token operator">:</span> reviewed <span class="token operator">{</span> subject<span class="token operator">:</span> <span class="token string">'201'</span><span class="token punctuation">,</span> count<span class="token operator">:</span> <span class="token number">2</span><span class="token punctuation">,</span> rating<span class="token operator">:</span> <span class="token number">4.5</span> <span class="token operator">}</span></code></pre>
<p>This is such a great example of &quot;<a href="https://creators.spotify.com/pod/show/tech-aloud/episodes/The-Simplest-Thing-that-Could-Possibly-Work--A-conversation-with-Ward-Cunningham--Part-V---Bill-Venners-e5dpts">the simplest thing that could possibly work</a>&quot;, and indeed it works <em>very</em> well! At design time, you get messaging out of the box powered by a file-based mechanism, as we can see from the logs:</p>
<pre class="language-log" tabindex="0"><code class="language-log"><span class="token punctuation">[</span>cds<span class="token punctuation">]</span> <span class="token operator">-</span> connect to messaging <span class="token operator">></span> file<span class="token operator">-</span>based<span class="token operator">-</span>messaging</code></pre>
<p>and that file (that Daniel and I were trying to remember the name of) is <code>.cds-msg-box</code>. Like <code>.cds-services.json</code>, it is a design time only artifact:</p>
<ul>
<li>hidden (starts with a <code>.</code>)</li>
<li>in the developer user's home directory (<code>~/</code>)</li>
</ul>
<p>When emitting and receiving is working as planned, this file is normally empty. To look what gets written to it, you have to stop the receiver (so that the messages are not consumed) and take a look. Stopping the &quot;bookstore&quot; CAP server on 4004, and then creating another review, causes, as expected, another record to be written to the log of the <code>ReviewsService</code> CAP server on 4005, like this:</p>
<pre class="language-log" tabindex="0"><code class="language-log"><span class="token operator">&lt;</span> emitting<span class="token operator">:</span> reviewed <span class="token operator">{</span> subject<span class="token operator">:</span> <span class="token string">'207'</span><span class="token punctuation">,</span> count<span class="token operator">:</span> <span class="token number">2</span><span class="token punctuation">,</span> rating<span class="token operator">:</span> <span class="token number">2</span> <span class="token operator">}</span></code></pre>
<p>Inside the <code>~/.cds-msg-box</code> is an event record that looks like this:</p>
<pre class="language-log" tabindex="0"><code class="language-log">ReviewsService<span class="token punctuation">.</span>reviewed <span class="token operator">{</span><span class="token string">"data"</span><span class="token operator">:</span><span class="token operator">{</span><span class="token string">"subject"</span><span class="token operator">:</span><span class="token string">"207"</span><span class="token punctuation">,</span><span class="token string">"count"</span><span class="token operator">:</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token string">"rating"</span><span class="token operator">:</span><span class="token number">2</span><span class="token operator">}</span><span class="token punctuation">,</span><span class="token string">"headers"</span><span class="token operator">:</span><span class="token operator">{</span><span class="token string">"x-correlation-id"</span><span class="token operator">:</span><span class="token string">"9ad1c255-cde7-45f3-9943-7ff702691de4"</span><span class="token operator">}</span><span class="token operator">}</span></code></pre>
<p>And it almost goes without saying that as soon as the CAP server on 4004 is restarted (in <code>watch</code> mode of course) that record sitting in <code>~/.cds-msg-box</code> is consumed:</p>
<pre class="language-log" tabindex="0"><code class="language-log"><span class="token operator">></span> received<span class="token operator">:</span> reviewed <span class="token operator">{</span> subject<span class="token operator">:</span> <span class="token string">'207'</span><span class="token punctuation">,</span> count<span class="token operator">:</span> <span class="token number">2</span><span class="token punctuation">,</span> rating<span class="token operator">:</span> <span class="token number">2</span> <span class="token operator">}</span></code></pre>
<p><a name="exploring-agnostic-event-processing-in-the-repl"></a></p>
<h2 id="exploring-agnostic-event-processing-in-the-repl">Exploring agnostic event processing in the REPL</h2>
<p>At around <a href="https://www.youtube.com/live/BpTDnYxoNXI?t=2524">42:04</a> Daniel doubles down on what we've just experienced in this inter-service event coordination by diving once again into the cds REPL to (ultimately) show how similar <em>requests</em> and <em>events</em> are in CAP.</p>
<p>This is reflected in the <a href="https://cap.cloud.sap/docs/node.js/core-services#srv-send-request">srv.send(request)</a> and <a href="https://cap.cloud.sap/docs/node.js/core-services#srv-emit-event">srv.emit(event)</a> methods, but also in how Daniel described his choice of parameter names<a href="#footnote-7"><sup>7</sup></a> in handlers in this area, which I see like this:</p>
<pre class="language-text" tabindex="0"><code class="language-text">eve         The eventing "superclass" parent
 |
 +-- req    a request (synchronous request/response context)
 |
 +-- msg    a message (asynchronous event message context)</code></pre>
<p>At the REPL prompt, he creates a couple of <code>cds.Service</code> instances, which are &quot;just event dispatchers&quot;, and adorns each with a handler. Concisely, first here is <code>b</code>:</p>
<pre class="language-log" tabindex="0"><code class="language-log"><span class="token operator">></span> <span class="token operator">(</span>b <span class="token operator">=</span> new cds<span class="token punctuation">.</span>Service<span class="token operator">)</span><span class="token punctuation">.</span>before<span class="token operator">(</span><span class="token string">'*'</span><span class="token punctuation">,</span> eve <span class="token operator">=</span><span class="token operator">></span> console<span class="token punctuation">.</span>log<span class="token operator">(</span>eve<span class="token punctuation">.</span>event<span class="token punctuation">,</span> eve<span class="token punctuation">.</span>data<span class="token operator">)</span><span class="token operator">)</span>
Service <span class="token operator">{</span>
  <span class="token property">_handlers:</span> <span class="token operator">{</span>
    <span class="token property">_initial:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token property">before:</span> <span class="token punctuation">[</span> EventHandler <span class="token operator">{</span> before<span class="token operator">:</span> <span class="token string">'*'</span><span class="token punctuation">,</span> handler<span class="token operator">:</span> <span class="token punctuation">[</span>Function <span class="token operator">(</span>anonymous<span class="token operator">)</span><span class="token punctuation">]</span> <span class="token operator">}</span> <span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token property">on:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token property">after:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token property">_error:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
  <span class="token operator">}</span><span class="token punctuation">,</span>
  <span class="token property">name:</span> <span class="token string">'Service'</span><span class="token punctuation">,</span>
  <span class="token property">options:</span> <span class="token operator">{</span><span class="token operator">}</span>
<span class="token operator">}</span></code></pre>
<p>The handler's function signature uses <code>eve</code> as the parameter name, to underline the point above, in that it doesn't matter whether a request (<code>req</code>) or a message (<code>msg</code>) is (sent and) received, what matters is that it's &quot;just an event (with a small 'e') handler&quot;.</p>
<p>Next, <code>a</code><a href="#footnote-8"><sup>8</sup></a>:</p>
<pre class="language-log" tabindex="0"><code class="language-log"><span class="token operator">></span> <span class="token operator">(</span>a <span class="token operator">=</span> new cds<span class="token punctuation">.</span>Service<span class="token operator">)</span><span class="token punctuation">.</span>on<span class="token operator">(</span><span class="token string">'some event'</span><span class="token punctuation">,</span> msg <span class="token operator">=</span><span class="token operator">></span> b<span class="token punctuation">.</span>send<span class="token operator">(</span><span class="token string">'hey see'</span><span class="token punctuation">,</span> msg<span class="token operator">)</span><span class="token operator">)</span>
Service <span class="token operator">{</span>
  <span class="token property">_handlers:</span> <span class="token operator">{</span>
    <span class="token property">_initial:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token property">before:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token property">on:</span> <span class="token punctuation">[</span>
      EventHandler <span class="token operator">{</span>
        <span class="token property">on:</span> <span class="token string">'some event'</span><span class="token punctuation">,</span>
        <span class="token property">handler:</span> <span class="token punctuation">[</span>Function <span class="token operator">(</span>anonymous<span class="token operator">)</span><span class="token punctuation">]</span>
      <span class="token operator">}</span>
    <span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token property">after:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token property">_error:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
  <span class="token operator">}</span><span class="token punctuation">,</span>
  <span class="token property">name:</span> <span class="token string">'Service'</span><span class="token punctuation">,</span>
  <span class="token property">options:</span> <span class="token operator">{</span><span class="token operator">}</span>
<span class="token operator">}</span></code></pre>
<p>And now for the events themselves. First, a synchronous request with <code>send</code>:</p>
<pre class="language-log" tabindex="0"><code class="language-log"><span class="token operator">></span> await a<span class="token punctuation">.</span>send<span class="token operator">(</span><span class="token string">'some event'</span><span class="token punctuation">,</span> <span class="token operator">{</span>foo<span class="token operator">:</span><span class="token number">11</span><span class="token operator">}</span><span class="token operator">)</span>
hey see Request <span class="token operator">{</span> method<span class="token operator">:</span> <span class="token string">'some event'</span><span class="token punctuation">,</span> data<span class="token operator">:</span> <span class="token operator">{</span> foo<span class="token operator">:</span> <span class="token number">11</span> <span class="token operator">}</span> <span class="token operator">}</span></code></pre>
<p>Now for an asynchronous message with <code>emit</code>:</p>
<pre class="language-log" tabindex="0"><code class="language-log"><span class="token operator">></span> await a<span class="token punctuation">.</span>emit<span class="token operator">(</span><span class="token string">'some event'</span><span class="token punctuation">,</span> <span class="token operator">{</span>foo<span class="token operator">:</span><span class="token number">11</span><span class="token operator">}</span><span class="token operator">)</span>
hey see EventMessage <span class="token operator">{</span> event<span class="token operator">:</span> <span class="token string">'some event'</span><span class="token punctuation">,</span> data<span class="token operator">:</span> <span class="token operator">{</span> foo<span class="token operator">:</span> <span class="token number">11</span> <span class="token operator">}</span> <span class="token operator">}</span></code></pre>
<p>Different! But handled in the same way.</p>
<p><a name="interceptor-pattern-and-request-vs-eventmessage-handling"></a></p>
<h2 id="interceptor-pattern-and-request-vs-eventmessage-handling">Interceptor pattern and Request vs EventMessage handling</h2>
<p>Well. Almost the same. Directly following this demonstration, at around <a href="https://www.youtube.com/live/BpTDnYxoNXI?t=2845">47:25</a>, Daniel highlights a subtle but key difference, in the context of the <code>on</code> handlers, which -- for Request objects -- follow the <a href="https://cap.cloud.sap/docs/node.js/core-services#interceptor-stack-with-next">interceptor stack</a> pattern:</p>
<blockquote>
<p>&quot;When processing requests, <code>.on(request)</code> handlers are <em>executed in sequence</em> on a first-come-first-serve basis: Starting with the first registered one, each in the chain can decide to call subsequent handlers via <em>next()</em> or not, hence breaking the chain.&quot;</p>
</blockquote>
<p>The existing service <code>b</code> (in the current REPL session) currently has a single handler, specifically for the <code>before</code> phase:</p>
<pre class="language-log" tabindex="0"><code class="language-log"><span class="token operator">></span> <span class="token punctuation">.</span>inspect b
<span class="token property">b:</span> Service <span class="token operator">{</span>
  <span class="token property">_handlers:</span> <span class="token operator">{</span>
    <span class="token property">_initial:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token property">before:</span> <span class="token punctuation">[</span> EventHandler <span class="token operator">{</span> before<span class="token operator">:</span> <span class="token string">'*'</span><span class="token punctuation">,</span> handler<span class="token operator">:</span> <span class="token punctuation">[</span>Function <span class="token operator">(</span>anonymous<span class="token operator">)</span><span class="token punctuation">]</span> <span class="token operator">}</span> <span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token property">on:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token property">after:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token property">_error:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
  <span class="token operator">}</span><span class="token punctuation">,</span>
  <span class="token property">name:</span> <span class="token string">'Service'</span><span class="token punctuation">,</span>
  <span class="token property">options:</span> <span class="token operator">{</span><span class="token operator">}</span>
<span class="token operator">}</span></code></pre>
<p>Remember that the handler itself, represented in this <code>.inspect</code> output with <code>[Function (anonymous)]</code>, is defined to be invoked on any event (<code>*</code>) and looks like this: <code>eve =&gt; console.log(eve.event, eve.data)</code>.</p>
<p>At this point a second handler was added, but for the <code>on</code> phase, like this (I've taken the liberty to add an extra value <code>&quot;(on)&quot;</code> in the <code>console.log</code> call here so we can understand things a bit better when we see the output):</p>
<pre class="language-log" tabindex="0"><code class="language-log"><span class="token operator">></span> b<span class="token punctuation">.</span>on<span class="token operator">(</span><span class="token string">'xxxxx'</span><span class="token punctuation">,</span> eve <span class="token operator">=</span><span class="token operator">></span> console<span class="token punctuation">.</span>log<span class="token operator">(</span>eve<span class="token punctuation">.</span>event<span class="token punctuation">,</span> eve<span class="token punctuation">.</span>data<span class="token punctuation">,</span> <span class="token string">"(on)"</span><span class="token operator">)</span><span class="token operator">)</span></code></pre>
<p>Then an event was sent to <code>b</code>, with <code>send</code> (again, to make things a bit clearer -- i.e. avoid any <code>undefined</code> values being shown -- I am including a payload of <code>{bar:11}</code> here):</p>
<pre class="language-log" tabindex="0"><code class="language-log"><span class="token operator">></span> await b<span class="token punctuation">.</span>send<span class="token operator">(</span><span class="token string">'xxxxx'</span><span class="token punctuation">,</span><span class="token operator">{</span>bar<span class="token operator">:</span><span class="token number">11</span><span class="token operator">}</span><span class="token operator">)</span>
xxxxx <span class="token operator">{</span> bar<span class="token operator">:</span> <span class="token number">11</span> <span class="token operator">}</span>
xxxxx <span class="token operator">{</span> bar<span class="token operator">:</span> <span class="token number">11</span> <span class="token operator">}</span> <span class="token operator">(</span>on<span class="token operator">)</span></code></pre>
<p>The first log record is from the handler registered for the <code>before</code> phase (i.e. the first handler we created for <code>b</code>), and the second is the one we just registered for the <code>on</code> phase.</p>
<p>So far so good.</p>
<p>But.</p>
<p>After adding a <em>second</em> on handler in a similar way, so that <code>b</code> has one <code>before</code> phase handler and two <code>on</code> phase handlers, like this:</p>
<pre class="language-log" tabindex="0"><code class="language-log"><span class="token operator">></span> b<span class="token punctuation">.</span>on<span class="token operator">(</span><span class="token string">'xxxxx'</span><span class="token punctuation">,</span> eve <span class="token operator">=</span><span class="token operator">></span> console<span class="token punctuation">.</span>log<span class="token operator">(</span><span class="token string">"gotcha"</span><span class="token operator">)</span><span class="token operator">)</span>
Service <span class="token operator">{</span>
  <span class="token property">_handlers:</span> <span class="token operator">{</span>
    <span class="token property">_initial:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token property">before:</span> <span class="token punctuation">[</span> EventHandler <span class="token operator">{</span> before<span class="token operator">:</span> <span class="token string">'*'</span><span class="token punctuation">,</span> handler<span class="token operator">:</span> <span class="token punctuation">[</span>Function <span class="token operator">(</span>anonymous<span class="token operator">)</span><span class="token punctuation">]</span> <span class="token operator">}</span> <span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token property">on:</span> <span class="token punctuation">[</span>
      EventHandler <span class="token operator">{</span> on<span class="token operator">:</span> <span class="token string">'xxxxx'</span><span class="token punctuation">,</span> handler<span class="token operator">:</span> <span class="token punctuation">[</span>Function <span class="token operator">(</span>anonymous<span class="token operator">)</span><span class="token punctuation">]</span> <span class="token operator">}</span><span class="token punctuation">,</span>
      EventHandler <span class="token operator">{</span> on<span class="token operator">:</span> <span class="token string">'xxxxx'</span><span class="token punctuation">,</span> handler<span class="token operator">:</span> <span class="token punctuation">[</span>Function <span class="token operator">(</span>anonymous<span class="token operator">)</span><span class="token punctuation">]</span> <span class="token operator">}</span>
    <span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token property">after:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token property">_error:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
  <span class="token operator">}</span><span class="token punctuation">,</span>
  <span class="token property">name:</span> <span class="token string">'Service'</span><span class="token punctuation">,</span>
  <span class="token property">options:</span> <span class="token operator">{</span><span class="token operator">}</span>
<span class="token operator">}</span></code></pre>
<p>... we <em>do not</em> see that handler's output when transmitting another event (a request) to <code>b</code> with <code>send</code>:</p>
<pre class="language-log" tabindex="0"><code class="language-log"><span class="token operator">></span> await b<span class="token punctuation">.</span>send<span class="token operator">(</span><span class="token string">'xxxxx'</span><span class="token punctuation">,</span><span class="token operator">{</span>car<span class="token operator">:</span><span class="token number">11</span><span class="token operator">}</span><span class="token operator">)</span>
xxxxx <span class="token operator">{</span> car<span class="token operator">:</span> <span class="token number">11</span> <span class="token operator">}</span>
xxxxx <span class="token operator">{</span> car<span class="token operator">:</span> <span class="token number">11</span> <span class="token operator">}</span> <span class="token operator">(</span>on<span class="token operator">)</span></code></pre>
<p>However.</p>
<p>We <em>do</em> see that handler's output when transmitting an event (a message) to <code>b</code> with <code>emit</code>:</p>
<pre class="language-log" tabindex="0"><code class="language-log"><span class="token operator">></span> await b<span class="token punctuation">.</span>emit<span class="token operator">(</span><span class="token string">'xxxxx'</span><span class="token punctuation">,</span><span class="token operator">{</span>cdr<span class="token operator">:</span><span class="token number">11</span><span class="token operator">}</span><span class="token operator">)</span>
xxxxx <span class="token operator">{</span> cdr<span class="token operator">:</span> <span class="token number">11</span> <span class="token operator">}</span>
xxxxx <span class="token operator">{</span> cdr<span class="token operator">:</span> <span class="token number">11</span> <span class="token operator">}</span> <span class="token operator">(</span>on<span class="token operator">)</span>
gotcha</code></pre>
<p>What's going on, as Daniel explains, is that for synchronous requests, the interceptor pattern is honoured. In other words, for handlers in the <code>on</code> phase, if the first handler <a href="https://cap.cloud.sap/docs/node.js/core-services#interceptor-stack-with-next">breaks the chain</a> by <em>not</em> calling <code>next()</code>, any subsequent handlers registered for that <code>on</code> phase are not called - the processing is deemed to be complete. And there was no <code>next()</code> call in the <code>on</code> phase handler we just defined:</p>
<pre class="language-log" tabindex="0"><code class="language-log"><span class="token operator">></span> b<span class="token punctuation">.</span>on<span class="token operator">(</span><span class="token string">'xxxxx'</span><span class="token punctuation">,</span> eve <span class="token operator">=</span><span class="token operator">></span> console<span class="token punctuation">.</span>log<span class="token operator">(</span>eve<span class="token punctuation">.</span>event<span class="token punctuation">,</span> eve<span class="token punctuation">.</span>data<span class="token punctuation">,</span> <span class="token string">"(on)"</span><span class="token operator">)</span><span class="token operator">)</span></code></pre>
<p>Note that this rule, this interceptor stack processing, is for requests. Not messages. So when processing an event message, initiated with <code>emit</code> (rather than <code>send</code>), <em>every handler registered for the <code>on</code> phase gets called</em>. And this is why we see &quot;gotcha&quot;, which is what the <em>second</em> handler registered for the <code>on</code> phase outputs.</p>
<blockquote>
<p>This was a conscious decision by the CAP developers, in that it makes more sense when handling asynchronous messages to have all handlers have a chance to fire. Especially because the asynchronous context also implies there's nothing to <em>return</em>, nothing to send back, anyway (unlike when handling an incoming request, for which a response is expected, synchronously).</p>
</blockquote>
<p>Let's prove this to ourselves now, by creating a third service <code>c</code>, and defining the same handlers -- one for the <code>before</code> phase and two for the <code>on</code> phase -- except this time we'll ensure that the chain is not broken by the first <code>on</code> phase handler, by receiving and using the <code>next</code> function reference passed to it (we'll practise using the REPL's multiline editor facility):</p>
<pre class="language-log" tabindex="0"><code class="language-log"><span class="token operator">></span> <span class="token punctuation">.</span>editor
<span class="token operator">/</span><span class="token operator">/</span> Entering editor mode <span class="token operator">(</span>Ctrl<span class="token operator">+</span>D to finish<span class="token punctuation">,</span> Ctrl<span class="token operator">+</span>C to cancel<span class="token operator">)</span>
<span class="token operator">(</span>c <span class="token operator">=</span> new cds<span class="token punctuation">.</span>Service<span class="token operator">)</span>
<span class="token punctuation">.</span>before<span class="token operator">(</span><span class="token string">'*'</span><span class="token punctuation">,</span> eve <span class="token operator">=</span><span class="token operator">></span> console<span class="token punctuation">.</span>log<span class="token operator">(</span>eve<span class="token punctuation">.</span>event<span class="token punctuation">,</span> eve<span class="token punctuation">.</span>data<span class="token operator">)</span><span class="token operator">)</span>
<span class="token punctuation">.</span>on<span class="token operator">(</span><span class="token string">'xxxxx'</span><span class="token punctuation">,</span> <span class="token operator">(</span>eve<span class="token punctuation">,</span> next<span class="token operator">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token operator">{</span> console<span class="token punctuation">.</span>log<span class="token operator">(</span>eve<span class="token punctuation">.</span>event<span class="token punctuation">,</span> eve<span class="token punctuation">.</span>data<span class="token punctuation">,</span> <span class="token string">"(on)"</span><span class="token operator">)</span><span class="token operator">;</span> next<span class="token operator">(</span><span class="token operator">)</span> <span class="token operator">}</span><span class="token operator">)</span>
<span class="token punctuation">.</span>on<span class="token operator">(</span><span class="token string">'xxxxx'</span><span class="token punctuation">,</span> eve <span class="token operator">=</span><span class="token operator">></span> console<span class="token punctuation">.</span>log<span class="token operator">(</span><span class="token string">"gotcha"</span><span class="token operator">)</span><span class="token operator">)</span>

Service <span class="token operator">{</span>
  <span class="token property">_handlers:</span> <span class="token operator">{</span>
    <span class="token property">_initial:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token property">before:</span> <span class="token punctuation">[</span> EventHandler <span class="token operator">{</span> before<span class="token operator">:</span> <span class="token string">'*'</span><span class="token punctuation">,</span> handler<span class="token operator">:</span> <span class="token punctuation">[</span>Function <span class="token operator">(</span>anonymous<span class="token operator">)</span><span class="token punctuation">]</span> <span class="token operator">}</span> <span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token property">on:</span> <span class="token punctuation">[</span>
      EventHandler <span class="token operator">{</span> on<span class="token operator">:</span> <span class="token string">'xxxxx'</span><span class="token punctuation">,</span> handler<span class="token operator">:</span> <span class="token punctuation">[</span>Function <span class="token operator">(</span>anonymous<span class="token operator">)</span><span class="token punctuation">]</span> <span class="token operator">}</span><span class="token punctuation">,</span>
      EventHandler <span class="token operator">{</span> on<span class="token operator">:</span> <span class="token string">'xxxxx'</span><span class="token punctuation">,</span> handler<span class="token operator">:</span> <span class="token punctuation">[</span>Function <span class="token operator">(</span>anonymous<span class="token operator">)</span><span class="token punctuation">]</span> <span class="token operator">}</span>
    <span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token property">after:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token property">_error:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
  <span class="token operator">}</span><span class="token punctuation">,</span>
  <span class="token property">name:</span> <span class="token string">'Service'</span><span class="token punctuation">,</span>
  <span class="token property">options:</span> <span class="token operator">{</span><span class="token operator">}</span>
<span class="token operator">}</span></code></pre>
<p>Now for the moment of truth<a href="#footnote-9"><sup>9</sup></a>:</p>
<pre class="language-log" tabindex="0"><code class="language-log"><span class="token operator">></span> await c<span class="token punctuation">.</span>send<span class="token operator">(</span><span class="token string">'xxxxx'</span><span class="token punctuation">,</span><span class="token operator">{</span>mac<span class="token operator">:</span><span class="token number">11</span><span class="token operator">}</span><span class="token operator">)</span>
xxxxx <span class="token operator">{</span> mac<span class="token operator">:</span> <span class="token number">11</span> <span class="token operator">}</span>
xxxxx <span class="token operator">{</span> mac<span class="token operator">:</span> <span class="token number">11</span> <span class="token operator">}</span> <span class="token operator">(</span>on<span class="token operator">)</span>
gotcha</code></pre>
<p>Because the first <code>on</code> phase handler didn't break the chain, the second one (that outputs &quot;gotcha&quot;) got a chance to run too.</p>
<p>Nice!</p>
<blockquote>
<p>Remember also that while <code>on</code> phase handlers are executed in sequence, all <code>before</code> phase handlers are executed in parallel, as are all <code>after</code> phase handlers.</p>
</blockquote>
<p><a name="cds-event-and-cds-request"></a></p>
<h2 id="cds-event-and-cds-request">cds.Event and cds.Request</h2>
<p>Finishing off this exploration, at around <a href="https://www.youtube.com/live/BpTDnYxoNXI?t=2996">49:56</a>, Daniel talks a bit more about the difference between a (synchronous) request and an (asynchronous) message. In passing, he reveals how simple it also is to instantiate such things in the REPL.</p>
<p>First, a request:</p>
<pre class="language-log" tabindex="0"><code class="language-log"><span class="token operator">></span> req <span class="token operator">=</span> new cds<span class="token punctuation">.</span>Request<span class="token operator">(</span><span class="token operator">{</span>event<span class="token operator">:</span><span class="token string">'foo'</span><span class="token punctuation">,</span>data<span class="token operator">:</span><span class="token operator">{</span>foo<span class="token operator">:</span><span class="token number">11</span><span class="token operator">}</span><span class="token operator">}</span><span class="token operator">)</span>
Request <span class="token operator">{</span> event<span class="token operator">:</span> <span class="token string">'foo'</span><span class="token punctuation">,</span> data<span class="token operator">:</span> <span class="token operator">{</span> foo<span class="token operator">:</span> <span class="token number">11</span> <span class="token operator">}</span> <span class="token operator">}</span></code></pre>
<p>Now, a message (event):</p>
<pre class="language-log" tabindex="0"><code class="language-log"><span class="token operator">></span> msg <span class="token operator">=</span> new cds<span class="token punctuation">.</span>Event<span class="token operator">(</span><span class="token operator">{</span>event<span class="token operator">:</span><span class="token string">'foo'</span><span class="token punctuation">,</span>data<span class="token operator">:</span><span class="token operator">{</span>foo<span class="token operator">:</span><span class="token number">11</span><span class="token operator">}</span><span class="token operator">}</span><span class="token operator">)</span>
EventMessage <span class="token operator">{</span> event<span class="token operator">:</span> <span class="token string">'foo'</span><span class="token punctuation">,</span> data<span class="token operator">:</span> <span class="token operator">{</span> foo<span class="token operator">:</span> <span class="token number">11</span> <span class="token operator">}</span> <span class="token operator">}</span></code></pre>
<p>Observe how similar the creation and content of each of these objects is.</p>
<p>In fact, the illustration of how similar they are, or rather how <em>related</em> they are, can be found in the <a href="https://cap.cloud.sap/docs/node.js/events">cds.Events</a> section of Capire. Specifically:</p>
<ul>
<li>the <a href="https://cap.cloud.sap/docs/node.js/events#cds-event">cds.Event</a> section explains that the <code>cds.Event</code> class &quot;serves as the base class for <code>cds.Request</code>&quot;</li>
<li>the <a href="https://cap.cloud.sap/docs/node.js/events#cds-request">cds.Request</a> section shows that the <code>cds.Request</code> class extends the <code>cds.Event</code> class, notably with methods that include <em>sending back a response</em>, such as <code>req.reply()</code></li>
</ul>
<p>Incidentally, if you're interested to learn more about how Daniel got his instance of VS Code to attach to the Node.js REPL process, see <a href="https://code.visualstudio.com/docs/nodejs/nodejs-debugging">Node.js debugging in VS Code</a>.</p>
<p><a name="remote-services-proxies-and-abstraction"></a></p>
<h2 id="remote-services-proxies-and-abstraction">Remote services, proxies, and abstraction</h2>
<p>Coming almost to the end of this part, at around <a href="https://www.youtube.com/live/BpTDnYxoNXI?t=3230">53:50</a>, Daniel explains briefly in the very limited time left about remote services.</p>
<p>To quote Daniel:</p>
<blockquote>
<p>&quot;A remote service is a service that we create locally but which happens to be a proxy to whatever remote thing there is&quot;</p>
</blockquote>
<p>As we're learning, CAP services are &quot;just&quot; agnostic event machines that can receive and forward messages. Especially when we use the <code>'*'</code> &quot;any&quot; event when registering handlers, we are reminded of Smalltalk's <code>#doesNotUnderstand</code> mechanism <a href="/blog/posts/2024/12/10/tasc-notes-part-4/#everything-is-a-service">that we touched upon in part 4</a>.</p>
<p>What supports this power and flexibility is another core feature of CAP's design and philosophy: abstraction. An essential example of this is <a href="https://cap.cloud.sap/docs/cds/cql">CQL</a> (and the machine-readable version <a href="https://cap.cloud.sap/docs/cds/cqn">CQN</a>), which allows CAP to dispatch events, and their payloads, to various services, including database services and protocol handlers, where the payload is crystallised in CQN, a superset of all database layer languages and protocol mechanics. See also the earlier <a href="#cql-sql">CQL &gt; SQL</a> section.</p>
<p>This seems an ideal potential starting point for the next part - as we ran out of time at this point.</p>
<p>Until next time - and I hope these notes are useful - let me know in the comments!</p>
<hr>
<p><a name="footnotes"></a></p>
<h2 id="footnotes">Footnotes</h2>
<p><a name="footnote-1"></a></p>
<ol>
<li>I know this seems obvious, but sometimes it's helpful to stare at the obvious for a while, in a &quot;kata&quot; style of memory reinforcement.</li>
</ol>
<p><a name="footnote-2"></a>
2. Which is Suppliers, Products and Categories, with relationships between them (if you want to peruse such a service, there's one available <a href="https://developer-challenge.cfapps.eu10.hana.ondemand.com/odata/v4/northbreeze">here</a>).</p>
<p><a name="footnote-3"></a>
3. You can paste multiple lines into the REPL, or edit multiple lines yourself, using the <code>.editor</code> REPL command (see the <a href="https://nodejs.org/api/repl.html#commands-and-special-keys">Commands and special keys</a> section of the Node.js REPL documentation). You can also use <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Template_literals">template literals</a> (<code>`...`</code>) for multiline strings.</p>
<p><a name="footnote-4"></a>
4. See the <a href="https://github.com/qmacro/odata-v4-and-cap/blob/main/slides.md#improved-expand">Improved $expand</a> section of my talk on <a href="https://github.com/qmacro/odata-v4-and-cap">OData V4 and SAP Cloud Application Programming Model</a> for more on the complex <code>$expand</code> value.</p>
<p><a name="footnote-5"></a>
5. I know that <code>car</code> is just a subsequent value derived from <code>bar</code>, but I like to think that it's a respectful reference to a core building block of the language that provided so much fundamental thinking for functional programming, which in turn has informed CAP. I'm talking of course about the <a href="https://en.wikipedia.org/wiki/CAR_and_CDR">primitive operation <code>car</code> in Lisp</a>.</p>
<p><a name="footnote-6"></a>
6. That this is a <code>cds watch</code> based affordance is further underlined when Daniel starts up the <code>bookstore</code> service in the cds REPL with <code>cds r --run cap/samples/bookstore/</code> at around <a href="https://www.youtube.com/live/BpTDnYxoNXI?t=1711">28:31</a> and receives the error <em>No credentials configured for &quot;ReviewsService&quot;</em>, because the &quot;check <code>~/.cds-services.json</code> and mock if nothing found&quot; design time feature is only invoked with <code>cds watch</code>.</p>
<p><a name="footnote-7"></a>
7. At this point in the live stream I remark on Daniel's choice of three characters for his parameter names reflecting some lovely historical Unix trivia, in that the system usernames of Unix and C gods such as Thompson, Richie, Kernaghan, Weinberger et al. were always three characters, as we can see in the first column in <a href="https://github.com/dspinellis/unix-history-repo/blob/BSD-3-Snapshot-Development/etc/passwd">this historical <code>/etc/passwd</code> file</a>:</p>
<pre class="language-log" tabindex="0"><code class="language-log">dmr<span class="token operator">:</span>gfVwhuAMF0Trw<span class="token operator">:</span><span class="token number">42</span><span class="token operator">:</span><span class="token number">10</span><span class="token operator">:</span>Dennis Ritchie<span class="token operator">:</span><span class="token file-path string">/usr/staff/dmr</span><span class="token operator">:</span>
ken<span class="token operator">:</span>ZghOT0eRm4U9s<span class="token operator">:</span><span class="token number">52</span><span class="token operator">:</span><span class="token number">10</span><span class="token operator">:</span><span class="token operator">&amp;</span> Thompson<span class="token operator">:</span><span class="token file-path string">/usr/staff/ken</span><span class="token operator">:</span>
sif<span class="token operator">:</span>IIVxQSvq1V9R2<span class="token operator">:</span><span class="token number">53</span><span class="token operator">:</span><span class="token number">10</span><span class="token operator">:</span>Stuart Feldman<span class="token operator">:</span><span class="token file-path string">/usr/staff/sif</span><span class="token operator">:</span>
scj<span class="token operator">:</span>IL2bmGECQJgbk<span class="token operator">:</span><span class="token number">60</span><span class="token operator">:</span><span class="token number">10</span><span class="token operator">:</span>Steve Johnson<span class="token operator">:</span><span class="token file-path string">/usr/staff/scj</span><span class="token operator">:</span>
pjw<span class="token operator">:</span>N33<span class="token punctuation">.</span>MCNcTh5Qw<span class="token operator">:</span><span class="token number">61</span><span class="token operator">:</span><span class="token number">10</span><span class="token operator">:</span>Peter J<span class="token punctuation">.</span> Weinberger<span class="token punctuation">,</span><span class="token number">2015827214</span><span class="token operator">:</span><span class="token file-path string">/usr/staff/pjw</span><span class="token operator">:</span><span class="token file-path string">/bin/csh</span>
bwk<span class="token operator">:</span>ymVglQZjbWYDE<span class="token operator">:</span><span class="token number">62</span><span class="token operator">:</span><span class="token number">10</span><span class="token operator">:</span>Brian W<span class="token punctuation">.</span> Kernighan<span class="token punctuation">,</span><span class="token number">2015826021</span><span class="token operator">:</span><span class="token file-path string">/usr/staff/bwk</span><span class="token operator">:</span>
uucp<span class="token operator">:</span>P0CHBwE<span class="token operator">/</span>mB51k<span class="token operator">:</span><span class="token number">66</span><span class="token operator">:</span><span class="token number">10</span><span class="token operator">:</span>UNIX<span class="token operator">-</span>to<span class="token operator">-</span>UNIX Copy<span class="token operator">:</span><span class="token file-path string">/usr/spool/uucp</span><span class="token operator">:</span><span class="token file-path string">/usr/lib/uucp/uucico</span>
srb<span class="token operator">:</span>c8UdIntIZCUIA<span class="token operator">:</span><span class="token number">68</span><span class="token operator">:</span><span class="token number">10</span><span class="token operator">:</span>Steve Bourne<span class="token punctuation">,</span><span class="token number">2015825829</span><span class="token operator">:</span><span class="token file-path string">/usr/staff/srb</span><span class="token operator">:</span></code></pre>
<p>(and yes, my favourite shell <code>bash</code> is named after a successor to the shell that Steve Bourne created which was called the Bourne shell (<code>sh</code>), in that &quot;bash&quot; stands for the play on words &quot;Bourne (born) again shell&quot;.)</p>
<p><a name="footnote-8"></a>
8. It still slightly disturbs me (in a fun way) that the event identifier here (<code>some event</code>) contains whitespace :-)</p>
<p><a name="footnote-9"></a>
9. Yes, the choice of the property name <code>mac</code> here was deliberate; three characters, but a reference to a band that wrote a song which I've referenced in the explanation for this example and forms a core part of what we've learned here. Can you guess what the band is and why? :-)</p>
<p><a name="appendix"></a></p>
<h2 id="appendix-test-environment-with-northbreeze">Appendix - test environment with Northbreeze</h2>
<p>In working through some of the examples Daniel illustrated, I used the container-based CAP Node.js 8.5.1 environment I described in the <a href="/blog/posts/2024/12/10/tasc-notes-part-4/#appendix1">Appendix - setting up a test environment</a> in the <a href="/blog/posts/2024/12/10/tasc-notes-part-4/">notes from part 4</a>, with the <a href="https://github.com/qmacro/northbreeze">Northbreeze</a> service (a sort of cut-down version of the classic Northwind service).</p>
<p>When instantiating the container, I avoided making it immediately ephemeral (by not using <a href="https://docs.docker.com/reference/cli/docker/container/run/#rm">the <code>--rm</code> option</a>, and giving it a name with <code>--name</code>); I also added an option to publish port 4004 from the container, so the invocation that I used was:</p>
<pre class="language-shell" tabindex="0"><code class="language-shell"><span class="token function">docker</span> run <span class="token parameter variable">-it</span> <span class="token parameter variable">--name</span> part5 <span class="token parameter variable">-p</span> <span class="token number">4004</span>:4004 cap-8.5.1 <span class="token function">bash</span></code></pre>
<p>At the Bash prompt within the container, I then cloned the <a href="https://github.com/qmacro/northbreeze">Northbreeze</a> repository, and started a cds REPL in there:</p>
<pre class="language-shell" tabindex="0"><code class="language-shell"><span class="token function">node</span>  ~
$ <span class="token function">git</span> clone https://github.com/qmacro/northbreeze <span class="token operator">&amp;&amp;</span> <span class="token builtin class-name">cd</span> northbreeze
Cloning into <span class="token string">'northbreeze'</span><span class="token punctuation">..</span>.
remote: Enumerating objects: <span class="token number">35</span>, done.
remote: Counting objects: <span class="token number">100</span>% <span class="token punctuation">(</span><span class="token number">35</span>/35<span class="token punctuation">)</span>, done.
remote: Compressing objects: <span class="token number">100</span>% <span class="token punctuation">(</span><span class="token number">25</span>/25<span class="token punctuation">)</span>, done.
remote: Total <span class="token number">35</span> <span class="token punctuation">(</span>delta <span class="token number">8</span><span class="token punctuation">)</span>, reused <span class="token number">33</span> <span class="token punctuation">(</span>delta <span class="token number">6</span><span class="token punctuation">)</span>, pack-reused <span class="token number">0</span> <span class="token punctuation">(</span>from <span class="token number">0</span><span class="token punctuation">)</span>
Receiving objects: <span class="token number">100</span>% <span class="token punctuation">(</span><span class="token number">35</span>/35<span class="token punctuation">)</span>, <span class="token number">20.85</span> KiB <span class="token operator">|</span> <span class="token number">577.00</span> KiB/s, done.
Resolving deltas: <span class="token number">100</span>% <span class="token punctuation">(</span><span class="token number">8</span>/8<span class="token punctuation">)</span>, done.
<span class="token function">node</span>  ~/northbreeze <span class="token punctuation">(</span>main<span class="token punctuation">)</span>
$</code></pre>
<p>I then started a cds REPL session and within that session I <a href="https://hachyderm.io/deck/@qmacro/113673469026384747">started up the CAP server on port 4004</a>:</p>
<pre class="language-shell" tabindex="0"><code class="language-shell"><span class="token function">node</span>  ~/northbreeze <span class="token punctuation">(</span>main<span class="token punctuation">)</span>
$ cds r
Welcome to cds repl <span class="token function">v</span> <span class="token number">8.5</span>.1
<span class="token operator">></span> cds.test<span class="token punctuation">(</span><span class="token string">'.'</span>,<span class="token string">'--port'</span>,4004<span class="token punctuation">)</span>
<span class="token operator">&lt;</span>ref *<span class="token operator"><span class="token file-descriptor important">1</span>></span> Test <span class="token punctuation">{</span> test: <span class="token punctuation">[</span>Circular *1<span class="token punctuation">]</span> <span class="token punctuation">}</span>
<span class="token operator">></span> <span class="token punctuation">[</span>cds<span class="token punctuation">]</span> - loaded model from <span class="token number">2</span> file<span class="token punctuation">(</span>s<span class="token punctuation">)</span>:

  srv/main.cds
  db/schema.cds

<span class="token punctuation">[</span>cds<span class="token punctuation">]</span> - connect to db <span class="token operator">></span> sqlite <span class="token punctuation">{</span> url: <span class="token string">':memory:'</span> <span class="token punctuation">}</span>
  <span class="token operator">></span> init from db/data/northwind-Suppliers.csv
  <span class="token operator">></span> init from db/data/northwind-Products.csv
  <span class="token operator">></span> init from db/data/northwind-Categories.csv
/<span class="token operator">></span> successfully deployed to in-memory database.

<span class="token punctuation">[</span>cds<span class="token punctuation">]</span> - using auth strategy <span class="token punctuation">{</span>
  kind: <span class="token string">'mocked'</span>,
  impl: <span class="token string">'../../../usr/local/share/npm-global/lib/node_modules/@sap/cds-dk/node_modules/@sap/cds/lib/srv/middlewares/auth/basic-auth'</span>
<span class="token punctuation">}</span>

<span class="token punctuation">[</span>cds<span class="token punctuation">]</span> - using new OData adapter
<span class="token punctuation">[</span>cds<span class="token punctuation">]</span> - serving northbreeze <span class="token punctuation">{</span> path: <span class="token string">'/northbreeze'</span> <span class="token punctuation">}</span>

<span class="token punctuation">[</span>cds<span class="token punctuation">]</span> - server listening on <span class="token punctuation">{</span> url: <span class="token string">'http://localhost:4004'</span> <span class="token punctuation">}</span>
<span class="token punctuation">[</span>cds<span class="token punctuation">]</span> - launched at <span class="token number">12</span>/18/2024, <span class="token number">12</span>:05:58 PM, version: <span class="token number">8.5</span>.1, in: <span class="token number">609</span>.947ms
<span class="token punctuation">[</span>cds<span class="token punctuation">]</span> - <span class="token punctuation">[</span> terminate with ^C <span class="token punctuation">]</span>

<span class="token operator">></span></code></pre>



<script src="https://utteranc.es/client.js" repo="qmacro/qmacro.github.io" issue-term="title" crossorigin="anonymous" async=""></script>

<ul class="links-nextprev"><li class="links-nextprev-prev"> Previous<br> <a href="/blog/posts/2024/12/10/tasc-notes-part-4/">TASC Notes - Part 4</a></li><li class="links-nextprev-next">Next <br><a href="/blog/posts/2024/12/16/functions-as-first-class-citizens-in-sicp-lecture-1a/">Functions as first class citizens in SICP Lecture 1A</a></li>
</ul>

			</heading-anchors>
		</main>

		<!-- This page `/blog/posts/2024/12/13/tasc-notes-part-5/` was built on 2026-01-19T20:13:22.954Z -->
		<script type="module" src="/dist/t-8sxMV3B9.js"></script>
	</body>
</html>
