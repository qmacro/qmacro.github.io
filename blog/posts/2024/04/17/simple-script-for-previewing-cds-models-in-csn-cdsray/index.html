<!doctype html>
<html lang="en">
	<head>
		<meta charset="utf-8">
		<meta name="viewport" content="width=device-width, initial-scale=1.0">
		<title>Simple script for previewing CDS models in CSN - cdsray</title>
		<meta name="description" content="Reserving the right to be wrong.">
		<link rel="alternate" href="/feed/feed.xml" type="application/atom+xml" title="DJ Adams">
		<link rel="icon" type="image/x-icon" href="/images/favicon.ico">
		
		
		
		<style>/* This is an arbitrary CSS string added to the bundle */
/* Defaults */
:root {
	--font-family: -apple-system, system-ui, sans-serif;
	--font-family-monospace: Consolas, Menlo, Monaco, Andale Mono WT, Andale Mono, Lucida Console, Lucida Sans Typewriter, DejaVu Sans Mono, Bitstream Vera Sans Mono, Liberation Mono, Nimbus Mono L, Courier New, Courier, monospace;
}

/* Theme colors */
:root {
	--color-gray-20: #e0e0e0;
	--color-gray-50: #C0C0C0;
	--color-gray-90: #333;

	--background-color: #fff;

	--text-color: var(--color-gray-90);
	--text-color-link: #2884d2;
	--text-color-link-active: #15b0ed;
	--text-color-link-visited: #9f4199;

	--syntax-tab-size: 2;
}

@media (prefers-color-scheme: dark) {
	:root {
		--color-gray-20: #e0e0e0;
		--color-gray-50: #C0C0C0;
		--color-gray-90: #dad8d8;

		/* --text-color is assigned to --color-gray-_ above */
		--text-color-link: #1493fb;
		--text-color-link-active: #6969f7;
		--text-color-link-visited: #a6a6f8;

		--background-color: #15202b;
	}
}


/* Global stylesheet */
* {
	box-sizing: border-box;
}

@view-transition {
	navigation: auto;
}

html,
body {
	padding: 0;
	margin: 0 auto;
	font-family: var(--font-family);
	color: var(--text-color);
	background-color: var(--background-color);
}
html {
	overflow-y: scroll;
}
body {
	max-width: 40em;
}

/* https://www.a11yproject.com/posts/how-to-hide-content/ */
.visually-hidden:not(:focus):not(:active) {
	clip: rect(0 0 0 0);
	clip-path: inset(50%);
	height: 1px;
	overflow: hidden;
	position: absolute;
	white-space: nowrap;
	width: 1px;
}

/* Fluid images via https://www.zachleat.com/web/fluid-images/ */
img{
  max-width: 100%;
}
img[width][height] {
  height: auto;
}
img[src$=".svg"] {
  width: 100%;
  height: auto;
  max-width: none;
}
video,
iframe {
	width: 100%;
	height: auto;
}
iframe {
	aspect-ratio: 16/9;
}

p:last-child {
	margin-bottom: 0;
}
p {
	line-height: 1.5;
}

li {
	line-height: 1.5;
}

a[href] {
	color: var(--text-color-link);
}
a[href]:visited {
	color: var(--text-color-link-visited);
}
a[href]:hover,
a[href]:active {
	color: var(--text-color-link-active);
}

main,
footer {
	padding: 1rem;
}
/* main :first-child { */
/* 	margin-top: 0; */
/* } */

header {
	border-bottom: 1px dashed var(--color-gray-20);
}

#skip-link {
	text-decoration: none;
	background: var(--background-color);
	color: var(--text-color);
	padding: 0.5rem 1rem;
	border: 1px solid var(--color-gray-90);
	border-radius: 2px;
}

/* Prevent visually-hidden skip link fom pushing content around when focused */
#skip-link.visually-hidden:focus {
	position: absolute;
	top: 1rem;
	left: 1rem;
	/* Ensure it is positioned on top of everything else when it is shown */
	z-index: 999;
}

.links-nextprev {
	display: flex;
	justify-content: space-between;
	gap: .5em 1em;
	list-style: "";
	border-top: 1px dashed var(--color-gray-20);
	padding: 1em 0;
}
.links-nextprev > * {
	flex-grow: 1;
}
.links-nextprev-next {
	text-align: right;
}

table {
	margin: 1em 0;
}
table td,
table th {
	padding-right: 1em;
}

pre,
code {
	font-family: var(--font-family-monospace);
	color: seagreen;
}

pre,code[class*="language-"] {
	line-height: 1.2em !important;
	font-size: 0.93em !important;
}

pre:not([class*="language-"]) {
	margin: .5em 0;
	line-height: 1.375; /* 22px /16 */
	-moz-tab-size: var(--syntax-tab-size);
	-o-tab-size: var(--syntax-tab-size);
	tab-size: var(--syntax-tab-size);
	-webkit-hyphens: none;
	-ms-hyphens: none;
	hyphens: none;
	direction: ltr;
	text-align: left;
	white-space: pre;
	word-spacing: normal;
	word-break: normal;
	overflow-x: auto;
}
code {
	word-break: break-all;
}

/* Header */
header {
	display: flex;
	gap: 1em;
	flex-wrap: wrap;
	justify-content: space-between;
	align-items: center;
	padding: 1em;
}
.home-link {
	flex-grow: 1;
	font-size: 1em; /* 16px /16 */
	font-weight: 700;
}
.home-link:link:not(:hover) {
	text-decoration: none;
}

/* Nav */
.nav {
	display: flex;
	gap: .5em 1em;
	padding: 0;
	margin: 0;
	list-style: none;
}
.nav-item {
	display: inline-block;
}
.nav-item a[href]:not(:hover) {
	text-decoration: none;
}
.nav a[href][aria-current="page"] {
	text-decoration: underline;
}

/* Posts list */
.postlist {
	counter-reset: start-from var(--postlist-index);
	list-style: none;
	padding: 0;
}
.postlist-item {
	display: flex;
	flex-wrap: wrap;
	align-items: baseline;
	counter-increment: start-from -1;
	margin-bottom: 1em;
}
.postlist-item:before {
	display: inline-block;
	pointer-events: none;
	line-height: 100%;
	text-align: right;
	margin-left: -1.5rem;
}
.postlist-date,
.postlist-item:before {
	font-size: 0.8125em; /* 13px /16 */
	color: var(--color-gray-90);
}
.postlist-date {
	word-spacing: -0.5px;
}
.postlist-link {
	font-size: 1.1875em; /* 19px /16 */
	font-weight: 700;
	flex-basis: calc(100% - 1.5rem);
	text-underline-position: from-font;
	text-underline-offset: 0;
	text-decoration-thickness: 1px;
}
.postlist-item-active .postlist-link {
	font-weight: bold;
}

/* Tags */
.post-tag {
	display: inline-flex;
	align-items: center;
	justify-content: center;
	font-style: italic;
}

/* may want to make the description text smaller at some stage */
.post-description-list {
	font-size: 1.0em;
}

.post-description-main {
	font-style: italic;
}

.postlist-item > .post-tag {
	align-self: center;
}

/* Tags list */
.post-metadata {
	display: inline-flex;
	flex-wrap: wrap;
	gap: .5em;
	list-style: none;
	padding: 0;
	margin: 0;
}
.post-metadata time {
	margin-right: 1em;
}

blockquote {
	margin-top: 0px;
	margin-left: 0px;
	margin-bottom: 15px;
	padding-left: 15px;
	border-left: 5px solid lightgray;
}
/**
 * prism.js default theme for JavaScript, CSS and HTML
 * Based on dabblet (http://dabblet.com)
 * @author Lea Verou
 */

code[class*="language-"],
pre[class*="language-"] {
	color: black;
	background: none;
	text-shadow: 0 1px white;
	font-family: Consolas, Monaco, 'Andale Mono', 'Ubuntu Mono', monospace;
	font-size: 1em;
	text-align: left;
	white-space: pre;
	word-spacing: normal;
	word-break: normal;
	word-wrap: normal;
	line-height: 1.5;

	-moz-tab-size: 4;
	-o-tab-size: 4;
	tab-size: 4;

	-webkit-hyphens: none;
	-moz-hyphens: none;
	-ms-hyphens: none;
	hyphens: none;
}

pre[class*="language-"]::-moz-selection, pre[class*="language-"] ::-moz-selection,
code[class*="language-"]::-moz-selection, code[class*="language-"] ::-moz-selection {
	text-shadow: none;
	background: #b3d4fc;
}

pre[class*="language-"]::selection, pre[class*="language-"] ::selection,
code[class*="language-"]::selection, code[class*="language-"] ::selection {
	text-shadow: none;
	background: #b3d4fc;
}

@media print {
	code[class*="language-"],
	pre[class*="language-"] {
		text-shadow: none;
	}
}

/* Code blocks */
pre[class*="language-"] {
	padding: 1em;
	margin: .5em 0;
	overflow: auto;
}

:not(pre) > code[class*="language-"],
pre[class*="language-"] {
	background: #f5f2f0;
}

/* Inline code */
:not(pre) > code[class*="language-"] {
	padding: .1em;
	border-radius: .3em;
	white-space: normal;
}

.token.comment,
.token.prolog,
.token.doctype,
.token.cdata {
	color: slategray;
}

.token.punctuation {
	color: #999;
}

.token.namespace {
	opacity: .7;
}

.token.property,
.token.tag,
.token.boolean,
.token.number,
.token.constant,
.token.symbol,
.token.deleted {
	color: #905;
}

.token.selector,
.token.attr-name,
.token.string,
.token.char,
.token.builtin,
.token.inserted {
	color: #690;
}

.token.operator,
.token.entity,
.token.url,
.language-css .token.string,
.style .token.string {
	color: #9a6e3a;
	/* This background color was intended by the author of this theme. */
	background: hsla(0, 0%, 100%, .5);
}

.token.atrule,
.token.attr-value,
.token.keyword {
	color: #07a;
}

.token.function,
.token.class-name {
	color: #DD4A68;
}

.token.regex,
.token.important,
.token.variable {
	color: #e90;
}

.token.important,
.token.bold {
	font-weight: bold;
}
.token.italic {
	font-style: italic;
}

.token.entity {
	cursor: help;
}
/*
 * New diff- syntax
 */

pre[class*="language-diff-"] {
	--eleventy-code-padding: 1.25em;
	padding-left: var(--eleventy-code-padding);
	padding-right: var(--eleventy-code-padding);
}
.token.deleted {
	background-color: hsl(0, 51%, 37%);
	color: inherit;
}
.token.inserted {
	background-color: hsl(126, 31%, 39%);
	color: inherit;
}

/* Make the + and - characters unselectable for copy/paste */
.token.prefix.unchanged,
.token.prefix.inserted,
.token.prefix.deleted {
	-webkit-user-select: none;
	user-select: none;
	display: inline-flex;
	align-items: center;
	justify-content: center;
	padding-top: 2px;
	padding-bottom: 2px;
}
.token.prefix.inserted,
.token.prefix.deleted {
	width: var(--eleventy-code-padding);
	background-color: rgba(0,0,0,.2);
}

/* Optional: full-width background color */
.token.inserted:not(.prefix),
.token.deleted:not(.prefix) {
	display: block;
	margin-left: calc(-1 * var(--eleventy-code-padding));
	margin-right: calc(-1 * var(--eleventy-code-padding));
	text-decoration: none; /* override del, ins, mark defaults */
	color: inherit; /* override del, ins, mark defaults */
}
.utterances {
  margin-left: inherit !important;
}</style>
		
	</head>
	<body>
		<a href="#main" id="skip-link" class="visually-hidden">Skip to main content</a>

		<header>
			<a href="/" class="home-link">DJ Adams</a>
			<nav>
				<h2 class="visually-hidden" id="top-level-navigation-menu">Top level navigation menu</h2>
				<ul class="nav">
					<li class="nav-item"><a href="/">Home</a></li>
					<li class="nav-item"><a href="/about/">About</a></li>
					<li class="nav-item"><a href="/blog/">Blog</a></li>
					<li class="nav-item"><a href="/feed/feed.xml">Feed</a></li>
				</ul>
			</nav>
		</header>

		<main id="main">
			<heading-anchors>
				


<h1 id="simple-script-for-previewing-cds-models-in-csn-cdsray">Simple script for previewing CDS models in CSN - cdsray</h1>

<ul class="post-metadata">
	<li><time datetime="2024-04-17">17 April 2024</time></li>
	<li><a href="/tags/cap/" class="post-tag">cap</a>, </li>
	<li><a href="/tags/cds/" class="post-tag">cds</a>, </li>
	<li><a href="/tags/csn/" class="post-tag">csn</a>, </li>
	<li><a href="/tags/bash/" class="post-tag">bash</a></li>
</ul>

<p class="post-description-main"></p>

<p>The <a href="https://cap.cloud.sap/docs/releases/mar24#cds-previews-from-editor-title-bars">March 2024 release of CAP</a> brought many great new features including one for VS Code users - <a href="https://cap.cloud.sap/docs/releases/mar24#cds-previews-from-editor-title-bars">CDS Previews From Editor Title Bars</a>. It allows you to look, in realtime, at how your CDS model translates into various other representations, including YAML and JSON formats of Core Schema Notation (CSN)<a href="#footnotes"><sup>1</sup></a>, EDMX (for the OData protocol) and various flavours of Data Definition Language (DDL). Here's a screenshot of it in action, courtesy of <a href="https://cap.cloud.sap/docs/">Capire</a>:</p>
<p><img src="https://cap.cloud.sap/docs/assets/preview-in-editor-title.Ja_PTMdH.png" alt="preview in editor screenshot from Capire"></p>
<p>This feature really helps me visualise what I'm building, in that it gives me a live insight into how my model will be represented.</p>
<p>One aspect of this new feature that I find fascinating is that the default representation is the YAML flavour of CSN, rather than what most of us would expect when thinking about CSN, i.e. the JSON flavour. The reason is quite clear as soon as you start comparing the two: readability. YAML uses whitespace significantly, while JSON uses punctuation, to express structure. The result is that for any given structure, formatted YAML is more compact than its formatted JSON equivalent (unless you format JSON to the extreme with no or very little whitespace, which then makes it very difficult to read).</p>
<p>While I use VS Code, I'm more at home in my <a href="/blog/posts/2023/11/10/til-two-tmux-plugin-manager-features/">PDE</a> and I also enjoy embracing the Unix philosophy of using &quot;small tools loosely joined&quot;.</p>
<p>To that end, I built a simple script <a href="https://github.com/qmacro/dotfiles/blob/main/scripts/cdsray">cdsray</a> (for &quot;CDS X-ray&quot;) that gives me a similar experience. Inspired by the default choice of YAML flavoured CSN, I also opted to display YAML.</p>
<pre class="language-shell" tabindex="0"><code class="language-shell"><span class="token shebang important">#!/usr/bin/env bash</span>

<span class="token builtin class-name">declare</span> <span class="token assign-left variable">modelfile</span><span class="token operator">=</span><span class="token string">"<span class="token variable">${1<span class="token operator">:?</span>Specify CDS model file to compile}</span>"</span>

<span class="token builtin class-name">declare</span> <span class="token assign-left variable">scriptname</span><span class="token operator">=</span><span class="token string">"<span class="token variable">${0<span class="token operator">##</span>*<span class="token operator">/</span>}</span>"</span>
<span class="token builtin class-name">declare</span> <span class="token assign-left variable">old</span><span class="token operator">=</span><span class="token string">"./.<span class="token variable">${scriptname}</span>.old"</span>
<span class="token builtin class-name">declare</span> <span class="token assign-left variable">new</span><span class="token operator">=</span><span class="token string">"./.<span class="token variable">${scriptname}</span>.new"</span>

cds compile <span class="token parameter variable">--to</span> yaml <span class="token string">"<span class="token variable">$modelfile</span>"</span> <span class="token operator">></span> <span class="token string">"<span class="token variable">$new</span>"</span>

bat <span class="token parameter variable">-p</span> <span class="token parameter variable">-l</span> yaml <span class="token string">"<span class="token variable">$new</span>"</span>
<span class="token keyword">if</span> <span class="token punctuation">[</span><span class="token punctuation">[</span> <span class="token parameter variable">-f</span> <span class="token string">"<span class="token variable">$old</span>"</span> <span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token keyword">then</span>
    <span class="token builtin class-name">echo</span>
    <span class="token function">diff</span> <span class="token parameter variable">--color</span> <span class="token string">"<span class="token variable">$old</span>"</span> <span class="token string">"<span class="token variable">$new</span>"</span>
<span class="token keyword">fi</span>
<span class="token function">cp</span> <span class="token string">"<span class="token variable">$new</span>"</span> <span class="token string">"<span class="token variable">$old</span>"</span></code></pre>
<p>Not only does it display the YAML flavour of the CSN that the model compiles to, as the equivalent VS Code feature does, but it will also endeavour to show you the <em>differences</em> compared to the previous version. This helps me enormously when I'm trying to understand the effect - in CSN - of a change or addition I make in my CDS model.</p>
<p>The script creates and uses two hidden files in the current directory, where the names are based on the script name (<code>./.cdsray.old</code> and <code>./.cdsray.new</code>). These files contain the previous (old) and current (new) versions of the YAML flavoured CSN for the model.</p>
<p>It relies on:</p>
<ul>
<li><code>cds</code> to compile the model</li>
<li><code>bat</code> to display the YAML in a nice colour-coded way</li>
<li><code>diff</code> to show a colour-coded difference between the previous and current versions</li>
</ul>
<p>In order to get the live effect, I use the script with <code>entr</code> to listen for changes on CDS files and automatically rerun the script, like this, for example:</p>
<pre class="language-shell" tabindex="0"><code class="language-shell"><span class="token function">ls</span> *.cds <span class="token operator">|</span> entr <span class="token parameter variable">-c</span> cdsray services.cds </code></pre>
<p>Here's a quick demo of it in action:</p>
<p><img src="/images/2024/04/cdsray.gif" alt="Demo of cdsray"></p>
<hr>
<p><a href="footnotes"></a></p>
<h2 id="footnotes">Footnotes</h2>
<ol>
<li>For more on CSN and how it relates to CDS and CDL, see <a href="/blog/posts/2024/04/05/cap-cds-cdl-csn-and-jq-finding-associations/">CAP, CDS, CDL, CSN and jq - finding associations</a>.</li>
</ol>



<script src="https://utteranc.es/client.js" repo="qmacro/qmacro.github.io" issue-term="title" crossorigin="anonymous" async=""></script>

<ul class="links-nextprev"><li class="links-nextprev-prev">← Previous<br> <a href="/blog/posts/2024/04/15/using-cap-js-sqlite-in-cf-for-your-cap-services/">Using @cap-js/sqlite in CF for your CAP services</a></li><li class="links-nextprev-next">Next →<br><a href="/blog/posts/2024/05/03/controlling-automatic-http-requests-in-cap-node-js-design-time-loops/">Controlling automatic HTTP requests in CAP Node.js design time loops</a></li>
</ul>

			</heading-anchors>
		</main>

		<!-- This page `/blog/posts/2024/04/17/simple-script-for-previewing-cds-models-in-csn-cdsray/` was built on 2025-09-16T07:45:10.622Z -->
		<script type="module" src="/dist/xbxy_EL6cU.js"></script>
	</body>
</html>
