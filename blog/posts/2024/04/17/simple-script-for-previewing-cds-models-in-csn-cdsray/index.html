<!doctype html><html lang="en"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1"><link rel="canonical" href="https://qmacro.org/blog/posts/2024/04/17/simple-script-for-previewing-cds-models-in-csn-cdsray/"><link rel="alternate" type="application/atom+xml" title="DJ's Weblog - Feed" href="https://qmacro.org/feed.xml"><link href="/assets/main.fe6b9c1e7ba4ff2bb7b5.css" rel="stylesheet"><link rel="preconnect" href="https://fonts.gstatic.com"><link href="https://fonts.googleapis.com/css2?family=IBM+Plex+Sans&display=swap" rel="stylesheet"><title>Simple script for previewing CDS models in CSN - cdsray | DJ Adams</title><link rel="icon" type="“image/x-icon”" href="/images/favicon.ico"><meta property="og:title" content="Simple script for previewing CDS models in CSN - cdsray"><meta property="og:site_name" content="DJ Adams"><meta property="og:type" content="website"><meta property="og:url" content="https://qmacro.org/blog/posts/2024/04/17/simple-script-for-previewing-cds-models-in-csn-cdsray/"><meta name="description" content="Simple script for previewing CDS models in CSN - cdsray 17 Apr 2024 | 2 min read The March 2024 release of CAP brought many great new..."><meta property="og:description" content="Simple script for previewing CDS models in CSN - cdsray 17 Apr 2024 | 2 min read The March 2024 release of CAP brought many great new..."><meta name="description" content="Simple script for previewing CDS models in CSN - cdsray 17 Apr 2024 | 2 min read The March 2024 release of CAP brought many great new..."><meta property="og:image" content="https://qmacro.org/images/site-image.png"><script src="https://cdn.jsdelivr.net/npm/mermaid/dist/mermaid.min.js"></script><script>mermaid.initialize({startOnLoad:true});</script><script async src="https://www.googletagmanager.com/gtag/js?id=G-4WQKBG0L4Y"></script><script>window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());

      gtag('config', 'G-4WQKBG0L4Y');</script></head><body><div class="layout-wrapper"><header class="header"><div class="header__content"><h1 class="site-title"><a href="/">DJ Adams</a></h1><nav class="nav"><ul class="nav__list"><li class="nav-item"><a href="/about">About Me</a></li><li class="nav-item"><a href="/blog">Blog</a></li><li class="nav-item"><a href="/feed.xml">Feed</a></li></ul></nav></div></header><main class="main"><article class="post"><header class="post__header"><h1>Simple script for previewing CDS models in CSN - cdsray</h1><div class="post__details"><time datetime="2024-04-17">17 Apr 2024 </time><span>| </span><span>2 min read</span></div></header><main class="post__content"><p>The <a href="https://cap.cloud.sap/docs/releases/mar24#cds-previews-from-editor-title-bars">March 2024 release of CAP</a> brought many great new features including one for VS Code users - <a href="https://cap.cloud.sap/docs/releases/mar24#cds-previews-from-editor-title-bars">CDS Previews From Editor Title Bars</a>. It allows you to look, in realtime, at how your CDS model translates into various other representations, including YAML and JSON formats of Core Schema Notation (CSN)<a href="#footnotes"><sup>1</sup></a>, EDMX (for the OData protocol) and various flavours of Data Definition Language (DDL). Here's a screenshot of it in action, courtesy of <a href="https://cap.cloud.sap/docs/">Capire</a>:</p><p><img src="https://cap.cloud.sap/docs/assets/preview-in-editor-title.Ja_PTMdH.png" alt="preview in editor screenshot from Capire"></p><p>This feature really helps me visualise what I'm building, in that it gives me a live insight into how my model will be represented.</p><p>One aspect of this new feature that I find fascinating is that the default representation is the YAML flavour of CSN, rather than what most of us would expect when thinking about CSN, i.e. the JSON flavour. The reason is quite clear as soon as you start comparing the two: readability. YAML uses whitespace significantly, while JSON uses punctuation, to express structure. The result is that for any given structure, formatted YAML is more compact than its formatted JSON equivalent (unless you format JSON to the extreme with no or very little whitespace, which then makes it very difficult to read).</p><p>While I use VS Code, I'm more at home in my <a href="/blog/posts/2023/11/10/til-two-tmux-plugin-manager-features/">PDE</a> and I also enjoy embracing the Unix philosophy of using &quot;small tools loosely joined&quot;.</p><p>To that end, I built a simple script <a href="https://github.com/qmacro/dotfiles/blob/main/scripts/cdsray">cdsray</a> (for &quot;CDS X-ray&quot;) that gives me a similar experience. Inspired by the default choice of YAML flavoured CSN, I also opted to display YAML.</p><pre class="language-shell"><code class="language-shell"><span class="token shebang important">#!/usr/bin/env bash</span><br><br><span class="token builtin class-name">declare</span> <span class="token assign-left variable">modelfile</span><span class="token operator">=</span><span class="token string">"<span class="token variable">${1<span class="token operator">:?</span>Specify CDS model file to compile}</span>"</span><br><br><span class="token builtin class-name">declare</span> <span class="token assign-left variable">scriptname</span><span class="token operator">=</span><span class="token string">"<span class="token variable">${0<span class="token operator">##</span>*<span class="token operator">/</span>}</span>"</span><br><span class="token builtin class-name">declare</span> <span class="token assign-left variable">old</span><span class="token operator">=</span><span class="token string">"./.<span class="token variable">${scriptname}</span>.old"</span><br><span class="token builtin class-name">declare</span> <span class="token assign-left variable">new</span><span class="token operator">=</span><span class="token string">"./.<span class="token variable">${scriptname}</span>.new"</span><br><br>cds compile <span class="token parameter variable">--to</span> yaml <span class="token string">"<span class="token variable">$modelfile</span>"</span> <span class="token operator">></span> <span class="token string">"<span class="token variable">$new</span>"</span><br><br>bat <span class="token parameter variable">-p</span> <span class="token parameter variable">-l</span> yaml <span class="token string">"<span class="token variable">$new</span>"</span><br><span class="token keyword">if</span> <span class="token punctuation">[</span><span class="token punctuation">[</span> <span class="token parameter variable">-f</span> <span class="token string">"<span class="token variable">$old</span>"</span> <span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token keyword">then</span><br>    <span class="token builtin class-name">echo</span><br>    <span class="token function">diff</span> <span class="token parameter variable">--color</span> <span class="token string">"<span class="token variable">$old</span>"</span> <span class="token string">"<span class="token variable">$new</span>"</span><br><span class="token keyword">fi</span><br><span class="token function">cp</span> <span class="token string">"<span class="token variable">$new</span>"</span> <span class="token string">"<span class="token variable">$old</span>"</span></code></pre><p>Not only does it display the YAML flavour of the CSN that the model compiles to, as the equivalent VS Code feature does, but it will also endeavour to show you the <em>differences</em> compared to the previous version. This helps me enormously when I'm trying to understand the effect - in CSN - of a change or addition I make in my CDS model.</p><p>The script creates and uses two hidden files in the current directory, where the names are based on the script name (<code>./.cdsray.old</code> and <code>./.cdsray.new</code>). These files contain the previous (old) and current (new) versions of the YAML flavoured CSN for the model.</p><p>It relies on:</p><ul><li><code>cds</code> to compile the model</li><li><code>bat</code> to display the YAML in a nice colour-coded way</li><li><code>diff</code> to show a colour-coded difference between the previous and current versions</li></ul><p>In order to get the live effect, I use the script with <code>entr</code> to listen for changes on CDS files and automatically rerun the script, like this, for example:</p><pre class="language-shell"><code class="language-shell"><span class="token function">ls</span> *.cds <span class="token operator">|</span> entr <span class="token parameter variable">-c</span> cdsray services.cds </code></pre><p>Here's a quick demo of it in action:</p><p><img src="/images/2024/04/cdsray.gif" alt="Demo of cdsray"></p><hr><p><a href="footnotes"></a></p><h2>Footnotes</h2><ol><li>For more on CSN and how it relates to CDS and CDL, see <a href="/blog/posts/2024/04/05/cap-cds-cdl-csn-and-jq-finding-associations/">CAP, CDS, CDL, CSN and jq - finding associations</a>.</li></ol></main><aside class="post__aside"><div class="post__tags"><a href="/tags/cap/">#cap</a> <a href="/tags/cds/">#cds</a> <a href="/tags/csn/">#csn</a> <a href="/tags/bash/">#bash</a></div><style>.utterances {
  margin-left: inherit !important;
}</style><script src="https://utteranc.es/client.js" repo="qmacro/qmacro.github.io" issue-term="title" crossorigin="anonymous" async></script><nav class="post__pagination"><a href="/blog/posts/2024/05/03/controlling-automatic-http-requests-in-cap-node.js-design-time-loops/"><span>←</span> <span>Controlling automatic HTTP requests in CAP Node.js design time loops</span> </a><a href="/blog/posts/2024/04/15/using-@cap-jssqlite-in-cf-for-your-cap-services/"><span>Using @cap-js/sqlite in CF for your CAP services</span> <span>→</span></a></nav></aside></article></main><footer class="footer"><div class="footer__content"><ul class="hero__social-links"><li><a rel="me" href="https://github.com/qmacro" target="_blank" rel="noopener noreferrer">GitHub</a></li><li><a rel="me" href="https://www.youtube.com/djadams-qmacro" target="_blank" rel="noopener noreferrer">YouTube</a></li><li><a rel="me" href="https://www.linkedin.com/in/djadams/" target="_blank" rel="noopener noreferrer">LinkedIn</a></li><li><a rel="me" href="https://hachyderm.io/@qmacro" target="_blank" rel="noopener noreferrer">Mastodon</a></li><li><a href="/feed.xml" target="_blank" rel="noopener noreferrer">RSS</a></li></ul></div></footer></div><script src="/assets/main.31d6cfe0d16ae931b73c.js"></script></body></html>