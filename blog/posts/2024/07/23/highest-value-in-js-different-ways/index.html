<!doctype html><html lang="en"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1"><link rel="canonical" href="https://qmacro.org/blog/posts/2024/07/23/highest-value-in-js-different-ways/"><link rel="alternate" type="application/atom+xml" title="DJ's Weblog - Feed" href="https://qmacro.org/feed.xml"><link href="/assets/main.fe6b9c1e7ba4ff2bb7b5.css" rel="stylesheet"><link rel="preconnect" href="https://fonts.gstatic.com"><link href="https://fonts.googleapis.com/css2?family=IBM+Plex+Sans&display=swap" rel="stylesheet"><title>Highest value in JS - different ways | DJ Adams</title><link rel="icon" type="“image/x-icon”" href="/images/favicon.ico"><meta property="og:title" content="Highest value in JS - different ways"><meta property="og:site_name" content="DJ Adams"><meta property="og:type" content="website"><meta property="og:url" content="https://qmacro.org/blog/posts/2024/07/23/highest-value-in-js-different-ways/"><meta name="description" content="Highest value in JS - different ways 23 Jul 2024 | 4 min read This month I&#39;m running the Developer Challenge, which is on Reverse APIs. One..."><meta property="og:description" content="Highest value in JS - different ways 23 Jul 2024 | 4 min read This month I&#39;m running the Developer Challenge, which is on Reverse APIs. One..."><meta name="description" content="Highest value in JS - different ways 23 Jul 2024 | 4 min read This month I&#39;m running the Developer Challenge, which is on Reverse APIs. One..."><meta property="og:image" content="https://qmacro.org/images/site-image.png"><script src="https://cdn.jsdelivr.net/npm/mermaid/dist/mermaid.min.js"></script><script>mermaid.initialize({startOnLoad:true});</script><script async src="https://www.googletagmanager.com/gtag/js?id=G-4WQKBG0L4Y"></script><script>window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());

      gtag('config', 'G-4WQKBG0L4Y');</script></head><body><div class="layout-wrapper"><header class="header"><div class="header__content"><h1 class="site-title"><a href="/">DJ Adams</a></h1><nav class="nav"><ul class="nav__list"><li class="nav-item"><a href="/about">About Me</a></li><li class="nav-item"><a href="/blog">Blog</a></li><li class="nav-item"><a href="/feed.xml">Feed</a></li></ul></nav></div></header><main class="main"><article class="post"><header class="post__header"><h1>Highest value in JS - different ways</h1><div class="post__details"><time datetime="2024-07-23">23 Jul 2024 </time><span>| </span><span>4 min read</span></div></header><main class="post__content"><p>This month I'm running the Developer Challenge, which is on <a href="https://community.sap.com/t5/application-development-blog-posts/july-developer-challenge-quot-reverse-apis-quot/ba-p/13749653">Reverse APIs</a>. One of the 12 tasks is <a href="https://community.sap.com/t5/application-development-discussions/task-6-api-endpoint-with-payload-required-july-developer-challenge-quot/m-p/13765529">Task 6 - API endpoint with payload required</a> where the participants must create a &quot;REST&quot; style API endpoint.</p><p>This is in the context of an unbound action (in CAP, based on OData concepts) which means data is to be passed in the payload of an HTTP POST request, and arguably this was the more important part of the task. What the endpoint had to return was secondary and was not to divert effort away from the main part.</p><p>But I wanted to make it somewhat interesting, so I came up with the simple requirement of the data needing to be an array of numbers, and the return value to be the highest number in that array.</p><h2>Determining the highest value in an array of numbers</h2><p>There are many ways of approaching the implementation for this, here are a few. Let's assume we have a constant <code>nums</code> to which we've assigned an array of numbers, thus:</p><pre class="language-javascript"><code class="language-javascript"><span class="token keyword">const</span> nums <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">6</span><span class="token punctuation">,</span> <span class="token number">82</span><span class="token punctuation">,</span> <span class="token number">14</span><span class="token punctuation">,</span> <span class="token number">100</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">91</span><span class="token punctuation">]</span></code></pre><h3>By sorting</h3><p>First, we can sort the array and return the last one. Fairly straightforward, right? Well no, there are two gotchas.</p><p>The first is that the standard (and possibly more well-known) <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Array/sort">Array.prototype.sort</a> <strong>mutates</strong> the array upon which it operates. While JavaScript is a multi-paradigm language, it's arguable that the primary paradigm is functional. And in functional programming, mutating values is a no-no.</p><p>Consider:</p><pre class="language-javascript"><code class="language-javascript">nums<span class="token punctuation">.</span><span class="token function">sort</span><span class="token punctuation">(</span><span class="token punctuation">)</span></code></pre><p>This emits:</p><pre class="language-javascript"><code class="language-javascript"><span class="token punctuation">[</span> <span class="token operator">-</span><span class="token number">6</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">91</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">100</span><span class="token punctuation">,</span> <span class="token number">14</span><span class="token punctuation">,</span> <span class="token number">82</span> <span class="token punctuation">]</span></code></pre><p>It's not sorted as we'd expect - it's sorted the numbers <em>alphanumerically</em>. But that's the second gotcha and we'll come to that shortly.</p><p>The first gotcha is that it's now also mutated the contents of the original array. Ugh! The array values are now in the order we see here.</p><p>Luckily, we now also have <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Array/toSorted">Array.prototype.toSorted</a> which is a fairly recent addition to the language (first available with Node.js version 20, for example). This is a much more well-behaved function and does not mutate the array.</p><p>Unfortunately, it still exhibits the second gotcha, which is that numeric values are sorted in the same unexpected way as its badly behaved sibling, i.e. alphanumerically.</p><p>But, with both <code>sort()</code> and <code>toSorted()</code> you can pass a compare function, which it will use to compare values. This is the solution then to the sort-based approach of obtaining the highest number, as we can pass a function that will emit values to <code>sort()</code> or <code>toSorted()</code> that will bring about a numeric comparison based sort result:</p><pre class="language-javascript"><code class="language-javascript">nums<span class="token punctuation">.</span><span class="token function">toSorted</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">a<span class="token punctuation">,</span> b</span><span class="token punctuation">)</span> <span class="token operator">=></span> a <span class="token operator">-</span> b<span class="token punctuation">)</span></code></pre><p>This produces what we expect:</p><pre class="language-javascript"><code class="language-javascript"><span class="token punctuation">[</span> <span class="token operator">-</span><span class="token number">91</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">6</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">14</span><span class="token punctuation">,</span> <span class="token number">82</span><span class="token punctuation">,</span> <span class="token number">100</span> <span class="token punctuation">]</span></code></pre><p>and then we can take the last one.</p><p>But then even that's a bit cumbersome, as we can't index with <code>[-1]</code> to get the last one, as we can in other languages. We can get the positive index of the last element of an array <code>a</code> by offsetting the length by one, but we need to reify the array to do that, i.e. create an intermediate value (here, in <code>sorted</code>):</p><pre class="language-javascript"><code class="language-javascript"><span class="token keyword">const</span> sorted <span class="token operator">=</span> nums<span class="token punctuation">.</span><span class="token function">toSorted</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">a<span class="token punctuation">,</span> b</span><span class="token punctuation">)</span> <span class="token operator">=></span> a <span class="token operator">-</span> b<span class="token punctuation">)</span><br>sorted<span class="token punctuation">[</span>sorted<span class="token punctuation">.</span>length <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">]</span> <span class="token comment">// -> 100</span></code></pre><p>To avoid that, we could simply reverse the array's values and take the first one instead, which is easier and doesn't require knowing the array's length, and therefore doesn't require creating an intermediate array (<code>sorted</code>, in the previous example):</p><pre class="language-javascript"><code class="language-javascript">nums<span class="token punctuation">.</span><span class="token function">toSorted</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">a<span class="token punctuation">,</span> b</span><span class="token punctuation">)</span> <span class="token operator">=></span> a <span class="token operator">-</span> b<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">reverse</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token comment">// -> 100</span></code></pre><p>But it's still looking a bit &quot;busy&quot;.</p><p>There is another approach here, in that we can adjust the compare function so that it will cause the sort function to produce the values in the order we want:</p><pre class="language-javascript"><code class="language-javascript">nums<span class="token punctuation">.</span><span class="token function">toSorted</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">a<span class="token punctuation">,</span> b</span><span class="token punctuation">)</span> <span class="token operator">=></span> b <span class="token operator">-</span> a<span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token comment">// -> 100</span></code></pre><p>So that's an improvement. But I think we can do better.</p><h3>Using reduce</h3><p>It's no secret that <a href="https://www.google.com/search?q=site%3Aqmacro.org+reduce">one of my favourite functions is reduce</a>. It's such a powerful and fundamental function and has a beauty all of its own. And there's <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Array/reduce">a reduce function available on the Array prototype in JavaScript</a>.</p><p>The function operates on an array, and it's simple to address the requirement with it. Here's how:</p><pre class="language-javascript"><code class="language-javascript">nums<span class="token punctuation">.</span><span class="token function">reduce</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">a<span class="token punctuation">,</span> x</span><span class="token punctuation">)</span> <span class="token operator">=></span> x <span class="token operator">></span> a <span class="token operator">?</span> x <span class="token operator">:</span> a<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token comment">// -> 100</span></code></pre><p>To read this, notice that <code>reduce</code> itself has two parameters:</p><ul><li>a reducer function (<code>(a, x) =&gt; x &gt; a ? x : a</code>)</li><li>a starting value (<code>0</code>)</li></ul><p>As you can see, the reducer function itself takes two parameters - an &quot;accumulator&quot; and a current value. When you call <code>reduce</code> on an array, it iterates over each value in the array, calling the reducer function for each one, supplying the accumulator (<code>a</code>) and the current value (<code>x</code>), executes the function body, and whatever value is produced becomes the accumulator for the next call. And the starting value (<code>0</code>) is what's used as the accumulator value for the very first call.</p><p>For those curious about the actual function body here, it's just the <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Operators/Conditional_operator">ternary operator</a> that will emit the higher of <code>a</code> and <code>x</code>.</p><p>And of course, it goes without saying that <code>reduce</code> is also well behaved, i.e. it does not mutate the array upon which it operates.</p><h3>Using Math.max</h3><p>There's also the static method <code>Math.max</code> which will do what we want. Well, almost. It doesn't operate on an array, it expects the numbers to be passed via separate parameters. Let's see - if we try to pass our <code>nums</code> array, we get <code>NaN</code>:</p><pre class="language-javascript"><code class="language-javascript">Math<span class="token punctuation">.</span><span class="token function">max</span><span class="token punctuation">(</span>nums<span class="token punctuation">)</span> <span class="token comment">// -> NaN</span></code></pre><p>Why? Because this is what it returns &quot;if any of the parameters is or is converted into NaN&quot;. And an array, when converted to a number, becomes <code>NaN</code>:</p><pre class="language-javascript"><code class="language-javascript"><span class="token function">Number</span><span class="token punctuation">(</span>nums<span class="token punctuation">)</span> <span class="token comment">// -> NaN</span></code></pre><p>So we would have to pass the values in the array separately, like this:</p><pre class="language-javascript"><code class="language-javascript">Math<span class="token punctuation">.</span><span class="token function">max</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">6</span><span class="token punctuation">,</span> <span class="token number">82</span><span class="token punctuation">,</span> <span class="token number">14</span><span class="token punctuation">,</span> <span class="token number">100</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">91</span><span class="token punctuation">)</span> <span class="token comment">// -> 100</span></code></pre><p>Oh dear.</p><p>Luckily we have the <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Functions/rest_parameters">rest parameters syntax</a> which is primarily to allow the representation of variadic functions. But it's super useful generally for &quot;exploding&quot; an array into individual values that can then be passed to a function that expects discrete parameters.</p><p>We can see the rest parameter syntax, which is <code>...</code>, here:</p><pre class="language-javascript"><code class="language-javascript">console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>nums<span class="token punctuation">)</span> <span class="token comment">// -> [ 1, -6, 82, 14, 100, -91 ]</span></code></pre><pre class="language-javascript"><code class="language-javascript">console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token operator">...</span>nums<span class="token punctuation">)</span> <span class="token comment">// -> 1 -6 82 14 100 -91</span></code></pre><p>Spot the difference? In the second example where the rest parameters syntax is used, <code>console.log</code> emits multiple individual values (as that's what it received).</p><p>So we can use this syntax to pass the <code>nums</code> array to <code>Math.max</code> thus:</p><pre class="language-javascript"><code class="language-javascript">Math<span class="token punctuation">.</span><span class="token function">max</span><span class="token punctuation">(</span><span class="token operator">...</span>nums<span class="token punctuation">)</span> <span class="token comment">// -> 100</span></code></pre><p>This is arguably the nicest solution, but I personally still prefer the <code>reduce</code> based approach.</p><p>What's yours?</p></main><aside class="post__aside"><div class="post__tags"><a href="/tags/javascript/">#javascript</a> <a href="/tags/developerchallenge/">#developerchallenge</a></div><style>.utterances {
  margin-left: inherit !important;
}</style><script src="https://utteranc.es/client.js" repo="qmacro/qmacro.github.io" issue-term="title" crossorigin="anonymous" async></script><nav class="post__pagination"><a href="/blog/posts/2024/07/23/reduce-the-ur-function/"><span>←</span> <span>reduce - the ur-function</span> </a><a href="/blog/posts/2024/07/12/turning-an-odata-expand-into-a-cds.ql-cql-query-with-a-projection-function-in-cap/"><span>Turning an OData expand into a cds.ql CQL query with a projection function in CAP</span> <span>→</span></a></nav></aside></article></main><footer class="footer"><div class="footer__content"><ul class="hero__social-links"><li><a rel="me" href="https://github.com/qmacro" target="_blank" rel="noopener noreferrer">GitHub</a></li><li><a rel="me" href="https://www.youtube.com/djadams-qmacro" target="_blank" rel="noopener noreferrer">YouTube</a></li><li><a rel="me" href="https://www.linkedin.com/in/djadams/" target="_blank" rel="noopener noreferrer">LinkedIn</a></li><li><a rel="me" href="https://hachyderm.io/@qmacro" target="_blank" rel="noopener noreferrer">Mastodon</a></li><li><a href="/feed.xml" target="_blank" rel="noopener noreferrer">RSS</a></li></ul></div></footer></div><script src="/assets/main.31d6cfe0d16ae931b73c.js"></script></body></html>