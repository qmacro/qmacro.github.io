<!doctype html><html lang="en"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1"><link rel="canonical" href="https://qmacro.org/blog/posts/2024/11/08/flattening-the-hierarchy-with-mixins/"><link rel="alternate" type="application/atom+xml" title="DJ's Weblog - Feed" href="https://qmacro.org/feed.xml"><link href="/assets/main.fe6b9c1e7ba4ff2bb7b5.css" rel="stylesheet"><link rel="preconnect" href="https://fonts.gstatic.com"><link href="https://fonts.googleapis.com/css2?family=IBM+Plex+Sans&display=swap" rel="stylesheet"><title>Flattening the hierarchy with mixins | DJ Adams</title><link rel="icon" type="“image/x-icon”" href="/images/favicon.ico"><meta property="og:title" content="Flattening the hierarchy with mixins"><meta property="og:site_name" content="DJ Adams"><meta property="og:type" content="website"><meta property="og:url" content="https://qmacro.org/blog/posts/2024/11/08/flattening-the-hierarchy-with-mixins/"><meta name="description" content="Flattening the hierarchy with mixins 08 Nov 2024 | 2 min read Another gem in the TASC (&amp;quot;The Art &amp;amp; Science of CAP&amp;quot;) inaugural..."><meta property="og:description" content="Flattening the hierarchy with mixins 08 Nov 2024 | 2 min read Another gem in the TASC (&amp;quot;The Art &amp;amp; Science of CAP&amp;quot;) inaugural..."><meta name="description" content="Flattening the hierarchy with mixins 08 Nov 2024 | 2 min read Another gem in the TASC (&amp;quot;The Art &amp;amp; Science of CAP&amp;quot;) inaugural..."><meta property="og:image" content="https://qmacro.org/images/site-image.png"><script src="https://cdn.jsdelivr.net/npm/mermaid/dist/mermaid.min.js"></script><script>mermaid.initialize({startOnLoad:true});</script><script async src="https://www.googletagmanager.com/gtag/js?id=G-4WQKBG0L4Y"></script><script>window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());

      gtag('config', 'G-4WQKBG0L4Y');</script></head><body><div class="layout-wrapper"><header class="header"><div class="header__content"><h1 class="site-title"><a href="/">DJ Adams</a></h1><nav class="nav"><ul class="nav__list"><li class="nav-item"><a href="/about">About Me</a></li><li class="nav-item"><a href="/blog">Blog</a></li><li class="nav-item"><a href="/feed.xml">Feed</a></li></ul></nav></div></header><main class="main"><article class="post"><header class="post__header"><h1>Flattening the hierarchy with mixins</h1><div class="post__details"><time datetime="2024-11-08">08 Nov 2024 </time><span>| </span><span>2 min read</span></div></header><main class="post__content"><p>Another <a href="https://qmacro.org/tags/gems/">gem</a> in the <a href="https://qmacro.org/tags/tasc/">TASC</a> (&quot;The Art &amp; Science of CAP&quot;) <a href="https://www.youtube.com/watch?v=XMchiFnDJ6E">inaugural episode</a> is from around 49 mins in, in Daniel H's example about two application teams (&quot;invoices&quot; and &quot;orders&quot;), a foundation team (&quot;core&quot;) and a team sitting in between the foundation and application teams (&quot;middle&quot;):</p><pre class="language-text"><code class="language-text">invoices     orders<br>   |           |<br>   +-----+-----+<br>         |<br>       middle<br>         |<br>        core</code></pre><p>Considering what the foundation team offers as a base for application projects:</p><pre class="language-cds"><code class="language-cds"><span class="token keyword">entity</span> BusinessObject {<br>    createdAt : <span class="token type builtin">DateTime</span>;<br>    createdBy : <span class="token type builtin">String</span>;<br>}</code></pre><p>here's how e.g. the &quot;invoices&quot; application team is to make use of that:</p><pre class="language-cds"><code class="language-cds"><span class="token using keyword">using</span> { BusinessObject } <span class="token from keyword">from</span> './core';<br><br><span class="token keyword">entity</span> Invoices : BusinessObject {<br>    <span class="token cqlkeywords keyword">key</span> InvoiceID : <span class="token type builtin">String</span>;<br>}</code></pre><p>Nothing untoward here, and of course we can appreciate the <a href="/blog/posts/2024/11/04/separating-concerns-and-focusing-on-the-important-stuff/#using-aspects">use of aspects</a> with the <code>:</code> shortcut syntax.</p><p>Now the middle layer team arrives with their requirement to have the core layer <code>BusinessObject</code> have another element relating to their <code>User</code> entity definition which looked like this, in their <code>middle.cds</code> file:</p><pre class="language-cds"><code class="language-cds"><span class="token keyword">entity</span> Users {<br>    <span class="token cqlkeywords keyword">key</span> ID : <span class="token type builtin">UUID</span>;<br>    Name   : <span class="token type builtin">String</span>;<br>}</code></pre><p>In a classic hierarchical-thinking context, this new middle layer team would have to speak to and convince either the core team, or all of the application teams, to make changes to the details of their model. Beyond being a coordination problem, this introduces:</p><ul><li>work for every application team (adding an element to each entity manually)</li><li>work for all teams (changing the base inheritance from the core <code>BusinessObject</code> to one from a new layer)</li><li>a problem for the core team (inheriting from a level above in the hierarchy)</li></ul><p>as well as bringing about increased brittleness all round.</p><p>But why think in hierarchical terms? CAP's embrace of <a href="https://cap.cloud.sap/docs/cds/cdl#aspects">aspects</a>, brought to life here with <a href="https://cap.cloud.sap/docs/cds/cdl#extend">the <code>extend</code> directive</a>, is a great example of adopting a mixin-based approach. A mixin <a href="https://en.wikipedia.org/wiki/Mixin">is defined as</a>:</p><p><em>... a class that contains methods for use by other classes without having to be the parent class of those other classes. How those other classes gain access to the mixin's methods depends on the language. Mixins are sometimes described as being &quot;included&quot; rather than &quot;inherited&quot;.</em></p><p>I find that mentally substituting the word &quot;definition&quot; for &quot;class&quot; here helps to land this concept from a theoretical point of view in CDS based modelling. And how does this concept land practically here? Like this:</p><pre class="language-cds"><code class="language-cds"><span class="token using keyword">using</span> { BusinessObject } <span class="token from keyword">from</span> './core';<br><br><span class="token keyword">entity</span> Users {<br>    <span class="token cqlkeywords keyword">key</span> ID : <span class="token type builtin">UUID</span>;<br>    Name   : <span class="token type builtin">String</span>;<br>}<br><br><span class="token keyword">extend</span> BusinessObject with {<br>    creator : <span class="token association-composition keyword">Association to Users</span>;<br>}</code></pre><p>A simple three step approach, the beauty of which is masked by its simplicity:</p><ul><li>import the <code>BusinessObject</code></li><li>define the new <code>Users</code> entity</li><li>extend the imported <code>BusinessObject</code> with an element that refers to that new entity</li></ul><p>Not only that, but there's no work, no changes, for either the core team or the application teams.</p><p>Boom! Hierarchy? What hierarchy? The power of <code>extend</code>, as a practical personification of a mixin mechanic, combined with the CDS model (compiler)'s approach of loading all the appropriate files to build the &quot;effective model&quot;, is a subtly powerful solution to problems like this brought about by layer-based thinking.</p><p>Lovely!</p></main><aside class="post__aside"><div class="post__tags"><a href="/tags/cds/">#cds</a> <a href="/tags/cap/">#cap</a> <a href="/tags/tasc/">#tasc</a> <a href="/tags/gems/">#gems</a> <a href="/tags/mixins/">#mixins</a></div><style>.utterances {
  margin-left: inherit !important;
}</style><script src="https://utteranc.es/client.js" repo="qmacro/qmacro.github.io" issue-term="title" crossorigin="anonymous" async></script><nav class="post__pagination"><a href="/blog/posts/2024/11/07/five-reasons-to-use-cap/"><span>Five reasons to use CAP</span> <span>→</span></a></nav></aside></article></main><footer class="footer"><div class="footer__content"><ul class="hero__social-links"><li><a rel="me" href="https://github.com/qmacro" target="_blank" rel="noopener noreferrer">GitHub</a></li><li><a rel="me" href="https://www.youtube.com/djadams-qmacro" target="_blank" rel="noopener noreferrer">YouTube</a></li><li><a rel="me" href="https://www.linkedin.com/in/djadams/" target="_blank" rel="noopener noreferrer">LinkedIn</a></li><li><a rel="me" href="https://hachyderm.io/@qmacro" target="_blank" rel="noopener noreferrer">Mastodon</a></li><li><a href="/feed.xml" target="_blank" rel="noopener noreferrer">RSS</a></li></ul></div></footer></div><script src="/assets/main.31d6cfe0d16ae931b73c.js"></script></body></html>