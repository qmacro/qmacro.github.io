<!doctype html><html lang="en"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1"><link rel="canonical" href="https://qmacro.org/blog/posts/2004/06/22/real-web-services-with-rest-and-icf/"><link rel="alternate" type="application/atom+xml" title="DJ's Weblog - Feed" href="https://qmacro.org/feed.xml"><link href="/assets/main.54fe08380532f159e78f.css" rel="stylesheet"><link rel="preconnect" href="https://fonts.gstatic.com"><link href="https://fonts.googleapis.com/css2?family=IBM+Plex+Sans&display=swap" rel="stylesheet"><title>Real Web Services with REST and ICF | DJ Adams</title><link rel="icon" type="“image/x-icon”" href="/images/favicon.ico"><meta property="og:title" content="Real Web Services with REST and ICF"><meta property="og:site_name" content="DJ Adams"><meta property="og:type" content="website"><meta property="og:url" content="https://qmacro.org/blog/posts/2004/06/22/real-web-services-with-rest-and-icf/"><meta name="description" content="Real Web Services with REST and ICF 22 Jun 2004 | 12 min read This was a piece I wrote in 2004 as part of a set of articles I contributed to..."><meta property="og:description" content="Real Web Services with REST and ICF 22 Jun 2004 | 12 min read This was a piece I wrote in 2004 as part of a set of articles I contributed to..."><meta name="description" content="Real Web Services with REST and ICF 22 Jun 2004 | 12 min read This was a piece I wrote in 2004 as part of a set of articles I contributed to..."><meta property="og:image" content="https://qmacro.org/images/site-image.png"><script src="https://cdn.jsdelivr.net/npm/mermaid/dist/mermaid.min.js"></script><script>mermaid.initialize({startOnLoad:true});</script><script async src="https://www.googletagmanager.com/gtag/js?id=G-4WQKBG0L4Y"></script><script>window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());

      gtag('config', 'G-4WQKBG0L4Y');</script></head><body><div class="layout-wrapper"><header class="header"><div class="header__content"><h1 class="site-title"><a href="/">DJ Adams</a></h1><nav class="nav"><ul class="nav__list"><li class="nav-item"><a href="/about">About Me</a></li><li class="nav-item"><a href="/blog">Blog</a></li><li class="nav-item"><a href="/feed.xml">Feed</a></li></ul></nav></div></header><main class="main"><article class="post"><header class="post__header"><h1>Real Web Services with REST and ICF</h1><div class="post__details"><time datetime="2004-06-22">22 Jun 2004 </time><span>| </span><span>12 min read</span></div></header><main class="post__content"><p><em>This was a piece I wrote in 2004 as part of a set of articles I contributed to the early SAP Developer Network. Back then the content was published behind a login wall; plus, unfortunately, during an SAP Developer Network platform migration, content was lost, including this article. Luckily I managed to piece it together over the last few months. Here it is. Some OCR based artifacts and errors may remain, if you spot any, please let me know. Thanks. DJ (Apr 2025).</em></p><p>It was published with a rather unfriendly disclaimer that the SAP Developer Network editors at the time added to the top of it, without my knowledge or checking with me first:</p><p><img src="/images/2004/06/article-header-with-disclaimer.png" alt="article header with disclaimer: &quot;DJ Adams is not an SAP employee and the opinions he expresses in this article do not reflect the official position or positioning of SAP&quot;"></p><p>Turns out that disclaimer didn't age well, as REST turned out to be the primary, dominant style of API architecture in the SAP enterprise world ... and still is :-)</p><h2>Summary</h2><p>Learn about the Internet Communication Framework, and how to harness it to write your own web services in SAP. Break free from the stranglehold of complexity that SOAP has upon you and start building real web services with HTTP.</p><h2>Web Services and SOAP</h2><p>There's a lot of hype about SOAP and associated WS-* initiatives being the panacea of data interop over the web. But while the most common transport of SOAP messages is HTTP, can SOAP be really classed as a ‘web’ service? There's really nothing web-like about SOAP, except that in many cases, the standard HTTP port is used ~ ‘hijacked’, almost ~ as a tunnel through which to transfer opaque messages to and from a single non- specific endpoint.</p><p>Ok, that was perhaps a little harsh. But as the saying goes, truth hurts. When I think of SOAP I feel very distant from the information I'm trying to manage. There are just too many mechanisms and far too much protocol in the way. Why employ an application protocol (such as HTTP) and then only use it to transfer messages between meaningless addresses? It's ike buying a car and only using it to store things in.</p><p>Let's think about what web services are about. They're about the sharing and exchange of data over the web. What's the biggest, most scalable, most interoperable, most widely used, most successful example of that? Yes, surprise surprise, it's the web itself. And what powers the web? The Hypertext Transfer Protocol. HTTP. Sure, there are plenty of key team members that go to make up the full experience ((X)HTML, MIME, CSS, and so on), but the one essential ingredient that makes everything work, is the application protocol - not transport protocol -- HTTP.</p><p>So if web services are about sharing and exchanging data, what are we trying to achieve? We're trying to open up the data and functionality inside our SAP systems, in a controlled manner of course, to share with our partners and customers.</p><p>Look at this in the context of SOAP. You have an element (or elements) of data that you want to share with your customers. Who in their right mind would wrap a CORBA-wannabe function call in angle brackets, send the request to an opaque endpoint, expect the receiver to blindly accept it, and then expect to have to start an XML parser just to get at the reply? People building job security, perhaps? Or with too much time on their hands?</p><p>And another thing. When you're reading or writing data with SOAP, you're not actually addressing that data directly, are you? All you've got is the address of some faceless SOAP server location with which you must interact. But surely, if an element of data is important enough to share with your customer, isn't it also important enough to have its own address -- its own URL?</p><h2>HTTP - The Application Protocol</h2><p>I pointed out earlier that HTTP is an application protocol, not a transport protocol. That's an important distinction to make here. HTTP is not just about transporting payloads around. Let's look briefly at what HTTP is all about.</p><p>HTTP allows you to manage data, in that it allows you to read (retrieve), write, update and delete it. And as any SQL guru will testify, those are the four essential fundamentals in any data manipulation mechanism. In HTTP there are verbs and nouns. The verbs -- GET (read), PUT (write), POST (update), DELETE (ahem, delete) - reflect the actions that can be carried out on the nouns. The nouns are URLS.</p><p>Looking at this in the context of, say, a page of HTML, we could have the following simple scenarios as shown in Figure 1.</p><p>Verb: GET<br>Path: /some/path/page.html<br>Action: Retrieve the specified HTML page</p><p>Verb: PUT<br>Path: /some/path/page1.html<br>Action: Replace the specified HTML page with a new one</p><p>Verb: POST<br>Path: /some/path/<br>Action: Add a new HTML page - the response will indicate where the new page is stored (e.g. /path/page2.html)</p><p>Verb: DELETE<br>/some/path/page1.html<br>Action: Delete the specified HTML page</p><p><em>Figure 1. HTTP verb/noun scenario example</em></p><p>With MIME types allowing us to specific and handle content types of all kinds, HTTP is arguably all we need as a flexible application protocol to provide all kinds of web services.</p><p>Part of the appeal of using real web services is that HTTP is unadorned. What you see is exactly what you want. And what you want, you can get using a huge array of tools, on a wide range of platforms. HTTP is probably one of the most widely ported application protocols around. There are all sorts of ways you can construct and execute HTTP requests and parse responses. There are command line tools, like GET and POST (that come with the fantastic LWP library), which mean that you can combine HTTP requests with your essential shell scripting and pipe-work. There are libraries for almost every language under the sun. There are even text-mode web browsers that double up as generic HTTP tools. And one of the most attractive side-effects of HTTP's ubiquity is that there's a plethora of debugging tools out there.</p><h2>SOAP and Firewalls</h2><p>Finally, it's worth giving a thought to our poor firewall administrators, whose job it is to analyse traffic and control what enters the enterprise network. With SOAP, the firewall administrator's toolset is about as much use as a chocolate teapot when it comes to helping police SOAP requests.</p><p>Firstly, in many cases, all SOAP requests, whether they have read-only intentions or write intentions, go to the same endpoint (URL), so no distinction can be made based on the action (verb) or object (noun). Secondly, even if the firewall software did take the time and effort to open up the SOAP payload (arguably not the firewall's right), fire up an XML parse to interpret it, and look at the method call being issued, who's to say, based on the arbitrary name of that method call, what the intention was? (There is the SOAPAetion header which is supposed to help here; but for one thing, it's optional, and for another, even if it was mandatory, the value supplied is as good as arbitrary).</p><p>With HTTP, the firewall administrator's job is easier. What's the verb? POST? Ok. What's the noun? /some/path/to/a/data/element. Ok, not allowed. Job done.</p><h2>A Simple Web Service in SAP</h2><p>So, I'd like to balance out this fighting talk with a very simple example of a real web service, implemented using the Internet Communication Framework (ICF). Before we do, let's look at the context in which the example will sit.</p><h2>The Internet Communication Framework</h2><p>The ICF is an essential part of the HTTP framework built into an SAP system. While the Internet Communication Manager (ICM) does the actual low-level handling of HTTP. requests (with kernel-level code), it's the ICF that exposes the ICM features to us, the lowly ABAP programmers, giving us a fantastic platform on which to build HTTP applications. It gives us a set of core interfaces and classes representing the fundamental objects in any web server application development environment - the web server itself, the request object, the response object, utilities for manipulating HTTP data, and so on.</p><p>For more information about the ICF, see the relevant section in the online SAP documentation at <a href="http://help.sap.com">http://help.sap.com</a>.</p><p>With the ICF, you build web applications - web services - by writing a so-called handler. A handler is simply a piece of code, in the form of a class, that's called by the HTTP framework for requests made to certain URLs. The code interprets the request, and constructs the response. Where does the BSP technology fit in all of this? Well, the BSP is 'just' another handler, class CL_HTTP_EXT_BSP, pre-written and provided by SAP, a handler that is called in the case of requests to certain URLs (starting /sap/bc/bsp). It just so happens that the BSP handler is hugely powerful and is a complete MVC-powered development world within itself - kudos, chaps!</p><h2>A Simple Handler Class</h2><p>So let's build a simple handler class to allow authenticated HTTP requests to retrieve (GET) information from the Correction and Transport System (CTS). I've developed this example in my copy of the free WAS 6.40 testdrive system 'NW4', which is Basis-only, meaning I'm bound to use some Basis-orientated data unless I develop some custom applications myself. To keep things simple, I'm going to use CTS data.</p><p>We're just interested in exposing basic attributes of transport requests and tasks - who the ‘owner is, what type itis, the date, and the short description. That sort of thing. The ‘exposure will be made through URLs that have this pattern:</p><pre class="language-url"><code class="language-url"><span class="token scheme">http<span class="token scheme-delimiter">:</span></span><span class="token authority"><span class="token authority-delimiter">//</span><span class="token host">servemame</span><span class="token port-segment"><span class="token port-delimiter">:</span></span></span><span class="token path">port<span class="token path-separator">/</span>some-pathitransport<span class="token path-separator">/</span></span>&lt;requestname>/&lt;attribute></code></pre><p>For simplicity (and to save lookup tables or dynamic jiggery-pokery in the example code), we're going to use the field names from tables E070 (CTS Request / Task Header table) and E07T (CTS Request / Task Short Text table).</p><p>So for example, to retrieve the owner of request NW4K900008, all that is needed is an HTTP GET on the following URL:</p><pre class="language-url"><code class="language-url"><span class="token scheme">http<span class="token scheme-delimiter">:</span></span><span class="token authority"><span class="token authority-delimiter">//</span><span class="token host">shrdlu</span></span> local.net:8000/qmacro/transpor/Y 6BK039552/as4user</code></pre><p>Note that each element of data has its own address. Each element is a noun in the context of HTTP.</p><p>The host on which my NW4 system runs is ‘shrdlu.local.net, the ICM is listening for HTTP. requests on port 8000, and I've defined a namespace ‘qmacro’ in SICF within which I develop all my test services. Under that namespace I have defined a service object ‘transport’, for which the handler class Z_CL_TRANSPORT_INFO is defined. This can be seen in Figure 2.</p><p><img src="/images/2004/06/figure2.png" alt="The definition of the ‘transport’ service in SICF"></p><p><em>Figure 2. The definition of the ‘transport’ service in SICF</em></p><p>Within the handler class we have the code to identify what transport is being requested ('Y6BK039552’) and what attribute (‘as4user’). The handler will retrieve the relevant details, and return them in response. Figure 3 shows how that data can be retrieved on the ‘command line, using the GET command. The owner of request Y6BK039552 in this case is FILDEBRANDT. Figure 4 shows a similar piece of data retrieved via the web browser.</p><pre class="language-shell"><code class="language-shell"><span class="token punctuation">[</span>dj@hadrian<span class="token punctuation">]</span>$ GET http://shrdlu.local.net:8000/qmacro/transport/¥6BK039552/as4user<br>Enter username <span class="token keyword">for</span> NW4 at shrdlu.local.net:8000: developer<br>Password: *****<br><br>HILDEBRANDT</code></pre><p><img src="/images/2004/06/figure4.png" alt="Retrieving data from a web browser"></p><p><em>Figure 4. Retrieving data from a web browser</em></p><h2>Method HANDLE_REQUEST in IF_HTTP_EXTENSION</h2><p>Classes that are to act as ICF handlers must implement interface IF_HTTP_EXTENSION. This interface has a single method, HANDLE_REQUEST. It's in this method that you write the ABAP code to work out what's being requested, and what to do to respond to that request. Figure 5 shows the code in class Z_CL_TRANSPORT_INFO's method IF_HTTP_EXTENSION~HANDLE_REQUEST.</p><pre class="language-abap"><code class="language-abap"><span class="token keyword">METHOD</span> IF_HTTP <span class="token keyword">EXTENSION</span>~HANDLE_REQUEST <span class="token punctuation">.</span><br>    <span class="token operator">*</span> [DATA <span class="token keyword">DEFINITION</span>]<br>    <span class="token operator">*</span> e07* <span class="token keyword">table</span> <span class="token keyword">data</span> held <span class="token keyword">in</span> transinfo<br><br>    <span class="token keyword">TYPES</span><span class="token punctuation">:</span><br>    <span class="token keyword">begin</span> <span class="token keyword">of</span> transinfo<span class="token punctuation">,</span><br>        trfunction <span class="token keyword">TYPE</span> e070<span class="token token-operator punctuation">-</span>trfunction<span class="token punctuation">,</span><br>        trstatus <span class="token keyword">TYPE</span> e070<span class="token token-operator punctuation">-</span>trstatus<span class="token punctuation">,</span><br>        as4user <span class="token keyword">TYPE</span> e070<span class="token token-operator punctuation">-</span>as4user<span class="token punctuation">,</span><br>        as4date <span class="token keyword">TYPE</span> e070<span class="token token-operator punctuation">-</span>as4date<span class="token punctuation">,</span><br>        as4text <span class="token keyword">TYPE</span> e07t<span class="token token-operator punctuation">-</span>as4text<span class="token punctuation">,</span><br>    <span class="token keyword">end</span> <span class="token keyword">of</span> transinfo<span class="token punctuation">.</span><br><br>    <span class="token keyword">DATA</span><span class="token punctuation">:</span><br>    path_info <span class="token keyword">TYPE</span> string<span class="token punctuation">,</span><br>    w_trkorr <span class="token keyword">TYPE</span> string<span class="token punctuation">,</span><br>    w_attr <span class="token keyword">TYPE</span> string<span class="token punctuation">,</span><br>    w_body <span class="token keyword">TYPE</span> string<span class="token punctuation">,</span><br>    w_fieldname <span class="token keyword">TYPE</span> string<span class="token punctuation">,</span><br>    transportinfo <span class="token keyword">TYPE</span> transinfo<span class="token punctuation">.</span><br><br>    <span class="token keyword">FIELD-SYMBOLS</span> \&lt;fs> <span class="token keyword">TYPE</span> <span class="token keyword">any</span><span class="token punctuation">.</span><br><br>    <span class="token operator">*</span> [INTERPRET <span class="token keyword">REQUEST</span>]<br>    <span class="token operator">*</span> Look <span class="token keyword">at</span> what <span class="token keyword">is</span> being <span class="token keyword">requested</span><br><br>    path_info <span class="token operator">=</span> server<span class="token token-operator punctuation">-></span>request<span class="token token-operator punctuation">-></span>get_header_field<span class="token punctuation">(</span> <span class="token keyword">name</span> <span class="token operator">=</span> <span class="token string">'~path_info'</span> <span class="token punctuation">)</span><span class="token punctuation">.</span><br>    <span class="token keyword">SHIFT</span> path_info <span class="token keyword">LEFT</span> <span class="token keyword">BY</span> <span class="token number">1</span> <span class="token keyword">PLACES</span><span class="token punctuation">.</span><br>    <span class="token keyword">SPLIT</span> path_info <span class="token keyword">AT</span> <span class="token string">'/'</span> <span class="token keyword">INTO</span> w_trkorr w_attr<span class="token punctuation">.</span><br><br>    <span class="token operator">*</span> [RETRIEVE <span class="token keyword">DATA</span>]<br>    <span class="token operator">*</span> <span class="token keyword">Try</span> <span class="token keyword">to</span> retrieve the transport<br><br>    <span class="token keyword">SELECT</span> <span class="token keyword">SINGLE</span> <span class="token number">070</span>~trfunction e070<span class="token token-operator punctuation">~</span>trstatus e070<span class="token token-operator punctuation">~</span>as4user e070<span class="token token-operator punctuation">~</span>as4date e07t<span class="token token-operator punctuation">~</span>as4text<br>    <span class="token keyword">FROM</span> <span class="token number">070</span><br>    <span class="token keyword">INNER</span> <span class="token keyword">JOIN</span> e07t <span class="token keyword">ON</span> e07t<span class="token token-operator punctuation">~</span>trkorr <span class="token operator">=</span> e070<span class="token token-operator punctuation">~</span>trkorr<br>    <span class="token keyword">INTO</span> transportinfo<br>    <span class="token keyword">WHERE</span> e070<span class="token token-operator punctuation">~</span>trkorr <span class="token keyword">EQ</span> w_trkorr<br>    <span class="token keyword">AND</span> e07t<span class="token token-operator punctuation">~</span>langu <span class="token keyword">EQ</span> sy<span class="token token-operator punctuation">-</span>langu<span class="token punctuation">.</span><br><br>    <span class="token operator">*</span> [TRANSPORT <span class="token keyword">NOT</span> <span class="token keyword">FOUND</span>]<br>    <span class="token operator">*</span> Abort <span class="token keyword">with</span> <span class="token number">404</span> <span class="token keyword">if</span> the transport can't be <span class="token keyword">found</span><br><br>    <span class="token keyword">IF</span> sy<span class="token token-operator punctuation">-</span>subre <span class="token keyword">ne</span> <span class="token number">0</span><span class="token punctuation">.</span><br>        <span class="token keyword">CALL</span> <span class="token keyword">METHOD</span> server<span class="token token-operator punctuation">-></span>response<span class="token token-operator punctuation">-></span>set_status <span class="token punctuation">(</span> <span class="token keyword">code</span> <span class="token operator">=</span> <span class="token eol-comment comment">"404" reason = </span><span class="token string">'Transport not found'</span> <span class="token punctuation">)</span><span class="token punctuation">.</span><br>        <span class="token keyword">CONCATENATE</span> <span class="token string">'&lt;html>'</span><br>        <span class="token string">'&lt;head>'</span><br>        <span class="token string">'&lt;title>Transport not found&lt;/title>'</span><br>        <span class="token string">'&lt;/head>'</span><br>        <span class="token string">'&lt;body>'</span><br>        <span class="token string">'&lt;h1>Transport&amp;nbsp;'</span><br>        w_trkorr<br>        <span class="token string">'&amp;nbsp;not found&lt;/h1>'</span><br>        <span class="token string">'&lt;/body>'</span><br>        <span class="token string">'&lt;/html>'</span><br>        <span class="token keyword">INTO</span> w_body<span class="token punctuation">.</span><br><br>        <span class="token keyword">CALL</span> <span class="token keyword">METHOD</span> server<span class="token token-operator punctuation">-></span>response<span class="token token-operator punctuation">-></span>set_cdata<span class="token punctuation">(</span> <span class="token keyword">data</span> <span class="token operator">=</span> w_body <span class="token punctuation">)</span><span class="token punctuation">.</span><br>        <span class="token keyword">EXIT</span><span class="token punctuation">.</span><br>    <span class="token keyword">ENDIF</span><span class="token punctuation">.</span><br><br>    <span class="token operator">*</span> [SELECT ATTRIBUTE]<br>    <span class="token operator">*</span> <span class="token keyword">Select</span> desired attribute<br><br>    <span class="token keyword">TRANSLATE</span> w_attr <span class="token keyword">TO</span> <span class="token keyword">UPPER</span> <span class="token keyword">CASE</span><span class="token punctuation">.</span><br><br>    <span class="token keyword">CONCATENATE</span> <span class="token string">'TRANSPORTINFO'</span> w_attr <span class="token keyword">INTO</span> w_fieldname<br>    <span class="token keyword">SEPARATED</span> <span class="token keyword">BY</span> <span class="token string">'-'</span><span class="token punctuation">.</span><br>    <span class="token keyword">ASSIGN</span> <span class="token punctuation">(</span>w_fieldname<span class="token punctuation">)</span> <span class="token keyword">to</span> &lt;fs><span class="token punctuation">.</span><br><br>    <span class="token operator">*</span> [ATTRIBUTE <span class="token keyword">NOT</span> <span class="token keyword">FOUND</span>]<br>    <span class="token operator">*</span> Abort <span class="token keyword">with</span> <span class="token number">404</span> <span class="token keyword">if</span> the attribute cannot be <span class="token keyword">found</span><br><br>    <span class="token keyword">IF</span> sy<span class="token token-operator punctuation">-</span>subre <span class="token keyword">ne</span> <span class="token number">0</span><span class="token punctuation">.</span><br>        <span class="token keyword">CALL</span> <span class="token keyword">METHOD</span> server<span class="token token-operator punctuation">-></span>response<span class="token token-operator punctuation">-></span>set_status <span class="token punctuation">(</span><br>        <span class="token keyword">code</span> <span class="token operator">=</span> <span class="token string">'404'</span><br>        reason <span class="token operator">=</span> <span class="token string">'Attribute not found'</span> <span class="token punctuation">)</span><span class="token punctuation">.</span><br>        <span class="token keyword">CONCATENATE</span> <span class="token string">'&lt;html>'</span><br>        <span class="token string">'&lt;head>'</span><br>        <span class="token string">'&lt;title>Attribute not found&lt;/title>'</span><br>        <span class="token string">'&lt;/head>'</span><br>        <span class="token string">'&lt;body>'</span><br>        <span class="token string">'&lt;h1>Attribute &amp;nbsp;'</span><br>        w_attr<br>        <span class="token string">'&amp;nbsp;not found&lt;/h1>'</span><br>        <span class="token string">'&lt;/body>'</span><br>        <span class="token string">'&lt;/html>'</span><br>        <span class="token keyword">INTO</span> w_body<span class="token punctuation">.</span><br>        <span class="token keyword">CALL</span> <span class="token keyword">METHOD</span> server<span class="token token-operator punctuation">-></span>response<span class="token token-operator punctuation">-></span>set_cdata<span class="token punctuation">(</span> <span class="token keyword">data</span> <span class="token operator">=</span> w_body <span class="token punctuation">)</span><span class="token punctuation">.</span><br>        <span class="token keyword">EXIT</span><span class="token punctuation">.</span><br>    <span class="token keyword">ENDIF</span><span class="token punctuation">.</span><br><br>    <span class="token operator">*</span> [STORE ATTRIBUTE]<br><br>    w_body <span class="token operator">=</span> &lt;fs><span class="token punctuation">.</span><br><br>    <span class="token operator">*</span> [SET CONTENT <span class="token keyword">TYPE</span>]<br>    <span class="token operator">*</span> So far so good ~ <span class="token keyword">return</span> attribute <span class="token keyword">value</span> <span class="token keyword">in</span> response body<br><br>    <span class="token keyword">CALL</span> <span class="token keyword">METHOD</span> server<span class="token token-operator punctuation">-></span>response<span class="token token-operator punctuation">-></span>set_header_field<span class="token punctuation">(</span><br>    <span class="token keyword">name</span> <span class="token operator">=</span> <span class="token string">'Content-Type'</span><br>    <span class="token keyword">value</span> <span class="token operator">=</span> <span class="token string">'text/plain; charset=utf-8'</span> <span class="token punctuation">)</span><span class="token punctuation">.</span><br><br>    <span class="token operator">*</span> [PUT <span class="token keyword">DATA</span> <span class="token keyword">IN</span> RESPONSE BODY<span class="token punctuation">)</span><br>    <span class="token keyword">CALL</span> <span class="token keyword">METHOD</span> server<span class="token token-operator punctuation">-></span>response<span class="token token-operator punctuation">-></span>set_cdata<span class="token punctuation">(</span> <span class="token keyword">data</span> <span class="token operator">=</span> w_body <span class="token punctuation">)</span><span class="token punctuation">.</span><br><span class="token keyword">ENDMETHOD</span><span class="token punctuation">.</span></code></pre><p><em>Figure 5. Z_CL_TRANSPORT_INFO's IF_HTTP_EXTENSION~HANDLE_REQUEST</em></p><h2>Step By Step</h2><p>Let's take the code in Figure 5 step by step. The code is deliberately simplistic and sequential to make it easier to go through in stages. The subheadings that follow refer to the sections of the same name in the code comments.</p><h3>DATA DEFINITION</h3><p>Here we define a structure to hold the CTS data that we're going to retrieve, a few working fields, and a field symbol to use when selecting the requested attribute later on.</p><h3>INTERPRET REQUEST</h3><p>For every incoming HTTP request, a 'server control block' is made available to the handler method in the form of a CL_HTTP_SERVER object. This object has two significant attributes, one of which is the HTTP request object (REQUEST). We can retrieve all sorts of information about the incoming HTTP request from this, such as the path information from the URL. In this case, this is anything following what's been defined in SICF for which this handler is specified (see Figure 2), i.e. '/default_host/qmacro/transport'.</p><p>So making this call:</p><pre class="language-abap"><code class="language-abap">path_info <span class="token operator">=</span> server<span class="token token-operator punctuation">-></span>request<span class="token token-operator punctuation">-></span>get_header_field<span class="token punctuation">(</span> <span class="token keyword">name</span> <span class="token operator">=</span> <span class="token string">'"~path_info'</span> <span class="token punctuation">)</span><span class="token punctuation">.</span></code></pre><p>retrieves the path information, which, from the example above, is '/Y6BK039552/as4text'. Note that '~path_info' isn't really a proper HTTP header field; in the ICF context it's one of the so-called 'pseudo' header fields, which are just bundled in with the rest of the real header fields for convenience of access.</p><p>Once retrieved, the path information is split into transport number and attribute.</p><h3>RETRIEVE DATA</h3><p>Now we've got the desired transport number, we can read tables E070 and E07T for the information.</p><h3>TRANSPORT NOT FOUND</h3><p>If the read failed, we assume the request or task cannot be found, and so must respond accordingly. The HTTP response object (RESPONSE) is the other significant attribute of the control block and can be used to build the HTTP response. Here we do two things. We set the HTTP status, and supply some friendly HTML in the body in case the request has been made from a browser.</p><p>Calling the set_status() method of the response object allows us to specify the HTTP status code and reason. We're setting the well-known 'Not found' status code 404 in this case, with a meaningful reason text.</p><p>Following that, some HTML is concatenated and placed in the response body with the set_cdata() method.</p><p>Figure 6 shows the response in a web browser to a request for an unknown transport.</p><p><img src="/images/2004/06/figure6.png" alt="Unknown transport result in a web browser"></p><p>Figure 6. Unknown transport result in a web browser</p><h3>SELECT ATTRIBUTE</h3><p>At this stage it's time to select the attribute. Although not absolutely necessary, we're translating the attribute name to upper case before using a dynamic assign to point to the right place in the transportinfo structure.</p><h3>ATTRIBUTE NOT FOUND</h3><p>Of course, if an invalid attribute name was specified in the URL, the assign is going to fail, so we respond accordingly, in a similar manner to how we responded in the case of a request or task not being found. We send back status code 404, with a short explanation of what happened.</p><h3>STORE ATTRIBUTE</h3><p>If the attribute was valid, and the assign was successful, then we can retrieve the attribute value from the structure.</p><h3>SET CONTENT TYPE</h3><p>We're on the home straight now; all that's needed is to build the response. Here, because the data we're sending back is straightforward text, we set the content type of the response appropriately. The set_header_field() method of the response object is the antithesis of the get_header_field() method of the request object, in that it's used to set a header field in the ‘outgoing HTTP response.</p><h3>PUT DATA IN RESPONSE BODY</h3><p>In the same way that we used the set_cdata() method to put some HTML in the 404 response, we now use it to place the attribute value in the HTTP body.</p><h2>Where to next</h2><p>The ICF provides all you need to develop your own handlers for your own web applications and services. The simple example here merely scratched the surface; the best thing for you to do next is take this and expand on it, discovering the wealth of features available to the ABAP programmer of the 21st century.</p><p>For a start, how about dealing with the fact that we really want to avoid people interacting with the transport info URLs using anything other than GET. It's a fairly straightforward matter to add a bit of code into the &quot;INTERPRET REQUEST” section as shown in Figure 7.</p><pre class="language-abap"><code class="language-abap"><span class="token comment">* [INTERPRET REQUEST)</span><br><span class="token comment">* Look at what is being requested</span><br><br>path_info <span class="token operator">=</span> server<span class="token token-operator punctuation">-></span>request<span class="token token-operator punctuation">-></span>get_header_field<span class="token punctuation">(</span> <span class="token keyword">name</span> <span class="token operator">=</span> path_info' <span class="token punctuation">)</span><span class="token punctuation">.</span><br><br><span class="token comment">* (extended code - start)</span><br>verb <span class="token operator">=</span> server<span class="token token-operator punctuation">-></span>request<span class="token token-operator punctuation">-></span>get_header_field<span class="token punctuation">(</span> <span class="token keyword">name</span> <span class="token operator">=</span> <span class="token string">'~request_method'</span> <span class="token punctuation">)</span><span class="token punctuation">.</span><br><br><span class="token comment">* Abort if not GET</span><br><span class="token keyword">IF</span> verb <span class="token keyword">NE</span> <span class="token string">'GET'</span><span class="token punctuation">.</span><br>    <span class="token keyword">CALL</span> <span class="token keyword">METHOD</span> server<span class="token token-operator punctuation">-></span>response<span class="token token-operator punctuation">-></span>set_header_field<span class="token punctuation">(</span><br>    <span class="token keyword">name</span> <span class="token operator">=</span> <span class="token string">'Allow'</span><br>    <span class="token keyword">value</span> <span class="token operator">=</span> <span class="token string">'GET'</span> <span class="token punctuation">)</span><span class="token punctuation">.</span><br>    <span class="token keyword">CALL</span> <span class="token keyword">METHOD</span> server<span class="token token-operator punctuation">-></span>response<span class="token token-operator punctuation">-></span>set_status <span class="token punctuation">(</span><br>    <span class="token keyword">code</span> <span class="token operator">=</span> <span class="token string">'405'</span><br>    reason <span class="token operator">=</span> 'Method <span class="token keyword">not</span> allowed’ <span class="token punctuation">)</span><span class="token punctuation">.</span><br>    <span class="token keyword">EXIT</span><span class="token punctuation">.</span><br><span class="token keyword">ENDIF</span><span class="token punctuation">.</span><br><br><span class="token comment">* (extended code - end)</span><br><br><span class="token keyword">SHIFT</span> path_info <span class="token keyword">LEFT</span> <span class="token keyword">BY</span> <span class="token number">1</span> PLACE<span class="token punctuation">.</span><br><span class="token keyword">SPLIT</span> path_info <span class="token keyword">AT</span> <span class="token string">'/'</span> <span class="token keyword">INTO</span> w_trkorr w_attr<span class="token punctuation">.</span></code></pre><p><em>Figure 7. Extending the INTERPRET REQUEST section for 'GET only'</em></p><p>Here we use the get_header_field() method to retrieve the actual HTTP verb used. It's stored, like the path info, as a pseudo HTTP header. (The new variable 'verb' is defined in the DATA DEFINITION section as TYPE string). We only want to allow GET, and so reject, all others by sending a status code of 405 in the response, indicating that the method used was not allowed. The HTTP 1.1 specification states that when you return a status of 405 you must also return a header field in the response, to list the methods that are valid and acceptable for the resource (URL) in question. This is achieved using the set_header_field() method as shown, before setting the status and reason with set_status(). Figure 8 shows a typical response, with header lines, to an attempt to POST some data to a transport info URL. (In this case, we're supplying the basic authentication information via the -C parameter.)</p><pre class="language-shell"><code class="language-shell"><span class="token punctuation">[</span>dj@hadrian dj<span class="token punctuation">]</span>$ <span class="token builtin class-name">echo</span> <span class="token string">"SOAP sucks"</span> <span class="token punctuation">\</span><br><span class="token operator">|</span> POST <span class="token parameter variable">-Se</span> <span class="token parameter variable">-C</span> developer:password http://shrdlu.local.net:8000/qmacro/transport/Y6BK039552/trstatus<br>POST http://shrdlu.local.net:8000/qmacro/transport/Y6BK039552/trstatus --<span class="token operator">></span><br><span class="token number">405</span> Method not allowed<br>Server: SAP Web Application Server <span class="token punctuation">(</span><span class="token number">1.0</span><span class="token punctuation">;</span> <span class="token number">640</span><span class="token punctuation">)</span><br>Allow: GET<br>Content-Length: <span class="token number">114</span><br>Content-Type: text/html<span class="token punctuation">;</span> <span class="token assign-left variable">charset</span><span class="token operator">=</span>iso-8859-1<br>Client-Date: Fri, <span class="token number">18</span> Jun <span class="token number">2004</span> <span class="token number">10</span>:44:18 GMT<br>Client-Response-Num: <span class="token number">1</span><br>Title: Method not allowed<br><br><span class="token operator">&lt;</span>HTML<span class="token operator">></span><br><span class="token operator">&lt;</span>HEAD<span class="token operator">></span><span class="token operator">&lt;</span>TITLE<span class="token operator">></span>An Error Occurred<span class="token operator">&lt;</span>/TITLE<span class="token operator">></span><span class="token operator">&lt;</span>/HEAD<span class="token operator">></span><br><span class="token operator">&lt;</span>BODY<span class="token operator">></span><br><span class="token operator">&lt;</span>H<span class="token operator"><span class="token file-descriptor important">1</span>></span>An Error Occurred<span class="token operator">&lt;</span>/H<span class="token operator"><span class="token file-descriptor important">1</span>></span><br><span class="token number">405</span> Method not allowed<br><span class="token operator">&lt;</span>/BODY<span class="token operator">></span><br><span class="token operator">&lt;</span>/HTML<span class="token operator">></span><br><span class="token punctuation">[</span>dj@hadrian dj<span class="token punctuation">]</span>$</code></pre><p><em>Figure 8. Response to an invalid POST request.</em></p><h2>A Note on REST</h2><p>The title of this article mentioned REST. What is REST? It stands for &quot;REpresentational State Transfer&quot; and is an architectural style, not a protocol per se. The term was coined by Roy Fielding (one of the authors of the HTTP 1.1 specification) in his Ph.D. dissertation looking at the model of web architecture and defining a framework for understanding that architecture (see the dissertation abstract for more details).</p><p>REST's premise is that HTTP has everything we need to implement web services. The ideas and example in this article are driven by the REST philosophy.</p><p>Yau can read more on REST by following links from the Portland Pattern Repository's RestArchitecturalStyle wiki page.</p><h2>Final Thoughts</h2><p>Whether or not you're a fan of SOAP, I hope this has provided food for thought, and showed that there are plenty of facilities at your disposal in SAP for building Real Web Services.</p><hr><p>First published on the SAP Developer Network.</p></main><aside class="post__aside"><div class="post__tags"><a href="/tags/rest/">#rest</a> <a href="/tags/sapcommunity/">#sapcommunity</a> <a href="/tags/abap/">#abap</a> <a href="/tags/icf/">#icf</a></div><style>.utterances {
  margin-left: inherit !important;
}</style><script src="https://utteranc.es/client.js" repo="qmacro/qmacro.github.io" issue-term="title" crossorigin="anonymous" async></script><nav class="post__pagination"><a href="/blog/posts/2004/06/24/forget-soap-build-real-web-services-with-the-icf/"><span>←</span> <span>Forget SOAP - build real web services with the ICF</span> </a><a href="/blog/posts/2004/05/31/nw4-oss1-and-logon-group-selection-for-oss/"><span>NW4, OSS1 and logon group selection for OSS</span> <span>→</span></a></nav></aside></article></main><footer class="footer"><div class="footer__content"><ul class="hero__social-links"><li><a rel="me" href="https://github.com/qmacro" target="_blank" rel="noopener noreferrer">GitHub</a></li><li><a rel="me" href="https://www.youtube.com/djadams-qmacro" target="_blank" rel="noopener noreferrer">YouTube</a></li><li><a rel="me" href="https://www.linkedin.com/in/djadams/" target="_blank" rel="noopener noreferrer">LinkedIn</a></li><li><a rel="me" href="/tweets/">Tweet Archive</a></li><li><a rel="me" href="https://hachyderm.io/@qmacro" target="_blank" rel="noopener noreferrer">Mastodon</a></li><li><a rel="me" href="https://bsky.app/profile/qmacro.org" target="_blank" rel="noopener noreferrer">Bluesky</a></li><li><a href="/feed.xml" target="_blank" rel="noopener noreferrer">RSS</a></li></ul></div></footer></div><script src="/assets/main.31d6cfe0d16ae931b73c.js"></script></body></html>