<!doctype html><html lang="en"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1"><link rel="canonical" href="https://qmacro.org/blog/posts/2004/10/12/the-meaning-of-lifetime_rc/"><link rel="alternate" type="application/atom+xml" title="DJ's Weblog - Feed" href="https://qmacro.org/feed.xml"><link href="/assets/main.fe6b9c1e7ba4ff2bb7b5.css" rel="stylesheet"><link rel="preconnect" href="https://fonts.gstatic.com"><link href="https://fonts.googleapis.com/css2?family=IBM+Plex+Sans&display=swap" rel="stylesheet"><title>The meaning of LIFETIME_RC | DJ Adams</title><link rel="icon" type="‚Äúimage/x-icon‚Äù" href="/images/favicon.ico"><meta property="og:title" content="The meaning of LIFETIME_RC"><meta property="og:site_name" content="DJ Adams"><meta property="og:type" content="website"><meta property="og:url" content="https://qmacro.org/blog/posts/2004/10/12/the-meaning-of-lifetime_rc/"><meta name="description" content="The meaning of LIFETIME_RC 12 Oct 2004 | 2 min read Last week, during some preparation for my talk at TechEd on Thursday this week, I‚Äôd been..."><meta property="og:description" content="The meaning of LIFETIME_RC 12 Oct 2004 | 2 min read Last week, during some preparation for my talk at TechEd on Thursday this week, I‚Äôd been..."><meta name="description" content="The meaning of LIFETIME_RC 12 Oct 2004 | 2 min read Last week, during some preparation for my talk at TechEd on Thursday this week, I‚Äôd been..."><meta property="og:image" content="https://qmacro.org/images/site-image.png"><script src="https://cdn.jsdelivr.net/npm/mermaid/dist/mermaid.min.js"></script><script>mermaid.initialize({startOnLoad:true});</script><script async src="https://www.googletagmanager.com/gtag/js?id=G-4WQKBG0L4Y"></script><script>window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());

      gtag('config', 'G-4WQKBG0L4Y');</script></head><body><div class="layout-wrapper"><header class="header"><div class="header__content"><h1 class="site-title"><a href="/">DJ Adams</a></h1><nav class="nav"><ul class="nav__list"><li class="nav-item"><a href="/about">About Me</a></li><li class="nav-item"><a href="/blog">Blog</a></li><li class="nav-item"><a href="/feed.xml">Feed</a></li></ul></nav></div></header><main class="main"><article class="post"><header class="post__header"><h1>The meaning of LIFETIME_RC</h1><div class="post__details"><time datetime="2004-10-12">12 Oct 2004 </time><span>| </span><span>2 min read</span></div></header><main class="post__content"><p>Last week, during some preparation for my talk at TechEd on Thursday this week, I‚Äôd been wondering about something in the ICF that hadn‚Äôt seemed quite right. Interface <code>IF_HTTP_EXTENSION</code>, which is what every ICF handler must implement (in the form of a single method <code>HANDLE_REQUEST</code>) has a couple of attributes, <code>FLOW_RC</code> and <code>LIFETIME_RC</code>. <code>FLOW_RC</code> is for controlling the flow of handler dispatching for a request. <code>LIFETIME_RC</code> is for controlling the lifetime of handlers for a sequence of requests. To quote the <a href="https://help.sap.com/docs/SAP_NETWEAVER_AS_ABAP_751_IP/753088fc00704d0a80e7fbd6803c8adb/48d60603553b3e49e10000000a421937.html?locale=en-US&amp;version=7.51.6">documentation at help.sap.com</a> on the latter:</p><blockquote><p>HTTP request handlers can control the lifetime of their instances if they are operating in stateful mode ‚Ä¶ If the attribute <code>IF_HTTP_EXTENSION~LIFETIME_RC</code> is set to one of the following values, the HTTP request handler can specify whether the handler should be reinitiated for every request in a session, or whether the handler should be retained and reused for subsequent HTTP requests.</p></blockquote><p>The default action is for the handler instance created to handle the request to be kept, so that instance-level data is retained (think of an incrementing counter value that keeps going up every new request). This is the equivalent of setting <code>LIFETIME_RC</code> to the value of the constant <code>CO_LIFETIME_KEEP</code>. But if <code>LIFETIME_RC</code> is set to the value of constant <code>CO_LIFETIME_DESTROY</code>:</p><blockquote><p>The current instance of the HTTP request handler is terminated after the request is processed. If stateful mode is active, a new instance of the HTTP request handler is created. This means that local data belonging to the instance is lost.</p></blockquote><p>(This of course only makes sense in the context of stateful sessions, which you can create using the <code>SET_SESSION_STATEFUL</code> method (of <code>IF_HTTP_SERVER</code>) ‚Äì one effect of which causes a context id cookie to be constructed and set in the next HTTP response.)</p><p>Ok, so with the phrasing of the help text (such as ‚Äú‚Ä¶can control the lifetime‚Ä¶‚Äú) and the implication of the ‚ÄúDESTROY‚Äù part of the constant name, I did a little experiment to try and control the lifetime, by setting the <code>LIFETIME_RC</code> attribute so that the handler instance would be destroyed after it exited. Did it work as expected?</p><p>No.</p><p>Hmm. What‚Äôs going on? Well, it seems that with <code>LIFETIME_RC</code>, it‚Äôs either all or nothing. If you set your session to be stateful and specify that the handler instance should be kept (or let it default to that anyway), then you can‚Äôt, later in the session, suddenly decide to have the session destroyed.</p><p>Looking under the hood, we see this is confirmed in the ICF layer‚Äôs code. The whole process of handling a request is triggered via PBO modules in <code>SAPMHTTP</code>, and via the <code>HTTP_DISPATCH_REQUEST</code> coordinator, we come to the <code>EXECUTE_REQUEST</code> (or <code>EXECUTE_REQUEST_FROM_MEMORY</code> which I‚Äôve seen in 6.40) method of the <code>CL_HTTP_SERVER</code> class.</p><p>When a request comes in, the appropriate handler is instantiated, and the <code>HANDLE_REQUEST</code> method called. Once this method returns, a decision based on <code>LIFETIME_RC</code> is made as to whether to save the instantiated handler object in an internal table, ready for a new request. Unless <code>LIFETIME_RC</code> is set to destroy, the object is saved, providing we‚Äôre dealing with a stateful session:</p><pre class="language-abap"><code class="language-abap"><span class="token keyword">if</span> server<span class="token token-operator punctuation">-></span>stateful <span class="token operator">=</span> <span class="token number">1</span> <span class="token keyword">and</span> extension<span class="token token-operator punctuation">-></span>lifetime_rc <span class="token operator">=</span> if_http_extension<span class="token token-operator punctuation">=></span>co_lifetime_keep <span class="token keyword">and</span> ext_inst_idx <span class="token operator">=</span> -<span class="token number">1</span><span class="token punctuation">.</span> <span class="token operator">*</span> <span class="token keyword">add</span> <span class="token keyword">extension</span> <span class="token keyword">to</span> <span class="token keyword">list</span> <span class="token keyword">of</span> instantiated extensions <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span></code></pre><p>There‚Äôs no facility for removing existing table entries though. And this is the key to understanding why manipulating the <code>LIFETIME_RC</code> attribute won‚Äôt always do ‚Ä¶ what you think it should do.</p><p>I bet you‚Äôre glad you know that now ‚Ä¶ share and enjoy üôÇ</p><p><a href="https://blogs.sap.com/2004/10/12/the-meaning-of-lifetimerc/">Originally published on SAP Community</a></p></main><aside class="post__aside"><div class="post__tags"><a href="/tags/sapcommunity/">#sapcommunity</a></div><style>.utterances {
  margin-left: inherit !important;
}</style><script src="https://utteranc.es/client.js" repo="qmacro/qmacro.github.io" issue-term="title" crossorigin="anonymous" async></script><nav class="post__pagination"><a href="/blog/posts/2004/10/13/photos-from-sap-teched-munich/"><span>‚Üê</span> <span>Photos from SAP TechEd Munich</span> </a><a href="/blog/posts/2004/10/12/sap-teched-first-day-notes-from-munich/"><span>SAP TechEd first day - notes from Munich</span> <span>‚Üí</span></a></nav></aside></article></main><footer class="footer"><div class="footer__content"><ul class="hero__social-links"><li><a rel="me" href="https://github.com/qmacro" target="_blank" rel="noopener noreferrer">GitHub</a></li><li><a rel="me" href="https://www.youtube.com/djadams-qmacro" target="_blank" rel="noopener noreferrer">YouTube</a></li><li><a rel="me" href="https://www.linkedin.com/in/djadams/" target="_blank" rel="noopener noreferrer">LinkedIn</a></li><li><a rel="me" href="https://hachyderm.io/@qmacro" target="_blank" rel="noopener noreferrer">Mastodon</a></li><li><a href="/feed.xml" target="_blank" rel="noopener noreferrer">RSS</a></li></ul></div></footer></div><script src="/assets/main.31d6cfe0d16ae931b73c.js"></script></body></html>