<!doctype html>
<html lang="en">
	<head>
		<meta charset="utf-8">
		<meta name="viewport" content="width=device-width, initial-scale=1.0">
		<title>A simple exploration of status transition flows in CAP</title>
		<meta name="description" content="In this post I explore the new Status-Transition Flows in CAP with a simple example.">
		<link rel="alternate" href="/feed/feed.xml" type="application/atom+xml" title="DJ Adams">
		<link rel="icon" type="image/x-icon" href="/images/favicon.ico">

      <meta property="og:title" content="A simple exploration of status transition flows in CAP">
        <meta property="og:site_name" content="DJ Adams">
          <meta property="og:image" content="/images/site-image.png">
        <meta property="og:description" content="In this post I explore the new Status-Transition Flows in CAP with a simple example.">
        <meta property="og:url" content="https://qmacro.org/blog/posts/2025/12/08/a-simple-exploration-of-status-transition-flows-in-cap/">
		
		
		
		<style>/* This is an arbitrary CSS string added to the bundle */
/* Defaults */
:root {
	--font-family: -apple-system, system-ui, sans-serif;
	--font-family-monospace: Consolas, Menlo, Monaco, Andale Mono WT, Andale Mono, Lucida Console, Lucida Sans Typewriter, DejaVu Sans Mono, Bitstream Vera Sans Mono, Liberation Mono, Nimbus Mono L, Courier New, Courier, monospace;
}

/* Theme colors */
:root {
	--color-gray-20: #e0e0e0;
	--color-gray-50: #C0C0C0;
	--color-gray-90: #333;

	--background-color: #fff;

	--text-color: var(--color-gray-90);
	--text-color-link: #2884d2;
	--text-color-link-active: #15b0ed;
	--text-color-link-visited: #9f4199;

	--syntax-tab-size: 2;
}

@media (prefers-color-scheme: dark) {
	:root {
		--color-gray-20: #e0e0e0;
		--color-gray-50: #C0C0C0;
		--color-gray-90: #dad8d8;

		/* --text-color is assigned to --color-gray-_ above */
		--text-color-link: #1493fb;
		--text-color-link-active: #6969f7;
		--text-color-link-visited: #a6a6f8;

		--background-color: #15202b;
	}
}


/* Global stylesheet */
* {
	box-sizing: border-box;
}

@view-transition {
	navigation: auto;
}

html,
body {
	padding: 0;
	margin: 0 auto;
	font-family: var(--font-family);
	color: var(--text-color);
	background-color: var(--background-color);
}
html {
	overflow-y: scroll;
}
body {
	max-width: 40em;
}

/* https://www.a11yproject.com/posts/how-to-hide-content/ */
.visually-hidden:not(:focus):not(:active) {
	clip: rect(0 0 0 0);
	clip-path: inset(50%);
	height: 1px;
	overflow: hidden;
	position: absolute;
	white-space: nowrap;
	width: 1px;
}

/* Fluid images via https://www.zachleat.com/web/fluid-images/ */
img{
  max-width: 100%;
}
img[width][height] {
  height: auto;
}
img[src$=".svg"] {
  width: 100%;
  height: auto;
  max-width: none;
}
video,
iframe {
	width: 100%;
	height: auto;
}
iframe {
	aspect-ratio: 16/9;
}

p:last-child {
	margin-bottom: 0;
}
p {
	line-height: 1.5;
}

li {
	line-height: 1.5;
}

a[href] {
	color: var(--text-color-link);
}
a[href]:visited {
	color: var(--text-color-link-visited);
}
a[href]:hover,
a[href]:active {
	color: var(--text-color-link-active);
}

main,
footer {
	padding: 1rem;
}
/* main :first-child { */
/* 	margin-top: 0; */
/* } */

header {
	border-bottom: 1px dashed var(--color-gray-20);
}

#skip-link {
	text-decoration: none;
	background: var(--background-color);
	color: var(--text-color);
	padding: 0.5rem 1rem;
	border: 1px solid var(--color-gray-90);
	border-radius: 2px;
}

/* Prevent visually-hidden skip link fom pushing content around when focused */
#skip-link.visually-hidden:focus {
	position: absolute;
	top: 1rem;
	left: 1rem;
	/* Ensure it is positioned on top of everything else when it is shown */
	z-index: 999;
}

.links-nextprev {
	display: flex;
	justify-content: space-between;
	gap: .5em 1em;
	list-style: "";
	border-top: 1px dashed var(--color-gray-20);
	padding: 1em 0;
}
.links-nextprev > * {
	flex-grow: 1;
}
.links-nextprev-next {
	text-align: right;
}

table {
	margin: 1em 0;
}
table td,
table th {
	padding-right: 1em;
}

pre,
code {
	font-family: var(--font-family-monospace);
	color: seagreen;
}

pre,code[class*="language-"] {
	line-height: 1.2em !important;
	font-size: 0.93em !important;
}

pre:not([class*="language-"]) {
	margin: .5em 0;
	line-height: 1.375; /* 22px /16 */
	-moz-tab-size: var(--syntax-tab-size);
	-o-tab-size: var(--syntax-tab-size);
	tab-size: var(--syntax-tab-size);
	-webkit-hyphens: none;
	-ms-hyphens: none;
	hyphens: none;
	direction: ltr;
	text-align: left;
	white-space: pre;
	word-spacing: normal;
	word-break: normal;
	overflow-x: auto;
}
code {
	word-break: break-word;
}

/* Header */
header {
	display: flex;
	gap: 1em;
	flex-wrap: wrap;
	justify-content: space-between;
	align-items: center;
	padding: 1em;
}
.home-link {
	flex-grow: 1;
	font-size: 1em; /* 16px /16 */
	font-weight: 700;
}
.home-link:link:not(:hover) {
	text-decoration: none;
}

/* Nav */
.nav {
	display: flex;
	gap: .5em 1em;
	padding: 0;
	margin: 0;
	list-style: none;
}
.nav-item {
	display: inline-block;
}
.nav-item a[href]:not(:hover) {
	text-decoration: none;
}
.nav a[href][aria-current="page"] {
	text-decoration: underline;
}

/* Posts list */
.postlist {
	counter-reset: start-from var(--postlist-index);
	list-style: none;
	padding: 0;
}
.postlist-item {
	display: flex;
	flex-wrap: wrap;
	align-items: baseline;
	counter-increment: start-from -1;
	margin-bottom: 1em;
}
.postlist-item:before {
	display: inline-block;
	pointer-events: none;
	line-height: 100%;
	text-align: right;
	margin-left: -1.5rem;
}
.postlist-date,
.postlist-item:before {
	font-size: 0.8125em; /* 13px /16 */
	color: var(--color-gray-90);
}
.postlist-date {
	word-spacing: -0.5px;
}
.postlist-link {
	font-size: 1.1875em; /* 19px /16 */
	font-weight: 700;
	flex-basis: calc(100% - 1.5rem);
	text-underline-position: from-font;
	text-underline-offset: 0;
	text-decoration-thickness: 1px;
}
.postlist-item-active .postlist-link {
	font-weight: bold;
}

/* Tags */
.post-tag {
	display: inline-flex;
	align-items: center;
	justify-content: center;
	font-style: italic;
}

/* may want to make the description text smaller at some stage */
.post-description-list {
	font-size: 1.0em;
}

.post-description-main {
	font-style: italic;
}

.postlist-item > .post-tag {
	align-self: center;
}

/* Tags list */
.post-metadata {
	display: inline-flex;
	flex-wrap: wrap;
	gap: .5em;
	list-style: none;
	padding: 0;
	margin: 0;
}
.post-metadata time {
	margin-right: 1em;
}

blockquote {
	margin-top: 0px;
	margin-left: 0px;
	margin-bottom: 15px;
	padding-left: 15px;
	border-left: 5px solid lightgray;
}
/**
 * prism.js default theme for JavaScript, CSS and HTML
 * Based on dabblet (http://dabblet.com)
 * @author Lea Verou
 */

code[class*="language-"],
pre[class*="language-"] {
	color: black;
	background: none;
	text-shadow: 0 1px white;
	font-family: Consolas, Monaco, 'Andale Mono', 'Ubuntu Mono', monospace;
	font-size: 1em;
	text-align: left;
	white-space: pre;
	word-spacing: normal;
	word-break: normal;
	word-wrap: normal;
	line-height: 1.5;

	-moz-tab-size: 4;
	-o-tab-size: 4;
	tab-size: 4;

	-webkit-hyphens: none;
	-moz-hyphens: none;
	-ms-hyphens: none;
	hyphens: none;
}

pre[class*="language-"]::-moz-selection, pre[class*="language-"] ::-moz-selection,
code[class*="language-"]::-moz-selection, code[class*="language-"] ::-moz-selection {
	text-shadow: none;
	background: #b3d4fc;
}

pre[class*="language-"]::selection, pre[class*="language-"] ::selection,
code[class*="language-"]::selection, code[class*="language-"] ::selection {
	text-shadow: none;
	background: #b3d4fc;
}

@media print {
	code[class*="language-"],
	pre[class*="language-"] {
		text-shadow: none;
	}
}

/* Code blocks */
pre[class*="language-"] {
	padding: 1em;
	margin: .5em 0;
	overflow: auto;
}

:not(pre) > code[class*="language-"],
pre[class*="language-"] {
	background: #f5f2f0;
}

/* Inline code */
:not(pre) > code[class*="language-"] {
	padding: .1em;
	border-radius: .3em;
	white-space: normal;
}

.token.comment,
.token.prolog,
.token.doctype,
.token.cdata {
	color: slategray;
}

.token.punctuation {
	color: #999;
}

.token.namespace {
	opacity: .7;
}

.token.property,
.token.tag,
.token.boolean,
.token.number,
.token.constant,
.token.symbol,
.token.deleted {
	color: #905;
}

.token.selector,
.token.attr-name,
.token.string,
.token.char,
.token.builtin,
.token.inserted {
	color: #690;
}

.token.operator,
.token.entity,
.token.url,
.language-css .token.string,
.style .token.string {
	color: #9a6e3a;
	/* This background color was intended by the author of this theme. */
	background: hsla(0, 0%, 100%, .5);
}

.token.atrule,
.token.attr-value,
.token.keyword {
	color: #07a;
}

.token.function,
.token.class-name {
	color: #DD4A68;
}

.token.regex,
.token.important,
.token.variable {
	color: #e90;
}

.token.important,
.token.bold {
	font-weight: bold;
}
.token.italic {
	font-style: italic;
}

.token.entity {
	cursor: help;
}
/*
 * New diff- syntax
 */

pre[class*="language-diff-"] {
	--eleventy-code-padding: 1.25em;
	padding-left: var(--eleventy-code-padding);
	padding-right: var(--eleventy-code-padding);
}
.token.deleted {
	background-color: hsl(0, 51%, 37%);
	color: inherit;
}
.token.inserted {
	background-color: hsl(126, 31%, 39%);
	color: inherit;
}

/* Make the + and - characters unselectable for copy/paste */
.token.prefix.unchanged,
.token.prefix.inserted,
.token.prefix.deleted {
	-webkit-user-select: none;
	user-select: none;
	display: inline-flex;
	align-items: center;
	justify-content: center;
	padding-top: 2px;
	padding-bottom: 2px;
}
.token.prefix.inserted,
.token.prefix.deleted {
	width: var(--eleventy-code-padding);
	background-color: rgba(0,0,0,.2);
}

/* Optional: full-width background color */
.token.inserted:not(.prefix),
.token.deleted:not(.prefix) {
	display: block;
	margin-left: calc(-1 * var(--eleventy-code-padding));
	margin-right: calc(-1 * var(--eleventy-code-padding));
	text-decoration: none; /* override del, ins, mark defaults */
	color: inherit; /* override del, ins, mark defaults */
}
.utterances {
  margin-left: inherit !important;
}</style>
		

    <!-- Global site tag (gtag.js) - Google Analytics -->
    <script async="" src="https://www.googletagmanager.com/gtag/js?id=G-4WQKBG0L4Y"></script>
    

	</head>
	<body>
		<a href="#main" id="skip-link" class="visually-hidden">Skip to main content</a>

		<header>
			<a href="/" class="home-link">DJ Adams</a>
			<nav>
				<h2 class="visually-hidden" id="top-level-navigation-menu">Top level navigation menu</h2>
				<ul class="nav">
					<li class="nav-item"><a href="/">Home</a></li>
					<li class="nav-item"><a href="/about/">About</a></li>
					<li class="nav-item"><a href="/blog/">Blog</a></li>
					<li class="nav-item"><a href="/feed/feed.xml">Feed</a></li>
				</ul>
			</nav>
		</header>

		<main id="main">
			<heading-anchors>
				


<h1 id="a-simple-exploration-of-status-transition-flows-in-cap">A simple exploration of status transition flows in CAP</h1>

<ul class="post-metadata">
	<li><time datetime="2025-12-08">08 December 2025</time></li>
	<li><a href="/tags/cap/" class="post-tag">cap</a>, </li>
	<li><a href="/tags/cds/" class="post-tag">cds</a>, </li>
	<li><a href="/tags/status/" class="post-tag">status</a>, </li>
	<li><a href="/tags/annotations/" class="post-tag">annotations</a></li>
</ul>

<p class="post-description-main">In this post I explore the new Status-Transition Flows in CAP with a simple example.</p>

<p>The <a href="https://cap.cloud.sap/docs/releases/nov25">November 2025 release</a> of CAP heralded <a href="https://cap.cloud.sap/docs/releases/nov25#status-transition-flows">a beta version of Status-Transition Flows</a>, moving us up yet another gear in the journey towards declarative nirvana.</p>
<h2 id="background">Background</h2>
<p>I wanted to try out this new significant feature, one which embodies and celebrates one of the key reasons to use CAP - <a href="/blog/posts/2024/11/07/five-reasons-to-use-cap/#1-the-code-is-in-the-framework-not-outside-of-it">the code is in the framework, not outside of it</a>. In the November release notes there's a brief glimpse of what this declarative approach looks like:</p>
<pre class="language-cds" tabindex="0"><code class="language-cds">annotate Travels with <span class="token annotation important">@flow.status:</span> Status <span class="token keyword">actions</span> {
  rejectTravel    @<span class="token from keyword">from</span>: #Open  <span class="token annotation important">@to:</span> #Canceled;
  acceptTravel    @<span class="token from keyword">from</span>: #Open  <span class="token annotation important">@to:</span> #Accepted;
  deductDiscount  @<span class="token from keyword">from</span>: #Open;
};</code></pre>
<p>Of course, this is only part of how things are set up; following the link at the end of this section of the release notes leads us to <a href="https://cap.cloud.sap/docs/guides/providing-services#status-transition-flows">the relevant Capire section within the Providing Services topic</a>, where we can see some of the rest of the CDS model (domain model and service definition specifically) that goes to make up the sample.</p>
<p>I wanted to write my own example, complete but also as simple as possible, so I could then <a href="/blog/posts/2017/02/19/the-beauty-of-recursion-and-list-machinery/#initial-recognition">stare at it</a> for a while to let things sink in. Here's what I came up with.</p>
<p><img src="/images/2025/12/double-toggle-switch.jpg" alt="double toggle switch">
(<a href="https://commons.wikimedia.org/wiki/File:A_double_toggle_light_switch.jpg">Image courtesy of Wikimedia Commons</a>)</p>
<h2 id="modelling-an-on-off-switch">Modelling an on/off switch</h2>
<p>After initialising a new CAP project (with <code>cds init</code>), I just created a <code>services.cds</code> file<a href="#footnotes"><sup>1</sup></a> with the following content:</p>
<pre class="language-cds" tabindex="0"><code class="language-cds"><span class="token keyword">context</span> qmacro {

  <span class="token cqlkeywords keyword">type</span> Status : <span class="token type builtin">String </span><span class="token keyword">enum</span> {
    Up;
    Down;
  }

  <span class="token keyword">entity</span> Switches {
    <span class="token cqlkeywords keyword">key</span> ID     : <span class="token type builtin">Integer</span>;
        status : Status <span class="token cdl-keyword keyword">default</span> #Down;
  }
}

<span class="token keyword">service</span> SwitchService {

  <span class="token keyword">entity</span> Switches <span class="token cqlkeywords keyword">as</span> <span class="token cdl-keyword keyword">projection</span> <span class="token cqlkeywords keyword">on</span> qmacro.Switches

    <span class="token keyword">actions</span> {
      <span class="token keyword">action</span> flipUp();
      <span class="token keyword">action</span> flipDown();
    };


  annotate Switches with <span class="token annotation important">@flow.status:</span> status <span class="token keyword">actions</span> {
    flipUp               @<span class="token from keyword">from</span>       : #Down  <span class="token annotation important">@to:</span> #Up;
    flipDown             @<span class="token from keyword">from</span>       : #Up    <span class="token annotation important">@to:</span> #Down;
  };
}</code></pre>
<h2 id="understanding-the-definitions">Understanding the definitions</h2>
<p>Recently I've been looking more closely at CDS modelling in general and CDL in particular, partly in the context of creating the exercise content for the <a href="https://github.com/SAP-samples/cap-cds-hands-on/">Hands-on with CAP CDS</a> workshop which I gave <a href="/blog/posts/2025/09/10/upcoming-talks-in-autumn-2025/#ukisug-connect">at UKISUG Connect</a> at the start of this month. And I have come to value taking my time to understand the nuances of how models are expressed. Here are a few points of interest relating to the declarations here:</p>
<ul>
<li>I want to have everything in a single file to keep things as simple as possible</li>
<li>This includes my data model, my service definition and my annotations</li>
</ul>
<p>With regards to the data model:</p>
<ul>
<li>I'm using the <code>context</code> keyword to enclose my data model, which consists of a custom named type <code>Status</code> and the entity <code>Switches</code>, with a scope name prefix (<code>qmacro</code>)</li>
<li>The <code>status</code> element of <code>Switches</code> is defined with the custom <code>Status</code> type which has its possible values as a list of <a href="https://cap.cloud.sap/docs/cds/cdl#enums">enumeration values</a> (<code>Up</code> and <code>Down</code>); as this is the element that's going to be used as the status element, I've given it a default value (<code>Down</code>) as it requires one (no initial state can be provided on creation as the element should be readonly from the client perspective)</li>
</ul>
<p>With regards to the service definition:</p>
<ul>
<li>There's a pass-through projection (i.e. it defaults to an <a href="https://cap.cloud.sap/docs/cds/cdl#views-with-inferred-signatures">inferred signature</a>)</li>
<li>The projection is for the <code>Switches</code> entity, and there's also a couple of <a href="https://cap.cloud.sap/docs/cds/cdl#bound-actions">bound actions</a> declared as part of the entity definition that starts with <code>entity Switches ...</code> and finishes with the semicolon <code>;</code></li>
<li>As actions semantically signal that side-effects are likely, they'll need to be invoked with HTTP POST</li>
</ul>
<p>Finally there's the annotation:</p>
<ul>
<li>It's separate to the annotation target, and arguably easier to read that way; moreover, it would likely (or at least possibly) be in a separate file if it weren't so deliberately simple (see <a href="/blog/posts/2024/11/04/separating-concerns-and-focusing-on-the-important-stuff/">Separating concerns and focusing on the important stuff</a>)</li>
<li>It has been written in accordance with the description in the <a href="https://cap.cloud.sap/docs/guides/providing-services#modeling-flows">Modelling Flows</a> section of the <a href="https://cap.cloud.sap/docs/guides/providing-services">Providing Services</a> topic in Capire</li>
</ul>
<h3 id="digging-in-to-the-annotation">Digging in to the annotation</h3>
<p>The annotation is quite involved:</p>
<pre class="language-shell" tabindex="0"><code class="language-shell">annotate <span class="token operator">&lt;</span>target<span class="token operator">></span> with <span class="token operator">&lt;</span>annotation<span class="token operator">></span> <span class="token builtin class-name">:</span> <span class="token operator">&lt;</span>info<span class="token operator">></span> actions <span class="token punctuation">{</span> <span class="token punctuation">..</span>. <span class="token punctuation">}</span>
</code></pre>
<p>and indeed the construction used is rather unusual:</p>
<ul>
<li><code>annotate &lt;target&gt; actions { ... }</code> is <a href="https://github.com/search?q=org%3Acapire+OR+org%3ASAP-samples+%2Fannotate+.%2B+actions%2F+path%3A*.cds&amp;type=code">reasonably common</a></li>
<li>but <em>two</em> effective targets in a single annotation declaration context is <a href="https://github.com/search?q=org%3Acapire+OR+org%3ASAP-samples+%2Fannotate+.%2B+with+%40.%2B+actions%2F+path%3A*.cds&amp;type=code">extremely rare</a></li>
</ul>
<p>What we have here is a sequence of two annotations in one. The single annotation expression above could just as readily be expressed like this<a href="#footnotes"><sup>2</sup></a>:</p>
<pre class="language-cds" tabindex="0"><code class="language-cds">annotate Switches with <span class="token annotation important">@flow.status:</span> status;

annotate Switches <span class="token keyword">actions</span> {
  flipUp    @<span class="token from keyword">from</span>: #Down  <span class="token annotation important">@to:</span> #Up;
  flipDown  @<span class="token from keyword">from</span>: #Up    <span class="token annotation important">@to:</span> #Down;
};</code></pre>
<p>Separating these out like this makes it a bit easier for me to grok what's going on.</p>
<p>First, we're blessing the <code>Switches</code> entity with the Status-Transition Flows ability; at this level, we must specify the element to be used for the status. It's the <code>status</code> element that's important, and we do that here by targeting the entire entity with the annotation and then specifying the element as a secondary piece of information. We could have annotated the element directly, like this:</p>
<pre class="language-cds" tabindex="0"><code class="language-cds"><span class="token keyword">context</span> qmacro {

  <span class="token single-line-comment comment">// ...</span>

  <span class="token keyword">entity</span> Switches {
    <span class="token cqlkeywords keyword">key</span> ID     : <span class="token type builtin">Integer</span>;

        <span class="token annotation important">@flow.status</span>
        status : Status <span class="token cdl-keyword keyword">default</span> #Down;
  }
}

<span class="token keyword">service</span> SwitchService {

  <span class="token single-line-comment comment">// ...</span>

  annotate Switches <span class="token keyword">actions</span> {
    flipUp    @<span class="token from keyword">from</span>: #Down  <span class="token annotation important">@to:</span> #Up;
    flipDown  @<span class="token from keyword">from</span>: #Up    <span class="token annotation important">@to:</span> #Down;
  };

}</code></pre>
<p>but, we'd have needed to additionally, explicitly and manually specify the <code>@readonly</code> annotation <a href="https://cap.cloud.sap/docs/guides/providing-services#declare-flow-using-flow-status">as directed</a>:</p>
<pre class="language-cds" tabindex="0"><code class="language-cds"><span class="token keyword">entity</span> Switches {
  <span class="token cqlkeywords keyword">key</span> ID     : <span class="token type builtin">Integer</span>;

      <span class="token annotation important">@readonly</span>
      <span class="token annotation important">@flow.status</span>
      status : Status <span class="token cdl-keyword keyword">default</span> #Down;
}</code></pre>
<p>In the current state of how we make these declarations, specifying the flow status annotation at the entity level, and in the service layer, nearer to the related actions, makes more sense to me.</p>
<blockquote>
<p>In case you're wondering, the original entity level <code>@flow.status</code> annotation does indeed also cause a <code>@readonly</code> annotation to be added; here's the relevant section of the CSN that's generated:</p>
<pre class="language-yaml" tabindex="0"><code class="language-yaml"><span class="token key atrule">definitions</span><span class="token punctuation">:</span>
  <span class="token key atrule">SwitchService.Switches</span><span class="token punctuation">:</span>
    <span class="token key atrule">kind</span><span class="token punctuation">:</span> entity
    <span class="token key atrule">"@flow.status"</span><span class="token punctuation">:</span> <span class="token punctuation">{</span> <span class="token key atrule">"="</span><span class="token punctuation">:</span> status <span class="token punctuation">}</span>
    <span class="token key atrule">projection</span><span class="token punctuation">:</span> <span class="token punctuation">{</span> <span class="token key atrule">from</span><span class="token punctuation">:</span> <span class="token punctuation">{</span> <span class="token key atrule">ref</span><span class="token punctuation">:</span> <span class="token punctuation">[</span>qmacro.Switches<span class="token punctuation">]</span> <span class="token punctuation">}</span> <span class="token punctuation">}</span>
    <span class="token key atrule">elements</span><span class="token punctuation">:</span>
      <span class="token key atrule">ID</span><span class="token punctuation">:</span> <span class="token punctuation">{</span> <span class="token key atrule">key</span><span class="token punctuation">:</span> <span class="token boolean important">true</span><span class="token punctuation">,</span> <span class="token key atrule">type</span><span class="token punctuation">:</span> cds.Integer <span class="token punctuation">}</span>
      <span class="token key atrule">status</span><span class="token punctuation">:</span>
        <span class="token key atrule">type</span><span class="token punctuation">:</span> qmacro.Status
        <span class="token key atrule">default</span><span class="token punctuation">:</span> <span class="token punctuation">{</span> <span class="token key atrule">"#"</span><span class="token punctuation">:</span> Down<span class="token punctuation">,</span> <span class="token key atrule">val</span><span class="token punctuation">:</span> Down <span class="token punctuation">}</span>
        <span class="token key atrule">"@flow.status"</span><span class="token punctuation">:</span> <span class="token boolean important">true</span>
        <span class="token key atrule">"@readonly"</span><span class="token punctuation">:</span> <span class="token boolean important">true</span></code></pre>
</blockquote>
<p>And, what of the actions themselves?</p>
<h3 id="looking-at-the-implementation-for-the-actions">Looking at the implementation for the actions</h3>
<p>We are used to having the CAP server provide a complete out-of-the-box CRUD handler experience for our services, on an entity by entity basis. We are also used to having to write our own handlers for custom &quot;orthogonal&quot; offerings such as actions and functions, as, almost by definition, they could be anything and are unguessable.</p>
<p>And so here we are now with a couple of actions we've declared:</p>
<pre class="language-cds" tabindex="0"><code class="language-cds"><span class="token single-line-comment comment">// ...</span>

<span class="token keyword">service</span> SwitchService {

  <span class="token keyword">entity</span> Switches <span class="token cqlkeywords keyword">as</span> <span class="token cdl-keyword keyword">projection</span> <span class="token cqlkeywords keyword">on</span> qmacro.Switches

    <span class="token keyword">actions</span> {
      <span class="token keyword">action</span> flipUp();
      <span class="token keyword">action</span> flipDown();
    };

    <span class="token single-line-comment comment">// ...</span></code></pre>
<p>and annotated:</p>
<pre class="language-cds" tabindex="0"><code class="language-cds">  <span class="token single-line-comment comment">// ...</span>

  annotate Switches <span class="token keyword">actions</span> {
    flipUp    @<span class="token from keyword">from</span>: #Down  <span class="token annotation important">@to:</span> #Up;
    flipDown  @<span class="token from keyword">from</span>: #Up    <span class="token annotation important">@to:</span> #Down;
  };
}</code></pre>
<p>Here's what the implementation looks like, say in a corresponding <code>services.js</code> file:</p>
<pre class="language-javascript" tabindex="0"><code class="language-javascript"></code></pre>
<p>Yep, that's right. There is no implementation required, and no corresponding implementation file needed - that's sort of the whole point!</p>
<p>With the declarative Status-Transition Flows approach, we've declared everything we need with the annotations, describing what each action should do with respect to the status; what starting status requirements there are and what target statuses there can be. Here:</p>
<ul>
<li><code>flipUp</code>, which will transition the status to <code>Up</code>, can only be invoked if the status is currently <code>Down</code></li>
<li><code>flipDown</code>, which will transition the status to <code>Down</code>, can only be invoked if the status is currently <code>Up</code></li>
</ul>
<p>Of course, there are far more flexible and involved possibilities here, which are nicely described <a href="https://cap.cloud.sap/docs/guides/providing-services#status-transition-flows">in the appropriate section</a>.</p>
<h2 id="kicking-the-tyres">Kicking the tyres</h2>
<p>Now I have my model and service definition, and the appropriate annotations, what does it feel like, how does one interact with and experience it?</p>
<p>Simply from an HTTP level, I'll give it a go. One can imagine how this then translates to calls being made from a frontend somewhere too, with buttons and other widgets in the UI enabled or disabled (or even hidden) according to the current status.</p>
<p>I'll start the server with <code>cds watch</code>.</p>
<h3 id="creating-my-first-switch">Creating my first switch</h3>
<p>OK, are there any existing switch entities?</p>
<pre class="language-bash" tabindex="0"><code class="language-bash"><span class="token punctuation">;</span> <span class="token function">curl</span> <span class="token punctuation">\</span>
  <span class="token parameter variable">--silent</span> <span class="token punctuation">\</span>
  <span class="token parameter variable">--url</span> <span class="token string">'localhost:4004/odata/v4/switch/Switches'</span> <span class="token punctuation">\</span>
  <span class="token operator">|</span> jq
<span class="token punctuation">{</span>
  <span class="token string">"@odata.context"</span><span class="token builtin class-name">:</span> <span class="token string">"<span class="token variable">$metadata</span>#Switches"</span>,
  <span class="token string">"value"</span><span class="token builtin class-name">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
<span class="token punctuation">}</span></code></pre>
<p>No. So I'll create one:</p>
<pre class="language-bash" tabindex="0"><code class="language-bash"><span class="token punctuation">;</span> <span class="token function">curl</span> <span class="token punctuation">\</span>
  <span class="token parameter variable">--header</span> <span class="token string">'Content-Type: application/json'</span> <span class="token punctuation">\</span>
  <span class="token parameter variable">--data</span> <span class="token string">'{"ID":1}'</span> <span class="token punctuation">\</span>
  <span class="token parameter variable">--silent</span> <span class="token punctuation">\</span>
  <span class="token parameter variable">--url</span> <span class="token string">'localhost:4004/odata/v4/switch/Switches'</span> <span class="token punctuation">\</span>
  <span class="token operator">|</span> jq
<span class="token punctuation">{</span>
  <span class="token string">"@odata.context"</span><span class="token builtin class-name">:</span> <span class="token string">"<span class="token variable">$metadata</span>#Switches/<span class="token variable">$entity</span>"</span>,
  <span class="token string">"ID"</span><span class="token builtin class-name">:</span> <span class="token number">1</span>,
  <span class="token string">"status"</span><span class="token builtin class-name">:</span> <span class="token string">"Down"</span>
<span class="token punctuation">}</span></code></pre>
<p>It has the default status of <code>Down</code>, as expected.</p>
<h3 id="trying-to-flip-the-switch-the-wrong-way">Trying to flip the switch the wrong way</h3>
<p>The switch is down, so I want to see if I can invoke the <code>flipDown</code> action<a href="#footnotes"><sup>3</sup></a>:</p>
<pre class="language-bash" tabindex="0"><code class="language-bash"><span class="token punctuation">;</span> <span class="token function">curl</span> <span class="token punctuation">\</span>
  <span class="token parameter variable">--request</span> POST <span class="token punctuation">\</span>
  <span class="token parameter variable">--include</span> <span class="token punctuation">\</span>
  <span class="token parameter variable">--url</span> <span class="token string">'localhost:4004/odata/v4/switch/Switches/1/flipDown'</span>
HTTP/1.1 <span class="token number">409</span> Conflict
X-Powered-By: Express
OData-Version: <span class="token number">4.0</span>
Content-Type: application/json<span class="token punctuation">;</span> <span class="token assign-left variable">charset</span><span class="token operator">=</span>utf-8
Content-Length: <span class="token number">151</span>

<span class="token punctuation">{</span>
  <span class="token string">"error"</span><span class="token builtin class-name">:</span> <span class="token punctuation">{</span>
    <span class="token string">"message"</span><span class="token builtin class-name">:</span> <span class="token string">"Action <span class="token entity" title="\&quot;">\"</span>flipDown<span class="token entity" title="\&quot;">\"</span> requires <span class="token entity" title="\&quot;">\"</span>status<span class="token entity" title="\&quot;">\"</span> to be <span class="token entity" title="\&quot;">\"</span>[<span class="token entity" title="\&quot;">\"</span>Up<span class="token entity" title="\&quot;">\"</span>]<span class="token entity" title="\&quot;">\"</span>."</span>,
    <span class="token string">"code"</span><span class="token builtin class-name">:</span> <span class="token string">"INVALID_FLOW_TRANSITION_SINGLE"</span>,
    <span class="token string">"@Common.numericSeverity"</span><span class="token builtin class-name">:</span> <span class="token number">4</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span></code></pre>
<p>Nope! Plus, the HTTP status code 409 is <a href="https://developer.mozilla.org/en-US/docs/Web/HTTP/Reference/Status/409">nicely appropriate</a>.</p>
<h3 id="flipping-the-switch-the-right-way">Flipping the switch the right way</h3>
<p>So how about flipping the switch from down to up?</p>
<pre class="language-bash" tabindex="0"><code class="language-bash"><span class="token punctuation">;</span> <span class="token function">curl</span> <span class="token punctuation">\</span>
  <span class="token parameter variable">--request</span> POST <span class="token punctuation">\</span>
  <span class="token parameter variable">--include</span> <span class="token punctuation">\</span>
  <span class="token parameter variable">--url</span> <span class="token string">'localhost:4004/odata/v4/switch/Switches/1/flipUp'</span>
HTTP/1.1 <span class="token number">204</span> No Content
X-Powered-By: Express
OData-Version: <span class="token number">4.0</span></code></pre>
<p>That seemed to work, but I'll check anyway:</p>
<pre class="language-bash" tabindex="0"><code class="language-bash"><span class="token punctuation">;</span> <span class="token function">curl</span> <span class="token punctuation">\</span>
  <span class="token parameter variable">--silent</span> <span class="token punctuation">\</span>
  <span class="token parameter variable">--url</span> <span class="token string">'localhost:4004/odata/v4/switch/Switches/1'</span> <span class="token punctuation">\</span>
  <span class="token operator">|</span> jq
<span class="token punctuation">{</span>
  <span class="token string">"@odata.context"</span><span class="token builtin class-name">:</span> <span class="token string">"<span class="token variable">$metadata</span>#Switches/<span class="token variable">$entity</span>"</span>,
  <span class="token string">"ID"</span><span class="token builtin class-name">:</span> <span class="token number">1</span>,
  <span class="token string">"status"</span><span class="token builtin class-name">:</span> <span class="token string">"Up"</span>
<span class="token punctuation">}</span></code></pre>
<p>Excellent!</p>
<h2 id="wrapping-up">Wrapping up</h2>
<p>Of course, there's a lot more that this new Status-Transition Flows feature offers, but for now, I'm glad I took a first look with this simple example.</p>
<p>For further explorations and explanations, see Simon Engel's great session <a href="https://www.youtube.com/watch?v=1XolXCjN5IQ">Status Transition Flows in CAP</a> from Devtoberfest earlier this year, as well as the <a href="https://cap.cloud.sap/docs/guides/providing-services#status-transition-flows">coverage in Capire</a>.</p>
<p>And remember, this is a beta feature right now, so a great time to try it out for yourself.</p>
<h2 id="footnotes">Footnotes</h2>
<ol>
<li>
<p>The name of this file is significant, it's one of the two file items (the rest are directory items) in the &quot;CDS roots&quot;, as illustrated:</p>
<pre class="language-bash" tabindex="0"><code class="language-bash"><span class="token punctuation">;</span> cds <span class="token function">env</span> roots
<span class="token punctuation">[</span>
  <span class="token string">"db/"</span>,
  <span class="token string">"srv/"</span>,
  <span class="token string">"app/"</span>,
  <span class="token string">"schema"</span>,
  <span class="token string">"services"</span>
<span class="token punctuation">]</span></code></pre>
<p>This means that it's a default (&quot;well-known&quot;) location for CDS model definitions.</p>
</li>
<li>
<p>What's really going to blow your mind is that <code>annotate</code> is really <a href="https://cap.cloud.sap/docs/cds/cdl#the-annotate-directive">just a shortcut variant</a> of <code>extend</code>.</p>
</li>
<li>
<p>I use <code>--include</code> to have the response headers emitted, but have only included some of them in the output here, to keep things brief.</p>
</li>
</ol>



<script src="https://utteranc.es/client.js" repo="qmacro/qmacro.github.io" issue-term="title" crossorigin="anonymous" async=""></script>

<ul class="links-nextprev"><li class="links-nextprev-prev">← Previous<br> <a href="/blog/posts/2025/11/12/some-ramblings-on-simple-cds-modelling-with-cdl/">Some ramblings on simple CDS modelling with CDL</a></li><li class="links-nextprev-next">Next →<br><a href="/blog/posts/2025/12/09/a-new-hands-on-sap-dev-mini-series-on-the-core-expression-language-in-cds/">A new Hands-on SAP Dev mini-series on the core expression language in CDS</a></li>
</ul>

			</heading-anchors>
		</main>

		<!-- This page `/blog/posts/2025/12/08/a-simple-exploration-of-status-transition-flows-in-cap/` was built on 2026-01-16T13:04:25.782Z -->
		<script type="module" src="/dist/t-8sxMV3B9.js"></script>
	</body>
</html>
