<!doctype html><html lang="en"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1"><link rel="canonical" href="https://qmacro.org/blog/posts/2025/02/07/tasc-notes-part-7/"><link rel="alternate" type="application/atom+xml" title="DJ's Weblog - Feed" href="https://qmacro.org/feed.xml"><link href="/assets/main.7884d8f8e9dd86c3b137.css" rel="stylesheet"><link rel="preconnect" href="https://fonts.gstatic.com"><link href="https://fonts.googleapis.com/css2?family=IBM+Plex+Sans&display=swap" rel="stylesheet"><title>TASC Notes - Part 7 | DJ Adams</title><link rel="icon" type="“image/x-icon”" href="/images/favicon.ico"><meta property="og:title" content="TASC Notes - Part 7"><meta property="og:site_name" content="DJ Adams"><meta property="og:type" content="website"><meta property="og:url" content="https://qmacro.org/blog/posts/2025/02/07/tasc-notes-part-7/"><meta name="description" content="TASC Notes - Part 7 07 Feb 2025 | 10 min read These are the notes summarising what was covered in The Art and Science of CAP part 7, one..."><meta property="og:description" content="TASC Notes - Part 7 07 Feb 2025 | 10 min read These are the notes summarising what was covered in The Art and Science of CAP part 7, one..."><meta name="description" content="TASC Notes - Part 7 07 Feb 2025 | 10 min read These are the notes summarising what was covered in The Art and Science of CAP part 7, one..."><meta property="og:image" content="https://qmacro.org/images/site-image.png"><script src="https://cdn.jsdelivr.net/npm/mermaid/dist/mermaid.min.js"></script><script>mermaid.initialize({startOnLoad:true});</script><script async src="https://www.googletagmanager.com/gtag/js?id=G-4WQKBG0L4Y"></script><script>window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());

      gtag('config', 'G-4WQKBG0L4Y');</script></head><body><div class="layout-wrapper"><header class="header"><div class="header__content"><h1 class="site-title"><a href="/">DJ Adams</a></h1><nav class="nav"><ul class="nav__list"><li class="nav-item"><a href="/about">About Me</a></li><li class="nav-item"><a href="/blog">Blog</a></li><li class="nav-item"><a href="/feed.xml">Feed</a></li></ul></nav></div></header><main class="main"><article class="post"><header class="post__header"><h1>TASC Notes - Part 7</h1><div class="post__details"><time datetime="2025-02-07">07 Feb 2025 </time><span>| </span><span>10 min read</span></div></header><main class="post__content"><p>These are the notes summarising what was covered in <a href="https://www.youtube.com/watch?v=r_mxsBZSgEo">The Art and Science of CAP part 7</a>, one episode in a mini series with Daniel Hutzel to explore the philosophy, the background, the technology history and layers that support and inform the SAP Cloud Application Programming Model.</p><p>For all resources related to this series, see the post <a href="/blog/posts/2024/12/06/the-art-and-science-of-cap/">The Art and Science of CAP</a>.</p><p>This episode started with a review of the previous episode (part 6), based on the <a href="/blog/posts/2024/12/20/tasc-notes-part-6/">notes for that episode</a>. We continued to look back more generally over the previous episodes to pick out the main themes around which we wove a (hopefully) coherent story:</p><ul><li>Domain-driven design</li><li>The importance of modelling</li><li>Aspect-oriented programming</li><li>Artistic &amp; scientific principles</li></ul><p>During this review, at around <a href="https://www.youtube.com/watch?v=r_mxsBZSgEo&amp;t=1105">18:25</a>, it was almost inevitable that we revisited the Class vs Prototype conversation, dwelling on the differences, and the importance of prototypical inheritance (the power of which is also reflected in the concept of <a href="/blog/posts/2024/11/08/flattening-the-hierarchy-with-mixins/">mixins</a>). But before we got to diving into that, we took a quick detour to revisit the theme of code generation.</p><h2>A quick review of some bad practices and what CAP brings</h2><p>We talked about code generation, and how and why it appears in the <a href="https://cap.cloud.sap/docs/about/bad-practices">Bad Practices</a> topic in Capire. This time Daniel reminded us of today's popular context of serverless and functions-as-a-service where codebase size and startup times - two areas where code generation cause more problems than they solve - are critical. Moreover, an approach that CAP also takes here is what one could only describe as at the opposite end of code generation and the <a href="https://cap.cloud.sap/docs/about/bad-practices#tons-of-glue-code">staleness</a> that inevitably accompanies that - dynamic interpretation of the models at run time.</p><p>Talking of staleness and &quot;glue code&quot; (technical non-domain code), another key philosophy driving CAP's design and realisation here is the idea that application developers should concentrate on developing the application. They should not be working on technical aspects of bringing that application to bear - tenant isolation, database management, security, protocol-level service integration and so on.</p><p>In fact, the entire idea of CAP's <a href="https://cap.cloud.sap/docs/about/best-practices#the-calesi-pattern">Calesi Pattern</a> (CAP-level service integration) fits squarely into the space that this philosophical approach is carving out for us - the provision of CAP client libraries for BTP platform services that are designed to drastically reduce boilerplate and purely technical code.</p><p>Another aspect of why <a href="/blog/posts/2024/11/07/five-reasons-to-use-cap/#1-the-code-is-in-the-framework-not-outside-of-it">keeping the code inside the framework</a> is important is eloquently expressed by Daniel: as builders of enterprise applications, we have to ensure that our code scales, and that our teams and the output from those teams can scale too.</p><p>Taking care of the important non-domain-specific aspects of building such enterprise applications not only removes the tedium but also reduces the chance for error and minimises the possibilities for varying and ultimately chaotically different approaches across different teams (think about how SAP-delivered UI5 based Fiori apps have standard layouts and MVC patterns, and why Fiori elements came into being).</p><h2>Revisiting some of CAP's solid science foundations</h2><p>At around <a href="https://www.youtube.com/watch?v=r_mxsBZSgEo&amp;t=1520">25:20</a> Daniel shared a biography slide from a deck that he'd compiled for a recent presentation on CAP at the <a href="https://hpi.de/en/">Hasso Plattner Institute</a>.</p><blockquote><p>I couldn't help notice Daniel's pedigree from that biography slide; I mean, many of us already know Smalltalk runs through his veins, and perhaps knew, or at least suspected, that he has had enough experience<a href="#footnote-1"><sup>1</sup></a> with Java and JEE to ensure that CAP exudes good practices and eschews bad ones ... in the right way ;-)</p><p>And I was delighted to learn that he also has been touched by NeXTSTEP - an object-oriented OS that also happened to sport a graphical desktop manager that is one of my favourites (and which lives on in the form of <a href="https://www.windowmaker.org/">Window Maker</a>). I'm already assuming that you realise that NeXTSTEP was created for the machines upon which the Web was invented - it was on a NeXTcube that Tim Berners-Lee wrote the first versions of Web client and server software. <img src="/images/2025/02/NeXTcube.jpg" alt="A NeXTcube"></p><p><em>(<a href="https://commons.wikimedia.org/wiki/File:NEXT_Cube-IMG_7154.jpg">Photo courtesy of Wikimedia Commons</a>)</em></p></blockquote><p>Daniel jumps from Smalltalk to Lisp (the latter influenced the former) which is the &quot;hero language&quot; of functional programming, one of the key science pillars of CAP. It's hard to sum up decades of computing and computer science here, but I can sleep easy knowing that the good parts are in CAP; and those parts that were ultimately discovered to be not so good ... are not.</p><p>In the abstract-all-the-things mania of the 90's we had CASE and UML (and the corresponding code generation machinery that went with that) and by and large this has now been shown, over and over again, to be a noble but essentially wrong direction.</p><p>Ironically, or at least in stark contrast, we have functional programming and the simplicity of treating data as data (passive), which in turn allows us to think about immutability. And things that cannot move ... cannot break.</p><p>Not only that, but such qualities allow us to think about processing large quantities of data with simple pipelines, such as <a href="https://en.wikipedia.org/wiki/MapReduce">MapReduce</a>, which is a scalable and relatively efficient way of analysing data in a chain of steps that are each horizontally scalable (and yes, the name comes from two classic functions <code>map</code> and <code>reduce</code><a href="#footnote-1"><sup>2</sup></a> that are building blocks in many functional programming approaches).</p><p>Core functional programming tenets such as immutability and the related concept of pure functions, i.e. those that are side-effect free, principles that allows mechanisms such as function chains (such as ones used in MapReduce) are consequently found in CAP too:</p><ul><li><a href="https://cap.cloud.sap/docs/about/best-practices#services">Services</a> are stateless</li><li><a href="https://cap.cloud.sap/docs/about/best-practices#data">Data</a> is passive</li></ul><p>On the topic of passive data, Daniel relates the story of an esteemed colleague extolling the virtues of <em>non-anemic</em> objects, while Daniel himself takes the opposite approach. While the adjective <a href="https://deviq.com/domain-driven-design/anemic-model">anemic</a> is an established one, it is a pejorative description based on a viewpoint held not least by luminaries such as Martin Fowler <a href="#footnote-2"><sup>3</sup></a>, and I suggest we use a different, more positive term for what we're striving for here. &quot;Pure objects&quot;, anyone?</p><p>Anemic, or pure objects, are almost a prerequisite for late binding and aspect oriented techniques.</p><h2>Prototype based system examples</h2><p>Riffing on that last point, championing the prototype based inheritance model over the class based one, Daniel opens up one of our (now) favourite developer tools - the cds REPL - to give an example, which I'll try to summarise here.</p><p>First, a &quot;class&quot; <code>Foo</code> is defined, and an &quot;instance&quot; created:</p><pre class="language-text"><code class="language-text">> Foo = class { bar = 11; boo(){ return "Hu?" } }<br>class { bar = 11; boo(){ return "Hu?" } }<br>> foo = new Foo<br>Foo { bar: 11 }</code></pre><p>The <code>boo</code> &quot;method&quot; is available on <code>foo</code>:</p><pre class="language-text"><code class="language-text">> foo.boo()<br>Hu?</code></pre><blockquote><p>Note that so far I've used double quotes around &quot;class&quot;, &quot;instance&quot; and &quot;method&quot; here.</p></blockquote><p>Next we can create <code>Bar</code> as an child &quot;class&quot; of <code>Foo</code>:</p><pre class="language-text"><code class="language-text">> Bar = class extends Foo {}<br>class extends Foo {}</code></pre><p>At this point &quot;instances&quot; of <code>Bar</code> have both the <code>bar</code> property and the <code>boo</code> &quot;method&quot; available:</p><pre class="language-text"><code class="language-text">> bar = new Bar<br>Bar { bar: 11 }<br>> bar.boo()<br>Hu?</code></pre><p>And here's what's really going to wake you up: THERE IS NO CLASS. Moreover, <code>bar</code> is not an instance either (in the sense that we might understand or expect from the Java world, for example).</p><p>It's <em>prototypes</em> all the way down.</p><p>What's great is that we can employ aspect oriented approaches here, in that even if we're not the owner of <code>Foo</code>, we can <em>add an aspect</em>, a new behaviour to it, in a totally &quot;late&quot; way:</p><pre class="language-text"><code class="language-text">> Foo.prototype.moo = function(){ return "Not a cow" }<br>function(){ return "Not a cow" }</code></pre><p>And through the syntactic sugar and class machinery here, we see that <code>bar</code> even now has access to this new behaviour:</p><pre class="language-text"><code class="language-text">> bar.moo()<br>Not a cow</code></pre><p>Finally, to underline how fundamental the prototype mechanic is here, Daniel creates another &quot;instance&quot; of <code>Foo</code> (<code>car</code>), but perhaps not how you'd expect:</p><pre class="language-text"><code class="language-text">> car = { __proto__: foo }<br>Foo {}<br>> car.bar<br>11<br>> car.boo()<br>Hu?</code></pre><p>Boom!</p><h2>Reflection in the cds REPL</h2><p>Directly after this, at around <a href="https://www.youtube.com/watch?v=r_mxsBZSgEo&amp;t=2336">38:56</a>, Daniel jumps into the cds REPL to demonstrate how much of this is also reflected in CDS model construction. He almost immediately reaches for the relatively new <code>.inspect</code> cds REPL command (which we saw both in a <a href="/blog/posts/2024/12/10/tasc-notes-part-4/#the-repl">previous episode of this series</a> and also in <a href="/blog/posts/2025/01/10/cap-node.js-plugins-part-2-using-the-repl/#exploring-the-cds-facade">part 2 of the mini-series on CAP Node.js plugins</a>), which in turn reveals a whole series of <code>LinkedDefinitions</code>.</p><p>These <code>LinkedDefinitions</code> are <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Iteration_protocols#the_iterable_protocol">iterables</a>, and if you want to know more about how to embrace them, for example using destructuring assignments or the <code>for ... of</code> and <code>for ... in</code> statements see the <a href="/blog/posts/2025/01/10/cap-node.js-plugins-part-2-using-the-repl/#digging-deeper-into-the-bookshop-service">Digging deeper into the Bookshop service</a> section of the notes to part 2 of this series.</p><h2>Reflection in CDS modelling</h2><p>Launching from the fundamental prototype approach which we've explored now, Daniel connects the dots for us by revisiting some common<a href="#footnote-3"><sup>4</sup></a> aspects (<code>managed</code> and <code>cuid</code>) to show how the prototype approach brings the ultimate in aspect-based flexibility.</p><p>In particular, he relates a project situation where the <code>managed</code> aspect wasn't quite enough for what was required - the domain model design required the ability to store a comment on what was changed, in addition to actually tracking that it was changed.</p><p>And guess what? In <em>exactly the same way</em> as <code>moo</code> was added to <code>Foo</code> as a late injected aspect earlier, despite the lack of actual &quot;ownership&quot; of <code>Foo</code>:</p><pre class="language-javascript"><code class="language-javascript"><span class="token class-name">Foo</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function-variable function">moo</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span> <span class="token keyword">return</span> <span class="token string">"Not a cow"</span> <span class="token punctuation">}</span></code></pre><p>... the project was able to realise that design by adding the new element (let's use <code>boo</code> to keep things simple and show the parallel) to the <code>managed</code> aspect, again, despite the lack of actual &quot;ownership&quot; of that aspect or its wider context (<code>@sap/cds/common</code>):</p><pre class="language-cds"><code class="language-cds"><span class="token keyword">extend</span> managed with {<br>  boo : <span class="token type builtin">String</span>;<br>}</code></pre><p>This is art and science coming full circle in a beautiful parallel, and was well worth revisiting since Daniel talked about it earlier in the series, and which I subsequently blogged about in <a href="/blog/posts/2024/11/08/flattening-the-hierarchy-with-mixins/">Flattening the hierarachy with mixins</a>.</p><p>This time around though, we are better informed to grok how CDS modelling reflects the fundamental building blocks of the computer science upon which it is built, and the obvious relationship bursts forth from the editor.</p><h2>Extensible means extensible</h2><p>Following this completed circle, Daniel then expands on the extension by showing that effectively anything is possible, by specifying that the element in the extension should actually be a relationship to a complex object. On the way, we are taught how to think in flexible rather than rigid terms, using CDL features that we actually already know.</p><p>The starting scenario is that the &quot;bookshop&quot; service has a couple of entities <code>Books</code> and <code>Authors</code>, each of which are extended via the <code>managed</code> aspect:</p><pre class="language-cds"><code class="language-cds"><span class="token keyword">entity</span> Books : managed {<br>  descr  : localized <span class="token type builtin">String(1111)</span>;<br>  author : <span class="token association-composition keyword">Association to Authors</span> <span class="token annotation important">@mandatory;</span><br>  ...<br>}<br><br><span class="token keyword">entity</span> Authors : managed {<br>  <span class="token cqlkeywords keyword">key</span> ID : <span class="token type builtin">Integer</span>;<br>  name   : <span class="token type builtin">String(111)</span> <span class="token annotation important">@mandatory;</span><br>  ...<br>}</code></pre><p>With this addition of an element via the extension to the <code>managed</code> aspect:</p><pre class="language-cds"><code class="language-cds"><span class="token keyword">extend</span> managed with {<br>  boo : <span class="token type builtin">String</span>;<br>}</code></pre><p>each of <code>Books</code> and <code>Authors</code> would have this <code>boo</code> element too.</p><h3>The wrong way</h3><p>But what happens when that element should be something more complex, like a change list:</p><pre class="language-cds"><code class="language-cds"><span class="token keyword">entity</span> ChangeList : {<br>  <span class="token cqlkeywords keyword">key</span> ID    : <span class="token type builtin">UUID</span>;<br>  timestamp : <span class="token type builtin">Timestamp</span>;<br>  user      : <span class="token type builtin">String</span>;<br>  comment   : <span class="token type builtin">String</span>;<br>}</code></pre><p>That looks reasonable, so let's modify the additional element to relate to this. Something like:</p><pre class="language-cds"><code class="language-cds"><span class="token keyword">extend</span> managed with {<br>  changes : <span class="token association-composition keyword">Composition of many ChangeList</span> <span class="token cqlkeywords keyword">on</span> changes.book = $self;<br>}</code></pre><p>The problem with this is it's both brittle and inflexible as we now also need to add an element in the <code>ChangeList</code> entity to be a back pointer:</p><pre class="language-cds"><code class="language-cds"><span class="token keyword">entity</span> ChangeList : {<br>  Book      : <span class="token association-composition keyword">Association to Books</span>;<br>  <span class="token cqlkeywords keyword">key</span> ID    : <span class="token type builtin">UUID</span>;<br>  timestamp : <span class="token type builtin">Timestamp</span>;<br>  user      : <span class="token type builtin">String</span>;<br>  comment   : <span class="token type builtin">String</span>;<br>}</code></pre><p>Oops - and also one for <code>Authors</code>:</p><pre class="language-cds"><code class="language-cds"><span class="token keyword">entity</span> ChangeList : {<br>  Book      : <span class="token association-composition keyword">Association to Books</span>;<br>  Authors   : <span class="token association-composition keyword">Association to Authors</span>;<br>  <span class="token cqlkeywords keyword">key</span> ID    : <span class="token type builtin">UUID</span>;<br>  timestamp : <span class="token type builtin">Timestamp</span>;<br>  user      : <span class="token type builtin">String</span>;<br>  comment   : <span class="token type builtin">String</span>;<br>}</code></pre><p>Where will this end? Well, not only is it brittle and inflexible ... it's also wrong, because this aspect extension is now inextricably tied up with references to random entities to which the aspect itself has been applied.</p><p>And how could that ever work, when you factor <a href="https://www.youtube.com/watch?v=ScEPu1cs4l0">time</a> into the equation? Who knows what future entities you might have and want to extend with the <code>managed</code> aspect? And let's not even think about trying to address this with <a href="https://en.wikipedia.org/wiki/Polymorphic_association">polymorphic associations</a>. And not even coming up with a generic <code>parent : &lt;sometype&gt;</code> is going to work either.</p><p>As my sister Katie is fond of saying: <em>How about &quot;no&quot;?</em>.</p><p>If we were to doggedly persist with such an approach, we would still have the ugliness of what I feel are the CDS model relationship equivalents of impure functions, that have &quot;side effects&quot;, relationships pointing to somewhere outside their scope. I am minded to think about the myriad patch cables that connect different modules on a modular synth, much like the one shown in this classic photo by <a href="https://www.flickr.com/photos/jamesthephotographer/120916737/">Jim Gardner</a>, courtesy of Jim and <a href="https://commons.wikimedia.org/w/index.php?curid=1737148">Wikipedia</a>:</p><p><img src="/images/2025/02/modular-synth.jpg" alt="Steve Porcaro of Toto with a modular synthesizer in 1982">.</p><p><em>(Yes, that's Steve Porcaro of Toto, keyboard playing brother of Jeff Porcaro, creator of possibly the coolest drum pattern ever, the <a href="https://en.wikipedia.org/wiki/Rosanna_shuffle">Rosanna shuffle</a>)</em>.</p><h3>The right way</h3><p>Staying in the early 80's for a second (Rosanna was from Toto's 1982 album &quot;Toto IV&quot;), we can be mindful of the exhortation taken from the title of Talking Heads' classic studio album from 1980, and &quot;<a href="https://en.wikipedia.org/wiki/Remain_in_Light">Remain in Light</a>&quot;, i.e. adhere to the concept of aspects, rather than tie ourselves up with what is nearer to classes (objects) and relationships.</p><p>Reframing the complex object requirement in aspect terms:</p><pre class="language-cds"><code class="language-cds"><span class="token keyword">aspect</span> ChangeList : {<br>  <span class="token cqlkeywords keyword">key</span> ID    : <span class="token type builtin">UUID</span>;<br>  timestamp : <span class="token type builtin">Timestamp</span>;<br>  user      : <span class="token type builtin">String</span>;<br>  comment   : <span class="token type builtin">String</span>;<br>}</code></pre><p>means that we just need a simpler managed relationship:</p><pre class="language-cds"><code class="language-cds"><span class="token keyword">extend</span> managed with {<br>  changes : <span class="token association-composition keyword">Composition of many ChangeList</span>;</code></pre><p>and, in Daniel's words (at around <a href="https://www.youtube.com/watch?v=r_mxsBZSgEo&amp;t=2973">49:33</a>) - &quot;we're done&quot;.</p><p>Behind the scenes there's still an entity, in the shape of the aspect defined here, but that entity is added by the compiler, as Daniel shows when he pulls back the curtain (via the <a href="https://cap.cloud.sap/docs/tools/cds-editors#preview-cds-sources">Preview CDS sources</a> feature in the VS Code extension) to reveal an entity (a &quot;definition&quot;) named:</p><pre class="language-text"><code class="language-text">sap.capire.bookshop.Books.changes</code></pre><p>which has a name made up from:</p><ul><li>the namespace <code>sap.capire.bookshop</code></li><li>the entity name <code>Books</code></li><li>the element <code>changes</code></li></ul><p>The eagle-eyed amongst you will also have of course spotted the <code>Authors</code> equivalent in that definition list too, as <code>Authors</code> was also adorned with the <code>managed</code> aspect:</p><p><img src="/images/2025/02/definitions.png" alt="definitions"></p><p>In generating this entity, the compiler also includes an element to point back, and because this work is at compile time, and individually specific to each primary entity (<code>Books</code> and <code>Authors</code> here) it can be specific and precise. This is what the YAML representation of the CSN based on the model looks like, for the <code>changes</code> element relating to the <code>Books</code> entity:</p><pre class="language-yaml"><code class="language-yaml"><span class="token key atrule">sap.capire.bookshop.Books.changes</span><span class="token punctuation">:</span><br>  <span class="token key atrule">kind</span><span class="token punctuation">:</span> entity<br>  <span class="token key atrule">elements</span><span class="token punctuation">:</span><br>    <span class="token key atrule">up_</span><span class="token punctuation">:</span><br>      <span class="token key atrule">key</span><span class="token punctuation">:</span> <span class="token boolean important">true</span><br>      <span class="token key atrule">type</span><span class="token punctuation">:</span> cds.Association<br>      <span class="token key atrule">cardinality</span><span class="token punctuation">:</span> <span class="token punctuation">{</span><span class="token key atrule">min</span><span class="token punctuation">:</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token key atrule">max</span><span class="token punctuation">:</span> <span class="token number">1</span><span class="token punctuation">}</span><br>      <span class="token key atrule">target</span><span class="token punctuation">:</span> sap.capire.bookshop.Books<br>      <span class="token key atrule">keys</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token punctuation">{</span><span class="token key atrule">ref</span><span class="token punctuation">:</span> <span class="token punctuation">[</span>ID<span class="token punctuation">]</span><span class="token punctuation">}</span><span class="token punctuation">]</span><br>      <span class="token key atrule">notNull</span><span class="token punctuation">:</span> <span class="token boolean important">true</span><br>    <span class="token key atrule">ID</span><span class="token punctuation">:</span> <span class="token punctuation">{</span><span class="token key atrule">key</span><span class="token punctuation">:</span> <span class="token boolean important">true</span><span class="token punctuation">,</span> <span class="token key atrule">type</span><span class="token punctuation">:</span> cds.UUID<span class="token punctuation">}</span><br>    <span class="token key atrule">timestamp</span><span class="token punctuation">:</span> <span class="token punctuation">{</span><span class="token key atrule">type</span><span class="token punctuation">:</span> cds.Timestamp<span class="token punctuation">}</span><br>    <span class="token key atrule">user</span><span class="token punctuation">:</span> <span class="token punctuation">{</span><span class="token key atrule">type</span><span class="token punctuation">:</span> cds.String<span class="token punctuation">}</span><br>    <span class="token key atrule">comment</span><span class="token punctuation">:</span> <span class="token punctuation">{</span><span class="token key atrule">type</span><span class="token punctuation">:</span> cds.String<span class="token punctuation">}</span></code></pre><p>This is a lovely example of the truth, the reality, underpinning the general idea that with aspect oriented programming: &quot;you can extend everything that you can get access to, whether it is your definition or somebody else's definition or even your framework's definition&quot;. And that extension will be applied to the appropriate usages of that definition.</p><p>Daniel goes further to emphasise that while this (deliberately simple) example was in the same <code>schema.cds</code> file, the definitions and extensions can be stored in separate files, used in CDS plugins, and so on. In fact, this is exactly how the <a href="https://github.com/cap-js/change-tracking">Change Tracking Plugin</a> works.</p><p>Note that this was a named aspect (the name is <code>ChangeList</code>) but the same modelling outcome could have been effected using an anonymous aspect, like this:</p><pre class="language-cds"><code class="language-cds"><span class="token keyword">extend</span> managed with {<br>    changes : <span class="token association-composition keyword">Composition of many </span>{<br>    <span class="token cqlkeywords keyword">key</span> ID    : <span class="token type builtin">UUID</span>;<br>    timestamp : <span class="token type builtin">Timestamp</span>;<br>    user      : <span class="token type builtin">String</span>;<br>    comment   : <span class="token type builtin">String</span>;<br>  };<br>}</code></pre><h2>Wrapping up with relational algebra</h2><p>CAP's query language, <a href="https://cap.cloud.sap/docs/cds/cql">CQL</a>, is based upon and extends SQL in two important directions:</p><ul><li>nested projections</li><li>path expressions (along associations)</li></ul><p>From a science perspective, Daniel and the team were keen to validate the idea and realisation of CDS models, and CQL in particular. To this end, behold:</p><pre class="language-cds"><code class="language-cds"><span class="token using keyword">using</span> { sap.capire.bookshop.Books } <span class="token from keyword">from</span> './schema';<br><span class="token using keyword">using</span> { sap.capire.bookshop.Authors } <span class="token from keyword">from</span> './schema';<br><br><span class="token annotation important">@singleton</span><br><span class="token keyword">entity</span> Schema {<br>  <span class="token cqlkeywords keyword">key</span> ID   : <span class="token type builtin">Integer</span>; <span class="token single-line-comment comment">// just to make it a valid DDL</span><br>  Books    : <span class="token association-composition keyword">Association to many Books</span> <span class="token cqlkeywords keyword">on</span> 1=1;<br>  Authors  : <span class="token association-composition keyword">Association to many Authors</span> <span class="token cqlkeywords keyword">on</span> 1=1;<br>}</code></pre><blockquote><p>In case you're scratching your head over <code>@singleton</code>, Daniel has some advice: &quot;Don't try to look it up, I just invented it&quot; :-)</p></blockquote><p>Consider these queries:</p><pre class="language-text"><code class="language-text">> await cds.ql `SELECT from Schema:Books`<br>[]</code></pre><p>then:</p><pre class="language-text"><code class="language-text">> await INSERT({ID:1}).into(Schema)</code></pre><p>so:</p><pre class="language-text"><code class="language-text">> await cds.ql `SELECT from Schema:Books`<br>[ <some results> ]</some></code></pre><p>Your task (homework), should you choose to accept it, is to think about this, read up on the <a href="https://en.wikipedia.org/wiki/Relational_model">Relational Model</a>, and maybe even try the queries out yourself.</p><p>Until next time!</p><hr><p><a name="footnotes"></a></p><h2>Footnotes</h2><p><a name="footnote-1"></a></p><ol><li>Battle scars.</li></ol><p><a name="footnote-2"></a> 2. For more on <code>reduce</code> and how it is such a fundamental building block, see <a href="/blog/posts/2024/07/23/reduce-the-ur-function/">reduce - the ur-function</a>.</p><p><a name="footnote-3"></a> 3. Martin's post <a href="https://martinfowler.com/bliki/AnemicDomainModel.html">Anemic Domain Model</a> is from 2003 and rather cutting but definitely worth a read, as is the <a href="https://en.wikipedia.org/wiki/Anemic_domain_model">Wikipedia article on the same topic</a>.</p><p><a name="footnote-4"></a> 4. Literally (as many of us use them in our own projects) and technically (as they're supplied in <code>@sap/cds/common</code>) - see <a href="https://cap.cloud.sap/docs/cds/common">Common Types and Aspects</a> in Capire.</p></main><aside class="post__aside"><div class="post__tags"><a href="/tags/tasc/">#tasc</a> <a href="/tags/cap/">#cap</a> <a href="/tags/cds/">#cds</a> <a href="/tags/handsonsapdev/">#handsonsapdev</a></div><style>.utterances {
  margin-left: inherit !important;
}</style><script src="https://utteranc.es/client.js" repo="qmacro/qmacro.github.io" issue-term="title" crossorigin="anonymous" async></script><nav class="post__pagination"><a href="/blog/posts/2025/01/17/cap-node.js-plugins-part-3-writing-our-own/"><span>CAP Node.js plugins - part 3 - writing our own</span> <span>→</span></a></nav></aside></article></main><footer class="footer"><div class="footer__content"><ul class="hero__social-links"><li><a rel="me" href="https://github.com/qmacro" target="_blank" rel="noopener noreferrer">GitHub</a></li><li><a rel="me" href="https://www.youtube.com/djadams-qmacro" target="_blank" rel="noopener noreferrer">YouTube</a></li><li><a rel="me" href="https://www.linkedin.com/in/djadams/" target="_blank" rel="noopener noreferrer">LinkedIn</a></li><li><a rel="me" href="https://hachyderm.io/@qmacro" target="_blank" rel="noopener noreferrer">Mastodon</a></li><li><a rel="me" href="https://bsky.app/profile/qmacro.bsky.social" target="_blank" rel="noopener noreferrer">Bluesky</a></li><li><a href="/feed.xml" target="_blank" rel="noopener noreferrer">RSS</a></li></ul></div></footer></div><script src="/assets/main.31d6cfe0d16ae931b73c.js"></script></body></html>