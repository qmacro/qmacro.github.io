<!doctype html>
<html lang="en">
	<head>
		<meta charset="utf-8">
		<meta name="viewport" content="width=device-width, initial-scale=1.0">
		<title>Modelling contained-in relationships with compositions in CDS</title>
		<meta name="description" content="A short study of the features of CDS for modelling classic contained-in relationships, with a focus on the details, and a lean towards anonymous aspects.">
		<link rel="alternate" href="/feed/feed.xml" type="application/atom+xml" title="DJ Adams">
		<link rel="icon" type="image/x-icon" href="/images/favicon.ico">

      <meta property="og:title" content="Modelling contained-in relationships with compositions in CDS">
        <meta property="og:site_name" content="DJ Adams">
          <meta property="og:image" content="/images/site-image.png">
        <meta property="og:description" content="A short study of the features of CDS for modelling classic contained-in relationships, with a focus on the details, and a lean towards anonymous aspects.">
        <meta property="og:url" content="https://qmacro.org/blog/posts/2025/10/14/modelling-contained-in-relationships-with-compositions-in-cds/">
		
		
		
		<style>/* This is an arbitrary CSS string added to the bundle */
/* Defaults */
:root {
	--font-family: -apple-system, system-ui, sans-serif;
	--font-family-monospace: Consolas, Menlo, Monaco, Andale Mono WT, Andale Mono, Lucida Console, Lucida Sans Typewriter, DejaVu Sans Mono, Bitstream Vera Sans Mono, Liberation Mono, Nimbus Mono L, Courier New, Courier, monospace;
}

/* Theme colors */
:root {
	--color-gray-20: #e0e0e0;
	--color-gray-50: #C0C0C0;
	--color-gray-90: #333;

	--background-color: #fff;

	--text-color: var(--color-gray-90);
	--text-color-link: #2884d2;
	--text-color-link-active: #15b0ed;
	--text-color-link-visited: #9f4199;

	--syntax-tab-size: 2;
}

@media (prefers-color-scheme: dark) {
	:root {
		--color-gray-20: #e0e0e0;
		--color-gray-50: #C0C0C0;
		--color-gray-90: #dad8d8;

		/* --text-color is assigned to --color-gray-_ above */
		--text-color-link: #1493fb;
		--text-color-link-active: #6969f7;
		--text-color-link-visited: #a6a6f8;

		--background-color: #15202b;
	}
}


/* Global stylesheet */
* {
	box-sizing: border-box;
}

@view-transition {
	navigation: auto;
}

html,
body {
	padding: 0;
	margin: 0 auto;
	font-family: var(--font-family);
	color: var(--text-color);
	background-color: var(--background-color);
}
html {
	overflow-y: scroll;
}
body {
	max-width: 40em;
}

/* https://www.a11yproject.com/posts/how-to-hide-content/ */
.visually-hidden:not(:focus):not(:active) {
	clip: rect(0 0 0 0);
	clip-path: inset(50%);
	height: 1px;
	overflow: hidden;
	position: absolute;
	white-space: nowrap;
	width: 1px;
}

/* Fluid images via https://www.zachleat.com/web/fluid-images/ */
img{
  max-width: 100%;
}
img[width][height] {
  height: auto;
}
img[src$=".svg"] {
  width: 100%;
  height: auto;
  max-width: none;
}
video,
iframe {
	width: 100%;
	height: auto;
}
iframe {
	aspect-ratio: 16/9;
}

p:last-child {
	margin-bottom: 0;
}
p {
	line-height: 1.5;
}

li {
	line-height: 1.5;
}

a[href] {
	color: var(--text-color-link);
}
a[href]:visited {
	color: var(--text-color-link-visited);
}
a[href]:hover,
a[href]:active {
	color: var(--text-color-link-active);
}

main,
footer {
	padding: 1rem;
}
/* main :first-child { */
/* 	margin-top: 0; */
/* } */

header {
	border-bottom: 1px dashed var(--color-gray-20);
}

#skip-link {
	text-decoration: none;
	background: var(--background-color);
	color: var(--text-color);
	padding: 0.5rem 1rem;
	border: 1px solid var(--color-gray-90);
	border-radius: 2px;
}

/* Prevent visually-hidden skip link fom pushing content around when focused */
#skip-link.visually-hidden:focus {
	position: absolute;
	top: 1rem;
	left: 1rem;
	/* Ensure it is positioned on top of everything else when it is shown */
	z-index: 999;
}

.links-nextprev {
	display: flex;
	justify-content: space-between;
	gap: .5em 1em;
	list-style: "";
	border-top: 1px dashed var(--color-gray-20);
	padding: 1em 0;
}
.links-nextprev > * {
	flex-grow: 1;
}
.links-nextprev-next {
	text-align: right;
}

table {
	margin: 1em 0;
}
table td,
table th {
	padding-right: 1em;
}

pre,
code {
	font-family: var(--font-family-monospace);
	color: seagreen;
}

pre,code[class*="language-"] {
	line-height: 1.2em !important;
	font-size: 0.93em !important;
}

pre:not([class*="language-"]) {
	margin: .5em 0;
	line-height: 1.375; /* 22px /16 */
	-moz-tab-size: var(--syntax-tab-size);
	-o-tab-size: var(--syntax-tab-size);
	tab-size: var(--syntax-tab-size);
	-webkit-hyphens: none;
	-ms-hyphens: none;
	hyphens: none;
	direction: ltr;
	text-align: left;
	white-space: pre;
	word-spacing: normal;
	word-break: normal;
	overflow-x: auto;
}
code {
	word-break: break-word;
}

/* Header */
header {
	display: flex;
	gap: 1em;
	flex-wrap: wrap;
	justify-content: space-between;
	align-items: center;
	padding: 1em;
}
.home-link {
	flex-grow: 1;
	font-size: 1em; /* 16px /16 */
	font-weight: 700;
}
.home-link:link:not(:hover) {
	text-decoration: none;
}

/* Nav */
.nav {
	display: flex;
	gap: .5em 1em;
	padding: 0;
	margin: 0;
	list-style: none;
}
.nav-item {
	display: inline-block;
}
.nav-item a[href]:not(:hover) {
	text-decoration: none;
}
.nav a[href][aria-current="page"] {
	text-decoration: underline;
}

/* Posts list */
.postlist {
	counter-reset: start-from var(--postlist-index);
	list-style: none;
	padding: 0;
}
.postlist-item {
	display: flex;
	flex-wrap: wrap;
	align-items: baseline;
	counter-increment: start-from -1;
	margin-bottom: 1em;
}
.postlist-item:before {
	display: inline-block;
	pointer-events: none;
	line-height: 100%;
	text-align: right;
	margin-left: -1.5rem;
}
.postlist-date,
.postlist-item:before {
	font-size: 0.8125em; /* 13px /16 */
	color: var(--color-gray-90);
}
.postlist-date {
	word-spacing: -0.5px;
}
.postlist-link {
	font-size: 1.1875em; /* 19px /16 */
	font-weight: 700;
	flex-basis: calc(100% - 1.5rem);
	text-underline-position: from-font;
	text-underline-offset: 0;
	text-decoration-thickness: 1px;
}
.postlist-item-active .postlist-link {
	font-weight: bold;
}

/* Tags */
.post-tag {
	display: inline-flex;
	align-items: center;
	justify-content: center;
	font-style: italic;
}

/* may want to make the description text smaller at some stage */
.post-description-list {
	font-size: 1.0em;
}

.post-description-main {
	font-style: italic;
}

.postlist-item > .post-tag {
	align-self: center;
}

/* Tags list */
.post-metadata {
	display: inline-flex;
	flex-wrap: wrap;
	gap: .5em;
	list-style: none;
	padding: 0;
	margin: 0;
}
.post-metadata time {
	margin-right: 1em;
}

blockquote {
	margin-top: 0px;
	margin-left: 0px;
	margin-bottom: 15px;
	padding-left: 15px;
	border-left: 5px solid lightgray;
}
/**
 * prism.js default theme for JavaScript, CSS and HTML
 * Based on dabblet (http://dabblet.com)
 * @author Lea Verou
 */

code[class*="language-"],
pre[class*="language-"] {
	color: black;
	background: none;
	text-shadow: 0 1px white;
	font-family: Consolas, Monaco, 'Andale Mono', 'Ubuntu Mono', monospace;
	font-size: 1em;
	text-align: left;
	white-space: pre;
	word-spacing: normal;
	word-break: normal;
	word-wrap: normal;
	line-height: 1.5;

	-moz-tab-size: 4;
	-o-tab-size: 4;
	tab-size: 4;

	-webkit-hyphens: none;
	-moz-hyphens: none;
	-ms-hyphens: none;
	hyphens: none;
}

pre[class*="language-"]::-moz-selection, pre[class*="language-"] ::-moz-selection,
code[class*="language-"]::-moz-selection, code[class*="language-"] ::-moz-selection {
	text-shadow: none;
	background: #b3d4fc;
}

pre[class*="language-"]::selection, pre[class*="language-"] ::selection,
code[class*="language-"]::selection, code[class*="language-"] ::selection {
	text-shadow: none;
	background: #b3d4fc;
}

@media print {
	code[class*="language-"],
	pre[class*="language-"] {
		text-shadow: none;
	}
}

/* Code blocks */
pre[class*="language-"] {
	padding: 1em;
	margin: .5em 0;
	overflow: auto;
}

:not(pre) > code[class*="language-"],
pre[class*="language-"] {
	background: #f5f2f0;
}

/* Inline code */
:not(pre) > code[class*="language-"] {
	padding: .1em;
	border-radius: .3em;
	white-space: normal;
}

.token.comment,
.token.prolog,
.token.doctype,
.token.cdata {
	color: slategray;
}

.token.punctuation {
	color: #999;
}

.token.namespace {
	opacity: .7;
}

.token.property,
.token.tag,
.token.boolean,
.token.number,
.token.constant,
.token.symbol,
.token.deleted {
	color: #905;
}

.token.selector,
.token.attr-name,
.token.string,
.token.char,
.token.builtin,
.token.inserted {
	color: #690;
}

.token.operator,
.token.entity,
.token.url,
.language-css .token.string,
.style .token.string {
	color: #9a6e3a;
	/* This background color was intended by the author of this theme. */
	background: hsla(0, 0%, 100%, .5);
}

.token.atrule,
.token.attr-value,
.token.keyword {
	color: #07a;
}

.token.function,
.token.class-name {
	color: #DD4A68;
}

.token.regex,
.token.important,
.token.variable {
	color: #e90;
}

.token.important,
.token.bold {
	font-weight: bold;
}
.token.italic {
	font-style: italic;
}

.token.entity {
	cursor: help;
}
/*
 * New diff- syntax
 */

pre[class*="language-diff-"] {
	--eleventy-code-padding: 1.25em;
	padding-left: var(--eleventy-code-padding);
	padding-right: var(--eleventy-code-padding);
}
.token.deleted {
	background-color: hsl(0, 51%, 37%);
	color: inherit;
}
.token.inserted {
	background-color: hsl(126, 31%, 39%);
	color: inherit;
}

/* Make the + and - characters unselectable for copy/paste */
.token.prefix.unchanged,
.token.prefix.inserted,
.token.prefix.deleted {
	-webkit-user-select: none;
	user-select: none;
	display: inline-flex;
	align-items: center;
	justify-content: center;
	padding-top: 2px;
	padding-bottom: 2px;
}
.token.prefix.inserted,
.token.prefix.deleted {
	width: var(--eleventy-code-padding);
	background-color: rgba(0,0,0,.2);
}

/* Optional: full-width background color */
.token.inserted:not(.prefix),
.token.deleted:not(.prefix) {
	display: block;
	margin-left: calc(-1 * var(--eleventy-code-padding));
	margin-right: calc(-1 * var(--eleventy-code-padding));
	text-decoration: none; /* override del, ins, mark defaults */
	color: inherit; /* override del, ins, mark defaults */
}
.utterances {
  margin-left: inherit !important;
}</style>
		

    <!-- Global site tag (gtag.js) - Google Analytics -->
    <script async="" src="https://www.googletagmanager.com/gtag/js?id=G-4WQKBG0L4Y"></script>
    

	</head>
	<body>
		<a href="#main" id="skip-link" class="visually-hidden">Skip to main content</a>

		<header>
			<a href="/" class="home-link">DJ Adams</a>
			<nav>
				<h2 class="visually-hidden" id="top-level-navigation-menu">Top level navigation menu</h2>
				<ul class="nav">
					<li class="nav-item"><a href="/">Home</a></li>
					<li class="nav-item"><a href="/about/">About</a></li>
					<li class="nav-item"><a href="/blog/">Blog</a></li>
					<li class="nav-item"><a href="/feed/feed.xml">Feed</a></li>
				</ul>
			</nav>
		</header>

		<main id="main">
			<heading-anchors>
				


<h1 id="modelling-contained-in-relationships-with-compositions-in-cds">Modelling contained-in relationships with compositions in CDS</h1>

<ul class="post-metadata">
	<li><time datetime="2025-10-14">14 October 2025</time></li>
	<li><a href="/tags/bestpractices/" class="post-tag">bestpractices</a>, </li>
	<li><a href="/tags/cap/" class="post-tag">cap</a>, </li>
	<li><a href="/tags/cds/" class="post-tag">cds</a>, </li>
	<li><a href="/tags/compositions/" class="post-tag">compositions</a>, </li>
	<li><a href="/tags/aspects/" class="post-tag">aspects</a></li>
</ul>

<p class="post-description-main">A short study of the features of CDS for modelling classic contained-in relationships, with a focus on the details, and a lean towards anonymous aspects.</p>

<h2 id="background">Background</h2>
<p>There's a classic structure often found representing business data in enterprise software, and that's the &quot;document&quot;. Purchase requisition, sales order, goods receipt, and so on. Header and items. Most of the time the items don't make sense existing on their own, independent of their header parent. Such documents are typically modelled using contained-in relationships.</p>
<p>There's a great section of the <a href="https://cap.cloud.sap/docs/">Capire</a> documentation, specifically on <a href="https://cap.cloud.sap/docs/guides/domain-modeling#compositions">compositions</a>, on which I want to expand here.</p>
<h2 id="explicit-modelling">Explicit modelling</h2>
<p>Given a hammer, all problems look like nails. Given the &quot;entity&quot; concept, all business data structures look like they should be modelled using entities.</p>
<p>Which does work. To wit:</p>
<pre class="language-cds" tabindex="0"><code class="language-cds"><span class="token keyword">service</span> S {
  <span class="token keyword">entity</span> Orders {
    <span class="token cqlkeywords keyword">key</span> ID    : <span class="token type builtin">Integer</span>;
        Items : <span class="token association-composition keyword">Composition of many OrderItems</span>
                  <span class="token cqlkeywords keyword">on</span> Items.parent = $self;
  }

  <span class="token keyword">entity</span> OrderItems {
    <span class="token cqlkeywords keyword">key</span> parent : <span class="token association-composition keyword">Association to Orders</span>;
    <span class="token cqlkeywords keyword">key</span> pos    : <span class="token type builtin">Integer</span>;
        qty    : <span class="token type builtin">Integer</span>;
  }
}</code></pre>
<p>When compiled (with <code>cds compile --to yaml service.cds</code><a href="#footnotes"><sup>1</sup></a>), this results in the following schema notation (in a YAML representation as I find it cleaner and easier to read)<a href="#footnotes"><sup>2</sup></a>:</p>
<pre class="language-yaml" tabindex="0"><code class="language-yaml"><span class="token key atrule">definitions</span><span class="token punctuation">:</span>
  <span class="token key atrule">S</span><span class="token punctuation">:</span>
    <span class="token key atrule">kind</span><span class="token punctuation">:</span> service
  <span class="token key atrule">S.Orders</span><span class="token punctuation">:</span>
    <span class="token key atrule">kind</span><span class="token punctuation">:</span> entity
    <span class="token key atrule">elements</span><span class="token punctuation">:</span>
      <span class="token key atrule">ID</span><span class="token punctuation">:</span>
        <span class="token key atrule">key</span><span class="token punctuation">:</span> <span class="token boolean important">true</span>
        <span class="token key atrule">type</span><span class="token punctuation">:</span> cds.Integer
      <span class="token key atrule">Items</span><span class="token punctuation">:</span>
        <span class="token key atrule">type</span><span class="token punctuation">:</span> cds.Composition
        <span class="token key atrule">cardinality</span><span class="token punctuation">:</span>
          <span class="token key atrule">max</span><span class="token punctuation">:</span> <span class="token string">'*'</span>
        <span class="token key atrule">target</span><span class="token punctuation">:</span> S.OrderItems
        <span class="token key atrule">'on'</span><span class="token punctuation">:</span>
          <span class="token punctuation">-</span> <span class="token key atrule">ref</span><span class="token punctuation">:</span>
              <span class="token punctuation">-</span> Items
              <span class="token punctuation">-</span> parent
          <span class="token punctuation">-</span> <span class="token string">'='</span>
          <span class="token punctuation">-</span> <span class="token key atrule">ref</span><span class="token punctuation">:</span>
              <span class="token punctuation">-</span> $self
  <span class="token key atrule">S.OrderItems</span><span class="token punctuation">:</span>
    <span class="token key atrule">kind</span><span class="token punctuation">:</span> entity
    <span class="token key atrule">elements</span><span class="token punctuation">:</span>
      <span class="token key atrule">parent</span><span class="token punctuation">:</span>
        <span class="token key atrule">key</span><span class="token punctuation">:</span> <span class="token boolean important">true</span>
        <span class="token key atrule">type</span><span class="token punctuation">:</span> cds.Association
        <span class="token key atrule">target</span><span class="token punctuation">:</span> S.Orders
        <span class="token key atrule">keys</span><span class="token punctuation">:</span>
          <span class="token punctuation">-</span> <span class="token key atrule">ref</span><span class="token punctuation">:</span>
              <span class="token punctuation">-</span> ID
      <span class="token key atrule">pos</span><span class="token punctuation">:</span>
        <span class="token key atrule">key</span><span class="token punctuation">:</span> <span class="token boolean important">true</span>
        <span class="token key atrule">type</span><span class="token punctuation">:</span> cds.Integer
      <span class="token key atrule">qty</span><span class="token punctuation">:</span>
        <span class="token key atrule">type</span><span class="token punctuation">:</span> cds.Integer</code></pre>
<p>The resulting CSN encompasses the modelling intent - zero or more item children, and a relationship constraint that links back to the parent.</p>
<p>But the definitions at the CDS model level are quite explicit and arguably a little &quot;noisy&quot;:</p>
<ul>
<li>at the parent level, the constraint detail (i.e. <code>on Items.parent = $self</code>) needs to be expressed explicitly</li>
<li>the child requires an explicit (key) element to point back to the parent</li>
<li>that child-to-parent relationship needs to be expressed explicitly as a to-one association which is arguably also just a bit too much &quot;machinery&quot; on show</li>
</ul>
<p>Remember, domain modelling is the common language for business domain experts and developers, and the CDS model is where they meet. So machinery is to be avoided where possible.</p>
<h2 id="implicit-modelling">Implicit modelling</h2>
<p>Such a classic parent-child structure can be expressed in the CDS model a lot more succinctly, using <a href="https://cap.cloud.sap/docs/guides/domain-modeling#aspects">aspects</a>, specifically <a href="https://cap.cloud.sap/docs/guides/domain-modeling#composition-of-aspects">anonymous aspects</a>.</p>
<p>The exact same model can be expressed thus:</p>
<pre class="language-cds" tabindex="0"><code class="language-cds"><span class="token keyword">service</span> S {
  <span class="token keyword">entity</span> Orders {
    <span class="token cqlkeywords keyword">key</span> ID    : <span class="token type builtin">Integer</span>;
        Items : <span class="token association-composition keyword">Composition of many </span>{
                  <span class="token cqlkeywords keyword">key</span> pos : <span class="token type builtin">Integer</span>;
                      qty : <span class="token type builtin">Integer</span>;
                }
  }

}</code></pre>
<p>That's it - that's the entire equivalent declaration. In using an anonymous aspect (that's the part expressed as the <code>{ ... }</code> block) to describe the composition target, we get to NOT have to come up with and define:</p>
<ul>
<li>a second entity definition</li>
<li>a name for that second entity</li>
<li>a composition constraint</li>
<li>a pointer from the child back to the parent</li>
</ul>
<p>I would go so far as to say that <a href="/blog/posts/2017/02/19/the-beauty-of-recursion-and-list-machinery/#initial-recognition">staring at</a> this structure expression conjures up far more readily what a document (such as those examples mentioned above) &quot;looks like&quot; mentally.</p>
<p>And guess what? The equivalent schema notation is logically the same. Here's what compiling this &quot;quieter&quot; and more compact version to the YAML flavour of CSN gives us<a href="#footnotes"><sup>2</sup></a>:</p>
<pre class="language-yaml" tabindex="0"><code class="language-yaml"><span class="token key atrule">definitions</span><span class="token punctuation">:</span>
  <span class="token key atrule">S</span><span class="token punctuation">:</span>
    <span class="token key atrule">kind</span><span class="token punctuation">:</span> service
  <span class="token key atrule">S.Orders</span><span class="token punctuation">:</span>
    <span class="token key atrule">kind</span><span class="token punctuation">:</span> entity
    <span class="token key atrule">elements</span><span class="token punctuation">:</span>
      <span class="token key atrule">ID</span><span class="token punctuation">:</span>
        <span class="token key atrule">key</span><span class="token punctuation">:</span> <span class="token boolean important">true</span>
        <span class="token key atrule">type</span><span class="token punctuation">:</span> cds.Integer
      <span class="token key atrule">Items</span><span class="token punctuation">:</span>
        <span class="token key atrule">type</span><span class="token punctuation">:</span> cds.Composition
        <span class="token key atrule">cardinality</span><span class="token punctuation">:</span>
          <span class="token key atrule">max</span><span class="token punctuation">:</span> <span class="token string">'*'</span>
        <span class="token key atrule">targetAspect</span><span class="token punctuation">:</span>
          <span class="token key atrule">elements</span><span class="token punctuation">:</span>
            <span class="token key atrule">pos</span><span class="token punctuation">:</span>
              <span class="token key atrule">key</span><span class="token punctuation">:</span> <span class="token boolean important">true</span>
              <span class="token key atrule">type</span><span class="token punctuation">:</span> cds.Integer
            <span class="token key atrule">qty</span><span class="token punctuation">:</span>
              <span class="token key atrule">type</span><span class="token punctuation">:</span> cds.Integer
        <span class="token key atrule">target</span><span class="token punctuation">:</span> S.Orders.Items
        <span class="token key atrule">'on'</span><span class="token punctuation">:</span>
          <span class="token punctuation">-</span> <span class="token key atrule">ref</span><span class="token punctuation">:</span>
              <span class="token punctuation">-</span> Items
              <span class="token punctuation">-</span> up_
          <span class="token punctuation">-</span> <span class="token string">'='</span>
          <span class="token punctuation">-</span> <span class="token key atrule">ref</span><span class="token punctuation">:</span>
              <span class="token punctuation">-</span> $self
  <span class="token key atrule">S.Orders.Items</span><span class="token punctuation">:</span>
    <span class="token key atrule">kind</span><span class="token punctuation">:</span> entity
    <span class="token key atrule">elements</span><span class="token punctuation">:</span>
      <span class="token key atrule">up_</span><span class="token punctuation">:</span>
        <span class="token key atrule">key</span><span class="token punctuation">:</span> <span class="token boolean important">true</span>
        <span class="token key atrule">type</span><span class="token punctuation">:</span> cds.Association
        <span class="token key atrule">cardinality</span><span class="token punctuation">:</span>
          <span class="token key atrule">min</span><span class="token punctuation">:</span> <span class="token number">1</span>
          <span class="token key atrule">max</span><span class="token punctuation">:</span> <span class="token number">1</span>
        <span class="token key atrule">target</span><span class="token punctuation">:</span> S.Orders
        <span class="token key atrule">keys</span><span class="token punctuation">:</span>
          <span class="token punctuation">-</span> <span class="token key atrule">ref</span><span class="token punctuation">:</span>
              <span class="token punctuation">-</span> ID
        <span class="token key atrule">notNull</span><span class="token punctuation">:</span> <span class="token boolean important">true</span>
      <span class="token key atrule">pos</span><span class="token punctuation">:</span>
        <span class="token key atrule">key</span><span class="token punctuation">:</span> <span class="token boolean important">true</span>
        <span class="token key atrule">type</span><span class="token punctuation">:</span> cds.Integer
      <span class="token key atrule">qty</span><span class="token punctuation">:</span>
        <span class="token key atrule">type</span><span class="token punctuation">:</span> cds.Integer</code></pre>
<p>There are some technical differences, which are worth pointing out (there's always an opportunity to learn):</p>
<ul>
<li>there's still a composition <code>target</code> pointing to an entity definition, but here that is <code>S.Orders.Items</code>, a definition that's been created on the fly to help satisfy the composition requirements</li>
<li>this <code>S.Orders.Items</code> entity has a key element <code>up_</code> that points back to the parent</li>
<li>there's additional info at the <code>Items</code> element in the parent that captures the original anonymous aspect definition (in <code>targetAspect</code>)</li>
</ul>
<p>From a naming convention perspective, the name of the generated target entity is created using the parent entity as a prefix (<code>S.Orders</code>) to the composition element's name (<code>Items</code>), forming a <a href="https://cap.cloud.sap/docs/cds/cdl#scoped-names">scoped</a> name <code>S.Orders.Items</code>. And I would wager that it's unlikely that we as humans would use an underscore-suffixed name for an element, so <code>up_</code> is a good choice for the automatically generated pointer-to-parent element name.</p>
<h2 id="hybrid">Hybrid</h2>
<p>There is a middle ground, where named, rather than anonymous aspects can be used. You can read more about this in the <a href="https://cap.cloud.sap/docs/cds/cdl#with-named-targets">named targets</a> section of the Domain Modelling topic of Capire.</p>
<h2 id="wrapping-up">Wrapping up</h2>
<p>The CDS modelling language (and CDL specifically) is for humans. CSN is for machines. The distinction is not always top of mind, but if we try to keep it there, we'll end up with cleaner, simpler model definitions that are easier to reason about, easier to extend and reuse, and easier to maintain.</p>
<h2 id="footnotes">Footnotes</h2>
<ol>
<li>
<p>I piped the resulting YAML through <code>yq -y .</code> to pretty-print it, as I find the long(er) lines of the raw YAML output a little tough to digest.</p>
</li>
<li>
<p>I removed the metadata from the compiled YAML output:</p>
<pre class="language-yaml" tabindex="0"><code class="language-yaml"><span class="token key atrule">meta</span><span class="token punctuation">:</span>
  <span class="token key atrule">creator</span><span class="token punctuation">:</span> CDS Compiler v6.4.2
  <span class="token key atrule">flavor</span><span class="token punctuation">:</span> inferred
<span class="token key atrule">$version</span><span class="token punctuation">:</span> <span class="token number">2</span></code></pre>
<p>just to keep things a little more compact.</p>
</li>
</ol>



<script src="https://utteranc.es/client.js" repo="qmacro/qmacro.github.io" issue-term="title" crossorigin="anonymous" async=""></script>

<ul class="links-nextprev"><li class="links-nextprev-prev">← Previous<br> <a href="/blog/posts/2025/10/12/using-capire-modules-from-github-packages/">Using @capire modules from GitHub Packages</a></li><li class="links-nextprev-next">Next →<br><a href="/blog/posts/2025/10/20/quiet-cds-test-output-two-ways/">Quiet cds test output - two ways</a></li>
</ul>

			</heading-anchors>
		</main>

		<!-- This page `/blog/posts/2025/10/14/modelling-contained-in-relationships-with-compositions-in-cds/` was built on 2026-01-28T08:12:42.723Z -->
		<script type="module" src="/dist/t-8sxMV3B9.js"></script>
	</body>
</html>
