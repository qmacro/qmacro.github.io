<!doctype html><html lang="en"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1"><link rel="canonical" href="https://qmacro.org/blog/posts/2025/08/06/neovim-configuration-for-file-and-module-navigation-in-cds-models/"><link rel="alternate" type="application/atom+xml" title="DJ's Weblog - Feed" href="https://qmacro.org/feed.xml"><link href="/assets/main.54fe08380532f159e78f.css" rel="stylesheet"><link rel="preconnect" href="https://fonts.gstatic.com"><link href="https://fonts.googleapis.com/css2?family=IBM+Plex+Sans&display=swap" rel="stylesheet"><title>Neovim configuration for file and module navigation in CDS models | DJ Adams</title><link rel="icon" type="“image/x-icon”" href="/images/favicon.ico"><meta property="og:title" content="Neovim configuration for file and module navigation in CDS models"><meta property="og:site_name" content="DJ Adams"><meta property="og:type" content="website"><meta property="og:url" content="https://qmacro.org/blog/posts/2025/08/06/neovim-configuration-for-file-and-module-navigation-in-cds-models/"><meta name="description" content="Neovim configuration for file and module navigation in CDS models 06 Aug 2025 | 5 min read In this post I describe how I extended my..."><meta property="og:description" content="Neovim configuration for file and module navigation in CDS models 06 Aug 2025 | 5 min read In this post I describe how I extended my..."><meta name="description" content="Neovim configuration for file and module navigation in CDS models 06 Aug 2025 | 5 min read In this post I describe how I extended my..."><meta property="og:image" content="https://qmacro.org/images/site-image.png"><script src="https://cdn.jsdelivr.net/npm/mermaid/dist/mermaid.min.js"></script><script>mermaid.initialize({startOnLoad:true});</script><script async src="https://www.googletagmanager.com/gtag/js?id=G-4WQKBG0L4Y"></script><script>window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());

      gtag('config', 'G-4WQKBG0L4Y');</script></head><body><div class="layout-wrapper"><header class="header"><div class="header__content"><h1 class="site-title"><a href="/">DJ Adams</a></h1><nav class="nav"><ul class="nav__list"><li class="nav-item"><a href="/about">About Me</a></li><li class="nav-item"><a href="/blog">Blog</a></li><li class="nav-item"><a href="/feed.xml">Feed</a></li></ul></nav></div></header><main class="main"><article class="post"><header class="post__header"><h1>Neovim configuration for file and module navigation in CDS models</h1><div class="post__details"><time datetime="2025-08-06">06 Aug 2025 </time><span>| </span><span>5 min read</span></div></header><main class="post__content"><p><em>In this post I describe how I extended my Lua-based Neovim configuration for CDS filetypes to improve navigation to referenced files and modules.</em></p><h2>CDS modelling across files and modules</h2><p>In the context of CDS models, one of the best practices is to embrace <a href="https://cap.cloud.sap/docs/about/best-practices#aspects">aspects</a> and &quot;factor out separate concerns into separate files&quot;. In addition to files the CDS compiler supports Node.js packages (modules).</p><p>An example of both can be found in the <a href="https://cap.cloud.sap/docs/tools/cds-cli#sample">sample</a> facet. Let's create a project based on this sample facet and explore.</p><pre class="language-bash"><code class="language-bash"><span class="token punctuation">;</span> <span class="token builtin class-name">cd</span> /tmp <span class="token operator">&amp;&amp;</span> cds init <span class="token parameter variable">--add</span> sample sample <span class="token operator">&amp;&amp;</span> <span class="token builtin class-name">cd</span> sample <span class="token operator">&amp;&amp;</span> tree <span class="token parameter variable">-L</span> <span class="token number">3</span><br>creating new CAP project <span class="token keyword">in</span> ./sample<br><br>adding nodejs<br>adding sample<br><br>successfully created project – <span class="token builtin class-name">continue</span> with <span class="token builtin class-name">cd</span> sample<br><br><span class="token function">find</span> samples on https://github.com/SAP-samples/cloud-cap-samples<br>learn about next steps at https://cap.cloud.sap<br><span class="token builtin class-name">.</span><br>├── README.md<br>├── app<br>│   ├── _i18n<br>│   │   ├── i18n.properties<br>│   │   └── i18n_de.properties<br>│   ├── admin-books<br>│   │   ├── fiori-service.cds<br>│   │   └── webapp<br>│   ├── appconfig<br>│   │   └── fioriSandboxConfig.json<br>│   ├── browse<br>│   │   ├── fiori-service.cds<br>│   │   └── webapp<br>│   ├── common.cds<br>│   ├── index.html<br>│   └── services.cds<br>├── db<br>│   ├── data<br>│   │   ├── sap.capire.bookshop-Authors.csv<br>│   │   ├── sap.capire.bookshop-Books.csv<br>│   │   ├── sap.capire.bookshop-Books_texts.csv<br>│   │   └── sap.capire.bookshop-Genres.csv<br>│   └── schema.cds<br>├── eslint.config.mjs<br>├── package.json<br>└── srv<br>    ├── admin-service.cds<br>    ├── admin-service.js<br>    ├── cat-service.cds<br>    └── cat-service.js<br><br><span class="token number">11</span> directories, <span class="token number">20</span> files</code></pre><h3>Examining the 'using' references</h3><p>In <code>app/admin-books/fiori-service.cds</code> there's this:</p><pre class="language-cds"><code class="language-cds"><span class="token using keyword">using</span> { AdminService } <span class="token from keyword">from</span> '../../srv/admin-<span class="token keyword">service</span>.cds';<br><span class="token using keyword">using</span> { sap.capire.bookshop } <span class="token from keyword">from</span> '../../db/schema';<br>...</code></pre><p>So <code>AdminService</code> is being imported from <code>../../srv/admin-service.cds</code>, which looks like this:</p><pre class="language-cds"><code class="language-cds"><span class="token using keyword">using</span> { sap.capire.bookshop <span class="token cqlkeywords keyword">as</span> my } <span class="token from keyword">from</span> '../db/schema';<br><span class="token keyword">service</span> AdminService <span class="token annotation important">@(requires:'admin')</span> {<br>  <span class="token keyword">entity</span> Books <span class="token cqlkeywords keyword">as</span> <span class="token cdl-keyword keyword">projection</span> <span class="token cqlkeywords keyword">on</span> my.Books;<br>  <span class="token keyword">entity</span> Authors <span class="token cqlkeywords keyword">as</span> <span class="token cdl-keyword keyword">projection</span> <span class="token cqlkeywords keyword">on</span> my.Authors;<br>}</code></pre><p>In turn, the entities here are from the <code>sap.capire.bookshop</code> namespace which is imported from <code>../db/schema</code>, which looks like this:</p><pre class="language-cds"><code class="language-cds"><span class="token using keyword">using</span> { Currency, managed, sap } <span class="token from keyword">from</span> '@sap/cds/common';<br><span class="token keyword">namespace</span> sap.capire.bookshop;<br><br><span class="token keyword">entity</span> Books : managed {<br>   ...<br>}</code></pre><p>And <code>Currency</code>, <code>managed</code> and <code>sap</code> are imported from the module <code>@sap/cds/common</code>, a file (<code>common.cds</code>) within the <code>@sap/cds</code> module, which (at this point) is available in the globally installed <code>@sap/cds-dk</code> module location (as we haven't performed a project-local <code>npm install</code> yet), and looks like this (heavily redacted):</p><pre class="language-cds"><code class="language-cds"><span class="token cqlkeywords keyword">type</span> Currency : <span class="token association-composition keyword">Association to sap</span>.common.Currencies;<br>...<br><span class="token keyword">aspect</span> managed {<br>  createdAt  : <span class="token type builtin">Timestamp </span><span class="token annotation important">@cds.on.insert</span> : $now;<br>  createdBy  : User      <span class="token annotation important">@cds.on.insert</span> : $user;<br>  modifiedAt : <span class="token type builtin">Timestamp </span><span class="token annotation important">@cds.on.insert</span> : $now  <span class="token annotation important">@cds.on.update</span> : $now;<br>  modifiedBy : User      <span class="token annotation important">@cds.on.insert</span> : $user <span class="token annotation important">@cds.on.update</span> : $user;<br>}<br>...</code></pre><h3>Visualising the navigation path</h3><p>Here's what these relations (and navigations) look like in &quot;diagram&quot; form (thanks to <a href="https://asciiflow.com/#/">ASCIIFlow</a>):</p><pre class="language-text"><code class="language-text">+-----------------------------+<br>|app/admin/fiori-service.cds  |<br>+-----------------------------+<br>|using ... from               |<br>|'../../srv/admin-service.cds'|<br>|             |              1|<br>+-------------|---------------+   +-----------------------------+<br>              +-------------------|srv/admin-service.cds        |<br>                                  +-----------------------------+<br>                                  |using ... from               |<br>                                  |'../db/schema.cds'           |<br>                                  |            |               2|<br>+-----------------------------+   +------------|----------------+<br>|db/schema.cds                |----------------+<br>+-----------------------------+<br>|using ... from               |<br>|'@sap/cds/common'            |<br>|             |              3|<br>+-------------|---------------+   +-----------------------------+<br>              +-------------------|@sap/cds/common              |<br>                                  +-----------------------------+<br>                                  |type Currency ...            |<br>                                  |aspect managed { ... }       |<br>                                  |                            4|<br>                                  +-----------------------------+</code></pre><blockquote><p>As mentioned earlier, the <code>@sap/cds/common</code> resource is a file called <code>common.cds</code> within the <code>@sap/cds</code> module.</p></blockquote><p>What's notable is that these relations are expressed differently each time:</p><ul><li>the first points to <code>../../srv/admin-service.cds</code> which has an explicit <code>.cds</code> extension</li><li>the second points to <code>../db/schema</code> which has no extension</li><li>the third points to a Node.js module based resource <code>@sap/cds/common</code>, again with no extension specified</li></ul><p>Here's a quick demo of how that navigation path can be followed in VS Code, with the <a href="https://marketplace.visualstudio.com/items?itemName=SAPSE.vscode-cds">SAP CDS Language Support</a> extension:</p><p><img src="/images/2025/08/vscode-nav.gif" alt="navigation in VS Code"></p><h2>Making CDS model navigation work in Neovim</h2><p>With the <code>@sap/cds-lsp</code> language server in play, plus the Tree-sitter queries for CDS, I have a good experience in Neovim already (see <a href="/blog/posts/2025/06/10/a-modern-and-clean-neovim-setup-for-cap-node.js-configuration-and-diagnostics/">A modern and clean Neovim setup for CAP Node.js - configuration and diagnostics</a>).</p><p>However, using the standard <a href="https://neovim.io/doc/user/editing.html#gf">gf</a> mechanism left me wanting, due to the types of navigation target and the vagaries of how they are expressed. With a little configuration though, (which is still experimental at this stage, as I'm still learning) I've improved the situation.</p><p>I added some <a href="https://neovim.io/doc/user/usr_41.html#_writing-a-filetype-plugin">ftplugin</a> configuration specific to CDS files, in an <code>after/ftplugin/cds.lua</code> file within my Neovim config, and it looks like this:</p><pre class="language-lua"><code class="language-lua"><span class="token comment">-- Settings to be able to navigate to cds resources in Node.js modules</span><br><br><span class="token comment">-- Given a path p, add it to the 'path' if it exists</span><br><span class="token keyword">local</span> addpath <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span>p<span class="token punctuation">)</span><br>  <span class="token keyword">if</span> vim<span class="token punctuation">.</span>uv<span class="token punctuation">.</span><span class="token function">fs_stat</span><span class="token punctuation">(</span>p<span class="token punctuation">)</span> <span class="token keyword">then</span> vim<span class="token punctuation">.</span>opt<span class="token punctuation">.</span>path<span class="token punctuation">:</span><span class="token function">append</span><span class="token punctuation">(</span>p<span class="token punctuation">)</span> <span class="token keyword">end</span><br><span class="token keyword">end</span><br><br><span class="token comment">-- Auto add .cds extension to files if necessary when nav with gf</span><br>vim<span class="token punctuation">.</span>opt<span class="token punctuation">.</span>suffixesadd <span class="token operator">=</span> <span class="token string">'.cds'</span><br><br><span class="token comment">-- Ensure that the literal @ symbol is treated as part of a filename</span><br><span class="token comment">-- (required as the CAP module names are in the @sap namespace)</span><br>vim<span class="token punctuation">.</span>opt<span class="token punctuation">.</span>isfname<span class="token punctuation">:</span>append <span class="token string">'@-@'</span><br><br><span class="token comment">-- The standard module location</span><br><span class="token keyword">local</span> moduledir <span class="token operator">=</span> <span class="token string">'/node_modules'</span><br><br><span class="token comment">-- If a project-local npm install has been executed then projpath</span><br><span class="token comment">-- will reflect the project-local node_modules dir</span><br><span class="token keyword">local</span> projpath <span class="token operator">=</span> vim<span class="token punctuation">.</span>fs<span class="token punctuation">.</span><span class="token function">root</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token string">'package.json'</span><span class="token punctuation">)</span> <span class="token operator">..</span> moduledir<br><br><span class="token comment">-- We can also add the CAP global based node_modules dir,</span><br><span class="token comment">-- based on the location of the 'cds' executable</span><br><span class="token keyword">local</span> cdsdkpath <span class="token operator">=</span> vim<span class="token punctuation">.</span>fs<span class="token punctuation">.</span><span class="token function">dirname</span><span class="token punctuation">(</span>vim<span class="token punctuation">.</span>fn<span class="token punctuation">.</span><span class="token function">exepath</span><span class="token punctuation">(</span><span class="token string">'cds'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><br>    <span class="token operator">..</span> <span class="token string">'/../lib/node_modules/@sap/cds-dk'</span><br>    <span class="token operator">..</span> moduledir<br><br><span class="token comment">-- Add them if they exist</span><br><span class="token function">addpath</span><span class="token punctuation">(</span>projpath<span class="token punctuation">)</span><br><span class="token function">addpath</span><span class="token punctuation">(</span>cdsdkpath<span class="token punctuation">)</span></code></pre><p>Here's a quick summary:</p><p>I have a simple function <code>addpath</code> which will add a (path) value to <code>path</code> option, which the help describes as &quot;a list of directories which will be searched when using <code>gf</code> ... and other commands&quot;. The function uses <a href="https://neovim.io/doc/user/lua.html#vim.fs.exists()">uv.fs_stat</a> to ensure the directory actually exists before adding it.</p><p>The <code>suffixesadd</code> option (via <a href="https://neovim.io/doc/user/options.html#'suffixesadd'">vim.opt.suffixesadd</a>) is also related to the use of <code>gf</code> and is a &quot;comma-separated list of suffixes, which are used when searching for a file for the <code>gf</code>, <code>[I</code>, etc. commands&quot;. So here I add <code>.cds</code> to this option for the case where an extension isn't given - like in this case:</p><pre class="language-cds"><code class="language-cds"><span class="token using keyword">using</span> { sap.capire.bookshop <span class="token cqlkeywords keyword">as</span> my } <span class="token from keyword">from</span> '../db/schema';</code></pre><blockquote><p>The extension is omitted here as a sort of CAP best practice, and could in fact be <code>.csn</code>, the compiled machine-readable equivalent of CDL (the human-readable language used in CDS model files). But I'll cross that bridge when I come to it.</p></blockquote><p>That's it with regards to handling navigation to other CDS model files. But navigation to Node.js modules requires a bit more fettling.</p><p>The CAP modules are all in the <code>sap</code> namespace. Namespaces, or <a href="https://docs.npmjs.com/about-scopes">scopes</a>, are prefixed with the <code>@</code> symbol (as in <code>@sap/cds</code>, for example). When modules are installed, in the <code>node_modules/</code> directory, the <code>@</code>-prefixed namespace forms part of the directory structure. So in this <code>sample</code> project, after running <code>npm install</code>, here's where <code>@sap/cds/common</code> is to be found:</p><pre class="language-text"><code class="language-text">node_modules/<br>├── @cap-js<br>│   ├── cds-types<br>│   │   ├── ...<br>│   │   └── scripts<br>│   ├── db-service<br>│   │   ├── ...<br>│   │   └── package.json<br>│   └── sqlite<br>│       ├── ...<br>│       └── package.json<br>└── @sap<br>    └── cds<br>        ├── CHANGELOG.md<br>        ├── LICENSE<br>        ├── README.md<br>        ├── _i18n<br>        ├── app<br>        ├── bin<br>  --->  ├── common.cds<br>        ├── eslint.config.mjs<br>        ├── lib<br>        ├── libx<br>        ├── package.json<br>        ├── server.js<br>        ├── srv<br>        └── tasks</code></pre><p>That means I need to add the literal <code>@</code> symbol to the <a href="https://neovim.io/doc/user/options.html#'isfname'">isfname</a> option, which denotes the characters included in filenames. If we look at the default value for <code>isfname</code> (with <code>:set isfname?</code>) we see this:</p><pre class="language-text"><code class="language-text">@,48-57,/,.,-,_,+,,,#,$,%,~,=</code></pre><p>But <code>@</code> here represents &quot;alpha characters&quot;, and to have the actual <code>@</code> symbol included, one needs to add <code>@-@</code>.</p><p>Once that is done, it's just a question of determining:</p><ul><li>the CAP Node.js project's root directory (with <code>vim.fs.root(0, 'package.json')</code>)</li><li>the location of the globally installed <code>@sap/cds-dk</code> module, based on where the <code>cds</code> executable can be found</li></ul><p>Then, <code>/node_modules</code> is appended to each, and they're both passed to the <code>addpath</code> function defined earlier.</p><p>Once either or both these paths are in the <code>path</code> option (depending on whether they exist or not), <code>gf</code> based navigation can proceed successfully!</p><h2>Wrapping up</h2><p>This was a quick configuration hack in an area of Neovim (well, Vim, I guess) that I hadn't previously much experience in. So it may need some more tweaking. But for now, it works well, as shown here:</p><p><img src="/images/2025/08/neovim-nav.gif" alt="navigation in Neovim"></p><blockquote><p>In VS Code each newly navigated-to resource was opened in a separate tab by default. In Neovim they're opened in the same buffer, so to return to the previous resource in the &quot;jump list&quot; one can use <code>ctrl-o</code>.</p></blockquote><h2>See also</h2><ul><li><a href="/blog/posts/2025/06/10/a-modern-and-clean-neovim-setup-for-cap-node.js-configuration-and-diagnostics/">A modern and clean Neovim setup for CAP Node.js - configuration and diagnostics</a></li><li><a href="/blog/posts/2025/08/04/excluding-specific-diagnostics-in-neovim/">Excluding specific diagnostics in Neovim</a></li></ul></main><aside class="post__aside"><div class="post__tags"><a href="/tags/neovim/">#neovim</a> <a href="/tags/cds/">#cds</a> <a href="/tags/lua/">#lua</a> <a href="/tags/cap/">#cap</a></div><style>.utterances {
  margin-left: inherit !important;
}</style><script src="https://utteranc.es/client.js" repo="qmacro/qmacro.github.io" issue-term="title" crossorigin="anonymous" async></script><nav class="post__pagination"><a href="/blog/posts/2025/09/01/auto-formatting-extensionless-bash-scripts-in-neovim/"><span>←</span> <span>Auto formatting extensionless Bash scripts in Neovim</span> </a><a href="/blog/posts/2025/08/04/excluding-specific-diagnostics-in-neovim/"><span>Excluding specific diagnostics in Neovim</span> <span>→</span></a></nav></aside></article></main><footer class="footer"><div class="footer__content"><ul class="hero__social-links"><li><a rel="me" href="https://github.com/qmacro" target="_blank" rel="noopener noreferrer">GitHub</a></li><li><a rel="me" href="https://www.youtube.com/djadams-qmacro" target="_blank" rel="noopener noreferrer">YouTube</a></li><li><a rel="me" href="https://www.linkedin.com/in/djadams/" target="_blank" rel="noopener noreferrer">LinkedIn</a></li><li><a rel="me" href="/tweets/">Tweet Archive</a></li><li><a rel="me" href="https://hachyderm.io/@qmacro" target="_blank" rel="noopener noreferrer">Mastodon</a></li><li><a rel="me" href="https://bsky.app/profile/qmacro.org" target="_blank" rel="noopener noreferrer">Bluesky</a></li><li><a href="/feed.xml" target="_blank" rel="noopener noreferrer">RSS</a></li></ul></div></footer></div><script src="/assets/main.31d6cfe0d16ae931b73c.js"></script></body></html>