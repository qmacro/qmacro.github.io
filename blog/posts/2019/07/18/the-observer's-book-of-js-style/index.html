<!doctype html><html lang="en"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1"><link rel="canonical" href="https://qmacro.org/blog/posts/2019/07/18/the-observer&#39;s-book-of-js-style/"><link href="/assets/main.abc736e4654d9e4a3a50.css" rel="stylesheet"><link rel="preconnect" href="https://fonts.gstatic.com"><link href="https://fonts.googleapis.com/css2?family=IBM+Plex+Sans&display=swap" rel="stylesheet"><title>The Observer&#39;s Book of JS Style | DJ Adams</title><link rel="icon" type="“image/x-icon”" href="/images/favicon.ico"><meta property="og:title" content="The Observer&#39;s Book of JS Style"><meta property="og:site_name" content="DJ Adams"><meta property="og:type" content="website"><meta property="og:url" content="https://qmacro.org/blog/posts/2019/07/18/the-observer&#39;s-book-of-js-style/"><meta name="twitter:card" content="summary_large_image"><meta name="twitter:creator" content="@qmacro"><meta name="description" content="The Observer&amp;#39;s Book of JS Style 18 Jul 2019 | 4 min read In the 1970&#39;s I had a book which I cherished: The Observer&#39;s Book of Commercial..."><meta property="og:description" content="The Observer&amp;#39;s Book of JS Style 18 Jul 2019 | 4 min read In the 1970&#39;s I had a book which I cherished: The Observer&#39;s Book of Commercial..."><meta name="description" content="The Observer&amp;#39;s Book of JS Style 18 Jul 2019 | 4 min read In the 1970&#39;s I had a book which I cherished: The Observer&#39;s Book of Commercial..."><meta property="og:image" content="https://qmacro.org/images/DJA-head.png"><meta name="twitter:image" content="https://qmacro.org/images/DJA-head.png"><script src="https://cdn.jsdelivr.net/npm/mermaid/dist/mermaid.min.js"></script><script>mermaid.initialize({startOnLoad:true});</script><script async src="https://www.googletagmanager.com/gtag/js?id=G-4WQKBG0L4Y"></script><script>window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());

      gtag('config', 'G-4WQKBG0L4Y');</script></head><body><div class="layout-wrapper"><header class="header"><div class="header__content"><h1 class="site-title"><a href="/">DJ Adams</a></h1><nav class="nav"><ul class="nav__list"><li class="nav-item"><a href="/about">About Me</a></li><li class="nav-item"><a href="/talks">Talks</a></li><li class="nav-item"><a href="/blog">Blog</a></li><li class="nav-item"><a href="/feed.xml">Feed</a></li></ul></nav></div></header><main class="main"><article class="post"><header class="post__header"><h1>The Observer&#39;s Book of JS Style</h1><div class="post__details"><time datetime="2019-07-18">18 Jul 2019 </time><span>| </span><span>4 min read</span></div></header><main class="post__content"><p><img src="/images/2019/07/observersbook.png" alt="Observer's Book of Commercial Vehicles - cover"></p><p>In the 1970's I had a book which I cherished: <a href="https://www.goodreads.com/book/show/46652855-observer-s-book-of-commercial-vehicles">The Observer's Book of Commercial Vehicles</a>. It was pocket-sized &amp; well thumbed, and listed various vans and trucks. I could identify a Volvo F88 tractor unit from 500 paces.</p><p>I guess the interest in spotting and identifying things of interest has never left me, and so I find myself delighting in various examples of style with respect to expressing oneself in code. These days it's mostly in the context of JavaScript; unlike other languages, JavaScript is not only multi-paradigm but extremely malleable, making it possible to leave behind a trace of one's character, often by accident.</p><p>This post is to record some of those characterful or otherwise interesting expressions in code, taken predominantly from the Node.js codebase for the SAP Cloud Application Programming (CAP) Model.</p><h1><strong>File: @sap/cds/server.js</strong></h1><p>Who knew there could be so much richness to write about in a single file of fewer than 100 lines? This is the main server mechanism, in the form of a <code>server.js</code> file in <code>@sap/cds</code>, that uses the <a href="https://expressjs.com/">Express</a> web framework to serve resources both static and dynamic.</p><p>If you want to see this code in context, or even get it running in your favourite debugging setup to examine things step by step, pull the <code>@sap/cds</code> package from <a href="https://npm.sap.com">SAP's NPM registry</a>, dig in to the sources, and have a look.</p><h3>Object destructuring with default value</h3><pre class="language-javascript"><code class="language-javascript"><span class="token keyword">const</span> <span class="token punctuation">{</span> <span class="token constant">PORT</span><span class="token operator">=</span><span class="token number">4004</span> <span class="token punctuation">}</span> <span class="token operator">=</span> process<span class="token punctuation">.</span>env<br><span class="token keyword">return</span> app<span class="token punctuation">.</span><span class="token function">listen</span> <span class="token punctuation">(</span><span class="token constant">PORT</span><span class="token punctuation">)</span></code></pre><p>This is a lovely example of <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Operators/Destructuring_assignment#Object_destructuring">object destructuring</a> in action, with a bonus application of the default values option. Plus of course the appropriate use of a constant. This takes whatever value the PORT environmental variable might have, falling back to a default of 4004 if a value wasn't set.</p><p>The other thing that stands out to me is a particular affectation that I'm still not sure about - the use of whitespace before the brackets in the <code>app.listen</code> call. It does make the code feel more like a spoken language, somehow; here's another example of that use of whitespace from the same file:</p><pre class="language-javascript"><code class="language-javascript"><span class="token keyword">await</span> cds<span class="token punctuation">.</span><span class="token function">serve</span> <span class="token punctuation">(</span>models<span class="token punctuation">,</span>o<span class="token punctuation">)</span> <span class="token punctuation">.</span><span class="token function">in</span> <span class="token punctuation">(</span>app<span class="token punctuation">)</span></code></pre><p>I think I like it.</p><h3>Ignored parameters</h3><pre class="language-javascript"><code class="language-javascript">app<span class="token punctuation">.</span><span class="token function">get</span> <span class="token punctuation">(</span><span class="token string">'/'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">_<span class="token punctuation">,</span>res</span><span class="token punctuation">)</span> <span class="token operator">=></span> res<span class="token punctuation">.</span><span class="token function">send</span> <span class="token punctuation">(</span>index<span class="token punctuation">.</span>html<span class="token punctuation">)</span><span class="token punctuation">)</span>  <span class="token comment">//> if none in ./app</span></code></pre><p>The use of the undercore (<code>_</code>) here is not particular to JavaScript nor uncommon, but it's nice to see it in use here. As a sort of placeholder for a parameter that we're not interested in using in the function that is passed to <code>app.get</code>, the underscore is for me the perfect character to use.</p><p>If you're familiar with HTTP server libraries, you'll be able to guess what that parameter is that is being ignored. An HTTP handler function is usually passed the incoming HTTP request object, and the fledgling HTTP response object. The response object is the only thing that is important here, so the signature is</p><pre class="language-javascript"><code class="language-javascript"><span class="token punctuation">(</span><span class="token parameter">_<span class="token punctuation">,</span>res</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token operator">...</span></code></pre><p>rather than</p><pre class="language-javascript"><code class="language-javascript"><span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span>res</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token operator">...</span></code></pre><h3>Getter and fake filename</h3><p>Did you notice something odd in that previous example? There was a call to <code>res.send</code> like this:</p><pre class="language-javascript"><code class="language-javascript">res<span class="token punctuation">.</span><span class="token function">send</span> <span class="token punctuation">(</span>index<span class="token punctuation">.</span>html<span class="token punctuation">)</span></code></pre><p>At first I was only semi-aware of something not quite right about the way that appeared. But then looking further down in the code, I suddenly realised. <code>index.html</code> is not a filename ... it's a property (<code>html</code>) on an object (<code>index</code>)! Further down, we come across this, where it's defined:</p><pre class="language-javascript"><code class="language-javascript"><span class="token keyword">const</span> index <span class="token operator">=</span> <span class="token punctuation">{</span> <span class="token keyword">get</span> <span class="token function">html</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>  <span class="token operator">...</span><br>  <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>_html <span class="token operator">=</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string"><br>    &lt;html><br>      &lt;head><br>        ...<br>  </span><span class="token template-punctuation string">`</span></span><br><span class="token punctuation">}</span><span class="token punctuation">}</span></code></pre><p>I've not seen the use of a <code>getter</code> in the wild that often. According to <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Functions/get">the MDN web docu on 'getter'</a>:</p><p>&quot;The <code>get</code> syntax binds an object property to a function that will be called when that property is looked up&quot;.</p><p>Put simply, you can define properties on an object whose values are dynamic, resolved by a call to a function. Of course, you can also define functions as property values, but that would mean that you'd have to use the call syntax, i.e. <code>index.html()</code> in this case. But given the emphasis on something that's more readable than normal, I can see why a getter was used here. Although I think it might take a bit of getting used to.</p><h3>More destructuring</h3><p>Now the cat is out of the bag, it gets everywhere! I wanted to include this example of destructuring because at first I was scratching my head over the line, but then after staring at it for a few seconds I realised what I was looking at.</p><pre class="language-javascript"><code class="language-javascript"><span class="token keyword">const</span> <span class="token punctuation">{</span> isfile <span class="token punctuation">}</span> <span class="token operator">=</span> cds<span class="token punctuation">.</span>utils<span class="token punctuation">,</span> <span class="token punctuation">{</span>app<span class="token punctuation">}</span> <span class="token operator">=</span> cds<span class="token punctuation">.</span>env<span class="token punctuation">.</span>folders<span class="token punctuation">,</span> <span class="token punctuation">{</span>join<span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'path'</span><span class="token punctuation">)</span><br><span class="token keyword">const</span> _has_fiori_html <span class="token operator">=</span> <span class="token function">isfile</span> <span class="token punctuation">(</span><span class="token function">join</span> <span class="token punctuation">(</span>app<span class="token punctuation">,</span><span class="token string">'fiori.html'</span><span class="token punctuation">)</span><span class="token punctuation">)</span></code></pre><p>(I'm including the second line only to give a bit of usage context).</p><p>Part of the reason this had me wondering was simply due to the whitespace - I guess the author was in a hurry as the spacing is not consistent. I thought there was something special about the first pair of braces around <code>isfile</code>, but in fact it's just three separate constant declarations, all on the same line: <code>isfile</code>, <code>app</code> and then <code>join</code>.</p><p>The value for each is resolved through destructuring. For example, the <code>app</code> constant comes from the <code>cds.env.folders</code> property which itself has a number of child properties, one of which is <code>app</code>. <code>cds.env</code> is part of CAP's Node.js API, and provides access to an effective environment computed from different layers of configuration.</p><p>Going one example further, the <code>join</code> constant ends up having the value of <code>join</code> in the Node.js builtin <code>path</code> package (the value is a function), as you can see in this snippet from a Node.js REPL session:</p><pre><code>=&gt; node
&gt; require('path')
{ resolve: [Function: resolve],
  normalize: [Function: normalize],
  isAbsolute: [Function: isAbsolute],
  join: [Function: join],
  relative: [Function: relative],
  ...
</code></pre><p>Anyway, while there's more to explore and pore over, I'll leave it here for now. Who knows, I may write another one of these covering more finds in the source code. If you're interested, <a href="https://twitter.com/qmacro">let me know</a>.</p></main><aside class="post__aside"><div class="post__tags"><a href="/tags/language-ramblings/">#language-ramblings</a></div><style>.utterances {
  margin-left: inherit !important;
}</style><script src="https://utteranc.es/client.js" repo="qmacro/qmacro.github.io" issue-term="title" crossorigin="anonymous" async></script><nav class="post__pagination"><a href="/blog/posts/2019/07/29/we-can-do-better-than-&#39;polynimbus&#39;/"><span>←</span> <span>We can do better than &#39;polynimbus&#39;</span> </a><a href="/blog/posts/2019/07/11/david-edward-adams/"><span>David Edward Adams</span> <span>→</span></a></nav></aside></article></main><footer class="footer"><div class="footer__content"><ul class="hero__social-links"><li><a href="https://github.com/qmacro" target="_blank" rel="noopener noreferrer">GitHub</a></li><li><a href="https://www.youtube.com/djadams-qmacro" target="_blank" rel="noopener noreferrer">YouTube</a></li><li><a href="https://twitter.com/qmacro" target="_blank" rel="noopener noreferrer">Twitter</a></li><li><a href="/feed.xml" target="_blank" rel="noopener noreferrer">RSS</a></li></ul></div></footer></div><script src="/assets/main.31d6cfe0d16ae931b73c.js"></script></body></html>