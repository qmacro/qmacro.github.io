<!doctype html>
<html lang="en">
	<head>
		<meta charset="utf-8">
		<meta name="viewport" content="width=device-width, initial-scale=1.0">
		<title>Monday morning thoughts: growth is upwards</title>
		<meta name="description" content="Reserving the right to be wrong.">
		<link rel="alternate" href="/feed/feed.xml" type="application/atom+xml" title="DJ Adams">
		<link rel="icon" type="image/x-icon" href="/images/favicon.ico">
		
		
		
		<style>/* This is an arbitrary CSS string added to the bundle */
/* Defaults */
:root {
	--font-family: -apple-system, system-ui, sans-serif;
	--font-family-monospace: Consolas, Menlo, Monaco, Andale Mono WT, Andale Mono, Lucida Console, Lucida Sans Typewriter, DejaVu Sans Mono, Bitstream Vera Sans Mono, Liberation Mono, Nimbus Mono L, Courier New, Courier, monospace;
}

/* Theme colors */
:root {
	--color-gray-20: #e0e0e0;
	--color-gray-50: #C0C0C0;
	--color-gray-90: #333;

	--background-color: #fff;

	--text-color: var(--color-gray-90);
	--text-color-link: #2884d2;
	--text-color-link-active: #15b0ed;
	--text-color-link-visited: #9f4199;

	--syntax-tab-size: 2;
}

@media (prefers-color-scheme: dark) {
	:root {
		--color-gray-20: #e0e0e0;
		--color-gray-50: #C0C0C0;
		--color-gray-90: #dad8d8;

		/* --text-color is assigned to --color-gray-_ above */
		--text-color-link: #1493fb;
		--text-color-link-active: #6969f7;
		--text-color-link-visited: #a6a6f8;

		--background-color: #15202b;
	}
}


/* Global stylesheet */
* {
	box-sizing: border-box;
}

@view-transition {
	navigation: auto;
}

html,
body {
	padding: 0;
	margin: 0 auto;
	font-family: var(--font-family);
	color: var(--text-color);
	background-color: var(--background-color);
}
html {
	overflow-y: scroll;
}
body {
	max-width: 40em;
}

/* https://www.a11yproject.com/posts/how-to-hide-content/ */
.visually-hidden:not(:focus):not(:active) {
	clip: rect(0 0 0 0);
	clip-path: inset(50%);
	height: 1px;
	overflow: hidden;
	position: absolute;
	white-space: nowrap;
	width: 1px;
}

/* Fluid images via https://www.zachleat.com/web/fluid-images/ */
img{
  max-width: 100%;
}
img[width][height] {
  height: auto;
}
img[src$=".svg"] {
  width: 100%;
  height: auto;
  max-width: none;
}
video,
iframe {
	width: 100%;
	height: auto;
}
iframe {
	aspect-ratio: 16/9;
}

p:last-child {
	margin-bottom: 0;
}
p {
	line-height: 1.5;
}

li {
	line-height: 1.5;
}

a[href] {
	color: var(--text-color-link);
}
a[href]:visited {
	color: var(--text-color-link-visited);
}
a[href]:hover,
a[href]:active {
	color: var(--text-color-link-active);
}

main,
footer {
	padding: 1rem;
}
/* main :first-child { */
/* 	margin-top: 0; */
/* } */

header {
	border-bottom: 1px dashed var(--color-gray-20);
}

#skip-link {
	text-decoration: none;
	background: var(--background-color);
	color: var(--text-color);
	padding: 0.5rem 1rem;
	border: 1px solid var(--color-gray-90);
	border-radius: 2px;
}

/* Prevent visually-hidden skip link fom pushing content around when focused */
#skip-link.visually-hidden:focus {
	position: absolute;
	top: 1rem;
	left: 1rem;
	/* Ensure it is positioned on top of everything else when it is shown */
	z-index: 999;
}

.links-nextprev {
	display: flex;
	justify-content: space-between;
	gap: .5em 1em;
	list-style: "";
	border-top: 1px dashed var(--color-gray-20);
	padding: 1em 0;
}
.links-nextprev > * {
	flex-grow: 1;
}
.links-nextprev-next {
	text-align: right;
}

table {
	margin: 1em 0;
}
table td,
table th {
	padding-right: 1em;
}

pre,
code {
	font-family: var(--font-family-monospace);
	color: seagreen;
}

pre,code[class*="language-"] {
	line-height: 1.2em !important;
	font-size: 0.93em !important;
}

pre:not([class*="language-"]) {
	margin: .5em 0;
	line-height: 1.375; /* 22px /16 */
	-moz-tab-size: var(--syntax-tab-size);
	-o-tab-size: var(--syntax-tab-size);
	tab-size: var(--syntax-tab-size);
	-webkit-hyphens: none;
	-ms-hyphens: none;
	hyphens: none;
	direction: ltr;
	text-align: left;
	white-space: pre;
	word-spacing: normal;
	word-break: normal;
	overflow-x: auto;
}
code {
	word-break: break-all;
}

/* Header */
header {
	display: flex;
	gap: 1em;
	flex-wrap: wrap;
	justify-content: space-between;
	align-items: center;
	padding: 1em;
}
.home-link {
	flex-grow: 1;
	font-size: 1em; /* 16px /16 */
	font-weight: 700;
}
.home-link:link:not(:hover) {
	text-decoration: none;
}

/* Nav */
.nav {
	display: flex;
	gap: .5em 1em;
	padding: 0;
	margin: 0;
	list-style: none;
}
.nav-item {
	display: inline-block;
}
.nav-item a[href]:not(:hover) {
	text-decoration: none;
}
.nav a[href][aria-current="page"] {
	text-decoration: underline;
}

/* Posts list */
.postlist {
	counter-reset: start-from var(--postlist-index);
	list-style: none;
	padding: 0;
}
.postlist-item {
	display: flex;
	flex-wrap: wrap;
	align-items: baseline;
	counter-increment: start-from -1;
	margin-bottom: 1em;
}
.postlist-item:before {
	display: inline-block;
	pointer-events: none;
	line-height: 100%;
	text-align: right;
	margin-left: -1.5rem;
}
.postlist-date,
.postlist-item:before {
	font-size: 0.8125em; /* 13px /16 */
	color: var(--color-gray-90);
}
.postlist-date {
	word-spacing: -0.5px;
}
.postlist-link {
	font-size: 1.1875em; /* 19px /16 */
	font-weight: 700;
	flex-basis: calc(100% - 1.5rem);
	text-underline-position: from-font;
	text-underline-offset: 0;
	text-decoration-thickness: 1px;
}
.postlist-item-active .postlist-link {
	font-weight: bold;
}

/* Tags */
.post-tag {
	display: inline-flex;
	align-items: center;
	justify-content: center;
	font-style: italic;
}

/* may want to make the description text smaller at some stage */
.post-description-list {
	font-size: 1.0em;
}

.post-description-main {
	font-style: italic;
}

.postlist-item > .post-tag {
	align-self: center;
}

/* Tags list */
.post-metadata {
	display: inline-flex;
	flex-wrap: wrap;
	gap: .5em;
	list-style: none;
	padding: 0;
	margin: 0;
}
.post-metadata time {
	margin-right: 1em;
}

blockquote {
	margin-top: 0px;
	margin-left: 0px;
	margin-bottom: 15px;
	padding-left: 15px;
	border-left: 5px solid lightgray;
}
/**
 * prism.js default theme for JavaScript, CSS and HTML
 * Based on dabblet (http://dabblet.com)
 * @author Lea Verou
 */

code[class*="language-"],
pre[class*="language-"] {
	color: black;
	background: none;
	text-shadow: 0 1px white;
	font-family: Consolas, Monaco, 'Andale Mono', 'Ubuntu Mono', monospace;
	font-size: 1em;
	text-align: left;
	white-space: pre;
	word-spacing: normal;
	word-break: normal;
	word-wrap: normal;
	line-height: 1.5;

	-moz-tab-size: 4;
	-o-tab-size: 4;
	tab-size: 4;

	-webkit-hyphens: none;
	-moz-hyphens: none;
	-ms-hyphens: none;
	hyphens: none;
}

pre[class*="language-"]::-moz-selection, pre[class*="language-"] ::-moz-selection,
code[class*="language-"]::-moz-selection, code[class*="language-"] ::-moz-selection {
	text-shadow: none;
	background: #b3d4fc;
}

pre[class*="language-"]::selection, pre[class*="language-"] ::selection,
code[class*="language-"]::selection, code[class*="language-"] ::selection {
	text-shadow: none;
	background: #b3d4fc;
}

@media print {
	code[class*="language-"],
	pre[class*="language-"] {
		text-shadow: none;
	}
}

/* Code blocks */
pre[class*="language-"] {
	padding: 1em;
	margin: .5em 0;
	overflow: auto;
}

:not(pre) > code[class*="language-"],
pre[class*="language-"] {
	background: #f5f2f0;
}

/* Inline code */
:not(pre) > code[class*="language-"] {
	padding: .1em;
	border-radius: .3em;
	white-space: normal;
}

.token.comment,
.token.prolog,
.token.doctype,
.token.cdata {
	color: slategray;
}

.token.punctuation {
	color: #999;
}

.token.namespace {
	opacity: .7;
}

.token.property,
.token.tag,
.token.boolean,
.token.number,
.token.constant,
.token.symbol,
.token.deleted {
	color: #905;
}

.token.selector,
.token.attr-name,
.token.string,
.token.char,
.token.builtin,
.token.inserted {
	color: #690;
}

.token.operator,
.token.entity,
.token.url,
.language-css .token.string,
.style .token.string {
	color: #9a6e3a;
	/* This background color was intended by the author of this theme. */
	background: hsla(0, 0%, 100%, .5);
}

.token.atrule,
.token.attr-value,
.token.keyword {
	color: #07a;
}

.token.function,
.token.class-name {
	color: #DD4A68;
}

.token.regex,
.token.important,
.token.variable {
	color: #e90;
}

.token.important,
.token.bold {
	font-weight: bold;
}
.token.italic {
	font-style: italic;
}

.token.entity {
	cursor: help;
}
/*
 * New diff- syntax
 */

pre[class*="language-diff-"] {
	--eleventy-code-padding: 1.25em;
	padding-left: var(--eleventy-code-padding);
	padding-right: var(--eleventy-code-padding);
}
.token.deleted {
	background-color: hsl(0, 51%, 37%);
	color: inherit;
}
.token.inserted {
	background-color: hsl(126, 31%, 39%);
	color: inherit;
}

/* Make the + and - characters unselectable for copy/paste */
.token.prefix.unchanged,
.token.prefix.inserted,
.token.prefix.deleted {
	-webkit-user-select: none;
	user-select: none;
	display: inline-flex;
	align-items: center;
	justify-content: center;
	padding-top: 2px;
	padding-bottom: 2px;
}
.token.prefix.inserted,
.token.prefix.deleted {
	width: var(--eleventy-code-padding);
	background-color: rgba(0,0,0,.2);
}

/* Optional: full-width background color */
.token.inserted:not(.prefix),
.token.deleted:not(.prefix) {
	display: block;
	margin-left: calc(-1 * var(--eleventy-code-padding));
	margin-right: calc(-1 * var(--eleventy-code-padding));
	text-decoration: none; /* override del, ins, mark defaults */
	color: inherit; /* override del, ins, mark defaults */
}
.utterances {
  margin-left: inherit !important;
}</style>
		
	</head>
	<body>
		<a href="#main" id="skip-link" class="visually-hidden">Skip to main content</a>

		<header>
			<a href="/" class="home-link">DJ Adams</a>
			<nav>
				<h2 class="visually-hidden" id="top-level-navigation-menu">Top level navigation menu</h2>
				<ul class="nav">
					<li class="nav-item"><a href="/">Home</a></li>
					<li class="nav-item"><a href="/about/">About</a></li>
					<li class="nav-item"><a href="/blog/">Blog</a></li>
					<li class="nav-item"><a href="/feed/feed.xml">Feed</a></li>
				</ul>
			</nav>
		</header>

		<main id="main">
			<heading-anchors>
				


<h1 id="monday-morning-thoughts-growth-is-upwards">Monday morning thoughts: growth is upwards</h1>

<ul class="post-metadata">
	<li><time datetime="2018-09-24">24 September 2018</time></li>
	<li><a href="/tags/sapcommunity/" class="post-tag">sapcommunity</a>, </li>
	<li><a href="/tags/mondaymorningthoughts/" class="post-tag">mondaymorningthoughts</a>, </li>
	<li><a href="/tags/cap/" class="post-tag">cap</a>, </li>
	<li><a href="/tags/javascript/" class="post-tag">javascript</a>, </li>
	<li><a href="/tags/literature/" class="post-tag">literature</a>, </li>
	<li><a href="/tags/running/" class="post-tag">running</a></li>
</ul>

<p class="post-description-main"></p>

<p><em>In this post, I think about how we grow, how we improve ourselves by
adding to our knowledge and experience, and consider that our growth is
sometimes uphill but almost always rewarding.</em></p>
<p>I live to the east of the centre Manchester, in beautiful countryside
that's rich and green from all the rain. It's a great place to run,
and over the years <a href="/tweets/qmacro/status/1043793450603180032">since I started
running</a> I can
see my fitness has improved, not least because of the hills I have at my
disposal. While I do of course enjoy running fairly flat routes, the
sense of achievement is heightened, literally, if I take in a hill or
two.</p>
<h2 id="running-up-hills">Running up hills</h2>
<p>The journey to the summit, whether it's to the top of Hartshead Pike,
or just up from Ashton to Oldham, is sometimes hard going, but when I
get there, I know I've benefitted from the effort, and the view is
pretty good too.</p>
<p><img src="/images/2018/09/Screen-Shot-2018-09-24-at-08.18.22.png" alt="">
<em>The view from <a href="https://goo.gl/maps/SCzNCHkNdoF2">Hartshead Pike</a>,
looking south west</em></p>
<h2 id="reading-unfamiliar-dialects">Reading unfamiliar dialects</h2>
<p>So it is also with literature sometimes, too. One of my favourite books,
certainly one of the most memorable, is the post-apocalyptic novel
&quot;<a href="https://en.wikipedia.org/wiki/Riddley_Walker">Riddley Walker</a>&quot;, by
Russell Hoban. It's set many years in the future, after a nuclear war
has destroyed civilisation, and the world has regressed to a level last
seen in the Iron Age.</p>
<p><img src="/images/2018/09/Screen-Shot-2018-09-24-at-08.37.58.png" alt="">
<em>Riddley Walker, by Russell Hoban</em></p>
<p>Not only has technology broken down, but language too, and the book is
written in an imaginary and strange, devolved dialect of English, which
is initially unfamiliar to the reader ...there's no soft on-ramp, the
dialect hits you from the very first paragraph.</p>
<p><img src="/images/2018/09/Screen-Shot-2018-09-24-at-10.59.56.png" alt=""></p>
<p>Initially reading the book is a struggle, everything seems strange, but
gradually you get to know the language and your fluency grows. I think
the idea of using a strange dialect such as this is partly to reflect
the arduous nature of survival in the regressed world in which the
eponymous hero lives. As you travel through the language you travel with
Riddley Walker and the other characters and your experience of their
lives is that much more visceral.</p>
<p>Like running in hilly areas, exploring this novel is also sometimes
tough, but it's also ultimately rewarding. At first there's an almost
automatic rejection of the text, because it appears so different. But
after some thought and perseverance, the novel starts to flow, and the
sense of reward and achievement is indeed great*. Looking back at these
pages today, I read the text as a native of that period, with no
hesitation or effort.</p>
<p><em>*Beyond the language in this novel, there is almost always a richness
of allegory and a classic erudition that permeates most of what Russell
Hoban writes - this sometimes adds to the depth one must sometimes wade
through.</em></p>
<h2 id="expanding-ones-knowledge">Expanding one's knowledge</h2>
<p>As with running up hills, and reading strange, imaginary dialects of
English, there is also a great sense of achievement to be had when
expanding one's technical knowledge - whether you decide to go wider or
deeper in the subjects that interest you.</p>
<p>Yesterday I was trying to satisfy my desire to learn more about the
<a href="https://help.sap.com/viewer/65de2977205c403bbc107264b8eccf4b/Cloud/en-US/00823f91779d4d42aa29a498e0535cdf.html">Application Programming Model for SAP Cloud
Platform</a>
and I came across some code that looked initially a little strange but
closer inspection turned out to make sense.</p>
<p>Considering this closer inspection reminds me of a phrase that the
inimitable <a href="https://en.wikipedia.org/wiki/Erik_Meijer_(computer_scientist)">Erik
Meijer</a> seems
to use* a lot: <em>&quot;If you stare at it long enough ...&quot;</em>, which he uses
in reference to new programming language constructs he's introducing.
If you've not seen his C9 Lecture series &quot;<a href="https://www.youtube.com/watch?v=UIUlFQH4Cvo&amp;list=PLoJC20gNfC2gpI7Dl6fg8uj1a-wfnWTH8">Programming in
Haskell</a>&quot;,
I can highly recommend it - it's wonderful, and about so much more than
Haskell itself.</p>
<p><em>*Originally, I think, in reference to autostereograms.</em></p>
<p>Anyway, I digress.</p>
<p>Here's the code I came across, more or less:</p>
<pre class="language-javascript" tabindex="0"><code class="language-javascript"><span class="token comment">/**
* Custom logic for booking-service defined in ./booking-service.cds
* Check to restrict number of passenger traveling on a space craft to 5
*/</span>
module<span class="token punctuation">.</span><span class="token function-variable function">exports</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span> flight_trip_Bookings <span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">before</span> <span class="token punctuation">(</span><span class="token string">'CREATE'</span><span class="token punctuation">,</span> flight_trip_Bookings<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">cds</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
    cds<span class="token punctuation">.</span><span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=></span><span class="token punctuation">{</span>
       <span class="token constant">SELECT</span><span class="token punctuation">.</span><span class="token function">from</span> <span class="token punctuation">(</span><span class="token string">'flight_trip_Bookings'</span><span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">where</span> <span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token literal-property property">DateOfTravel</span><span class="token operator">:</span> cds<span class="token punctuation">.</span>data<span class="token punctuation">.</span>DateOfTravel<span class="token punctuation">,</span> <span class="token literal-property property">and</span> <span class="token operator">:</span> <span class="token punctuation">{</span><span class="token literal-property property">Itinerary_ID</span><span class="token operator">:</span> cds<span class="token punctuation">.</span>data<span class="token punctuation">.</span>Itinerary_ID<span class="token punctuation">}</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span> <span class="token parameter"><span class="token punctuation">[</span>bookings<span class="token punctuation">]</span></span> <span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
        <span class="token keyword">let</span> totalPassengers <span class="token operator">=</span> <span class="token number">0</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> booking <span class="token keyword">of</span> bookings<span class="token punctuation">)</span> <span class="token punctuation">{</span>
          totalPassengers <span class="token operator">=</span> totalPassengers <span class="token operator">+</span> booking<span class="token punctuation">.</span>NumberOfPassengers
          <span class="token keyword">if</span> <span class="token punctuation">(</span>totalPassengers <span class="token operator">+</span> cds<span class="token punctuation">.</span>data<span class="token punctuation">.</span>NumberOfPassengers <span class="token operator">>=</span> <span class="token number">5</span><span class="token punctuation">)</span>
            cds<span class="token punctuation">.</span><span class="token function">error</span> <span class="token punctuation">(</span><span class="token number">409</span><span class="token punctuation">,</span> <span class="token string">"Spacecraft Tickets Sold out for your Date and Destination, sorry"</span><span class="token punctuation">)</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
 <span class="token punctuation">}</span><span class="token punctuation">)</span></code></pre>
<p>Is this a strange incantation which I see before me?</p>
<p>Well, no, not quite. I'd like to spend the rest of this post taking a
gentle look at it, and thinking about what it represents.</p>
<p>First, what does this look like? Well, for many of us, it sort of looks
like JavaScript but seems a little unfamiliar, a little odd. There are
certain aspects that are missing, aspects might give us a more confident
feeling that it's JavaScript. There are also other aspects that are
present, that don't &quot;feel&quot; as though they're JavaScript. So at the
outset we're having a bit of a Riddley Walker moment, so let's stare
at it for a bit and see if we can't get closer to it, mentally.</p>
<p>Of course, context is everything, so consider that this bit of code is
the contents of a JavaScript file that is designed to be dropped into a
Node.js based service in the context of the Application Programming
Model for SAP Cloud Platform, specifically a bit of custom logic to be
invoked on certain request operations.</p>
<p>OK, so what we see at a high level, say, inside 10 seconds of staring,
is that we have:</p>
<ul>
<li>no semicolons</li>
<li>some strange statements like <code>let</code> and <code>for ... of</code></li>
<li>some odd looking punctuation reminiscent of what would be called
&quot;<a href="https://perl.plover.com/obfuscated/">line noise</a>&quot; in Perl</li>
<li>a significant amount of indentation</li>
</ul>
<p>In fact, looking at the indentation, there's only a single outermost
statement in the whole file - and that's the
<code>module.exports</code> assignment in the first line.</p>
<p>But actually there's not much to worry about at all here. Semicolons in
JavaScript are optional, and many, including Mattias Petter Johansson,
who has a <a href="https://www.youtube.com/channel/UCO1cgjhGzsSYb1rsB4bFe4Q">YouTube channel called
FunFunFunction</a> full
of new JavaScript ideas and more, prefer to omit them. I think it's a
&quot;modern&quot; choice.</p>
<p>We'll look at the strange statements shortly, as well as the
punctuation. But let's continue from where we started.</p>
<pre class="language-javascript" tabindex="0"><code class="language-javascript">module<span class="token punctuation">.</span>exports</code></pre>
<p>The reference to <code>module.exports</code> gives us confidence that what we're
indeed looking at is something that is a
<a href="https://nodejs.org/api/modules.html">module</a> in a Node.js context. So
far so good, we can use that as an anchor for the rest of our
interpretation. What's assigned to <code>module.exports</code> is an anonymous
function, but that should be a fairly familiar idea to us, already.</p>
<pre class="language-javascript" tabindex="0"><code class="language-javascript"><span class="token punctuation">(</span><span class="token punctuation">{</span> flight_trip_Bookings <span class="token punctuation">}</span><span class="token punctuation">)</span></code></pre>
<p>But further along the first line, we have something that looks
unfamiliar. What are those curly braces doing inside of the brackets
where we're expecting to see the function parameters? Well, that's a
new feature of ECMAScript* 6 (EC6) which other languages such as
Clojure already have -
<a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Operators/Destructuring_assignment">destructuring</a>.
Here, the function expects a map (or &quot;object&quot;) as input, and the value
of the specific property <code>flight_trip_Bookings</code> in that map is what the
function needs.</p>
<p><em>*ECMAScript is the actual language, JavaScript is a dialect of that
language.</em></p>
<pre class="language-javascript" tabindex="0"><code class="language-javascript"><span class="token keyword">this</span><span class="token punctuation">.</span>before</code></pre>
<p>What about the body of this anonymous function? Well, we see a function
<code>before</code> being called, with an operation (&quot;CREATE&quot;), the value of the
<code>flight_trip_Bookings</code> that we received in the call (remember, we're
now inside the anonymous function), and another anonymous function, this
time defined in the new ES6 style using <a href="https://www.sitepoint.com/es6-arrow-functions-new-fat-concise-syntax-javascript/">fat
arrows</a>.
This anonymous function, passed as the third argument to the call to
<code>before</code>, expects a single value, in this case <code>cds</code>. Note that one of
the beautiful things about JavaScript is the support for higher order
functions - functions can be passed in, and received from, other
functions.</p>
<p>The effect of this call is that this inner anonymous function expecting
the <code>cds</code> parameter will be registered as a callback to any CREATE
operations on the &quot;Bookings&quot; table within the &quot;flight_trip&quot;
namespace. What does this callback function do? Well, it uses the
<code>cds</code> value passed in, which will represent the CDS runtime object (CDS
is a core part of the Application Programming Model runtime, as well as
being the language with which we declare data models and service
definitions).</p>
<pre class="language-javascript" tabindex="0"><code class="language-javascript">cds<span class="token punctuation">.</span><span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=></span><span class="token punctuation">{</span></code></pre>
<p>Let's stare at the parts inside this inner anonymous ES6 function now
for a bit. We seem to have something like this:</p>
<pre class="language-javascript" tabindex="0"><code class="language-javascript">cds<span class="token punctuation">.</span><span class="token function">run</span><span class="token punctuation">(</span><span class="token constant">A</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token constant">B</span><span class="token punctuation">)</span></code></pre>
<p>In both cases, A and B are anonymous functions*.</p>
<p><em>*Surprised? You shouldn't be - Scheme, a dialect of LISP, a
functional language, was in JavaScript creator Brendan Eich's mind when
he created JavaScript while working at Netscape.</em></p>
<p>The first anonymous function expects no arguments, so is introduced in
ES6 fat arrow style like this: <code>() =&gt; { ... }</code>. The second is expecting
an argument. What is that argument? Well, notice the square brackets
here: <code>( [bookings] ) =&gt; { ... }</code>. In a similar way to what we saw in
the outermost function definition, here we also have destucturing at
work. In this case, however, rather than expecting a map, this anonymous
function is expecting an array, and only wants the first element in that
array to work with, which it will assign to <code>bookings</code>.</p>
<pre class="language-javascript" tabindex="0"><code class="language-javascript"><span class="token constant">SELECT</span><span class="token punctuation">.</span>from</code></pre>
<p>What is this chain of functions doing? Well, in anonymous function A, we
can see evidence of CDS's query language (CQL) which is based on
standard SQL, with various enhancements. Without going too much into CQL
here, we can see how the representation of CQL at the JavaScript syntax
level has been constructed so we can read it more or less like English.
This seems to be a common approach amongst domain specific languages and
especially those standard languages favouring a more flexible approach
to typing as well as embracing functional aspects.</p>
<p>Knowing that with ES6 style function definitions, the results of the
body's evaluation are automatically returned (i.e. there's no need for
an explicit <code>return</code> statement), we can surmise that any results of the
SELECT, from the &quot;Bookings&quot; table, will be returned from A.</p>
<pre class="language-javascript" tabindex="0"><code class="language-javascript"><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span> <span class="token parameter"><span class="token punctuation">[</span>bookings<span class="token punctuation">]</span></span> <span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span></code></pre>
<p>With <code>then</code> we have effectively a promise style continuation, where the
anonymous function B receives the array of possible results, including
any &quot;Bookings&quot; entries in the first position of that array. Inside B
we have more mundane JavaScript, made slightly more interesting by its
use of more ES6 constructs - specifically the <code>let</code> and
<code>for ... of</code> statements.</p>
<p>The <code>let</code> statement is just used to declare a block scope local variable
(a &quot;proper&quot; <code>var</code>, if you will) and the <code>for ... of</code> allows the
processing of each of the items in the bookings that were passed in (so
we can presume also that <code>bookings</code>, the first value in the array passed
in, is itself an array).</p>
<p>If the total number of passengers exceeds a certain number, then the
error function of the CDS runtime object is used to return an exception
which will bubble up the stack and be returned in the response, in this
case with a rather handsome <a href="https://httpstatuses.com/409">HTTP 409</a>
status code.</p>
<p>In summary then, this module is a bit of custom logic that will cause
the automatic handling of OData requests to react, specifically in the
case of CREATE operations on the Bookings entity, if the number of
passengers would mean that the total for the given Intinerary exceeded
capacity. The context of this custom logic is the complete OData service
that the Application Programming Model provides -- in this case in a
Node.js context -- given a service definition written in CDS.</p>
<h2 id="reflection">Reflection</h2>
<p>That for me was a pleasant reflection, and I hope that, like me, you
went from looking at that piece of code with some wonder, to looking at
it with more confidence. I've deliberately left out some details about
the operation of the CDS runtime itself - perhaps I can come back to
that another time.</p>
<p>Instead, I wanted to show that it's straightforward and interesting to
peel back the perhaps initially unfamiliar surface, even at the language
syntax level, to reveal something that will educate us, enrich our
understanding, and even make us smile.</p>
<p>As I stare at the code, the blurriness give way to focus, the language
and dialect becomes more familiar, and the summit starts to appear.
It's clear to me that to be a good developer, I need to keep learning,
and this growth and effort is something I enjoy, especially when I can
do it by learning from folks who are bringing new techniques, frameworks
and models to us. Not quite standing on the shoulders of giants, perhaps
... maybe just reading over their shoulder as they write.</p>
<p>As we move further into the cloud, and embrace more new techniques,
models and frameworks, we'll need to keep growing. And that, I think,
is a good thing.</p>
<h2 id="bonus">Bonus</h2>
<p>If you've got this far, thanks for persevering! There's a couple of
bonus thoughts in this post. First, there's a semi-hidden literary
quote. Can you find it and point to the original? Second, the code in
the anonymous function B is one way of computing the total number of
passengers. It's in a &quot;how to do it&quot; procedural style, rather than a
&quot;what I want&quot; functional style. Can you come up with an alternative in
the latter style? I'd love to hear from you in the comments below.</p>
<hr>
<p>This post was brought to you by a frosty morning, warmed up first by
Pact Coffee's Planalto and the later the welcome appearance of some
sunshine.</p>
<hr>
<p>Read more posts in this series here: <a href="/tags/mondaymorningthoughts/">Monday morning
thoughts</a>.</p>
<hr>
<p><a href="https://community.sap.com/t5/technology-blogs-by-sap/monday-morning-thoughts-growth-is-upwards/ba-p/13385530">Originally published on SAP Community</a></p>



<script src="https://utteranc.es/client.js" repo="qmacro/qmacro.github.io" issue-term="title" crossorigin="anonymous" async=""></script>

<ul class="links-nextprev"><li class="links-nextprev-prev">← Previous<br> <a href="/blog/posts/2018/09/17/monday-morning-thoughts-workflow-forms-and-the-definition-of-a-developer/">Monday morning thoughts: Workflow Forms and the definition of a developer</a></li><li class="links-nextprev-next">Next →<br><a href="/blog/posts/2018/10/01/monday-morning-thoughts-impostor-syndrome/">Monday morning thoughts: impostor syndrome</a></li>
</ul>

			</heading-anchors>
		</main>

		<!-- This page `/blog/posts/2018/09/24/monday-morning-thoughts-growth-is-upwards/` was built on 2025-09-16T13:21:20.663Z -->
		<script type="module" src="/dist/xbxy_EL6cU.js"></script>
	</body>
</html>
