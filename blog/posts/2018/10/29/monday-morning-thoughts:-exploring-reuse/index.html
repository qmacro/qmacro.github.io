<!doctype html><html lang="en"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1"><link rel="canonical" href="https://qmacro.org/blog/posts/2018/10/29/monday-morning-thoughts:-exploring-reuse/"><link rel="alternate" type="application/atom+xml" title="DJ's Weblog - Feed" href="https://qmacro.org/feed.xml"><link href="/assets/main.7884d8f8e9dd86c3b137.css" rel="stylesheet"><link rel="preconnect" href="https://fonts.gstatic.com"><link href="https://fonts.googleapis.com/css2?family=IBM+Plex+Sans&display=swap" rel="stylesheet"><title>Monday morning thoughts: exploring reuse | DJ Adams</title><link rel="icon" type="“image/x-icon”" href="/images/favicon.ico"><meta property="og:title" content="Monday morning thoughts: exploring reuse"><meta property="og:site_name" content="DJ Adams"><meta property="og:type" content="website"><meta property="og:url" content="https://qmacro.org/blog/posts/2018/10/29/monday-morning-thoughts:-exploring-reuse/"><meta name="description" content="Monday morning thoughts: exploring reuse 29 Oct 2018 | 6 min read In this post, I think about reuse and extension, in the context of the..."><meta property="og:description" content="Monday morning thoughts: exploring reuse 29 Oct 2018 | 6 min read In this post, I think about reuse and extension, in the context of the..."><meta name="description" content="Monday morning thoughts: exploring reuse 29 Oct 2018 | 6 min read In this post, I think about reuse and extension, in the context of the..."><meta property="og:image" content="https://qmacro.org/images/site-image.png"><script src="https://cdn.jsdelivr.net/npm/mermaid/dist/mermaid.min.js"></script><script>mermaid.initialize({startOnLoad:true});</script><script async src="https://www.googletagmanager.com/gtag/js?id=G-4WQKBG0L4Y"></script><script>window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());

      gtag('config', 'G-4WQKBG0L4Y');</script></head><body><div class="layout-wrapper"><header class="header"><div class="header__content"><h1 class="site-title"><a href="/">DJ Adams</a></h1><nav class="nav"><ul class="nav__list"><li class="nav-item"><a href="/about">About Me</a></li><li class="nav-item"><a href="/blog">Blog</a></li><li class="nav-item"><a href="/feed.xml">Feed</a></li></ul></nav></div></header><main class="main"><article class="post"><header class="post__header"><h1>Monday morning thoughts: exploring reuse</h1><div class="post__details"><time datetime="2018-10-29">29 Oct 2018 </time><span>| </span><span>6 min read</span></div></header><main class="post__content"><p><em>In this post, I think about reuse and extension, in the context of the Application Programming Model for SAP Cloud Platform, and mindful of Björn Goerke's SAP TechEd 2018 keynote message in Barcelona - &quot;keep the core clean&quot;.</em></p><p>Last week saw the Barcelona edition of SAP TechEd 2018, where SAP CTO Björn Goerke and a great team of role models on stage gave us a keynote with something for everyone - technical and business alike. During the keynote, I <a href="/tweets/qmacro/status/1054640660400295936">tweeted</a>:</p><blockquote><p><em>My three keywords from the #SAPTechEd keynote so far:</em></p><p><em>Open (standards, protocols, APIs)</em></p><p>*Reuse (important superpower of @sapcp application programming model) *</p><p><em>Clean (keep the core clean by extending outside of it)</em></p></blockquote><p>I want to think about the &quot;reuse&quot; and &quot;clean&quot; keywords, because in many ways they're complementary, in that reuse (and by association, extension) can help to achieve the goal of a clean core.</p><p>Of course, there's a lot more to it than that, but reusing &amp; extending definitions and services is a key part of building outside of the core, whether for net new applications or to extend existing solutions. That implies that the application programming model, which has reuse as a &quot;superpower&quot;, is a very useful model to know about.</p><p>So I thought I'd look into an example of reuse and extension that exist for us to meditate upon and learn from.</p><h2>cloud-samples-itelo</h2><p>Earlier this year Oliver Welzel wrote &quot;<a href="https://blogs.sap.com/2018/06/27/itelo-a-sample-business-application-for-the-new-application-programming-model-for-sap-cloud-platform/">ITelO -- A Sample Business Application for the new Application Programming Model for SAP Cloud Platform</a>&quot; in which he described an application with ra product catalog, and reviews, for the fictitious company ITelO. The data model is in three layers, with each building on the one beneath it.</p><p>This diagram from the post provides a nice summary of that:</p><p><img src="/images/2018/10/ITelOCatalog.png" alt=""></p><p><em>The component overview, showing how the data model is built up in layers</em></p><p>(Perhaps before continuing with this post, it might be worth you going and taking a read of Oliver's post. Don't forget to come back, though!)</p><h2>Multiple layers</h2><p>The idea is that there are core artefacts in the &quot;foundation&quot; layer, the &quot;product-catalog&quot; layer builds on top of that, and then there's the &quot;itelo&quot; specific application layer at the top.</p><p>Each layer is represented by a repository in GitHub, so all the source is available to study. If we start at the top, and look at the data model definition at the &quot;itelo&quot; layer, this is what we see*, specifically in the <a href="https://github.com/SAP/cloud-samples-itelo/blob/rel-1.0/db/model.cds">db/model.cds</a> source:</p><pre class="language-cds"><code class="language-cds"><span class="token keyword">namespace</span> clouds.itelo;<br><br><span class="token using keyword">using</span> clouds.products.Products <span class="token from keyword">from</span> '@sap/cloud-samples-catalog';<br><span class="token using keyword">using</span> clouds.foundation <span class="token cqlkeywords keyword">as</span> fnd <span class="token from keyword">from</span> '@sap/cloud-samples-foundation';<br><br><span class="token keyword">extend</span> Products with {<br>    reviews: <span class="token association-composition keyword">Association to many Reviews</span> <span class="token cqlkeywords keyword">on</span> reviews.product = $self <span class="token annotation important">@title:</span> '{i18n>review}';<br>    averageRating: <span class="token type builtin">Decimal(4, 2)</span> <span class="token annotation important">@(</span><br>        title: '{i18n>averageRating}',<br>        Common.FieldControl: #ReadOnly<br>    );<br>    numberOfReviews: <span class="token type builtin">Integer </span><span class="token annotation important">@(</span><br>        title: '{i18n>numberOfReviews}',<br>        Common.FieldControl: #ReadOnly<br>    );<br>}<br><br><span class="token keyword">entity</span> Reviews: fnd.BusinessObject {<br>    product: <span class="token association-composition keyword">Association to Products</span> <span class="token annotation important">@title:</span> '{i18n>product}';<br>    reviewer: <span class="token association-composition keyword">Association to Reviewers</span> <span class="token annotation important">@title:</span> '{i18n>reviewer_XTIT}';<br>    title: <span class="token type builtin">String(60)</span> <span class="token annotation important">@title:</span> '{i18n>reviewTitle}';<br>    message: <span class="token type builtin">String(1024)</span> <span class="token annotation important">@title:</span> '{i18n>reviewText}';<br>    rating: <span class="token type builtin">Decimal(4, 2)</span> <span class="token annotation important">@title:</span> '{i18n>rating}';<br>    helpfulCount: <span class="token type builtin">Integer </span><span class="token annotation important">@title:</span> '{i18n>ratedHelpful}';<br>    helpfulTotal: <span class="token type builtin">Integer </span><span class="token annotation important">@title:</span> '{i18n>ratedTotal}';<br>}<br><br>annotate Reviews with {<br>    ID <span class="token annotation important">@title:</span> '{i18n>review}';<br>}<br><br><span class="token keyword">entity</span> Reviewers: fnd.Person, fnd.BusinessObject {<br>}<br><br>annotate Reviewers with {<br>    ID <span class="token annotation important">@title:</span> '{i18n>reviewer_XTIT}';<br>}</code></pre><p>*I'm specifically using the &quot;rel-1.0&quot; branch in each case, because that's what's also used in the dependency references that we'll see shortly, and represents a stable version that we can examine.</p><h2>Reuse through &quot;using&quot; statements</h2><p>Looking at the first few lines, we see some &quot;using&quot; statements:</p><pre class="language-cds"><code class="language-cds"><span class="token using keyword">using</span> clouds.products.Products <span class="token from keyword">from</span> '@sap/cloud-samples-catalog';<br><span class="token using keyword">using</span> clouds.foundation <span class="token cqlkeywords keyword">as</span> fnd <span class="token from keyword">from</span> '@sap/cloud-samples-foundation';</code></pre><p>So this is already interesting. Is this reuse in action? It is. But what does it mean, exactly? Let's investigate. Taking the first &quot;using&quot; statement, something called &quot;clouds.products.Products&quot; is being used from something called &quot;@sap/cloud-samples-catalog&quot;.</p><p>In the <a href="https://help.sap.com/viewer/65de2977205c403bbc107264b8eccf4b/Cloud/en-US/c6f83f47d8364a06922a60aa57a699f8.html">Model Reuse</a> section of the documentation on the SAP Help Portal, we can see that this is effectively an import of a definition from another CDS model. OK, which one? Well, we can recognise the &quot;cloud-samples-catalog&quot; name as it's one of the layers in the diagram we looked at earlier. But how is that resolved?</p><p>For that, we have to look in the &quot;itelo&quot; layer project's <a href="https://github.com/SAP/cloud-samples-itelo/blob/rel-1.0/package.json">package.json</a> file, where, amongst other things, we see some dependencies defined:</p><pre class="language-cds"><code class="language-cds">"dependencies": {<br>    "<span class="token annotation important">@sap/cloud-samples-foundation":</span> "https:<span class="token single-line-comment comment">//github.com/SAP/cloud-samples-foundation.git#rel-1.0",</span><br>    "<span class="token annotation important">@sap/cloud-samples-catalog":</span> "https:<span class="token single-line-comment comment">//github.com/SAP/cloud-samples-catalog.git#rel-1.0"</span><br>}</code></pre><p>Ooh, well that's exciting, for a start! The package.json file is <a href="https://docs.npmjs.com/files/package.json">from the Node Package Manager (NPM) world</a> and the dependencies section is where one defines dependencies to other packages, typically ones like &quot;express&quot;, if you're building services that handle HTTP requests, for example. But what do we have here?</p><p>Well, we can see the names referenced in the &quot;using&quot; statements earlier, in other words &quot;@sap/cloud-samples-catalog&quot; and &quot;@sap/cloud-samples-foundation&quot;. But instead of simple package names, they're mapped to GitHub URLs. And not just any GitHub URLs, but URLs that refer to specific repositories, and indeed specific branches! Taking the URL for the &quot;@sap/cloud-samples-catalog&quot; name, we have:</p><pre class="language-cds"><code class="language-cds">https:<span class="token single-line-comment comment">//github.com/SAP/cloud-samples-catalog.git#rel-1.0</span></code></pre><p>which refers to the <a href="https://github.com/SAP/cloud-samples-catalog/tree/rel-1.0">rel-1.0 branch</a> of the cloud-samples-catalog repository belonging to SAP.</p><h2>The &quot;product-catalog&quot; layer</h2><p>Looking there, we see a fully formed application - the middle &quot;product-catalog&quot; layer that we saw earlier, with app, srv and db folders representing each of the three components of a typical fully fledged solution based on the application programming model.</p><p><img src="/images/2018/10/Screenshot-2018-10-29-at-10.19.20.png" alt=""></p><p>In the db folder we see the <a href="https://github.com/SAP/cloud-samples-catalog/blob/rel-1.0/db/model.cds">model.cds</a> file, which starts like this:</p><pre class="language-cds"><code class="language-cds"><span class="token keyword">namespace</span> clouds.products;<br><br><span class="token using keyword">using</span> clouds.foundation <span class="token cqlkeywords keyword">as</span> fnd <span class="token from keyword">from</span> '@sap/cloud-samples-foundation';<br><span class="token using keyword">using</span> clouds.foundation.CodeList;<br><br><span class="token keyword">entity</span> Products: fnd.BusinessObject {<br>    <span class="token single-line-comment comment">// general info</span><br>    <span class="token cqlkeywords keyword">key</span> ID: <span class="token type builtin">String(36)</span>;<br>    name: localized <span class="token type builtin">String </span><span class="token annotation important">@(</span><br>        title: '{i18n><span class="token cdl-keyword keyword">name</span>}',<br>        Common.FieldControl: #Mandatory,<br>        Capabilities.SearchRestrictions.Searchable<br>    );<br>    description: localized <span class="token type builtin">String </span><span class="token annotation important">@(</span><br>        title: '{i18n>description}',<br>        Common.FieldControl: #Mandatory<br>    );<br><br>    [...]</code></pre><h2>Fractals</h2><p>In a wonderfully fractal way, we notice immediately that this model definition also refers to another package with a &quot;using&quot; statement, but let's resist descending deeper just at this moment. Instead, we can concentrate on looking at what's going on with the &quot;using&quot; statement we've seen in the consuming definition earlier, which looked like this:</p><pre class="language-cds"><code class="language-cds"><span class="token using keyword">using</span> clouds.products.Products <span class="token from keyword">from</span> '@sap/cloud-samples-catalog';</code></pre><p>We realise that &quot;clouds.products.Products&quot; refers to the Products entity in the &quot;cloud.products&quot; namespace, which is defined here with the &quot;entity&quot; definition:</p><pre class="language-cds"><code class="language-cds"><span class="token keyword">entity</span> Products: fnd.BusinessObject { ... }</code></pre><p>But what is that &quot;fnd.BusinessObject&quot; sitting between the entity name and the block definition in curly braces? Why, it's more reuse, this time of the underlying &quot;foundation&quot; layer. Just above in the same file, we can see that this layer is referenced in a &quot;using&quot; statement, this time with a local alias &quot;fnd&quot; defined:</p><pre><code>using clouds.foundation as fnd from '@sap/cloud-samples-foundation';
</code></pre><p>So now let's briefly descend into the fractal. The reference to &quot;fnd.BusinessObject&quot; is to an entity defined in the &quot;foundation&quot; layer, which we can see if we follow the <a href="https://github.com/SAP/cloud-samples-catalog/blob/rel-1.0/package.json#L9">dependency reference in the &quot;product-catalog&quot; layer's package.json</a>:</p><p><img src="/images/2018/10/Screenshot-2018-10-29-at-10.22.27.png" alt=""></p><p>(It's worth observing that in this layer we only have data definitions -- in the form of &quot;.cds&quot; files -- rather than a full blown solution with app, srv and db folders.)</p><p>In this repository (again, branch &quot;rel-1.0&quot;) we can find the definition of the BusinessObject entity <a href="https://github.com/SAP/cloud-samples-foundation/blob/rel-1.0/common.cds#L3-L8">in the common.cds file</a> looking like this:</p><pre class="language-cds"><code class="language-cds"><span class="token keyword">abstract</span> <span class="token keyword">entity</span> BusinessObject : ManagedObject {<br>    <span class="token cqlkeywords keyword">key</span> ID : <span class="token type builtin">UUID </span><span class="token annotation important">@(</span><br>        title: '{i18n>uuid}',<br>        Common.Text: {$value: <span class="token cdl-keyword keyword">name</span>, "<span class="token annotation important">@UI.TextArrangement":</span> #TextOnly}<br>    );<br>}</code></pre><p>Note in passing that here the &quot;BusinessObject&quot; entity is defined as &quot;abstract&quot; which means that it's just a type declaration rather than something for which instances should exist. Note also that it's further defined, using a similar pattern to where we saw the &quot;fnd.BusinessObject&quot; reference, by another abstract entity definition &quot;ManagedObject&quot; (you can <a href="https://github.com/SAP/cloud-samples-foundation/blob/rel-1.0/common.cds#L10-L34">find this definition of ManagedObject</a> also in the common.cds file).</p><h2>Extension through &quot;extend&quot; statements</h2><p>Moving back up the layers for some air, we see that directly following the &quot;using&quot; statements, there is this:</p><pre class="language-cds"><code class="language-cds"><span class="token keyword">extend</span> Products with {<br>    reviews: <span class="token association-composition keyword">Association to many Reviews</span> <span class="token cqlkeywords keyword">on</span> reviews.product = $self <span class="token annotation important">@title:</span> '{i18n>review}';<br>    averageRating: <span class="token type builtin">Decimal(4, 2)</span> <span class="token annotation important">@(</span><br>        title: '{i18n>averageRating}',<br>        Common.FieldControl: #ReadOnly<br>    );<br>    numberOfReviews: <span class="token type builtin">Integer </span><span class="token annotation important">@(</span><br>        title: '{i18n>numberOfReviews}',<br>        Common.FieldControl: #ReadOnly<br>    );<br>}</code></pre><p>With the &quot;extend&quot; <a href="https://help.sap.com/viewer/65de2977205c403bbc107264b8eccf4b/Cloud/en-US/40582e7bbeca4311b0b165c8b9745094.html">aspect</a>, entity definitions can be repurposed with extra properties, for example. In this case, the existing Products entity (from the &quot;product-catalog&quot; layer's data definition) is extended with three properties: &quot;reviews&quot;, &quot;averageRating&quot; and &quot;numberOfReviews&quot;. Note that the &quot;reviews&quot; property is an association to a <a href="https://github.com/SAP/cloud-samples-itelo/blob/1.0.0/db/model.cds#L18-L26">Reviews entity</a> at this (itelo) application layer, defined expressly for this purpose.</p><p>Moreover, some of the properties in the Reviews entity are also defined as associations to further entities therein, such as the reviewer property which points to the <a href="https://github.com/SAP/cloud-samples-itelo/blob/1.0.0/db/model.cds#L32-L33">Reviewers entity</a>, which has no properties of its own, but in a beautiful way inherits from some of the definitions (Person and BussinessObject) at the &quot;foundation&quot; layer:</p><pre class="language-cds"><code class="language-cds"><span class="token keyword">entity</span> Reviewers: fnd.Person, fnd.BusinessObject {<br>}</code></pre><h2>Wrapping up</h2><p>That might be a lot to take in, in one sitting. It has become quite clear to me that the facilities afforded by the CDS language in the application programming model are very rich when it comes to reuse and extensions. Not only at the definition level, but also in the simplicity of how package based references are realised.</p><p>While at first I thought it was a little odd to see the GitHub repository &amp; branch URLs, and indeed to realise that the package.json mechanism was fundamental to how artefacts in the application programming model are related, I've come to think that it's a natural way to do it, and a celebration of adopting an approach that's already out there in the world beyond our SAP ecosphere.</p><p>What's more, we haven't even touched on how annotations work and what we are able to do in terms of reuse there too. But I'll leave that for another time, instead leaving you with the suggestion that reuse is indeed an important superpower of the application programming model, and demonstrably so. And keeping the core clean - well, the more extension and reuse we can achieve, the closer we can get to a cleaner core.</p><hr><p>This post was brought to you by a chilly Monday morning, by <a href="https://www.pactcoffee.com/coffees/asomuprisma">Pact Coffee's Asomuprisma</a> in my <a href="https://anchor.fm/sap-community-podcast">SAP Coffee Corner Radio</a> mug, and by a <a href="https://open.spotify.com/station/user/qmacro/cluster/3JqLjzwr3h5mESenCGHsbr">Spotify mix</a> designed for concentration.</p><hr><p>Read more posts in this series here: <a href="/tags/mondaymorningthoughts/">Monday morning thoughts</a>.</p><hr><p><a href="https://community.sap.com/t5/technology-blogs-by-sap/monday-morning-thoughts-exploring-reuse/ba-p/13350771">Originally published on SAP Community</a></p></main><aside class="post__aside"><div class="post__tags"><a href="/tags/sapcommunity/">#sapcommunity</a> <a href="/tags/mondaymorningthoughts/">#mondaymorningthoughts</a></div><style>.utterances {
  margin-left: inherit !important;
}</style><script src="https://utteranc.es/client.js" repo="qmacro/qmacro.github.io" issue-term="title" crossorigin="anonymous" async></script><nav class="post__pagination"><a href="/blog/posts/2018/11/05/monday-morning-thoughts:-on-starting-blogging/"><span>←</span> <span>Monday morning thoughts: on starting blogging</span> </a><a href="/blog/posts/2018/10/22/monday-morning-thoughts:-dynamic-language/"><span>Monday morning thoughts: dynamic language</span> <span>→</span></a></nav></aside></article></main><footer class="footer"><div class="footer__content"><ul class="hero__social-links"><li><a rel="me" href="https://github.com/qmacro" target="_blank" rel="noopener noreferrer">GitHub</a></li><li><a rel="me" href="https://www.youtube.com/djadams-qmacro" target="_blank" rel="noopener noreferrer">YouTube</a></li><li><a rel="me" href="https://www.linkedin.com/in/djadams/" target="_blank" rel="noopener noreferrer">LinkedIn</a></li><li><a rel="me" href="/tweets/">Tweet Archive</a></li><li><a rel="me" href="https://hachyderm.io/@qmacro" target="_blank" rel="noopener noreferrer">Mastodon</a></li><li><a rel="me" href="https://bsky.app/profile/qmacro.org" target="_blank" rel="noopener noreferrer">Bluesky</a></li><li><a href="/feed.xml" target="_blank" rel="noopener noreferrer">RSS</a></li></ul></div></footer></div><script src="/assets/main.31d6cfe0d16ae931b73c.js"></script></body></html>