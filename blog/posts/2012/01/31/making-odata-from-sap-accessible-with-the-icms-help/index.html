<!doctype html>
<html lang="en">
	<head>
		<meta charset="utf-8">
		<meta name="viewport" content="width=device-width, initial-scale=1.0">
		<title>Making OData from SAP accessible with the ICM&#39;s help</title>
		<meta name="description" content="Reserving the right to be wrong.">
		<link rel="alternate" href="/feed/feed.xml" type="application/atom+xml" title="DJ Adams">
		<link rel="icon" type="image/x-icon" href="/images/favicon.ico">

      <meta property="og:title" content="Making OData from SAP accessible with the ICM&#39;s help">
        <meta property="og:site_name" content="DJ Adams">
          <meta property="og:image" content="/images/site-image.png">
        <meta property="og:description" content="Reserving the right to be wrong.">
        <meta property="og:url" content="https://qmacro.org/blog/posts/2012/01/31/making-odata-from-sap-accessible-with-the-icms-help/">
		
		
		
		<style>/* This is an arbitrary CSS string added to the bundle */
/* Defaults */
:root {
	--font-family: -apple-system, system-ui, sans-serif;
	--font-family-monospace: Consolas, Menlo, Monaco, Andale Mono WT, Andale Mono, Lucida Console, Lucida Sans Typewriter, DejaVu Sans Mono, Bitstream Vera Sans Mono, Liberation Mono, Nimbus Mono L, Courier New, Courier, monospace;
}

/* Theme colors */
:root {
	--color-gray-20: #e0e0e0;
	--color-gray-50: #C0C0C0;
	--color-gray-90: #333;

	--background-color: #fff;

	--text-color: var(--color-gray-90);
	--text-color-link: #2884d2;
	--text-color-link-active: #15b0ed;
	--text-color-link-visited: #9f4199;

	--syntax-tab-size: 2;
}

@media (prefers-color-scheme: dark) {
	:root {
		--color-gray-20: #e0e0e0;
		--color-gray-50: #C0C0C0;
		--color-gray-90: #dad8d8;

		/* --text-color is assigned to --color-gray-_ above */
		--text-color-link: #1493fb;
		--text-color-link-active: #6969f7;
		--text-color-link-visited: #a6a6f8;

		--background-color: #15202b;
	}
}


/* Global stylesheet */
* {
	box-sizing: border-box;
}

@view-transition {
	navigation: auto;
}

html,
body {
	padding: 0;
	margin: 0 auto;
	font-family: var(--font-family);
	color: var(--text-color);
	background-color: var(--background-color);
}
html {
	overflow-y: scroll;
}
body {
	max-width: 40em;
}

/* https://www.a11yproject.com/posts/how-to-hide-content/ */
.visually-hidden:not(:focus):not(:active) {
	clip: rect(0 0 0 0);
	clip-path: inset(50%);
	height: 1px;
	overflow: hidden;
	position: absolute;
	white-space: nowrap;
	width: 1px;
}

/* Fluid images via https://www.zachleat.com/web/fluid-images/ */
img{
  max-width: 100%;
}
img[width][height] {
  height: auto;
}
img[src$=".svg"] {
  width: 100%;
  height: auto;
  max-width: none;
}
video,
iframe {
	width: 100%;
	height: auto;
}
iframe {
	aspect-ratio: 16/9;
}

p:last-child {
	margin-bottom: 0;
}
p {
	line-height: 1.5;
}

li {
	line-height: 1.5;
}

a[href] {
	color: var(--text-color-link);
}
a[href]:visited {
	color: var(--text-color-link-visited);
}
a[href]:hover,
a[href]:active {
	color: var(--text-color-link-active);
}

main,
footer {
	padding: 1rem;
}
/* main :first-child { */
/* 	margin-top: 0; */
/* } */

header {
	border-bottom: 1px dashed var(--color-gray-20);
}

#skip-link {
	text-decoration: none;
	background: var(--background-color);
	color: var(--text-color);
	padding: 0.5rem 1rem;
	border: 1px solid var(--color-gray-90);
	border-radius: 2px;
}

/* Prevent visually-hidden skip link fom pushing content around when focused */
#skip-link.visually-hidden:focus {
	position: absolute;
	top: 1rem;
	left: 1rem;
	/* Ensure it is positioned on top of everything else when it is shown */
	z-index: 999;
}

.links-nextprev {
	display: flex;
	justify-content: space-between;
	gap: .5em 1em;
	list-style: "";
	border-top: 1px dashed var(--color-gray-20);
	padding: 1em 0;
}
.links-nextprev > * {
	flex-grow: 1;
}
.links-nextprev-next {
	text-align: right;
}

table {
	margin: 1em 0;
}
table td,
table th {
	padding-right: 1em;
}

pre,
code {
	font-family: var(--font-family-monospace);
	color: seagreen;
}

pre,code[class*="language-"] {
	line-height: 1.2em !important;
	font-size: 0.93em !important;
}

pre:not([class*="language-"]) {
	margin: .5em 0;
	line-height: 1.375; /* 22px /16 */
	-moz-tab-size: var(--syntax-tab-size);
	-o-tab-size: var(--syntax-tab-size);
	tab-size: var(--syntax-tab-size);
	-webkit-hyphens: none;
	-ms-hyphens: none;
	hyphens: none;
	direction: ltr;
	text-align: left;
	white-space: pre;
	word-spacing: normal;
	word-break: normal;
	overflow-x: auto;
}
code {
	word-break: break-word;
}

/* Header */
header {
	display: flex;
	gap: 1em;
	flex-wrap: wrap;
	justify-content: space-between;
	align-items: center;
	padding: 1em;
}
.home-link {
	flex-grow: 1;
	font-size: 1em; /* 16px /16 */
	font-weight: 700;
}
.home-link:link:not(:hover) {
	text-decoration: none;
}

/* Nav */
.nav {
	display: flex;
	gap: .5em 1em;
	padding: 0;
	margin: 0;
	list-style: none;
}
.nav-item {
	display: inline-block;
}
.nav-item a[href]:not(:hover) {
	text-decoration: none;
}
.nav a[href][aria-current="page"] {
	text-decoration: underline;
}

/* Posts list */
.postlist {
	counter-reset: start-from var(--postlist-index);
	list-style: none;
	padding: 0;
}
.postlist-item {
	display: flex;
	flex-wrap: wrap;
	align-items: baseline;
	counter-increment: start-from -1;
	margin-bottom: 1em;
}
.postlist-item:before {
	display: inline-block;
	pointer-events: none;
	line-height: 100%;
	text-align: right;
	margin-left: -1.5rem;
}
.postlist-date,
.postlist-item:before {
	font-size: 0.8125em; /* 13px /16 */
	color: var(--color-gray-90);
}
.postlist-date {
	word-spacing: -0.5px;
}
.postlist-link {
	font-size: 1.1875em; /* 19px /16 */
	font-weight: 700;
	flex-basis: calc(100% - 1.5rem);
	text-underline-position: from-font;
	text-underline-offset: 0;
	text-decoration-thickness: 1px;
}
.postlist-item-active .postlist-link {
	font-weight: bold;
}

/* Tags */
.post-tag {
	display: inline-flex;
	align-items: center;
	justify-content: center;
	font-style: italic;
}

/* may want to make the description text smaller at some stage */
.post-description-list {
	font-size: 1.0em;
}

.post-description-main {
	font-style: italic;
}

.postlist-item > .post-tag {
	align-self: center;
}

/* Tags list */
.post-metadata {
	display: inline-flex;
	flex-wrap: wrap;
	gap: .5em;
	list-style: none;
	padding: 0;
	margin: 0;
}
.post-metadata time {
	margin-right: 1em;
}

blockquote {
	margin-top: 0px;
	margin-left: 0px;
	margin-bottom: 15px;
	padding-left: 15px;
	border-left: 5px solid lightgray;
}
/**
 * prism.js default theme for JavaScript, CSS and HTML
 * Based on dabblet (http://dabblet.com)
 * @author Lea Verou
 */

code[class*="language-"],
pre[class*="language-"] {
	color: black;
	background: none;
	text-shadow: 0 1px white;
	font-family: Consolas, Monaco, 'Andale Mono', 'Ubuntu Mono', monospace;
	font-size: 1em;
	text-align: left;
	white-space: pre;
	word-spacing: normal;
	word-break: normal;
	word-wrap: normal;
	line-height: 1.5;

	-moz-tab-size: 4;
	-o-tab-size: 4;
	tab-size: 4;

	-webkit-hyphens: none;
	-moz-hyphens: none;
	-ms-hyphens: none;
	hyphens: none;
}

pre[class*="language-"]::-moz-selection, pre[class*="language-"] ::-moz-selection,
code[class*="language-"]::-moz-selection, code[class*="language-"] ::-moz-selection {
	text-shadow: none;
	background: #b3d4fc;
}

pre[class*="language-"]::selection, pre[class*="language-"] ::selection,
code[class*="language-"]::selection, code[class*="language-"] ::selection {
	text-shadow: none;
	background: #b3d4fc;
}

@media print {
	code[class*="language-"],
	pre[class*="language-"] {
		text-shadow: none;
	}
}

/* Code blocks */
pre[class*="language-"] {
	padding: 1em;
	margin: .5em 0;
	overflow: auto;
}

:not(pre) > code[class*="language-"],
pre[class*="language-"] {
	background: #f5f2f0;
}

/* Inline code */
:not(pre) > code[class*="language-"] {
	padding: .1em;
	border-radius: .3em;
	white-space: normal;
}

.token.comment,
.token.prolog,
.token.doctype,
.token.cdata {
	color: slategray;
}

.token.punctuation {
	color: #999;
}

.token.namespace {
	opacity: .7;
}

.token.property,
.token.tag,
.token.boolean,
.token.number,
.token.constant,
.token.symbol,
.token.deleted {
	color: #905;
}

.token.selector,
.token.attr-name,
.token.string,
.token.char,
.token.builtin,
.token.inserted {
	color: #690;
}

.token.operator,
.token.entity,
.token.url,
.language-css .token.string,
.style .token.string {
	color: #9a6e3a;
	/* This background color was intended by the author of this theme. */
	background: hsla(0, 0%, 100%, .5);
}

.token.atrule,
.token.attr-value,
.token.keyword {
	color: #07a;
}

.token.function,
.token.class-name {
	color: #DD4A68;
}

.token.regex,
.token.important,
.token.variable {
	color: #e90;
}

.token.important,
.token.bold {
	font-weight: bold;
}
.token.italic {
	font-style: italic;
}

.token.entity {
	cursor: help;
}
/*
 * New diff- syntax
 */

pre[class*="language-diff-"] {
	--eleventy-code-padding: 1.25em;
	padding-left: var(--eleventy-code-padding);
	padding-right: var(--eleventy-code-padding);
}
.token.deleted {
	background-color: hsl(0, 51%, 37%);
	color: inherit;
}
.token.inserted {
	background-color: hsl(126, 31%, 39%);
	color: inherit;
}

/* Make the + and - characters unselectable for copy/paste */
.token.prefix.unchanged,
.token.prefix.inserted,
.token.prefix.deleted {
	-webkit-user-select: none;
	user-select: none;
	display: inline-flex;
	align-items: center;
	justify-content: center;
	padding-top: 2px;
	padding-bottom: 2px;
}
.token.prefix.inserted,
.token.prefix.deleted {
	width: var(--eleventy-code-padding);
	background-color: rgba(0,0,0,.2);
}

/* Optional: full-width background color */
.token.inserted:not(.prefix),
.token.deleted:not(.prefix) {
	display: block;
	margin-left: calc(-1 * var(--eleventy-code-padding));
	margin-right: calc(-1 * var(--eleventy-code-padding));
	text-decoration: none; /* override del, ins, mark defaults */
	color: inherit; /* override del, ins, mark defaults */
}
.utterances {
  margin-left: inherit !important;
}</style>
		

    <!-- Global site tag (gtag.js) - Google Analytics -->
    <script async="" src="https://www.googletagmanager.com/gtag/js?id=G-4WQKBG0L4Y"></script>
    

	</head>
	<body>
		<a href="#main" id="skip-link" class="visually-hidden">Skip to main content</a>

		<header>
			<a href="/" class="home-link">DJ Adams</a>
			<nav>
				<h2 class="visually-hidden" id="top-level-navigation-menu">Top level navigation menu</h2>
				<ul class="nav">
					<li class="nav-item"><a href="/">Home</a></li>
					<li class="nav-item"><a href="/about/">About</a></li>
					<li class="nav-item"><a href="/blog/">Blog</a></li>
					<li class="nav-item"><a href="/feed/feed.xml">Feed</a></li>
				</ul>
			</nav>
		</header>

		<main id="main">
			<heading-anchors>
				


<h1 id="making-odata-from-sap-accessible-with-the-icms-help">Making OData from SAP accessible with the ICM&#39;s help</h1>

<ul class="post-metadata">
	<li><time datetime="2012-01-31">31 January 2012</time></li>
	<li><a href="/tags/sapcommunity/" class="post-tag">sapcommunity</a></li>
</ul>

<p class="post-description-main"></p>

<p>I'm totally enamoured by the power and potential of SAP's <a href="https://blogs.sap.com/2012/11/13/gateway-and-duet-enterprise-day-one-in-madrid/">NetWeaver Gateway</a>, and all it has to offer with its REST-informed data-centric consumption model. One of the tools I've been looking at in exploring the services is the Sesame Data Browser, a Silverlight-based application that runs inside the browser or on the desktop, and lets you explore OData resources.</p>
<p>One of the challenges in getting the Data Browser to consume OData resources exposed by NetWeaver Gateway (get a trial version, available from the Gateway home page on SDN) was serving a couple of XML-based domain access directive files as described in &quot;<a href="https://learn.microsoft.com/en-us/previous-versions/windows/silverlight/dotnet-windows-silverlight/cc197955(v=vs.95)?redirectedfrom=MSDN">Making a Service Available Across Domain Boundaries</a>&quot; - namely <code>clientaccesspolicy.xml</code> and <code>crossdomain.xml</code>, both needing to be served from the root of the domain/port based URL of the Gateway system. In other words, the NetWeaver stack needed to serve requests for these two resources:</p>
<pre class="language-url" tabindex="0"><code class="language-url"><span class="token scheme">http<span class="token scheme-delimiter">:</span></span><span class="token authority"><span class="token authority-delimiter">//</span><span class="token host">hostname</span><span class="token port-segment"><span class="token port-delimiter">:</span></span></span><span class="token path">port<span class="token path-separator">/</span>clientaccesspolicy.xml</span></code></pre>
<p>and</p>
<pre class="language-url" tabindex="0"><code class="language-url"><span class="token scheme">http<span class="token scheme-delimiter">:</span></span><span class="token authority"><span class="token authority-delimiter">//</span><span class="token host">hostname</span><span class="token port-segment"><span class="token port-delimiter">:</span></span></span><span class="token path">port<span class="token path-separator">/</span>crossdomain.xml</span></code></pre>
<p>Without these files, the Data Browser will show you this sort of error:</p>
<pre class="language-text" tabindex="0"><code class="language-text">A SecurityException has been encountered while opening the connection. 
Please try to open the connection with Sesame installed on the desktop. 
If you are the owner of the OData feed, try to add a clientaccesspolicy.xml 
file on the server.--</code></pre>
<p>So, how to make these two cross domain access files available, and specifically from the root? There have been some thoughts on this already, <a href="https://web.archive.org/web/20200115083108/http://www.plinky.it/blog/2009/03/09/add-crossdomainxml-on-the-root-of-sap-web-application-server/">using a default service on the ICF's default host definition</a>, or even dynamically loading the XML as a file into the server cache (see the ABAP program in <a href="https://web.archive.org/web/20130628092517/http://scn.sap.com/thread/281050">this thread in the RIA dev forum</a>).</p>
<p>But a conversation on Twitter last night about BSPs, raw ICF and even the ICM reminded me that the ICM is a powerful engine that is often overlooked and underloved. The ICM - Internet Communication Manager - is the collection of core HTTP/SMTP/plugin services that sits underneath the ICF, and handle the actual HTTP traffic below the level of the ICF's ABAP layer. In the style of <a href="https://httpd.apache.org/docs/trunk/handler.html">Apache handlers</a>, there are a series of handlers that the ICM has to deal with plenty of HTTP serving situations - Logging, Authentication, Server Cache, Administration, Modification, File Access, Redirect, as well as the &quot;ABAP&quot; handler we know as the ICF layer.</p>
<p>Could the humble ICM help with serving these two XML resources? Of course it could!</p>
<p>The File Access handler is what we recognise from the level 2 trace info in the dev_icm tracefile as HttpFileAccessHandler. You all read the verbose traces from the ICM with your morning coffee, right? Just kidding. Anyway, the File Access handler makes its features available to us in the form of the <a href="http://help.sap.com/saphelp_nw70ehp2/helpdata/en/48/3e1b4e252f72d0e10000000a42189c/frameset.htm">icm/HTTP/file_access_<xx></xx></a> profile parameters. It allows us to point the ICM at a directory on the filesystem and have it serve files directly, if a URL is matched. Note that this File Access handler is invoked, and given a chance to respond, before we even get to the ABAP handler's ICF level.</p>
<p>With a couple of these file_access parameters, we can serve static <code>clientaccesspolicy.xml</code> and <code>crossdomain.xml</code> files straight from the filesystem, matched at root. Here's what I have in my <code>/usr/sap/NPL/SYS/profile/NPL_DVEBMGS42_nplhost</code> parameter file:</p>
<pre class="language-text" tabindex="0"><code class="language-text">icm/HTTP/file_access_1 = PREFIX=/clientaccesspolicy.xml, 
   DOCROOT=$(DIR_INSTANCE)/qmacro, DIRINDEX=clientaccesspolicy.xml 
icm/HTTP/file_access_2 = PREFIX=/crossdomain.xml, 
   DOCROOT=$(DIR_INSTANCE)/qmacro, DIRINDEX=crossdomain.xml</code></pre>
<p>(I already have <code>file_access_0</code> specifying something else not relevant here).</p>
<p>What are these parameters saying? Well the PREFIX specifies the relative URL to match, the DOCROOT specifies the directory that the ICM is to serve files from in response to requests matching the PREFIX, and DIRINDEX is a file to serve when the 'index' is requested. Usually the PREFIX is used to specify a directory, or a relative URL representing a 'container', so the DIRINDEX value is what's served when there's a request for exactly that container. The upshot is that the relevant file is served for the right relative resource. The files are in directory <code>/usr/sap/NPL/DVEBMGS42/qmacro/</code>.</p>
<p>While we're at it, we might as well specify a similar File Access handler parameter to serve the favicon, not least because that will prevent those pesky warnings about not being able to serve requests for that resource, if you don't have one already:</p>
<pre class="language-text" tabindex="0"><code class="language-text">icm/HTTP/file_access_3 = PREFIX=/favicon.ico, 
  DOCROOT=$(DIR_INSTANCE)/qmacro, DIRINDEX=favicon.ico</code></pre>
<p>The upshot of all this is that the static XML resources are served directly by the ICM, without the request even having to permeate up as far as the ABAP stack:</p>
<pre class="language-log" tabindex="0"><code class="language-log"><span class="token property">Handler 5:</span> <span class="token property">HttpFileAccessHandler matches url:</span> <span class="token file-path string">/clientaccesspolicy.xml</span> 
<span class="token property">HttpSubHandlerCall:</span> <span class="token property">Call Handler:</span> HttpFileAccessHandler <span class="token operator">(</span><span class="token number">1089830</span><span class="token operator">/</span><span class="token number">1088cf0</span><span class="token operator">)</span><span class="token punctuation">,</span> task<span class="token operator">=</span>TASK_REQUEST<span class="token operator">(</span><span class="token number">1</span><span class="token operator">)</span><span class="token punctuation">,</span> header_len<span class="token operator">=</span><span class="token number">407</span> 
<span class="token property">HttpFileAccessHandler:</span> <span class="token property">access file/dir:</span> <span class="token file-path string">/usr/sap/NPL/DVEBMGS42/qmacro</span> 
<span class="token property">HttpFileAccessHandler:</span> file <span class="token file-path string">/usr/sap/NPL/DVEBMGS42/qmacro/clientaccesspolicy.xml</span> modified<span class="token operator">:</span> <span class="token operator">-</span><span class="token number">1</span><span class="token operator">/</span><span class="token number">1326386676</span> 
<span class="token property">HttpSubHandlerItDeactivate:</span> <span class="token property">handler 4:</span> HttpFileAccessHandler 
<span class="token property">HttpSubHandlerClose:</span> <span class="token property">Call Handler:</span> HttpFileAccessHandler <span class="token operator">(</span><span class="token number">1089830</span><span class="token operator">/</span><span class="token number">1088cf0</span><span class="token operator">)</span><span class="token punctuation">,</span> task<span class="token operator">=</span>TASK_CLOSE<span class="token operator">(</span><span class="token number">3</span><span class="token operator">)</span></code></pre>
<p>and also that the browser-based Sesame Data Browser can access your Gateway OData resources successfully:</p>
<p>(Sesame Data Browser Screenshot lost in SAP community platform migration)</p>
<p>Success!</p>
<p>If you're interested in learning more about the Internet Communication Manager (ICM) and the Internet Communication Framework (ICF), you might be interested in my Omniversity of Manchester course:</p>
<p><a href="https://docs.google.com/presentation/d/1vudzwL0K2HlLC9SX6hBv42Nqe-00QIUJde4-EW326b8/edit">Web Programming with SAP's Internet Communication Framework</a></p>
<p>Which is currently running in March (3rd and 4th) and May (9th and 10th) in Manchester.</p>
<p><a href="https://blogs.sap.com/2012/01/31/making-odata-from-sap-accessible-with-the-icms-help/">Originally published on SAP Community</a></p>



<script src="https://utteranc.es/client.js" repo="qmacro/qmacro.github.io" issue-term="title" crossorigin="anonymous" async=""></script>

<ul class="links-nextprev"><li class="links-nextprev-prev">← Previous<br> <a href="/blog/posts/2012/01/25/sap-icf-course-marketing-video/">SAP ICF course marketing: video!</a></li><li class="links-nextprev-next">Next →<br><a href="/blog/posts/2012/02/13/sapui5-says-hello-odata-to-netweaver-gateway/">SAPUI5 says &quot;Hello OData&quot; to NetWeaver Gateway</a></li>
</ul>

			</heading-anchors>
		</main>

		<!-- This page `/blog/posts/2012/01/31/making-odata-from-sap-accessible-with-the-icms-help/` was built on 2026-01-10T15:26:00.063Z -->
		<script type="module" src="/dist/t-8sxMV3B9.js"></script>
	</body>
</html>
