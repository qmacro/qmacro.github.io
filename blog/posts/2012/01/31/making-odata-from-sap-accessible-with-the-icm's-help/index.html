<!doctype html><html lang="en"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1"><link rel="canonical" href="https://qmacro.org/blog/posts/2012/01/31/making-odata-from-sap-accessible-with-the-icm&#39;s-help/"><link rel="alternate" type="application/atom+xml" title="DJ's Weblog - Feed" href="https://qmacro.org/feed.xml"><link href="/assets/main.7884d8f8e9dd86c3b137.css" rel="stylesheet"><link rel="preconnect" href="https://fonts.gstatic.com"><link href="https://fonts.googleapis.com/css2?family=IBM+Plex+Sans&display=swap" rel="stylesheet"><title>Making OData from SAP accessible with the ICM&#39;s help | DJ Adams</title><link rel="icon" type="“image/x-icon”" href="/images/favicon.ico"><meta property="og:title" content="Making OData from SAP accessible with the ICM&#39;s help"><meta property="og:site_name" content="DJ Adams"><meta property="og:type" content="website"><meta property="og:url" content="https://qmacro.org/blog/posts/2012/01/31/making-odata-from-sap-accessible-with-the-icm&#39;s-help/"><meta name="description" content="Making OData from SAP accessible with the ICM&amp;#39;s help 31 Jan 2012 | 3 min read I&#39;m totally enamoured by the power and potential of SAP&#39;s..."><meta property="og:description" content="Making OData from SAP accessible with the ICM&amp;#39;s help 31 Jan 2012 | 3 min read I&#39;m totally enamoured by the power and potential of SAP&#39;s..."><meta name="description" content="Making OData from SAP accessible with the ICM&amp;#39;s help 31 Jan 2012 | 3 min read I&#39;m totally enamoured by the power and potential of SAP&#39;s..."><meta property="og:image" content="https://qmacro.org/images/site-image.png"><script src="https://cdn.jsdelivr.net/npm/mermaid/dist/mermaid.min.js"></script><script>mermaid.initialize({startOnLoad:true});</script><script async src="https://www.googletagmanager.com/gtag/js?id=G-4WQKBG0L4Y"></script><script>window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());

      gtag('config', 'G-4WQKBG0L4Y');</script></head><body><div class="layout-wrapper"><header class="header"><div class="header__content"><h1 class="site-title"><a href="/">DJ Adams</a></h1><nav class="nav"><ul class="nav__list"><li class="nav-item"><a href="/about">About Me</a></li><li class="nav-item"><a href="/blog">Blog</a></li><li class="nav-item"><a href="/feed.xml">Feed</a></li></ul></nav></div></header><main class="main"><article class="post"><header class="post__header"><h1>Making OData from SAP accessible with the ICM&#39;s help</h1><div class="post__details"><time datetime="2012-01-31">31 Jan 2012 </time><span>| </span><span>3 min read</span></div></header><main class="post__content"><p>I'm totally enamoured by the power and potential of SAP's <a href="https://blogs.sap.com/2012/11/13/gateway-and-duet-enterprise-day-one-in-madrid/">NetWeaver Gateway</a>, and all it has to offer with its REST-informed data-centric consumption model. One of the tools I've been looking at in exploring the services is the Sesame Data Browser, a Silverlight-based application that runs inside the browser or on the desktop, and lets you explore OData resources.</p><p>One of the challenges in getting the Data Browser to consume OData resources exposed by NetWeaver Gateway (get a trial version, available from the Gateway home page on SDN) was serving a couple of XML-based domain access directive files as described in &quot;<a href="https://learn.microsoft.com/en-us/previous-versions/windows/silverlight/dotnet-windows-silverlight/cc197955(v=vs.95)?redirectedfrom=MSDN">Making a Service Available Across Domain Boundaries</a>&quot; - namely <code>clientaccesspolicy.xml</code> and <code>crossdomain.xml</code>, both needing to be served from the root of the domain/port based URL of the Gateway system. In other words, the NetWeaver stack needed to serve requests for these two resources:</p><pre class="language-url"><code class="language-url"><span class="token scheme">http<span class="token scheme-delimiter">:</span></span><span class="token authority"><span class="token authority-delimiter">//</span><span class="token host">hostname</span><span class="token port-segment"><span class="token port-delimiter">:</span></span></span><span class="token path">port<span class="token path-separator">/</span>clientaccesspolicy.xml</span></code></pre><p>and</p><pre class="language-url"><code class="language-url"><span class="token scheme">http<span class="token scheme-delimiter">:</span></span><span class="token authority"><span class="token authority-delimiter">//</span><span class="token host">hostname</span><span class="token port-segment"><span class="token port-delimiter">:</span></span></span><span class="token path">port<span class="token path-separator">/</span>crossdomain.xml</span></code></pre><p>Without these files, the Data Browser will show you this sort of error:</p><pre class="language-text"><code class="language-text">A SecurityException has been encountered while opening the connection. <br>Please try to open the connection with Sesame installed on the desktop. <br>If you are the owner of the OData feed, try to add a clientaccesspolicy.xml <br>file on the server.--</code></pre><p>So, how to make these two cross domain access files available, and specifically from the root? There have been some thoughts on this already, <a href="https://web.archive.org/web/20200115083108/http://www.plinky.it/blog/2009/03/09/add-crossdomainxml-on-the-root-of-sap-web-application-server/">using a default service on the ICF's default host definition</a>, or even dynamically loading the XML as a file into the server cache (see the ABAP program in <a href="https://web.archive.org/web/20130628092517/http://scn.sap.com/thread/281050">this thread in the RIA dev forum</a>).</p><p>But a conversation on Twitter last night about BSPs, raw ICF and even the ICM reminded me that the ICM is a powerful engine that is often overlooked and underloved. The ICM - Internet Communication Manager - is the collection of core HTTP/SMTP/plugin services that sits underneath the ICF, and handle the actual HTTP traffic below the level of the ICF's ABAP layer. In the style of <a href="https://httpd.apache.org/docs/trunk/handler.html">Apache handlers</a>, there are a series of handlers that the ICM has to deal with plenty of HTTP serving situations - Logging, Authentication, Server Cache, Administration, Modification, File Access, Redirect, as well as the &quot;ABAP&quot; handler we know as the ICF layer.</p><p>Could the humble ICM help with serving these two XML resources? Of course it could!</p><p>The File Access handler is what we recognise from the level 2 trace info in the dev_icm tracefile as HttpFileAccessHandler. You all read the verbose traces from the ICM with your morning coffee, right? Just kidding. Anyway, the File Access handler makes its features available to us in the form of the <a href="http://help.sap.com/saphelp_nw70ehp2/helpdata/en/48/3e1b4e252f72d0e10000000a42189c/frameset.htm">icm/HTTP/file_access_<xx></xx></a>profile parameters. It allows us to point the ICM at a directory on the filesystem and have it serve files directly, if a URL is matched. Note that this File Access handler is invoked, and given a chance to respond, before we even get to the ABAP handler's ICF level.</p><p>With a couple of these file_access parameters, we can serve static <code>clientaccesspolicy.xml</code> and <code>crossdomain.xml</code> files straight from the filesystem, matched at root. Here's what I have in my <code>/usr/sap/NPL/SYS/profile/NPL_DVEBMGS42_nplhost</code> parameter file:</p><pre class="language-text"><code class="language-text">icm/HTTP/file_access_1 = PREFIX=/clientaccesspolicy.xml, <br>   DOCROOT=$(DIR_INSTANCE)/qmacro, DIRINDEX=clientaccesspolicy.xml <br>icm/HTTP/file_access_2 = PREFIX=/crossdomain.xml, <br>   DOCROOT=$(DIR_INSTANCE)/qmacro, DIRINDEX=crossdomain.xml</code></pre><p>(I already have <code>file_access_0</code> specifying something else not relevant here).</p><p>What are these parameters saying? Well the PREFIX specifies the relative URL to match, the DOCROOT specifies the directory that the ICM is to serve files from in response to requests matching the PREFIX, and DIRINDEX is a file to serve when the 'index' is requested. Usually the PREFIX is used to specify a directory, or a relative URL representing a 'container', so the DIRINDEX value is what's served when there's a request for exactly that container. The upshot is that the relevant file is served for the right relative resource. The files are in directory <code>/usr/sap/NPL/DVEBMGS42/qmacro/</code>.</p><p>While we're at it, we might as well specify a similar File Access handler parameter to serve the favicon, not least because that will prevent those pesky warnings about not being able to serve requests for that resource, if you don't have one already:</p><pre class="language-text"><code class="language-text">icm/HTTP/file_access_3 = PREFIX=/favicon.ico, <br>  DOCROOT=$(DIR_INSTANCE)/qmacro, DIRINDEX=favicon.ico</code></pre><p>The upshot of all this is that the static XML resources are served directly by the ICM, without the request even having to permeate up as far as the ABAP stack:</p><pre class="language-log"><code class="language-log"><span class="token property">Handler 5:</span> <span class="token property">HttpFileAccessHandler matches url:</span> <span class="token file-path string">/clientaccesspolicy.xml</span> <br><span class="token property">HttpSubHandlerCall:</span> <span class="token property">Call Handler:</span> HttpFileAccessHandler <span class="token operator">(</span><span class="token number">1089830</span><span class="token operator">/</span><span class="token number">1088cf0</span><span class="token operator">)</span><span class="token punctuation">,</span> task<span class="token operator">=</span>TASK_REQUEST<span class="token operator">(</span><span class="token number">1</span><span class="token operator">)</span><span class="token punctuation">,</span> header_len<span class="token operator">=</span><span class="token number">407</span> <br><span class="token property">HttpFileAccessHandler:</span> <span class="token property">access file/dir:</span> <span class="token file-path string">/usr/sap/NPL/DVEBMGS42/qmacro</span> <br><span class="token property">HttpFileAccessHandler:</span> file <span class="token file-path string">/usr/sap/NPL/DVEBMGS42/qmacro/clientaccesspolicy.xml</span> modified<span class="token operator">:</span> <span class="token operator">-</span><span class="token number">1</span><span class="token operator">/</span><span class="token number">1326386676</span> <br><span class="token property">HttpSubHandlerItDeactivate:</span> <span class="token property">handler 4:</span> HttpFileAccessHandler <br><span class="token property">HttpSubHandlerClose:</span> <span class="token property">Call Handler:</span> HttpFileAccessHandler <span class="token operator">(</span><span class="token number">1089830</span><span class="token operator">/</span><span class="token number">1088cf0</span><span class="token operator">)</span><span class="token punctuation">,</span> task<span class="token operator">=</span>TASK_CLOSE<span class="token operator">(</span><span class="token number">3</span><span class="token operator">)</span></code></pre><p>and also that the browser-based Sesame Data Browser can access your Gateway OData resources successfully:</p><p>(Sesame Data Browser Screenshot lost in SAP community platform migration)</p><p>Success!</p><p>If you're interested in learning more about the Internet Communication Manager (ICM) and the Internet Communication Framework (ICF), you might be interested in my Omniversity of Manchester course:</p><p><a href="https://docs.google.com/presentation/d/1vudzwL0K2HlLC9SX6hBv42Nqe-00QIUJde4-EW326b8/edit">Web Programming with SAP's Internet Communication Framework</a></p><p>Which is currently running in March (3rd and 4th) and May (9th and 10th) in Manchester.</p><p><a href="https://blogs.sap.com/2012/01/31/making-odata-from-sap-accessible-with-the-icms-help/">Originally published on SAP Community</a></p></main><aside class="post__aside"><div class="post__tags"><a href="/tags/sapcommunity/">#sapcommunity</a></div><style>.utterances {
  margin-left: inherit !important;
}</style><script src="https://utteranc.es/client.js" repo="qmacro/qmacro.github.io" issue-term="title" crossorigin="anonymous" async></script><nav class="post__pagination"><a href="/blog/posts/2012/02/13/sapui5-says-&quot;hello-odata&quot;-to-netweaver-gateway/"><span>←</span> <span>SAPUI5 says &quot;Hello OData&quot; to NetWeaver Gateway</span> </a><a href="/blog/posts/2012/01/25/sap-icf-course-marketing:-video!/"><span>SAP ICF course marketing: video!</span> <span>→</span></a></nav></aside></article></main><footer class="footer"><div class="footer__content"><ul class="hero__social-links"><li><a rel="me" href="https://github.com/qmacro" target="_blank" rel="noopener noreferrer">GitHub</a></li><li><a rel="me" href="https://www.youtube.com/djadams-qmacro" target="_blank" rel="noopener noreferrer">YouTube</a></li><li><a rel="me" href="https://www.linkedin.com/in/djadams/" target="_blank" rel="noopener noreferrer">LinkedIn</a></li><li><a rel="me" href="/tweets/">Tweet Archive</a></li><li><a rel="me" href="https://hachyderm.io/@qmacro" target="_blank" rel="noopener noreferrer">Mastodon</a></li><li><a rel="me" href="https://bsky.app/profile/qmacro.org" target="_blank" rel="noopener noreferrer">Bluesky</a></li><li><a href="/feed.xml" target="_blank" rel="noopener noreferrer">RSS</a></li></ul></div></footer></div><script src="/assets/main.31d6cfe0d16ae931b73c.js"></script></body></html>