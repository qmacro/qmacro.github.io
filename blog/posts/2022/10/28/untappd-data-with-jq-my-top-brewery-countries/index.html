<!doctype html><html lang="en"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1"><link rel="canonical" href="https://qmacro.org/blog/posts/2022/10/28/untappd-data-with-jq-my-top-brewery-countries/"><link href="/assets/main.f502db4e74c7edd25353.css" rel="stylesheet"><link rel="preconnect" href="https://fonts.gstatic.com"><link href="https://fonts.googleapis.com/css2?family=IBM+Plex+Sans&display=swap" rel="stylesheet"><title>Untappd data with jq - my top brewery countries | DJ Adams</title><link rel="icon" type="“image/x-icon”" href="/images/favicon.ico"><meta property="og:title" content="Untappd data with jq - my top brewery countries"><meta property="og:site_name" content="DJ Adams"><meta property="og:type" content="website"><meta property="og:url" content="https://qmacro.org/blog/posts/2022/10/28/untappd-data-with-jq-my-top-brewery-countries/"><meta name="twitter:card" content="summary_large_image"><meta name="twitter:creator" content="@qmacro"><meta name="description" content="Untappd data with jq - my top brewery countries 28 Oct 2022 | 6 min read In this short post I explore my Untappd checkin data with jq,..."><meta property="og:description" content="Untappd data with jq - my top brewery countries 28 Oct 2022 | 6 min read In this short post I explore my Untappd checkin data with jq,..."><meta name="description" content="Untappd data with jq - my top brewery countries 28 Oct 2022 | 6 min read In this short post I explore my Untappd checkin data with jq,..."><meta property="og:image" content="https://qmacro.org/images/site-image.png"><meta name="twitter:image" content="https://qmacro.org/images/site-image.png"><script src="https://cdn.jsdelivr.net/npm/mermaid/dist/mermaid.min.js"></script><script>mermaid.initialize({startOnLoad:true});</script><script async src="https://www.googletagmanager.com/gtag/js?id=G-4WQKBG0L4Y"></script><script>window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());

      gtag('config', 'G-4WQKBG0L4Y');</script></head><body><div class="layout-wrapper"><header class="header"><div class="header__content"><h1 class="site-title"><a href="/">DJ Adams</a></h1><nav class="nav"><ul class="nav__list"><li class="nav-item"><a href="/about">About Me</a></li><li class="nav-item"><a href="/talks">Talks</a></li><li class="nav-item"><a href="/blog">Blog</a></li><li class="nav-item"><a href="/feed.xml">Feed</a></li></ul></nav></div></header><main class="main"><article class="post"><header class="post__header"><h1>Untappd data with jq - my top brewery countries</h1><div class="post__details"><time datetime="2022-10-28">28 Oct 2022 </time><span>| </span><span>6 min read</span></div></header><main class="post__content"><p>In this short post I explore my Untappd checkin data with <code>jq</code>, because it's a nice data set to practise my limited filtering fu upon, and also to get my blogging flowing again.</p><p><img src="/images/2022/10/untappd-profile.png" alt="My profile on Untappd"></p><p>I'm an <a href="https://untappd.com/user/qmacro">Untappd supporter</a> and an early adopter, joining in early November 12 years ago in 2010. Recently Untappd <a href="https://twitter.com/untappd/status/1584908973135859717">celebrated 12 years of operation and 10 million users</a>. It got me thinking back to my <a href="https://untappd.com/user/qmacro/checkin/11215/">very first checkin</a> (it was a Leffe Brune, in case you're wondering) and then I remembered that as an Untappd supporter I could get access to my entire checkin history, in JSON.</p><h2>The Untappd checkin data</h2><p>The JSON data is quite simple - it's a single file (I've called it <code>checkins.json</code>) containing an array of checkin objects, where each object looks like this:</p><pre class="language-json"><code class="language-json"><span class="token punctuation">{</span><br>  <span class="token property">"beer_name"</span><span class="token operator">:</span> <span class="token string">"Leffe Brune / Bruin"</span><span class="token punctuation">,</span><br>  <span class="token property">"brewery_name"</span><span class="token operator">:</span> <span class="token string">"Abbaye de Leffe"</span><span class="token punctuation">,</span><br>  <span class="token property">"beer_type"</span><span class="token operator">:</span> <span class="token string">"Brown Ale - Belgian"</span><span class="token punctuation">,</span><br>  <span class="token property">"beer_abv"</span><span class="token operator">:</span> <span class="token string">"6.5"</span><span class="token punctuation">,</span><br>  <span class="token property">"beer_ibu"</span><span class="token operator">:</span> <span class="token string">"20"</span><span class="token punctuation">,</span><br>  <span class="token property">"comment"</span><span class="token operator">:</span> <span class="token string">"Christening Untappd with this, a fav of mine."</span><span class="token punctuation">,</span><br>  <span class="token property">"venue_name"</span><span class="token operator">:</span> <span class="token null keyword">null</span><span class="token punctuation">,</span><br>  <span class="token property">"venue_city"</span><span class="token operator">:</span> <span class="token null keyword">null</span><span class="token punctuation">,</span><br>  <span class="token property">"venue_state"</span><span class="token operator">:</span> <span class="token null keyword">null</span><span class="token punctuation">,</span><br>  <span class="token property">"venue_country"</span><span class="token operator">:</span> <span class="token null keyword">null</span><span class="token punctuation">,</span><br>  <span class="token property">"venue_lat"</span><span class="token operator">:</span> <span class="token null keyword">null</span><span class="token punctuation">,</span><br>  <span class="token property">"venue_lng"</span><span class="token operator">:</span> <span class="token null keyword">null</span><span class="token punctuation">,</span><br>  <span class="token property">"rating_score"</span><span class="token operator">:</span> <span class="token string">"5"</span><span class="token punctuation">,</span><br>  <span class="token property">"created_at"</span><span class="token operator">:</span> <span class="token string">"2010-11-08 18:52:02"</span><span class="token punctuation">,</span><br>  <span class="token property">"checkin_url"</span><span class="token operator">:</span> <span class="token string">"https://untappd.com/c/11215"</span><span class="token punctuation">,</span><br>  <span class="token property">"beer_url"</span><span class="token operator">:</span> <span class="token string">"https://untappd.com/beer/5941"</span><span class="token punctuation">,</span><br>  <span class="token property">"brewery_url"</span><span class="token operator">:</span> <span class="token string">"https://untappd.com/brewery/5"</span><span class="token punctuation">,</span><br>  <span class="token property">"brewery_country"</span><span class="token operator">:</span> <span class="token string">"Belgium"</span><span class="token punctuation">,</span><br>  <span class="token property">"brewery_city"</span><span class="token operator">:</span> <span class="token string">"Leuven"</span><span class="token punctuation">,</span><br>  <span class="token property">"brewery_state"</span><span class="token operator">:</span> <span class="token string">"Vlaanderen"</span><span class="token punctuation">,</span><br>  <span class="token property">"flavor_profiles"</span><span class="token operator">:</span> <span class="token string">""</span><span class="token punctuation">,</span><br>  <span class="token property">"purchase_venue"</span><span class="token operator">:</span> <span class="token string">""</span><span class="token punctuation">,</span><br>  <span class="token property">"serving_type"</span><span class="token operator">:</span> <span class="token string">""</span><span class="token punctuation">,</span><br>  <span class="token property">"checkin_id"</span><span class="token operator">:</span> <span class="token string">"11215"</span><span class="token punctuation">,</span><br>  <span class="token property">"bid"</span><span class="token operator">:</span> <span class="token string">"5941"</span><span class="token punctuation">,</span><br>  <span class="token property">"brewery_id"</span><span class="token operator">:</span> <span class="token string">"5"</span><span class="token punctuation">,</span><br>  <span class="token property">"photo_url"</span><span class="token operator">:</span> <span class="token null keyword">null</span><span class="token punctuation">,</span><br>  <span class="token property">"global_rating_score"</span><span class="token operator">:</span> <span class="token number">3.55</span><span class="token punctuation">,</span><br>  <span class="token property">"global_weighted_rating_score"</span><span class="token operator">:</span> <span class="token number">3.55</span><span class="token punctuation">,</span><br>  <span class="token property">"tagged_friends"</span><span class="token operator">:</span> <span class="token string">""</span><span class="token punctuation">,</span><br>  <span class="token property">"total_toasts"</span><span class="token operator">:</span> <span class="token string">"1"</span><span class="token punctuation">,</span><br>  <span class="token property">"total_comments"</span><span class="token operator">:</span> <span class="token string">"0"</span><br><span class="token punctuation">}</span></code></pre><p>(OK, I put my <code>rating_score</code> of 5 down to excitement at a new beer rating app).</p><h2>My top brewery countries</h2><p>Noting that my first checkin was to a beer from Belgium (see the value for the <code>brewery_country</code> property) I thought it would be a nice exercise to discover the top brewery countries for the beers I've checked in.</p><h3>Reducing the data set</h3><p>To keep the data compact for this blog post, I decided to analyse just the latest 20 checkins, rather than the entire <a href="https://untappd.com/user/qmacro">four thousand plus</a>. And for the purposes of experimentation and illustration, I only really need to see the beer name, brewery name and brewery country.</p><p>So I start my analysis like this:</p><pre class="language-bash"><code class="language-bash"><span class="token operator">&lt;</span> checkins.json jq <span class="token string">'<br>.[-20:]<br>| map({beer_name, brewery_name, brewery_country})<br>'</span></code></pre><blockquote><p>Note the use of a negative index on the <a href="https://stedolan.github.io/jq/manual/#Array/StringSlice:.%5B10:15%5D">array slice</a> here - which causes the slice to start from counting backwards from the end of the array. Note also that I'm invoking <code>jq</code> and passing in the data in a slightly different way than I have done before (such as in <a href="/blog/posts/2022/06/16/summing-and-grouping-values-with-jq/">Summing and grouping values with jq</a>). Instead of specifying a filename (<code>jq filter filename</code>) I'm using redirection to pass the contents of the <code>filename</code> to <code>jq</code>'s STDIN: <code>&lt; filename jq filter</code>.</p></blockquote><p>This gives us a much smaller data set to think about, but which has enough variation to have the analysis also make sense:</p><pre class="language-json"><code class="language-json"><span class="token punctuation">[</span><br>  <span class="token punctuation">{</span><br>    <span class="token property">"beer_name"</span><span class="token operator">:</span> <span class="token string">"Kentucky Breakfast Stout (KBS)"</span><span class="token punctuation">,</span><br>    <span class="token property">"brewery_name"</span><span class="token operator">:</span> <span class="token string">"Founders Brewing Co."</span><span class="token punctuation">,</span><br>    <span class="token property">"brewery_country"</span><span class="token operator">:</span> <span class="token string">"United States"</span><br>  <span class="token punctuation">}</span><span class="token punctuation">,</span><br>  <span class="token punctuation">{</span><br>    <span class="token property">"beer_name"</span><span class="token operator">:</span> <span class="token string">"Gueuze Tilquin – Draft Version"</span><span class="token punctuation">,</span><br>    <span class="token property">"brewery_name"</span><span class="token operator">:</span> <span class="token string">"Gueuzerie Tilquin"</span><span class="token punctuation">,</span><br>    <span class="token property">"brewery_country"</span><span class="token operator">:</span> <span class="token string">"Belgium"</span><br>  <span class="token punctuation">}</span><span class="token punctuation">,</span><br>  <span class="token punctuation">{</span><br>    <span class="token property">"beer_name"</span><span class="token operator">:</span> <span class="token string">"Zwanze 2022 - Poivre De Gorilles"</span><span class="token punctuation">,</span><br>    <span class="token property">"brewery_name"</span><span class="token operator">:</span> <span class="token string">"Brasserie Cantillon"</span><span class="token punctuation">,</span><br>    <span class="token property">"brewery_country"</span><span class="token operator">:</span> <span class="token string">"Belgium"</span><br>  <span class="token punctuation">}</span><span class="token punctuation">,</span><br>  <span class="token punctuation">{</span><br>    <span class="token property">"beer_name"</span><span class="token operator">:</span> <span class="token string">"Moeder Imperiale"</span><span class="token punctuation">,</span><br>    <span class="token property">"brewery_name"</span><span class="token operator">:</span> <span class="token string">"La Source Beer Co."</span><span class="token punctuation">,</span><br>    <span class="token property">"brewery_country"</span><span class="token operator">:</span> <span class="token string">"Belgium"</span><br>  <span class="token punctuation">}</span><span class="token punctuation">,</span><br>  <span class="token punctuation">{</span><br>    <span class="token property">"beer_name"</span><span class="token operator">:</span> <span class="token string">"Supersonic"</span><span class="token punctuation">,</span><br>    <span class="token property">"brewery_name"</span><span class="token operator">:</span> <span class="token string">"LERVIG"</span><span class="token punctuation">,</span><br>    <span class="token property">"brewery_country"</span><span class="token operator">:</span> <span class="token string">"Norway"</span><br>  <span class="token punctuation">}</span><span class="token punctuation">,</span><br>  <span class="token punctuation">{</span><br>    <span class="token property">"beer_name"</span><span class="token operator">:</span> <span class="token string">"Illuminati"</span><span class="token punctuation">,</span><br>    <span class="token property">"brewery_name"</span><span class="token operator">:</span> <span class="token string">"Leelanau Brewing Company"</span><span class="token punctuation">,</span><br>    <span class="token property">"brewery_country"</span><span class="token operator">:</span> <span class="token string">"United States"</span><br>  <span class="token punctuation">}</span><span class="token punctuation">,</span><br>  <span class="token punctuation">{</span><br>    <span class="token property">"beer_name"</span><span class="token operator">:</span> <span class="token string">"Out of Vogue"</span><span class="token punctuation">,</span><br>    <span class="token property">"brewery_name"</span><span class="token operator">:</span> <span class="token string">"Burning Sky Brewery"</span><span class="token punctuation">,</span><br>    <span class="token property">"brewery_country"</span><span class="token operator">:</span> <span class="token string">"England"</span><br>  <span class="token punctuation">}</span><span class="token punctuation">,</span><br>  <span class="token punctuation">{</span><br>    <span class="token property">"beer_name"</span><span class="token operator">:</span> <span class="token string">"SDIPA Strata"</span><span class="token punctuation">,</span><br>    <span class="token property">"brewery_name"</span><span class="token operator">:</span> <span class="token string">"Vault City Brewing"</span><span class="token punctuation">,</span><br>    <span class="token property">"brewery_country"</span><span class="token operator">:</span> <span class="token string">"Scotland"</span><br>  <span class="token punctuation">}</span><span class="token punctuation">,</span><br>  <span class="token punctuation">{</span><br>    <span class="token property">"beer_name"</span><span class="token operator">:</span> <span class="token string">"Petrus Dubbel"</span><span class="token punctuation">,</span><br>    <span class="token property">"brewery_name"</span><span class="token operator">:</span> <span class="token string">"Brouwerij De Brabandere"</span><span class="token punctuation">,</span><br>    <span class="token property">"brewery_country"</span><span class="token operator">:</span> <span class="token string">"Belgium"</span><br>  <span class="token punctuation">}</span><span class="token punctuation">,</span><br>  <span class="token punctuation">{</span><br>    <span class="token property">"beer_name"</span><span class="token operator">:</span> <span class="token string">"Outlaw"</span><span class="token punctuation">,</span><br>    <span class="token property">"brewery_name"</span><span class="token operator">:</span> <span class="token string">"Distant Hills"</span><span class="token punctuation">,</span><br>    <span class="token property">"brewery_country"</span><span class="token operator">:</span> <span class="token string">"England"</span><br>  <span class="token punctuation">}</span><span class="token punctuation">,</span><br>  <span class="token punctuation">{</span><br>    <span class="token property">"beer_name"</span><span class="token operator">:</span> <span class="token string">"North X Neon Raptor Imperial Stout + Cacao + Peanut + Banana"</span><span class="token punctuation">,</span><br>    <span class="token property">"brewery_name"</span><span class="token operator">:</span> <span class="token string">"North Brewing Co."</span><span class="token punctuation">,</span><br>    <span class="token property">"brewery_country"</span><span class="token operator">:</span> <span class="token string">"England"</span><br>  <span class="token punctuation">}</span><span class="token punctuation">,</span><br>  <span class="token punctuation">{</span><br>    <span class="token property">"beer_name"</span><span class="token operator">:</span> <span class="token string">"Sweet Temptation"</span><span class="token punctuation">,</span><br>    <span class="token property">"brewery_name"</span><span class="token operator">:</span> <span class="token string">"Vocation Brewery"</span><span class="token punctuation">,</span><br>    <span class="token property">"brewery_country"</span><span class="token operator">:</span> <span class="token string">"England"</span><br>  <span class="token punctuation">}</span><span class="token punctuation">,</span><br>  <span class="token punctuation">{</span><br>    <span class="token property">"beer_name"</span><span class="token operator">:</span> <span class="token string">"Turns"</span><span class="token punctuation">,</span><br>    <span class="token property">"brewery_name"</span><span class="token operator">:</span> <span class="token string">"Siren Craft Brew"</span><span class="token punctuation">,</span><br>    <span class="token property">"brewery_country"</span><span class="token operator">:</span> <span class="token string">"England"</span><br>  <span class="token punctuation">}</span><span class="token punctuation">,</span><br>  <span class="token punctuation">{</span><br>    <span class="token property">"beer_name"</span><span class="token operator">:</span> <span class="token string">"Abt 12"</span><span class="token punctuation">,</span><br>    <span class="token property">"brewery_name"</span><span class="token operator">:</span> <span class="token string">"Brouwerij St.Bernardus"</span><span class="token punctuation">,</span><br>    <span class="token property">"brewery_country"</span><span class="token operator">:</span> <span class="token string">"Belgium"</span><br>  <span class="token punctuation">}</span><span class="token punctuation">,</span><br>  <span class="token punctuation">{</span><br>    <span class="token property">"beer_name"</span><span class="token operator">:</span> <span class="token string">"Interference Is Temporary"</span><span class="token punctuation">,</span><br>    <span class="token property">"brewery_name"</span><span class="token operator">:</span> <span class="token string">"Cloudwater Brew Co."</span><span class="token punctuation">,</span><br>    <span class="token property">"brewery_country"</span><span class="token operator">:</span> <span class="token string">"England"</span><br>  <span class="token punctuation">}</span><span class="token punctuation">,</span><br>  <span class="token punctuation">{</span><br>    <span class="token property">"beer_name"</span><span class="token operator">:</span> <span class="token string">"Liquid Art"</span><span class="token punctuation">,</span><br>    <span class="token property">"brewery_name"</span><span class="token operator">:</span> <span class="token string">"Prizm Brewing Co."</span><span class="token punctuation">,</span><br>    <span class="token property">"brewery_country"</span><span class="token operator">:</span> <span class="token string">"France"</span><br>  <span class="token punctuation">}</span><span class="token punctuation">,</span><br>  <span class="token punctuation">{</span><br>    <span class="token property">"beer_name"</span><span class="token operator">:</span> <span class="token string">"Have You Got Cask Or Is It All Craft?"</span><span class="token punctuation">,</span><br>    <span class="token property">"brewery_name"</span><span class="token operator">:</span> <span class="token string">"DEYA Brewing Company"</span><span class="token punctuation">,</span><br>    <span class="token property">"brewery_country"</span><span class="token operator">:</span> <span class="token string">"England"</span><br>  <span class="token punctuation">}</span><span class="token punctuation">,</span><br>  <span class="token punctuation">{</span><br>    <span class="token property">"beer_name"</span><span class="token operator">:</span> <span class="token string">"DIVINE FAITH // DIPA (2022)"</span><span class="token punctuation">,</span><br>    <span class="token property">"brewery_name"</span><span class="token operator">:</span> <span class="token string">"Northern Monk"</span><span class="token punctuation">,</span><br>    <span class="token property">"brewery_country"</span><span class="token operator">:</span> <span class="token string">"England"</span><br>  <span class="token punctuation">}</span><span class="token punctuation">,</span><br>  <span class="token punctuation">{</span><br>    <span class="token property">"beer_name"</span><span class="token operator">:</span> <span class="token string">"Silver King"</span><span class="token punctuation">,</span><br>    <span class="token property">"brewery_name"</span><span class="token operator">:</span> <span class="token string">"Ossett Brewery"</span><span class="token punctuation">,</span><br>    <span class="token property">"brewery_country"</span><span class="token operator">:</span> <span class="token string">"England"</span><br>  <span class="token punctuation">}</span><span class="token punctuation">,</span><br>  <span class="token punctuation">{</span><br>    <span class="token property">"beer_name"</span><span class="token operator">:</span> <span class="token string">"HEATHEN // HAZY IPA"</span><span class="token punctuation">,</span><br>    <span class="token property">"brewery_name"</span><span class="token operator">:</span> <span class="token string">"Northern Monk"</span><span class="token punctuation">,</span><br>    <span class="token property">"brewery_country"</span><span class="token operator">:</span> <span class="token string">"England"</span><br>  <span class="token punctuation">}</span><br><span class="token punctuation">]</span></code></pre><h2>Grouping by brewery country</h2><p>Well the first thing I want to do is arrange the checkin objects by brewery country. Using <a href="https://stedolan.github.io/jq/manual/#group_by(path_expression)">group_by</a> produces a set of subarrays, like this:</p><pre class="language-bash"><code class="language-bash"><span class="token operator">&lt;</span> checkins.json jq <span class="token string">'<br>.[-20:]<br>| map({beer_name, brewery_name, brewery_country})<br>| group_by(.brewery_country)<br>'</span></code></pre><p>This results in a set of subarrays, one for each brewery country, as we'd expect. Note the new <code>[ [ ... ], [ ... ], ... ]</code> structure:</p><pre class="language-json"><code class="language-json"><span class="token punctuation">[</span><br>  <span class="token punctuation">[</span><br>    <span class="token punctuation">{</span><br>      <span class="token property">"beer_name"</span><span class="token operator">:</span> <span class="token string">"Gueuze Tilquin – Draft Version"</span><span class="token punctuation">,</span><br>      <span class="token property">"brewery_name"</span><span class="token operator">:</span> <span class="token string">"Gueuzerie Tilquin"</span><span class="token punctuation">,</span><br>      <span class="token property">"brewery_country"</span><span class="token operator">:</span> <span class="token string">"Belgium"</span><br>    <span class="token punctuation">}</span><span class="token punctuation">,</span><br>    <span class="token punctuation">{</span><br>      <span class="token property">"beer_name"</span><span class="token operator">:</span> <span class="token string">"Zwanze 2022 - Poivre De Gorilles"</span><span class="token punctuation">,</span><br>      <span class="token property">"brewery_name"</span><span class="token operator">:</span> <span class="token string">"Brasserie Cantillon"</span><span class="token punctuation">,</span><br>      <span class="token property">"brewery_country"</span><span class="token operator">:</span> <span class="token string">"Belgium"</span><br>    <span class="token punctuation">}</span><span class="token punctuation">,</span><br>    <span class="token punctuation">{</span><br>      <span class="token property">"beer_name"</span><span class="token operator">:</span> <span class="token string">"Moeder Imperiale"</span><span class="token punctuation">,</span><br>      <span class="token property">"brewery_name"</span><span class="token operator">:</span> <span class="token string">"La Source Beer Co."</span><span class="token punctuation">,</span><br>      <span class="token property">"brewery_country"</span><span class="token operator">:</span> <span class="token string">"Belgium"</span><br>    <span class="token punctuation">}</span><span class="token punctuation">,</span><br>    <span class="token punctuation">{</span><br>      <span class="token property">"beer_name"</span><span class="token operator">:</span> <span class="token string">"Petrus Dubbel"</span><span class="token punctuation">,</span><br>      <span class="token property">"brewery_name"</span><span class="token operator">:</span> <span class="token string">"Brouwerij De Brabandere"</span><span class="token punctuation">,</span><br>      <span class="token property">"brewery_country"</span><span class="token operator">:</span> <span class="token string">"Belgium"</span><br>    <span class="token punctuation">}</span><span class="token punctuation">,</span><br>    <span class="token punctuation">{</span><br>      <span class="token property">"beer_name"</span><span class="token operator">:</span> <span class="token string">"Abt 12"</span><span class="token punctuation">,</span><br>      <span class="token property">"brewery_name"</span><span class="token operator">:</span> <span class="token string">"Brouwerij St.Bernardus"</span><span class="token punctuation">,</span><br>      <span class="token property">"brewery_country"</span><span class="token operator">:</span> <span class="token string">"Belgium"</span><br>    <span class="token punctuation">}</span><br>  <span class="token punctuation">]</span><span class="token punctuation">,</span><br>  <span class="token punctuation">[</span><br>    <span class="token punctuation">{</span><br>      <span class="token property">"beer_name"</span><span class="token operator">:</span> <span class="token string">"Out of Vogue"</span><span class="token punctuation">,</span><br>      <span class="token property">"brewery_name"</span><span class="token operator">:</span> <span class="token string">"Burning Sky Brewery"</span><span class="token punctuation">,</span><br>      <span class="token property">"brewery_country"</span><span class="token operator">:</span> <span class="token string">"England"</span><br>    <span class="token punctuation">}</span><span class="token punctuation">,</span><br>    <span class="token punctuation">{</span><br>      <span class="token property">"beer_name"</span><span class="token operator">:</span> <span class="token string">"Outlaw"</span><span class="token punctuation">,</span><br>      <span class="token property">"brewery_name"</span><span class="token operator">:</span> <span class="token string">"Distant Hills"</span><span class="token punctuation">,</span><br>      <span class="token property">"brewery_country"</span><span class="token operator">:</span> <span class="token string">"England"</span><br>    <span class="token punctuation">}</span><span class="token punctuation">,</span><br>    <span class="token punctuation">{</span><br>      <span class="token property">"beer_name"</span><span class="token operator">:</span> <span class="token string">"North X Neon Raptor Imperial Stout + Cacao + Peanut + Banana"</span><span class="token punctuation">,</span><br>      <span class="token property">"brewery_name"</span><span class="token operator">:</span> <span class="token string">"North Brewing Co."</span><span class="token punctuation">,</span><br>      <span class="token property">"brewery_country"</span><span class="token operator">:</span> <span class="token string">"England"</span><br>    <span class="token punctuation">}</span><span class="token punctuation">,</span><br>    <span class="token punctuation">{</span><br>      <span class="token property">"beer_name"</span><span class="token operator">:</span> <span class="token string">"Sweet Temptation"</span><span class="token punctuation">,</span><br>      <span class="token property">"brewery_name"</span><span class="token operator">:</span> <span class="token string">"Vocation Brewery"</span><span class="token punctuation">,</span><br>      <span class="token property">"brewery_country"</span><span class="token operator">:</span> <span class="token string">"England"</span><br>    <span class="token punctuation">}</span><span class="token punctuation">,</span><br>    <span class="token punctuation">{</span><br>      <span class="token property">"beer_name"</span><span class="token operator">:</span> <span class="token string">"Turns"</span><span class="token punctuation">,</span><br>      <span class="token property">"brewery_name"</span><span class="token operator">:</span> <span class="token string">"Siren Craft Brew"</span><span class="token punctuation">,</span><br>      <span class="token property">"brewery_country"</span><span class="token operator">:</span> <span class="token string">"England"</span><br>    <span class="token punctuation">}</span><span class="token punctuation">,</span><br>    <span class="token punctuation">{</span><br>      <span class="token property">"beer_name"</span><span class="token operator">:</span> <span class="token string">"Interference Is Temporary"</span><span class="token punctuation">,</span><br>      <span class="token property">"brewery_name"</span><span class="token operator">:</span> <span class="token string">"Cloudwater Brew Co."</span><span class="token punctuation">,</span><br>      <span class="token property">"brewery_country"</span><span class="token operator">:</span> <span class="token string">"England"</span><br>    <span class="token punctuation">}</span><span class="token punctuation">,</span><br>    <span class="token punctuation">{</span><br>      <span class="token property">"beer_name"</span><span class="token operator">:</span> <span class="token string">"Have You Got Cask Or Is It All Craft?"</span><span class="token punctuation">,</span><br>      <span class="token property">"brewery_name"</span><span class="token operator">:</span> <span class="token string">"DEYA Brewing Company"</span><span class="token punctuation">,</span><br>      <span class="token property">"brewery_country"</span><span class="token operator">:</span> <span class="token string">"England"</span><br>    <span class="token punctuation">}</span><span class="token punctuation">,</span><br>    <span class="token punctuation">{</span><br>      <span class="token property">"beer_name"</span><span class="token operator">:</span> <span class="token string">"DIVINE FAITH // DIPA (2022)"</span><span class="token punctuation">,</span><br>      <span class="token property">"brewery_name"</span><span class="token operator">:</span> <span class="token string">"Northern Monk"</span><span class="token punctuation">,</span><br>      <span class="token property">"brewery_country"</span><span class="token operator">:</span> <span class="token string">"England"</span><br>    <span class="token punctuation">}</span><span class="token punctuation">,</span><br>    <span class="token punctuation">{</span><br>      <span class="token property">"beer_name"</span><span class="token operator">:</span> <span class="token string">"Silver King"</span><span class="token punctuation">,</span><br>      <span class="token property">"brewery_name"</span><span class="token operator">:</span> <span class="token string">"Ossett Brewery"</span><span class="token punctuation">,</span><br>      <span class="token property">"brewery_country"</span><span class="token operator">:</span> <span class="token string">"England"</span><br>    <span class="token punctuation">}</span><span class="token punctuation">,</span><br>    <span class="token punctuation">{</span><br>      <span class="token property">"beer_name"</span><span class="token operator">:</span> <span class="token string">"HEATHEN // HAZY IPA"</span><span class="token punctuation">,</span><br>      <span class="token property">"brewery_name"</span><span class="token operator">:</span> <span class="token string">"Northern Monk"</span><span class="token punctuation">,</span><br>      <span class="token property">"brewery_country"</span><span class="token operator">:</span> <span class="token string">"England"</span><br>    <span class="token punctuation">}</span><br>  <span class="token punctuation">]</span><span class="token punctuation">,</span><br>  <span class="token punctuation">[</span><br>    <span class="token punctuation">{</span><br>      <span class="token property">"beer_name"</span><span class="token operator">:</span> <span class="token string">"Liquid Art"</span><span class="token punctuation">,</span><br>      <span class="token property">"brewery_name"</span><span class="token operator">:</span> <span class="token string">"Prizm Brewing Co."</span><span class="token punctuation">,</span><br>      <span class="token property">"brewery_country"</span><span class="token operator">:</span> <span class="token string">"France"</span><br>    <span class="token punctuation">}</span><br>  <span class="token punctuation">]</span><span class="token punctuation">,</span><br>  <span class="token punctuation">[</span><br>    <span class="token punctuation">{</span><br>      <span class="token property">"beer_name"</span><span class="token operator">:</span> <span class="token string">"Supersonic"</span><span class="token punctuation">,</span><br>      <span class="token property">"brewery_name"</span><span class="token operator">:</span> <span class="token string">"LERVIG"</span><span class="token punctuation">,</span><br>      <span class="token property">"brewery_country"</span><span class="token operator">:</span> <span class="token string">"Norway"</span><br>    <span class="token punctuation">}</span><br>  <span class="token punctuation">]</span><span class="token punctuation">,</span><br>  <span class="token punctuation">[</span><br>    <span class="token punctuation">{</span><br>      <span class="token property">"beer_name"</span><span class="token operator">:</span> <span class="token string">"SDIPA Strata"</span><span class="token punctuation">,</span><br>      <span class="token property">"brewery_name"</span><span class="token operator">:</span> <span class="token string">"Vault City Brewing"</span><span class="token punctuation">,</span><br>      <span class="token property">"brewery_country"</span><span class="token operator">:</span> <span class="token string">"Scotland"</span><br>    <span class="token punctuation">}</span><br>  <span class="token punctuation">]</span><span class="token punctuation">,</span><br>  <span class="token punctuation">[</span><br>    <span class="token punctuation">{</span><br>      <span class="token property">"beer_name"</span><span class="token operator">:</span> <span class="token string">"Kentucky Breakfast Stout (KBS)"</span><span class="token punctuation">,</span><br>      <span class="token property">"brewery_name"</span><span class="token operator">:</span> <span class="token string">"Founders Brewing Co."</span><span class="token punctuation">,</span><br>      <span class="token property">"brewery_country"</span><span class="token operator">:</span> <span class="token string">"United States"</span><br>    <span class="token punctuation">}</span><span class="token punctuation">,</span><br>    <span class="token punctuation">{</span><br>      <span class="token property">"beer_name"</span><span class="token operator">:</span> <span class="token string">"Illuminati"</span><span class="token punctuation">,</span><br>      <span class="token property">"brewery_name"</span><span class="token operator">:</span> <span class="token string">"Leelanau Brewing Company"</span><span class="token punctuation">,</span><br>      <span class="token property">"brewery_country"</span><span class="token operator">:</span> <span class="token string">"United States"</span><br>    <span class="token punctuation">}</span><br>  <span class="token punctuation">]</span><br><span class="token punctuation">]</span></code></pre><h2>Arranging by brewery country and count</h2><p>Each of the subarrays has a length equal to the count of checkins for that country, clearly. So I can use this and gather the data into a key/value structure that I can then use further down the line with the <a href="https://stedolan.github.io/jq/manual/#to_entries,from_entries,with_entries">entries</a> family of functions.</p><pre class="language-bash"><code class="language-bash"><span class="token operator">&lt;</span> checkins.json jq <span class="token string">'<br>.[-20:]<br>| map({beer_name, brewery_name, brewery_country})<br>| group_by(.brewery_country)<br>| map({key: first.brewery_country, value: length})<br>'</span></code></pre><p>This has the effect of turning the subarrays into objects:</p><pre class="language-json"><code class="language-json"><span class="token punctuation">[</span><br>  <span class="token punctuation">{</span><br>    <span class="token property">"key"</span><span class="token operator">:</span> <span class="token string">"Belgium"</span><span class="token punctuation">,</span><br>    <span class="token property">"value"</span><span class="token operator">:</span> <span class="token number">5</span><br>  <span class="token punctuation">}</span><span class="token punctuation">,</span><br>  <span class="token punctuation">{</span><br>    <span class="token property">"key"</span><span class="token operator">:</span> <span class="token string">"England"</span><span class="token punctuation">,</span><br>    <span class="token property">"value"</span><span class="token operator">:</span> <span class="token number">10</span><br>  <span class="token punctuation">}</span><span class="token punctuation">,</span><br>  <span class="token punctuation">{</span><br>    <span class="token property">"key"</span><span class="token operator">:</span> <span class="token string">"France"</span><span class="token punctuation">,</span><br>    <span class="token property">"value"</span><span class="token operator">:</span> <span class="token number">1</span><br>  <span class="token punctuation">}</span><span class="token punctuation">,</span><br>  <span class="token punctuation">{</span><br>    <span class="token property">"key"</span><span class="token operator">:</span> <span class="token string">"Norway"</span><span class="token punctuation">,</span><br>    <span class="token property">"value"</span><span class="token operator">:</span> <span class="token number">1</span><br>  <span class="token punctuation">}</span><span class="token punctuation">,</span><br>  <span class="token punctuation">{</span><br>    <span class="token property">"key"</span><span class="token operator">:</span> <span class="token string">"Scotland"</span><span class="token punctuation">,</span><br>    <span class="token property">"value"</span><span class="token operator">:</span> <span class="token number">1</span><br>  <span class="token punctuation">}</span><span class="token punctuation">,</span><br>  <span class="token punctuation">{</span><br>    <span class="token property">"key"</span><span class="token operator">:</span> <span class="token string">"United States"</span><span class="token punctuation">,</span><br>    <span class="token property">"value"</span><span class="token operator">:</span> <span class="token number">2</span><br>  <span class="token punctuation">}</span><br><span class="token punctuation">]</span></code></pre><p>I could have mapped the subarrays slightly differently, like this:</p><pre class="language-bash"><code class="language-bash"><span class="token operator">&lt;</span> checkins.json jq <span class="token string">'<br>.[-20:]<br>| map({beer_name, brewery_name, brewery_country})<br>| group_by(.brewery_country)<br>| map({(first.brewery_country): length})<br>'</span></code></pre><p>which would have produced an arguably neater result:</p><pre class="language-json"><code class="language-json"><span class="token punctuation">[</span><br>  <span class="token punctuation">{</span><br>    <span class="token property">"Belgium"</span><span class="token operator">:</span> <span class="token number">5</span><br>  <span class="token punctuation">}</span><span class="token punctuation">,</span><br>  <span class="token punctuation">{</span><br>    <span class="token property">"England"</span><span class="token operator">:</span> <span class="token number">10</span><br>  <span class="token punctuation">}</span><span class="token punctuation">,</span><br>  <span class="token punctuation">{</span><br>    <span class="token property">"France"</span><span class="token operator">:</span> <span class="token number">1</span><br>  <span class="token punctuation">}</span><span class="token punctuation">,</span><br>  <span class="token punctuation">{</span><br>    <span class="token property">"Norway"</span><span class="token operator">:</span> <span class="token number">1</span><br>  <span class="token punctuation">}</span><span class="token punctuation">,</span><br>  <span class="token punctuation">{</span><br>    <span class="token property">"Scotland"</span><span class="token operator">:</span> <span class="token number">1</span><br>  <span class="token punctuation">}</span><span class="token punctuation">,</span><br>  <span class="token punctuation">{</span><br>    <span class="token property">"United States"</span><span class="token operator">:</span> <span class="token number">2</span><br>  <span class="token punctuation">}</span><br><span class="token punctuation">]</span></code></pre><p>The problem with this result is that it's now harder to sort by the count, because there's no stable property to refer to for sorting. So we'll stick with the use of <code>key</code> and <code>value</code> properties.</p><h2>Sorting</h2><p>It's now time to sort, and I want the most popular brewery country at the top, so I'll also need to reverse the sorted output:</p><pre class="language-bash"><code class="language-bash"><span class="token operator">&lt;</span> checkins.json jq <span class="token string">'<br>.[-20:]<br>| map({beer_name, brewery_name, brewery_country})<br>| group_by(.brewery_country)<br>| map({key: first.brewery_country, value: length})<br>| sort_by(.value)<br>| reverse<br>'</span></code></pre><p>This produces what we're expecting:</p><pre class="language-json"><code class="language-json"><span class="token punctuation">[</span><br>  <span class="token punctuation">{</span><br>    <span class="token property">"key"</span><span class="token operator">:</span> <span class="token string">"England"</span><span class="token punctuation">,</span><br>    <span class="token property">"value"</span><span class="token operator">:</span> <span class="token number">10</span><br>  <span class="token punctuation">}</span><span class="token punctuation">,</span><br>  <span class="token punctuation">{</span><br>    <span class="token property">"key"</span><span class="token operator">:</span> <span class="token string">"Belgium"</span><span class="token punctuation">,</span><br>    <span class="token property">"value"</span><span class="token operator">:</span> <span class="token number">5</span><br>  <span class="token punctuation">}</span><span class="token punctuation">,</span><br>  <span class="token punctuation">{</span><br>    <span class="token property">"key"</span><span class="token operator">:</span> <span class="token string">"United States"</span><span class="token punctuation">,</span><br>    <span class="token property">"value"</span><span class="token operator">:</span> <span class="token number">2</span><br>  <span class="token punctuation">}</span><span class="token punctuation">,</span><br>  <span class="token punctuation">{</span><br>    <span class="token property">"key"</span><span class="token operator">:</span> <span class="token string">"Scotland"</span><span class="token punctuation">,</span><br>    <span class="token property">"value"</span><span class="token operator">:</span> <span class="token number">1</span><br>  <span class="token punctuation">}</span><span class="token punctuation">,</span><br>  <span class="token punctuation">{</span><br>    <span class="token property">"key"</span><span class="token operator">:</span> <span class="token string">"Norway"</span><span class="token punctuation">,</span><br>    <span class="token property">"value"</span><span class="token operator">:</span> <span class="token number">1</span><br>  <span class="token punctuation">}</span><span class="token punctuation">,</span><br>  <span class="token punctuation">{</span><br>    <span class="token property">"key"</span><span class="token operator">:</span> <span class="token string">"France"</span><span class="token punctuation">,</span><br>    <span class="token property">"value"</span><span class="token operator">:</span> <span class="token number">1</span><br>  <span class="token punctuation">}</span><br><span class="token punctuation">]</span></code></pre><h2>Arranging into the final structure</h2><p>Now I have the core data computed and organised as required, I can neaten it up using the <code>from_entries</code> function, which expects <code>key</code> and <code>value</code> property names:</p><pre class="language-bash"><code class="language-bash"><span class="token operator">&lt;</span> checkins.json jq <span class="token string">'<br>.[-20:]<br>| map({beer_name, brewery_name, brewery_country})<br>| group_by(.brewery_country)<br>| map({key: first.brewery_country, value: length})<br>| sort_by(.value)<br>| reverse<br>| from_entries<br>'</span></code></pre><p>And I get an even better version of what I almost went for when I was first arranging by brewery country and count:</p><pre class="language-json"><code class="language-json"><span class="token punctuation">{</span><br>  <span class="token property">"England"</span><span class="token operator">:</span> <span class="token number">10</span><span class="token punctuation">,</span><br>  <span class="token property">"Belgium"</span><span class="token operator">:</span> <span class="token number">5</span><span class="token punctuation">,</span><br>  <span class="token property">"United States"</span><span class="token operator">:</span> <span class="token number">2</span><span class="token punctuation">,</span><br>  <span class="token property">"Scotland"</span><span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span><br>  <span class="token property">"Norway"</span><span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span><br>  <span class="token property">"France"</span><span class="token operator">:</span> <span class="token number">1</span><br><span class="token punctuation">}</span></code></pre><p>That'll do nicely.</p><h2>Running the filter on the entire data set</h2><p>Now I'm happy with the result, I can remove the first two parts of the filter (which were there just for a quick experiment) so that the results reflect my entire history checkin:</p><pre class="language-bash"><code class="language-bash"><span class="token operator">&lt;</span> checkins.json jq <span class="token string">'<br>group_by(.brewery_country)<br>| map({key: first.brewery_country, value: length})<br>| sort_by(.value)<br>| reverse<br>| from_entries<br>'</span></code></pre><p>This gives me the following result:</p><pre class="language-json"><code class="language-json"><span class="token punctuation">{</span><br>  <span class="token property">"England"</span><span class="token operator">:</span> <span class="token number">2518</span><span class="token punctuation">,</span><br>  <span class="token property">"United States"</span><span class="token operator">:</span> <span class="token number">590</span><span class="token punctuation">,</span><br>  <span class="token property">"Belgium"</span><span class="token operator">:</span> <span class="token number">497</span><span class="token punctuation">,</span><br>  <span class="token property">"Scotland"</span><span class="token operator">:</span> <span class="token number">157</span><span class="token punctuation">,</span><br>  <span class="token property">"Netherlands"</span><span class="token operator">:</span> <span class="token number">123</span><span class="token punctuation">,</span><br>  <span class="token property">"Denmark"</span><span class="token operator">:</span> <span class="token number">97</span><span class="token punctuation">,</span><br>  <span class="token property">"Germany"</span><span class="token operator">:</span> <span class="token number">79</span><span class="token punctuation">,</span><br>  <span class="token property">"Wales"</span><span class="token operator">:</span> <span class="token number">70</span><span class="token punctuation">,</span><br>  <span class="token property">"Spain"</span><span class="token operator">:</span> <span class="token number">69</span><span class="token punctuation">,</span><br>  <span class="token property">"Norway"</span><span class="token operator">:</span> <span class="token number">40</span><span class="token punctuation">,</span><br>  <span class="token property">"Ireland"</span><span class="token operator">:</span> <span class="token number">29</span><span class="token punctuation">,</span><br>  <span class="token property">"Sweden"</span><span class="token operator">:</span> <span class="token number">25</span><span class="token punctuation">,</span><br>  <span class="token property">"Italy"</span><span class="token operator">:</span> <span class="token number">20</span><span class="token punctuation">,</span><br>  <span class="token property">"France"</span><span class="token operator">:</span> <span class="token number">19</span><span class="token punctuation">,</span><br>  <span class="token property">"Australia"</span><span class="token operator">:</span> <span class="token number">17</span><span class="token punctuation">,</span><br>  <span class="token property">"Estonia"</span><span class="token operator">:</span> <span class="token number">16</span><span class="token punctuation">,</span><br>  <span class="token property">"Poland"</span><span class="token operator">:</span> <span class="token number">13</span><span class="token punctuation">,</span><br>  <span class="token property">"New Zealand"</span><span class="token operator">:</span> <span class="token number">13</span><span class="token punctuation">,</span><br>  <span class="token property">"Latvia"</span><span class="token operator">:</span> <span class="token number">10</span><span class="token punctuation">,</span><br>  <span class="token property">"Japan"</span><span class="token operator">:</span> <span class="token number">10</span><span class="token punctuation">,</span><br>  <span class="token property">"United Kingdom"</span><span class="token operator">:</span> <span class="token number">6</span><span class="token punctuation">,</span><br>  <span class="token property">"Northern Ireland"</span><span class="token operator">:</span> <span class="token number">5</span><span class="token punctuation">,</span><br>  <span class="token property">"India"</span><span class="token operator">:</span> <span class="token number">5</span><span class="token punctuation">,</span><br>  <span class="token property">"Austria"</span><span class="token operator">:</span> <span class="token number">5</span><span class="token punctuation">,</span><br>  <span class="token property">"Iceland"</span><span class="token operator">:</span> <span class="token number">3</span><span class="token punctuation">,</span><br>  <span class="token property">"Greece"</span><span class="token operator">:</span> <span class="token number">3</span><span class="token punctuation">,</span><br>  <span class="token property">"Croatia"</span><span class="token operator">:</span> <span class="token number">3</span><span class="token punctuation">,</span><br>  <span class="token property">"Canada"</span><span class="token operator">:</span> <span class="token number">3</span><span class="token punctuation">,</span><br>  <span class="token property">"Turkey"</span><span class="token operator">:</span> <span class="token number">2</span><span class="token punctuation">,</span><br>  <span class="token property">"Switzerland"</span><span class="token operator">:</span> <span class="token number">2</span><span class="token punctuation">,</span><br>  <span class="token property">"South Africa"</span><span class="token operator">:</span> <span class="token number">2</span><span class="token punctuation">,</span><br>  <span class="token property">"Portugal"</span><span class="token operator">:</span> <span class="token number">2</span><span class="token punctuation">,</span><br>  <span class="token property">"Lithuania"</span><span class="token operator">:</span> <span class="token number">2</span><span class="token punctuation">,</span><br>  <span class="token property">"Hungary"</span><span class="token operator">:</span> <span class="token number">2</span><span class="token punctuation">,</span><br>  <span class="token property">"Channel Islands"</span><span class="token operator">:</span> <span class="token number">2</span><span class="token punctuation">,</span><br>  <span class="token property">"Romania"</span><span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span><br>  <span class="token property">"Malta"</span><span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span><br>  <span class="token property">"Hong Kong"</span><span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span><br>  <span class="token property">"Finland"</span><span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span><br>  <span class="token property">"Czech Republic"</span><span class="token operator">:</span> <span class="token number">1</span><br><span class="token punctuation">}</span></code></pre><p>Given my beer tastes and my location, I don't think that's a surprising result. But nice to have it confirmed. Cheers and happy 12th birthday Untappd! 🍻</p></main><aside class="post__aside"><div class="post__tags"><a href="/tags/jq/">#jq</a> <a href="/tags/untappd/">#untappd</a> <a href="/tags/beer/">#beer</a></div><style>.utterances {
  margin-left: inherit !important;
}</style><script src="https://utteranc.es/client.js" repo="qmacro/qmacro.github.io" issue-term="title" crossorigin="anonymous" async></script><nav class="post__pagination"><a href="/blog/posts/2022/06/23/understanding-jq&#39;s-sql-style-operators-join-and-index/"><span>Understanding jq&#39;s SQL style operators JOIN and INDEX</span> <span>→</span></a></nav></aside></article></main><footer class="footer"><div class="footer__content"><ul class="hero__social-links"><li><a href="https://github.com/qmacro" target="_blank" rel="noopener noreferrer">GitHub</a></li><li><a href="https://www.youtube.com/djadams-qmacro" target="_blank" rel="noopener noreferrer">YouTube</a></li><li><a href="https://twitter.com/qmacro" target="_blank" rel="noopener noreferrer">Twitter</a></li><li><a href="/feed.xml" target="_blank" rel="noopener noreferrer">RSS</a></li></ul></div></footer></div><script src="/assets/main.31d6cfe0d16ae931b73c.js"></script></body></html>