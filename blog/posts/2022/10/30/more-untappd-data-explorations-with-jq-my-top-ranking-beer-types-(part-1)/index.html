<!doctype html><html lang="en"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1"><link rel="canonical" href="https://qmacro.org/blog/posts/2022/10/30/more-untappd-data-explorations-with-jq-my-top-ranking-beer-types-(part-1)/"><link rel="alternate" type="application/atom+xml" title="DJ's Weblog - Feed" href="https://qmacro.org/feed.xml"><link href="/assets/main.7884d8f8e9dd86c3b137.css" rel="stylesheet"><link rel="preconnect" href="https://fonts.gstatic.com"><link href="https://fonts.googleapis.com/css2?family=IBM+Plex+Sans&display=swap" rel="stylesheet"><title>More Untappd data explorations with jq - my top ranking beer types (part 1) | DJ Adams</title><link rel="icon" type="“image/x-icon”" href="/images/favicon.ico"><meta property="og:title" content="More Untappd data explorations with jq - my top ranking beer types (part 1)"><meta property="og:site_name" content="DJ Adams"><meta property="og:type" content="website"><meta property="og:url" content="https://qmacro.org/blog/posts/2022/10/30/more-untappd-data-explorations-with-jq-my-top-ranking-beer-types-(part-1)/"><meta name="description" content="More Untappd data explorations with jq - my top ranking beer types (part 1) 30 Oct 2022 | 4 min read I&#39;ve been exploring my Untappd data a..."><meta property="og:description" content="More Untappd data explorations with jq - my top ranking beer types (part 1) 30 Oct 2022 | 4 min read I&#39;ve been exploring my Untappd data a..."><meta name="description" content="More Untappd data explorations with jq - my top ranking beer types (part 1) 30 Oct 2022 | 4 min read I&#39;ve been exploring my Untappd data a..."><meta property="og:image" content="https://qmacro.org/images/site-image.png"><script src="https://cdn.jsdelivr.net/npm/mermaid/dist/mermaid.min.js"></script><script>mermaid.initialize({startOnLoad:true});</script><script async src="https://www.googletagmanager.com/gtag/js?id=G-4WQKBG0L4Y"></script><script>window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());

      gtag('config', 'G-4WQKBG0L4Y');</script></head><body><div class="layout-wrapper"><header class="header"><div class="header__content"><h1 class="site-title"><a href="/">DJ Adams</a></h1><nav class="nav"><ul class="nav__list"><li class="nav-item"><a href="/about">About Me</a></li><li class="nav-item"><a href="/blog">Blog</a></li><li class="nav-item"><a href="/feed.xml">Feed</a></li></ul></nav></div></header><main class="main"><article class="post"><header class="post__header"><h1>More Untappd data explorations with jq - my top ranking beer types (part 1)</h1><div class="post__details"><time datetime="2022-10-30">30 Oct 2022 </time><span>| </span><span>4 min read</span></div></header><main class="post__content"><p>I've been exploring my Untappd data a bit more since <a href="/blog/posts/2022/10/28/untappd-data-with-jq-my-top-brewery-countries/">analysing my top brewery countries</a>, this time to see if my average ratings indicated anything about my preferred beer types. Here's what I've done so far, in part 1 of this little series.</p><p><a href="https://untappd.com/user/qmacro/checkin/658678850"><img src="/images/2022/10/dogfishhead-checkin.png" alt="a 5 star rating to a checkin of Dogfishhead's 90 Minute Imperial IPA"></a></p><p>Near the start of the previous post <a href="https://qmacro.org/blog/posts/2022/10/28/untappd-data-with-jq-my-top-brewery-countries/">Untappd data with jq - my top brewery countries</a> there's an example of a checkin object; here are some of the properties:</p><pre class="language-json"><code class="language-json"><span class="token punctuation">{</span><br>  <span class="token property">"beer_name"</span><span class="token operator">:</span> <span class="token string">"Leffe Brune / Bruin"</span><span class="token punctuation">,</span><br>  <span class="token property">"brewery_name"</span><span class="token operator">:</span> <span class="token string">"Abbaye de Leffe"</span><span class="token punctuation">,</span><br>  <span class="token property">"beer_type"</span><span class="token operator">:</span> <span class="token string">"Brown Ale - Belgian"</span><span class="token punctuation">,</span><br>  <span class="token property">"rating_score"</span><span class="token operator">:</span> <span class="token string">"5"</span><br><span class="token punctuation">}</span></code></pre><h2>What are the beer types?</h2><p>I wanted to know how (if at all) my rating was affected by my particular preferences on beer types. I started looking at what types existed in my checkin data. First, how many are we talking about here?</p><pre class="language-bash"><code class="language-bash"><span class="token operator">&lt;</span> checkins.json jq <span class="token string">'<br>map(.beer_type) | unique | length<br>'</span></code></pre><p>Wow, there are quite a few:</p><pre class="language-json"><code class="language-json"><span class="token number">177</span></code></pre><p>Let's have a look at the first 20:</p><pre class="language-bash"><code class="language-bash"><span class="token operator">&lt;</span> checkins.json jq <span class="token string">'<br>map(.beer_type) | unique[:20]<br>'</span></code></pre><blockquote><p>The <a href="https://stedolan.github.io/jq/manual/#unique,unique_by(path_exp)">unique</a> function produces a sorted list as well as removing duplicates.</p></blockquote><pre class="language-json"><code class="language-json"><span class="token punctuation">[</span><br>  <span class="token string">"Altbier"</span><span class="token punctuation">,</span><br>  <span class="token string">"Barleywine - American"</span><span class="token punctuation">,</span><br>  <span class="token string">"Barleywine - English"</span><span class="token punctuation">,</span><br>  <span class="token string">"Barleywine - Other"</span><span class="token punctuation">,</span><br>  <span class="token string">"Belgian Blonde"</span><span class="token punctuation">,</span><br>  <span class="token string">"Belgian Dubbel"</span><span class="token punctuation">,</span><br>  <span class="token string">"Belgian Quadrupel"</span><span class="token punctuation">,</span><br>  <span class="token string">"Belgian Strong Dark Ale"</span><span class="token punctuation">,</span><br>  <span class="token string">"Belgian Strong Golden Ale"</span><span class="token punctuation">,</span><br>  <span class="token string">"Belgian Tripel"</span><span class="token punctuation">,</span><br>  <span class="token string">"Bitter - Best"</span><span class="token punctuation">,</span><br>  <span class="token string">"Bitter - Extra Special / Strong (ESB)"</span><span class="token punctuation">,</span><br>  <span class="token string">"Bitter - Session / Ordinary"</span><span class="token punctuation">,</span><br>  <span class="token string">"Bière de Champagne / Bière Brut"</span><span class="token punctuation">,</span><br>  <span class="token string">"Black &amp; Tan"</span><span class="token punctuation">,</span><br>  <span class="token string">"Blonde Ale"</span><span class="token punctuation">,</span><br>  <span class="token string">"Bock - Doppelbock"</span><span class="token punctuation">,</span><br>  <span class="token string">"Bock - Eisbock"</span><span class="token punctuation">,</span><br>  <span class="token string">"Bock - Hell / Maibock / Lentebock"</span><span class="token punctuation">,</span><br>  <span class="token string">"Bock - Single / Traditional"</span><br><span class="token punctuation">]</span></code></pre><p>OK so there are quite a few.</p><h2>Reducing the number of types</h2><p>I might be able to be a little less granular if I just take whatever comes before the dash, if there is one. That would, for example, group together all the Bock types, and, for another example, all the IPAs, of which there are quite a few:</p><pre class="language-bash"><code class="language-bash"><span class="token operator">&lt;</span> checkins.json jq <span class="token string">'<br>map(.beer_type|select(startswith("IPA -"))) | unique<br>'</span></code></pre><p>As you can see:</p><pre class="language-json"><code class="language-json"><span class="token punctuation">[</span><br>  <span class="token string">"IPA - American"</span><span class="token punctuation">,</span><br>  <span class="token string">"IPA - Belgian"</span><span class="token punctuation">,</span><br>  <span class="token string">"IPA - Black / Cascadian Dark Ale"</span><span class="token punctuation">,</span><br>  <span class="token string">"IPA - Brett"</span><span class="token punctuation">,</span><br>  <span class="token string">"IPA - Brut"</span><span class="token punctuation">,</span><br>  <span class="token string">"IPA - Cold"</span><span class="token punctuation">,</span><br>  <span class="token string">"IPA - English"</span><span class="token punctuation">,</span><br>  <span class="token string">"IPA - Farmhouse"</span><span class="token punctuation">,</span><br>  <span class="token string">"IPA - Imperial / Double"</span><span class="token punctuation">,</span><br>  <span class="token string">"IPA - Imperial / Double Black"</span><span class="token punctuation">,</span><br>  <span class="token string">"IPA - Imperial / Double Milkshake"</span><span class="token punctuation">,</span><br>  <span class="token string">"IPA - Imperial / Double New England / Hazy"</span><span class="token punctuation">,</span><br>  <span class="token string">"IPA - Milkshake"</span><span class="token punctuation">,</span><br>  <span class="token string">"IPA - New England / Hazy"</span><span class="token punctuation">,</span><br>  <span class="token string">"IPA - New Zealand"</span><span class="token punctuation">,</span><br>  <span class="token string">"IPA - Other"</span><span class="token punctuation">,</span><br>  <span class="token string">"IPA - Red"</span><span class="token punctuation">,</span><br>  <span class="token string">"IPA - Rye"</span><span class="token punctuation">,</span><br>  <span class="token string">"IPA - Session"</span><span class="token punctuation">,</span><br>  <span class="token string">"IPA - Sour"</span><span class="token punctuation">,</span><br>  <span class="token string">"IPA - Triple"</span><span class="token punctuation">,</span><br>  <span class="token string">"IPA - Triple New England / Hazy"</span><span class="token punctuation">,</span><br>  <span class="token string">"IPA - White / Wheat"</span><br><span class="token punctuation">]</span></code></pre><p>So if I call the part before any dash the &quot;major&quot; type, how many of those are there? Hopefully fewer than 177. Let's work it out:</p><pre class="language-bash"><code class="language-bash"><span class="token operator">&lt;</span> checkins.json jq <span class="token string">'<br>map(.beer_type|split(" -")|first) | unique | length, .<br>'</span></code></pre><blockquote><p>Hold on though, what if a <code>beer_type</code> value doesn't have a dash? What will calling <code>split(&quot; -&quot;)</code> do here? Let's see:</p><pre class="language-bash"><code class="language-bash">jq <span class="token parameter variable">-n</span> <span class="token string">'<br>["Major - minor", "Some other type"] | map(split(" -")|first)<br>'</span></code></pre><p>(The <code>-n</code> option tells <code>jq</code> to use <code>null</code> as the single input value, effectively telling <code>jq</code> not to expect any JSON to be fed in).</p><p>This gives:</p><pre class="language-json"><code class="language-json"><span class="token punctuation">[</span><br>  <span class="token string">"Major"</span><span class="token punctuation">,</span><br>  <span class="token string">"Some other type"</span><br><span class="token punctuation">]</span></code></pre><p>This is what we want to happen.</p></blockquote><p>OK, let's run the filter, which gives:</p><pre class="language-json"><code class="language-json"><span class="token number">62</span><br><span class="token punctuation">[</span><br>  <span class="token string">"Altbier"</span><span class="token punctuation">,</span><br>  <span class="token string">"Barleywine"</span><span class="token punctuation">,</span><br>  <span class="token string">"Belgian Blonde"</span><span class="token punctuation">,</span><br>  <span class="token string">"Belgian Dubbel"</span><span class="token punctuation">,</span><br>  <span class="token string">"Belgian Quadrupel"</span><span class="token punctuation">,</span><br>  <span class="token string">"Belgian Strong Dark Ale"</span><span class="token punctuation">,</span><br>  <span class="token string">"Belgian Strong Golden Ale"</span><span class="token punctuation">,</span><br>  <span class="token string">"Belgian Tripel"</span><span class="token punctuation">,</span><br>  <span class="token string">"Bitter"</span><span class="token punctuation">,</span><br>  <span class="token string">"Bière de Champagne / Bière Brut"</span><span class="token punctuation">,</span><br>  <span class="token string">"Black &amp; Tan"</span><span class="token punctuation">,</span><br>  <span class="token string">"Blonde Ale"</span><span class="token punctuation">,</span><br>  <span class="token string">"Bock"</span><span class="token punctuation">,</span><br>  <span class="token string">"Brett Beer"</span><span class="token punctuation">,</span><br>  <span class="token string">"Brown Ale"</span><span class="token punctuation">,</span><br>  <span class="token string">"California Common"</span><span class="token punctuation">,</span><br>  <span class="token string">"Chilli / Chile Beer"</span><span class="token punctuation">,</span><br>  <span class="token string">"Cider"</span><span class="token punctuation">,</span><br>  <span class="token string">"Cream Ale"</span><span class="token punctuation">,</span><br>  <span class="token string">"Dark Ale"</span><span class="token punctuation">,</span><br>  <span class="token string">"Farmhouse Ale"</span><span class="token punctuation">,</span><br>  <span class="token string">"Freeze-Distilled Beer"</span><span class="token punctuation">,</span><br>  <span class="token string">"Fruit Beer"</span><span class="token punctuation">,</span><br>  <span class="token string">"Gluten-Free"</span><span class="token punctuation">,</span><br>  <span class="token string">"Golden Ale"</span><span class="token punctuation">,</span><br>  <span class="token string">"Grape Ale"</span><span class="token punctuation">,</span><br>  <span class="token string">"Historical Beer"</span><span class="token punctuation">,</span><br>  <span class="token string">"Honey Beer"</span><span class="token punctuation">,</span><br>  <span class="token string">"IPA"</span><span class="token punctuation">,</span><br>  <span class="token string">"Kellerbier / Zwickelbier"</span><span class="token punctuation">,</span><br>  <span class="token string">"Kölsch"</span><span class="token punctuation">,</span><br>  <span class="token string">"Lager"</span><span class="token punctuation">,</span><br>  <span class="token string">"Lambic"</span><span class="token punctuation">,</span><br>  <span class="token string">"Mead"</span><span class="token punctuation">,</span><br>  <span class="token string">"Mild"</span><span class="token punctuation">,</span><br>  <span class="token string">"Märzen"</span><span class="token punctuation">,</span><br>  <span class="token string">"Old Ale"</span><span class="token punctuation">,</span><br>  <span class="token string">"Pale Ale"</span><span class="token punctuation">,</span><br>  <span class="token string">"Pilsner"</span><span class="token punctuation">,</span><br>  <span class="token string">"Porter"</span><span class="token punctuation">,</span><br>  <span class="token string">"Rauchbier"</span><span class="token punctuation">,</span><br>  <span class="token string">"Red Ale"</span><span class="token punctuation">,</span><br>  <span class="token string">"Roggenbier"</span><span class="token punctuation">,</span><br>  <span class="token string">"Rye Beer"</span><span class="token punctuation">,</span><br>  <span class="token string">"Rye Wine"</span><span class="token punctuation">,</span><br>  <span class="token string">"Schwarzbier"</span><span class="token punctuation">,</span><br>  <span class="token string">"Scotch Ale / Wee Heavy"</span><span class="token punctuation">,</span><br>  <span class="token string">"Scottish Ale"</span><span class="token punctuation">,</span><br>  <span class="token string">"Scottish Export Ale"</span><span class="token punctuation">,</span><br>  <span class="token string">"Shandy / Radler"</span><span class="token punctuation">,</span><br>  <span class="token string">"Smoked Beer"</span><span class="token punctuation">,</span><br>  <span class="token string">"Sour"</span><span class="token punctuation">,</span><br>  <span class="token string">"Specialty Grain"</span><span class="token punctuation">,</span><br>  <span class="token string">"Spiced / Herbed Beer"</span><span class="token punctuation">,</span><br>  <span class="token string">"Stout"</span><span class="token punctuation">,</span><br>  <span class="token string">"Strong Ale"</span><span class="token punctuation">,</span><br>  <span class="token string">"Table Beer"</span><span class="token punctuation">,</span><br>  <span class="token string">"Traditional Ale"</span><span class="token punctuation">,</span><br>  <span class="token string">"Wheat Beer"</span><span class="token punctuation">,</span><br>  <span class="token string">"Wild Ale"</span><span class="token punctuation">,</span><br>  <span class="token string">"Winter Ale"</span><span class="token punctuation">,</span><br>  <span class="token string">"Winter Warmer"</span><br><span class="token punctuation">]</span></code></pre><blockquote><p>Note there are two JSON values - a scalar (62) and an array. I wanted the count, as well as all the names of the major types, and that's what was produced, as you can see, from <code>length</code> and <code>.</code> respectively. The interesting thing to note is that in the last part of the filter, <em>both</em> <code>length</code> and <code>.</code> were passed the output from the preceding expression (the output from <code>unique</code>); there was no need for any variable binding or explicit value passing.</p></blockquote><h2>Encoding a function</h2><p>That &quot;major type&quot; thing is something I'll likely use again, so it's worth considering creating a function for it.</p><blockquote><p>From now on, I'll stop showing the entire command line invocation (passing the file contents to <code>jq</code>, and specifying the filter in single quotes, also on the command line) and show just the <code>jq</code> expressions instead. That's mostly because I can then get it formatted a little nicer in these posts (with a bit of colour that's sensitive to <code>jq</code>'s syntax). I'll create a file <code>untappd.jq</code> to hold the <code>jq</code> expressions, so you just need to imagine that the invocations now look like this:</p><pre class="language-bash"><code class="language-bash"><span class="token operator">&lt;</span> checkins.json jq <span class="token parameter variable">-f</span> untappd.jq </code></pre></blockquote><p>The function is very simple and just encapsulates what we've done already, which is then replaced with a call to that function:</p><pre class="language-jq"><code class="language-jq"><span class="token keyword">def</span> <span class="token function">category</span><span class="token punctuation">:</span> <span class="token c-style-function function">split</span><span class="token punctuation">(</span><span class="token string">" -"</span><span class="token punctuation">)</span> <span class="token operator pipe">|</span> first<span class="token punctuation">;</span><br><br><span class="token c-style-function function">map</span><span class="token punctuation">(</span><span class="token punctuation">.</span>beer_type<span class="token operator pipe">|</span>category<span class="token punctuation">)</span> <span class="token operator pipe">|</span> unique <span class="token operator pipe">|</span> length<span class="token punctuation">,</span> <span class="token dot important">.</span></code></pre><p>I wasn't fond of the name &quot;major_type&quot; for the function, so I've come up with the name &quot;category&quot; instead.</p><h2>What's next</h2><p>That's the end of part 1. It looks like I have a manageable set of major beer types (categories) to use as a basis for this analysis. I've also got the feeling that the <code>jq</code> that I'll end up writing might be more than a few lines' worth, so I'm glad I've made the switch away from a &quot;one-liner&quot; to a file based filter.</p><p>In <a href="/blog/posts/2022/10/31/more-untappd-data-explorations-with-jq-my-top-ranking-beer-types-(part-2)/">part 2</a> I look at collecting my ratings across all the checkins, ready for averaging them by category.</p></main><aside class="post__aside"><div class="post__tags"><a href="/tags/jq-series-top-beer-types/">#jq-series-top-beer-types</a> <a href="/tags/untappd/">#untappd</a> <a href="/tags/jq/">#jq</a> <a href="/tags/beer/">#beer</a></div><style>.utterances {
  margin-left: inherit !important;
}</style><script src="https://utteranc.es/client.js" repo="qmacro/qmacro.github.io" issue-term="title" crossorigin="anonymous" async></script><nav class="post__pagination"><a href="/blog/posts/2022/10/31/stop-asking-for-slides-in-advance/"><span>←</span> <span>Stop asking for slides in advance</span> </a><a href="/blog/posts/2022/10/28/untappd-data-with-jq-my-top-brewery-countries/"><span>Untappd data with jq - my top brewery countries</span> <span>→</span></a></nav></aside></article></main><footer class="footer"><div class="footer__content"><ul class="hero__social-links"><li><a rel="me" href="https://github.com/qmacro" target="_blank" rel="noopener noreferrer">GitHub</a></li><li><a rel="me" href="https://www.youtube.com/djadams-qmacro" target="_blank" rel="noopener noreferrer">YouTube</a></li><li><a rel="me" href="https://www.linkedin.com/in/djadams/" target="_blank" rel="noopener noreferrer">LinkedIn</a></li><li><a rel="me" href="/tweets/">Tweet Archive</a></li><li><a rel="me" href="https://hachyderm.io/@qmacro" target="_blank" rel="noopener noreferrer">Mastodon</a></li><li><a rel="me" href="https://bsky.app/profile/qmacro.org" target="_blank" rel="noopener noreferrer">Bluesky</a></li><li><a href="/feed.xml" target="_blank" rel="noopener noreferrer">RSS</a></li></ul></div></footer></div><script src="/assets/main.31d6cfe0d16ae931b73c.js"></script></body></html>