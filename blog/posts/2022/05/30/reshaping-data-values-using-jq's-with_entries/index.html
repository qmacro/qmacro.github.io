<!doctype html><html lang="en"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1"><link rel="canonical" href="https://qmacro.org/blog/posts/2022/05/30/reshaping-data-values-using-jq&#39;s-with_entries/"><link href="/assets/main.5954faabb414863081bd.css" rel="stylesheet"><link rel="preconnect" href="https://fonts.gstatic.com"><link href="https://fonts.googleapis.com/css2?family=IBM+Plex+Sans&display=swap" rel="stylesheet"><title>Reshaping data values using jq&#39;s with_entries | DJ Adams</title><link rel="icon" type="“image/x-icon”" href="/images/favicon.ico"><meta property="og:title" content="Reshaping data values using jq&#39;s with_entries"><meta property="og:site_name" content="DJ Adams"><meta property="og:type" content="website"><meta property="og:url" content="https://qmacro.org/blog/posts/2022/05/30/reshaping-data-values-using-jq&#39;s-with_entries/"><meta name="twitter:card" content="summary_large_image"><meta name="twitter:creator" content="@qmacro"><meta name="description" content="Reshaping data values using jq&amp;#39;s with_entries 30 May 2022 | 4 min read Receipt of a JSON file containing valid tags for tutorial..."><meta property="og:description" content="Reshaping data values using jq&amp;#39;s with_entries 30 May 2022 | 4 min read Receipt of a JSON file containing valid tags for tutorial..."><meta name="description" content="Reshaping data values using jq&amp;#39;s with_entries 30 May 2022 | 4 min read Receipt of a JSON file containing valid tags for tutorial..."><meta property="og:image" content="https://qmacro.org/images/site-image.png"><meta name="twitter:image" content="https://qmacro.org/images/site-image.png"><script src="https://cdn.jsdelivr.net/npm/mermaid/dist/mermaid.min.js"></script><script>mermaid.initialize({startOnLoad:true});</script><script async src="https://www.googletagmanager.com/gtag/js?id=G-4WQKBG0L4Y"></script><script>window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());

      gtag('config', 'G-4WQKBG0L4Y');</script></head><body><div class="layout-wrapper"><header class="header"><div class="header__content"><h1 class="site-title"><a href="/">DJ Adams</a></h1><nav class="nav"><ul class="nav__list"><li class="nav-item"><a href="/about">About Me</a></li><li class="nav-item"><a href="/talks">Talks</a></li><li class="nav-item"><a href="/blog">Blog</a></li><li class="nav-item"><a href="/feed.xml">Feed</a></li></ul></nav></div></header><main class="main"><article class="post"><header class="post__header"><h1>Reshaping data values using jq&#39;s with_entries</h1><div class="post__details"><time datetime="2022-05-30">30 May 2022 </time><span>| </span><span>4 min read</span></div></header><main class="post__content"><p>Receipt of a JSON file containing valid tags for tutorial metadata gave me the perfect opportunity to explore it and learn a bit more jq in the process.</p><p>For each of our <a href="https://github.com/SAP-tutorials">tutorials</a> in SAP's <a href="https://developers.sap.com/tutorial-navigator.html">Tutorial Navigator</a>, we have metadata in the frontmatter. Here's <a href="https://github.com/sap-tutorials/Tutorials/blob/5c282ddec1cb15f3d8d5c6e0814ad9a8c94ee0f2/tutorials/odata-01-intro-origins/odata-01-intro-origins.md">an example</a> from the <a href="https://developers.sap.com/tutorials/odata-01-intro-origins.html">Learn About OData Fundamentals</a> tutorial:</p><pre class="language-markdown"><code class="language-markdown">author_name: DJ Adams<br>author_profile: https://github.com/qmacro<br>title: Learn about OData Fundamentals<br>description: Discover OData's origins and learn about the fundamentals of OData by exploring a public OData service.<br>auto_validation: false<br>primary_tag: software-product>sap-business-technology-platform<br>tags: [ software-product>sap-business-technology-platform, topic>cloud, programming-tool>odata, tutorial>beginner ]<br>time: 15</code></pre><p>I received a JSON file with updated valid tags, against which I could check the values for the <code>primary_tag</code> and <code>tags</code> properties. The tags were arranged like this (drastically reduced to save space here):</p><pre class="language-json"><code class="language-json"><span class="token punctuation">{</span><br>  <span class="token property">"level"</span><span class="token operator">:</span> <span class="token punctuation">[</span><br>    <span class="token punctuation">{</span><br>      <span class="token property">"name"</span><span class="token operator">:</span> <span class="token string">"Beginner"</span><span class="token punctuation">,</span><br>      <span class="token property">"value"</span><span class="token operator">:</span> <span class="token string">" tutorial>beginner"</span><br>    <span class="token punctuation">}</span><span class="token punctuation">,</span><br>    <span class="token punctuation">{</span><br>      <span class="token property">"name"</span><span class="token operator">:</span> <span class="token string">"Intermediate"</span><span class="token punctuation">,</span><br>      <span class="token property">"value"</span><span class="token operator">:</span> <span class="token string">" tutorial>intermediate"</span><br>    <span class="token punctuation">}</span><span class="token punctuation">,</span><br>    <span class="token punctuation">{</span><br>      <span class="token property">"name"</span><span class="token operator">:</span> <span class="token string">"Advanced"</span><span class="token punctuation">,</span><br>      <span class="token property">"value"</span><span class="token operator">:</span> <span class="token string">" tutorial>advanced"</span><br>    <span class="token punctuation">}</span><br>  <span class="token punctuation">]</span><span class="token punctuation">,</span><br>  <span class="token property">"common"</span><span class="token operator">:</span> <span class="token punctuation">[</span><br>    <span class="token punctuation">{</span><br>      <span class="token property">"name"</span><span class="token operator">:</span> <span class="token string">"ABAP Connectivity"</span><span class="token punctuation">,</span><br>      <span class="token property">"value"</span><span class="token operator">:</span> <span class="token string">"topic>abap-connectivity"</span><br>    <span class="token punctuation">}</span><span class="token punctuation">,</span><br>    <span class="token punctuation">{</span><br>      <span class="token property">"name"</span><span class="token operator">:</span> <span class="token string">"ABAP Development"</span><span class="token punctuation">,</span><br>      <span class="token property">"value"</span><span class="token operator">:</span> <span class="token string">"programming-tool>abap-development"</span><br>    <span class="token punctuation">}</span><span class="token punctuation">,</span><br>    <span class="token punctuation">{</span><br>      <span class="token property">"name"</span><span class="token operator">:</span> <span class="token string">"ABAP Extensibility"</span><span class="token punctuation">,</span><br>      <span class="token property">"value"</span><span class="token operator">:</span> <span class="token string">"programming-tool>abap-extensibility"</span><br>    <span class="token punctuation">}</span><span class="token punctuation">,</span><br>    <span class="token punctuation">{</span><br>      <span class="token property">"name"</span><span class="token operator">:</span> <span class="token string">"Android"</span><span class="token punctuation">,</span><br>      <span class="token property">"value"</span><span class="token operator">:</span> <span class="token string">"operating-system>android"</span><br>    <span class="token punctuation">}</span><span class="token punctuation">,</span><br>    <span class="token punctuation">{</span><br>      <span class="token property">"name"</span><span class="token operator">:</span> <span class="token string">"Artificial Intelligence"</span><span class="token punctuation">,</span><br>      <span class="token property">"value"</span><span class="token operator">:</span> <span class="token string">"topic>artificial-intelligence"</span><br>    <span class="token punctuation">}</span><span class="token punctuation">,</span><br>    <span class="token punctuation">{</span><br>      <span class="token property">"name"</span><span class="token operator">:</span> <span class="token string">"Big Data"</span><span class="token punctuation">,</span><br>      <span class="token property">"value"</span><span class="token operator">:</span> <span class="token string">"topic>big-data"</span><br>    <span class="token punctuation">}</span><br>  <span class="token punctuation">]</span><br><span class="token punctuation">}</span></code></pre><p>I wanted to explore the tags by &quot;category&quot;, the part before the <code>&gt;</code> symbol in the <code>value</code> properties. In the above excerpt (in the <code>common</code> object, which is where the main list of tags are), there are the following categories: <code>topic</code>, <code>programming-tool</code> and <code>operating-system</code>.</p><h2>Separating tags from categories with split</h2><p>First, I used <a href="https://stedolan.github.io/jq/manual/#split(str)">split</a> to separate out the categories and tags by splitting on the <code>&gt;</code> symbol in each of the values.</p><pre class="language-jq"><code class="language-jq"><span class="token punctuation">.</span>common<br><span class="token operator pipe">|</span> <span class="token c-style-function function">map</span><span class="token punctuation">(</span><span class="token punctuation">.</span>value <span class="token operator pipe">|</span> <span class="token c-style-function function">split</span><span class="token punctuation">(</span><span class="token string">">"</span><span class="token punctuation">)</span><span class="token punctuation">)</span></code></pre><p>This produces an array of arrays. The outer array is the result of running <code>map</code> (which takes an array and produces an array) and the inner arrays are the result of running <code>split</code> on each <code>category&gt;tag</code> pattern in the <code>value</code> properties:</p><pre class="language-json"><code class="language-json"><span class="token punctuation">[</span><br>  <span class="token punctuation">[</span><br>    <span class="token string">"topic"</span><span class="token punctuation">,</span><br>    <span class="token string">"abap-connectivity"</span><br>  <span class="token punctuation">]</span><span class="token punctuation">,</span><br>  <span class="token punctuation">[</span><br>    <span class="token string">"programming-tool"</span><span class="token punctuation">,</span><br>    <span class="token string">"abap-development"</span><br>  <span class="token punctuation">]</span><span class="token punctuation">,</span><br>  <span class="token punctuation">[</span><br>    <span class="token string">"programming-tool"</span><span class="token punctuation">,</span><br>    <span class="token string">"abap-extensibility"</span><br>  <span class="token punctuation">]</span><span class="token punctuation">,</span><br>  <span class="token punctuation">[</span><br>    <span class="token string">"operating-system"</span><span class="token punctuation">,</span><br>    <span class="token string">"android"</span><br>  <span class="token punctuation">]</span><span class="token punctuation">,</span><br>  <span class="token punctuation">[</span><br>    <span class="token string">"topic"</span><span class="token punctuation">,</span><br>    <span class="token string">"artificial-intelligence"</span><br>  <span class="token punctuation">]</span><span class="token punctuation">,</span><br>  <span class="token punctuation">[</span><br>    <span class="token string">"topic"</span><span class="token punctuation">,</span><br>    <span class="token string">"big-data"</span><br><span class="token punctuation">]</span></code></pre><h2>Grouping by categories with group_by</h2><p>The categories are the first values in each of the inner arrays, so next is to group the inner arrays by those categories:</p><pre class="language-jq"><code class="language-jq"><span class="token punctuation">.</span>common<br><span class="token operator pipe">|</span> <span class="token c-style-function function">map</span><span class="token punctuation">(</span><span class="token punctuation">.</span>value <span class="token operator pipe">|</span> <span class="token c-style-function function">split</span><span class="token punctuation">(</span><span class="token string">">"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><br><span class="token operator pipe">|</span> <span class="token c-style-function function">group_by</span><span class="token punctuation">(</span><span class="token punctuation">.</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span></code></pre><p>The <code>.[0]</code> supplied to <code>group_by</code> specifies that it's the first element of each inner array that should be the basis of grouping (i.e. the categories <code>topic</code>, <code>programming-tool</code>, <code>programming-tool</code>, etc).</p><p>This produces a differently shaped nesting of arrays, one for each of the categories:</p><pre class="language-json"><code class="language-json"><span class="token punctuation">[</span><br>  <span class="token punctuation">[</span><br>    <span class="token punctuation">[</span><br>      <span class="token string">"operating-system"</span><span class="token punctuation">,</span><br>      <span class="token string">"android"</span><br>    <span class="token punctuation">]</span><br>  <span class="token punctuation">]</span><span class="token punctuation">,</span><br>  <span class="token punctuation">[</span><br>    <span class="token punctuation">[</span><br>      <span class="token string">"programming-tool"</span><span class="token punctuation">,</span><br>      <span class="token string">"abap-development"</span><br>    <span class="token punctuation">]</span><span class="token punctuation">,</span><br>    <span class="token punctuation">[</span><br>      <span class="token string">"programming-tool"</span><span class="token punctuation">,</span><br>      <span class="token string">"abap-extensibility"</span><br>    <span class="token punctuation">]</span><br>  <span class="token punctuation">]</span><span class="token punctuation">,</span><br>  <span class="token punctuation">[</span><br>    <span class="token punctuation">[</span><br>      <span class="token string">"topic"</span><span class="token punctuation">,</span><br>      <span class="token string">"abap-connectivity"</span><br>    <span class="token punctuation">]</span><span class="token punctuation">,</span><br>    <span class="token punctuation">[</span><br>      <span class="token string">"topic"</span><span class="token punctuation">,</span><br>      <span class="token string">"artificial-intelligence"</span><br>    <span class="token punctuation">]</span><span class="token punctuation">,</span><br>    <span class="token punctuation">[</span><br>      <span class="token string">"topic"</span><span class="token punctuation">,</span><br>      <span class="token string">"big-data"</span><br>    <span class="token punctuation">]</span><br>  <span class="token punctuation">]</span><br><span class="token punctuation">]</span></code></pre><h2>Reforming the structure with the entries functions</h2><p>Now comes the task to reform that essential structure into something a little less &quot;noisy&quot;. Using the <a href="https://stedolan.github.io/jq/manual/#to_entries,from_entries,with_entries">entries family</a> of functions, this turned out to be quite straightforward. That said, I'll explain the intermediate steps I went through on the way.</p><h3>Getting from an array-based to an object-based structure with to_entries</h3><p>As I wanted an object, with the keys being categories, and the values being arrays of tag strings, it felt right to reach for the <code>to_entries</code> function:</p><pre class="language-jq"><code class="language-jq"><span class="token punctuation">.</span>common<br><span class="token operator pipe">|</span> <span class="token c-style-function function">map</span><span class="token punctuation">(</span><span class="token punctuation">.</span>value <span class="token operator pipe">|</span> <span class="token c-style-function function">split</span><span class="token punctuation">(</span><span class="token string">">"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><br><span class="token operator pipe">|</span> <span class="token c-style-function function">group_by</span><span class="token punctuation">(</span><span class="token punctuation">.</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><br><span class="token operator pipe">|</span> to_entries</code></pre><p>This produced the following:</p><pre class="language-json"><code class="language-json"><span class="token punctuation">[</span><br>  <span class="token punctuation">{</span><br>    <span class="token property">"key"</span><span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span><br>    <span class="token property">"value"</span><span class="token operator">:</span> <span class="token punctuation">[</span><br>      <span class="token punctuation">[</span><br>        <span class="token string">"operating-system"</span><span class="token punctuation">,</span><br>        <span class="token string">"android"</span><br>      <span class="token punctuation">]</span><br>    <span class="token punctuation">]</span><br>  <span class="token punctuation">}</span><span class="token punctuation">,</span><br>  <span class="token punctuation">{</span><br>    <span class="token property">"key"</span><span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span><br>    <span class="token property">"value"</span><span class="token operator">:</span> <span class="token punctuation">[</span><br>      <span class="token punctuation">[</span><br>        <span class="token string">"programming-tool"</span><span class="token punctuation">,</span><br>        <span class="token string">"abap-development"</span><br>      <span class="token punctuation">]</span><span class="token punctuation">,</span><br>      <span class="token punctuation">[</span><br>        <span class="token string">"programming-tool"</span><span class="token punctuation">,</span><br>        <span class="token string">"abap-extensibility"</span><br>      <span class="token punctuation">]</span><br>    <span class="token punctuation">]</span><br>  <span class="token punctuation">}</span><span class="token punctuation">,</span><br>  <span class="token punctuation">{</span><br>    <span class="token property">"key"</span><span class="token operator">:</span> <span class="token number">2</span><span class="token punctuation">,</span><br>    <span class="token property">"value"</span><span class="token operator">:</span> <span class="token punctuation">[</span><br>      <span class="token punctuation">[</span><br>        <span class="token string">"topic"</span><span class="token punctuation">,</span><br>        <span class="token string">"abap-connectivity"</span><br>      <span class="token punctuation">]</span><span class="token punctuation">,</span><br>      <span class="token punctuation">[</span><br>        <span class="token string">"topic"</span><span class="token punctuation">,</span><br>        <span class="token string">"artificial-intelligence"</span><br>      <span class="token punctuation">]</span><span class="token punctuation">,</span><br>      <span class="token punctuation">[</span><br>        <span class="token string">"topic"</span><span class="token punctuation">,</span><br>        <span class="token string">"big-data"</span><br>      <span class="token punctuation">]</span><br>    <span class="token punctuation">]</span><br>  <span class="token punctuation">}</span><br><span class="token punctuation">]</span></code></pre><h3>Tidying up with object construction in a map</h3><p>That is sort of the direction I want to go, but there's some tidying up to do, to get cleaner values for <code>key</code> and <code>value</code>. So I reached for <code>map</code> to do this:</p><pre class="language-jq"><code class="language-jq"><span class="token punctuation">.</span>common<br><span class="token operator pipe">|</span> <span class="token c-style-function function">map</span><span class="token punctuation">(</span><span class="token punctuation">.</span>value <span class="token operator pipe">|</span> <span class="token c-style-function function">split</span><span class="token punctuation">(</span><span class="token string">">"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><br><span class="token operator pipe">|</span> <span class="token c-style-function function">group_by</span><span class="token punctuation">(</span><span class="token punctuation">.</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><br><span class="token operator pipe">|</span> to_entries<br><span class="token operator pipe">|</span> <span class="token c-style-function function">map</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token property-literal property">key</span><span class="token punctuation">:</span> <span class="token punctuation">.</span>value<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token property-literal property">value</span><span class="token punctuation">:</span> <span class="token punctuation">.</span>value<span class="token operator pipe">|</span><span class="token c-style-function function">map</span><span class="token punctuation">(</span><span class="token punctuation">.</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token punctuation">)</span></code></pre><p>The expression passed to <code>map</code> is the <a href="https://stedolan.github.io/jq/manual/#ObjectConstruction:%7B%7D">object construction</a> (<code>{...}</code>), creating objects each with two properties, <code>key</code> and <code>value</code>. The reason for staying with these property names will become clear shortly.</p><p>The value for <code>key</code> is expressed as <code>.value[0][0]</code>, i.e. the first (zeroth) element of the inner array that is the first (zeroth) element of the array that is the value of the <code>value</code> property.</p><p>In other words, given the last object in the above most recent intermediate results:</p><pre class="language-json"><code class="language-json">  <span class="token punctuation">{</span><br>    <span class="token property">"key"</span><span class="token operator">:</span> <span class="token number">2</span><span class="token punctuation">,</span><br>    <span class="token property">"value"</span><span class="token operator">:</span> <span class="token punctuation">[</span><br>      <span class="token punctuation">[</span><br>        <span class="token string">"topic"</span><span class="token punctuation">,</span><br>        <span class="token string">"abap-connectivity"</span><br>      <span class="token punctuation">]</span><span class="token punctuation">,</span><br>      <span class="token punctuation">[</span><br>        <span class="token string">"topic"</span><span class="token punctuation">,</span><br>        <span class="token string">"artificial-intelligence"</span><br>      <span class="token punctuation">]</span><span class="token punctuation">,</span><br>      <span class="token punctuation">[</span><br>        <span class="token string">"topic"</span><span class="token punctuation">,</span><br>        <span class="token string">"big-data"</span><br>      <span class="token punctuation">]</span><br>    <span class="token punctuation">]</span><br>  <span class="token punctuation">}</span></code></pre><p>Then <code>.value[0][0]</code> will return <code>&quot;topic&quot;</code> (specifically, the first instance of that string in the above JSON).</p><p>Similarly, to build the value for the new <code>value</code> property in the object being constructed, I used this expression: <code>.value|map(.[1])</code>. The current value of the <code>value</code> property is an array, so using <code>map</code> on that will produce another array. Of what? Well, of these values: <code>.[1]</code>.</p><p>In other words, the second (index 1) value in each of the sub arrays. Given this same last object example above, <code>.value|map(.[1])</code> produces <code>[&quot;abap-connectivity&quot;, &quot;artificial-intelligence&quot;, &quot;big-data&quot;]</code>.</p><p>Running this latest iteration with the <code>map</code> function produces this:</p><pre class="language-json"><code class="language-json"><span class="token punctuation">[</span><br>  <span class="token punctuation">{</span><br>    <span class="token property">"key"</span><span class="token operator">:</span> <span class="token string">"operating-system"</span><span class="token punctuation">,</span><br>    <span class="token property">"value"</span><span class="token operator">:</span> <span class="token punctuation">[</span><br>      <span class="token string">"android"</span><br>    <span class="token punctuation">]</span><br>  <span class="token punctuation">}</span><span class="token punctuation">,</span><br>  <span class="token punctuation">{</span><br>    <span class="token property">"key"</span><span class="token operator">:</span> <span class="token string">"programming-tool"</span><span class="token punctuation">,</span><br>    <span class="token property">"value"</span><span class="token operator">:</span> <span class="token punctuation">[</span><br>      <span class="token string">"abap-development"</span><span class="token punctuation">,</span><br>      <span class="token string">"abap-extensibility"</span><br>    <span class="token punctuation">]</span><br>  <span class="token punctuation">}</span><span class="token punctuation">,</span><br>  <span class="token punctuation">{</span><br>    <span class="token property">"key"</span><span class="token operator">:</span> <span class="token string">"topic"</span><span class="token punctuation">,</span><br>    <span class="token property">"value"</span><span class="token operator">:</span> <span class="token punctuation">[</span><br>      <span class="token string">"abap-connectivity"</span><span class="token punctuation">,</span><br>      <span class="token string">"artificial-intelligence"</span><span class="token punctuation">,</span><br>      <span class="token string">"big-data"</span><br>    <span class="token punctuation">]</span><br>  <span class="token punctuation">}</span><br><span class="token punctuation">]</span></code></pre><p>Almost there!</p><h2>Creating a neat structure with from_entries</h2><p><a href="https://stedolan.github.io/jq/manual/#to_entries,from_entries,with_entries">According to the manual</a>, the <code>to_entries</code> and <code>from_entries</code> &quot;convert between an object and array of key-value pairs&quot;. In each case, the name for the key and value properties are <code>key</code> and <code>value</code> respectively. I had an inkling I would probably want to use <code>from_entries</code> at some stage, and this is the reason why I kept the names of the properties earlier.</p><p>Let's have a look what passing the above structure into <code>from_entries</code> produces:</p><pre class="language-jq"><code class="language-jq"><span class="token punctuation">.</span>common<br><span class="token operator pipe">|</span> <span class="token c-style-function function">map</span><span class="token punctuation">(</span><span class="token punctuation">.</span>value <span class="token operator pipe">|</span> <span class="token c-style-function function">split</span><span class="token punctuation">(</span><span class="token string">">"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><br><span class="token operator pipe">|</span> <span class="token c-style-function function">group_by</span><span class="token punctuation">(</span><span class="token punctuation">.</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><br><span class="token operator pipe">|</span> to_entries<br><span class="token operator pipe">|</span> <span class="token c-style-function function">map</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token property-literal property">key</span><span class="token punctuation">:</span> <span class="token punctuation">.</span>value<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token property-literal property">value</span><span class="token punctuation">:</span> <span class="token punctuation">.</span>value<span class="token operator pipe">|</span><span class="token c-style-function function">map</span><span class="token punctuation">(</span><span class="token punctuation">.</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token punctuation">)</span><br><span class="token operator pipe">|</span> from_entries</code></pre><p>It's this:</p><pre class="language-json"><code class="language-json"><span class="token punctuation">{</span><br>  <span class="token property">"operating-system"</span><span class="token operator">:</span> <span class="token punctuation">[</span><br>    <span class="token string">"android"</span><br>  <span class="token punctuation">]</span><span class="token punctuation">,</span><br>  <span class="token property">"programming-tool"</span><span class="token operator">:</span> <span class="token punctuation">[</span><br>    <span class="token string">"abap-development"</span><span class="token punctuation">,</span><br>    <span class="token string">"abap-extensibility"</span><br>  <span class="token punctuation">]</span><span class="token punctuation">,</span><br>  <span class="token property">"topic"</span><span class="token operator">:</span> <span class="token punctuation">[</span><br>    <span class="token string">"abap-connectivity"</span><span class="token punctuation">,</span><br>    <span class="token string">"artificial-intelligence"</span><span class="token punctuation">,</span><br>    <span class="token string">"big-data"</span><br>  <span class="token punctuation">]</span><br><span class="token punctuation">}</span></code></pre><p>That's very nice, and pretty much exactly what I want. A neat and low-noise representation of the category and tag structure.</p><h2>Refactoring with with_entries</h2><p>It turns out that the pattern:</p><pre><code>to_entries -&gt; map(...) -&gt; from_entries
</code></pre><p>is common enough to have a function expression all of its own, and it's <code>with_entries</code>. As detailed in the <a href="https://stedolan.github.io/jq/manual/#to_entries,from_entries,with_entries">entries section of the manual</a>:</p><blockquote><p><code>with_entries(foo)</code> is shorthand for <code>to_entries | map(foo) | from_entries</code></p></blockquote><p>In fact, we can see how it's defined (which is exactly as described in the manual) <a href="https://github.com/stedolan/jq/tree/a9f97e9e61a910a374a5d768244e8ad63f407d3e">in builtin.jq</a>, along with <code>to_entries</code> and <code>from_entries</code>.</p><h2>Wrapping up</h2><p>While I've played around a little with the <a href="https://stedolan.github.io/jq/manual/#to_entries,from_entries,with_entries">entries family</a>, this is the first time I've used it for real. Going through the intermediate process of finding myself using <code>map</code> actually has helped me reflect on <code>with_entries</code> very well.</p></main><aside class="post__aside"><div class="post__tags"><a href="/tags/jq/">#jq</a></div><style>.utterances {
  margin-left: inherit !important;
}</style><script src="https://utteranc.es/client.js" repo="qmacro/qmacro.github.io" issue-term="title" crossorigin="anonymous" async></script><nav class="post__pagination"><a href="/blog/posts/2022/06/16/summing-and-grouping-values-with-jq/"><span>←</span> <span>Summing and grouping values with jq</span> </a><a href="/blog/posts/2022/05/28/multiple-level-filters-in-jq/"><span>Multiple level filters in jq</span> <span>→</span></a></nav></aside></article></main><footer class="footer"><div class="footer__content"><ul class="hero__social-links"><li><a rel="me" href="https://github.com/qmacro" target="_blank" rel="noopener noreferrer">GitHub</a></li><li><a rel="me" href="https://www.youtube.com/djadams-qmacro" target="_blank" rel="noopener noreferrer">YouTube</a></li><li><a rel="me" href="https://twitter.com/qmacro" target="_blank" rel="noopener noreferrer">Twitter</a></li><li><a rel="me" href="https://hachyderm.io/@qmacro" target="_blank" rel="noopener noreferrer">Mastodon</a></li><li><a href="/feed.xml" target="_blank" rel="noopener noreferrer">RSS</a></li></ul></div></footer></div><script src="/assets/main.31d6cfe0d16ae931b73c.js"></script></body></html>