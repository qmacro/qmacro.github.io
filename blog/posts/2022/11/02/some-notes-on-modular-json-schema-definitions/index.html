<!doctype html>
<html lang="en">
	<head>
		<meta charset="utf-8">
		<meta name="viewport" content="width=device-width, initial-scale=1.0">
		<title>Some notes on modular JSON Schema definitions</title>
		<meta name="description" content="Reserving the right to be wrong.">
		<link rel="alternate" href="/feed/feed.xml" type="application/atom+xml" title="DJ Adams">
		<link rel="icon" type="image/x-icon" href="/images/favicon.ico">
		
		
		
		<style>/* This is an arbitrary CSS string added to the bundle */
/* Defaults */
:root {
	--font-family: -apple-system, system-ui, sans-serif;
	--font-family-monospace: Consolas, Menlo, Monaco, Andale Mono WT, Andale Mono, Lucida Console, Lucida Sans Typewriter, DejaVu Sans Mono, Bitstream Vera Sans Mono, Liberation Mono, Nimbus Mono L, Courier New, Courier, monospace;
}

/* Theme colors */
:root {
	--color-gray-20: #e0e0e0;
	--color-gray-50: #C0C0C0;
	--color-gray-90: #333;

	--background-color: #fff;

	--text-color: var(--color-gray-90);
	--text-color-link: #2884d2;
	--text-color-link-active: #15b0ed;
	--text-color-link-visited: #9f4199;

	--syntax-tab-size: 2;
}

@media (prefers-color-scheme: dark) {
	:root {
		--color-gray-20: #e0e0e0;
		--color-gray-50: #C0C0C0;
		--color-gray-90: #dad8d8;

		/* --text-color is assigned to --color-gray-_ above */
		--text-color-link: #1493fb;
		--text-color-link-active: #6969f7;
		--text-color-link-visited: #a6a6f8;

		--background-color: #15202b;
	}
}


/* Global stylesheet */
* {
	box-sizing: border-box;
}

@view-transition {
	navigation: auto;
}

html,
body {
	padding: 0;
	margin: 0 auto;
	font-family: var(--font-family);
	color: var(--text-color);
	background-color: var(--background-color);
}
html {
	overflow-y: scroll;
}
body {
	max-width: 40em;
}

/* https://www.a11yproject.com/posts/how-to-hide-content/ */
.visually-hidden:not(:focus):not(:active) {
	clip: rect(0 0 0 0);
	clip-path: inset(50%);
	height: 1px;
	overflow: hidden;
	position: absolute;
	white-space: nowrap;
	width: 1px;
}

/* Fluid images via https://www.zachleat.com/web/fluid-images/ */
img{
  max-width: 100%;
}
img[width][height] {
  height: auto;
}
img[src$=".svg"] {
  width: 100%;
  height: auto;
  max-width: none;
}
video,
iframe {
	width: 100%;
	height: auto;
}
iframe {
	aspect-ratio: 16/9;
}

p:last-child {
	margin-bottom: 0;
}
p {
	line-height: 1.5;
}

li {
	line-height: 1.5;
}

a[href] {
	color: var(--text-color-link);
}
a[href]:visited {
	color: var(--text-color-link-visited);
}
a[href]:hover,
a[href]:active {
	color: var(--text-color-link-active);
}

main,
footer {
	padding: 1rem;
}
/* main :first-child { */
/* 	margin-top: 0; */
/* } */

header {
	border-bottom: 1px dashed var(--color-gray-20);
}

#skip-link {
	text-decoration: none;
	background: var(--background-color);
	color: var(--text-color);
	padding: 0.5rem 1rem;
	border: 1px solid var(--color-gray-90);
	border-radius: 2px;
}

/* Prevent visually-hidden skip link fom pushing content around when focused */
#skip-link.visually-hidden:focus {
	position: absolute;
	top: 1rem;
	left: 1rem;
	/* Ensure it is positioned on top of everything else when it is shown */
	z-index: 999;
}

.links-nextprev {
	display: flex;
	justify-content: space-between;
	gap: .5em 1em;
	list-style: "";
	border-top: 1px dashed var(--color-gray-20);
	padding: 1em 0;
}
.links-nextprev > * {
	flex-grow: 1;
}
.links-nextprev-next {
	text-align: right;
}

table {
	margin: 1em 0;
}
table td,
table th {
	padding-right: 1em;
}

pre,
code {
	font-family: var(--font-family-monospace);
	color: seagreen;
}

pre,code[class*="language-"] {
	line-height: 1.2em !important;
	font-size: 0.93em !important;
}

pre:not([class*="language-"]) {
	margin: .5em 0;
	line-height: 1.375; /* 22px /16 */
	-moz-tab-size: var(--syntax-tab-size);
	-o-tab-size: var(--syntax-tab-size);
	tab-size: var(--syntax-tab-size);
	-webkit-hyphens: none;
	-ms-hyphens: none;
	hyphens: none;
	direction: ltr;
	text-align: left;
	white-space: pre;
	word-spacing: normal;
	word-break: normal;
	overflow-x: auto;
}
code {
	word-break: break-all;
}

/* Header */
header {
	display: flex;
	gap: 1em;
	flex-wrap: wrap;
	justify-content: space-between;
	align-items: center;
	padding: 1em;
}
.home-link {
	flex-grow: 1;
	font-size: 1em; /* 16px /16 */
	font-weight: 700;
}
.home-link:link:not(:hover) {
	text-decoration: none;
}

/* Nav */
.nav {
	display: flex;
	gap: .5em 1em;
	padding: 0;
	margin: 0;
	list-style: none;
}
.nav-item {
	display: inline-block;
}
.nav-item a[href]:not(:hover) {
	text-decoration: none;
}
.nav a[href][aria-current="page"] {
	text-decoration: underline;
}

/* Posts list */
.postlist {
	counter-reset: start-from var(--postlist-index);
	list-style: none;
	padding: 0;
}
.postlist-item {
	display: flex;
	flex-wrap: wrap;
	align-items: baseline;
	counter-increment: start-from -1;
	margin-bottom: 1em;
}
.postlist-item:before {
	display: inline-block;
	pointer-events: none;
	line-height: 100%;
	text-align: right;
	margin-left: -1.5rem;
}
.postlist-date,
.postlist-item:before {
	font-size: 0.8125em; /* 13px /16 */
	color: var(--color-gray-90);
}
.postlist-date {
	word-spacing: -0.5px;
}
.postlist-link {
	font-size: 1.1875em; /* 19px /16 */
	font-weight: 700;
	flex-basis: calc(100% - 1.5rem);
	text-underline-position: from-font;
	text-underline-offset: 0;
	text-decoration-thickness: 1px;
}
.postlist-item-active .postlist-link {
	font-weight: bold;
}

/* Tags */
.post-tag {
	display: inline-flex;
	align-items: center;
	justify-content: center;
	font-style: italic;
}

/* may want to make the description text smaller at some stage */
.post-description-list {
	font-size: 1.0em;
}

.post-description-main {
	font-style: italic;
}

.postlist-item > .post-tag {
	align-self: center;
}

/* Tags list */
.post-metadata {
	display: inline-flex;
	flex-wrap: wrap;
	gap: .5em;
	list-style: none;
	padding: 0;
	margin: 0;
}
.post-metadata time {
	margin-right: 1em;
}

blockquote {
	margin-top: 0px;
	margin-left: 0px;
	margin-bottom: 15px;
	padding-left: 15px;
	border-left: 5px solid lightgray;
}
/**
 * prism.js default theme for JavaScript, CSS and HTML
 * Based on dabblet (http://dabblet.com)
 * @author Lea Verou
 */

code[class*="language-"],
pre[class*="language-"] {
	color: black;
	background: none;
	text-shadow: 0 1px white;
	font-family: Consolas, Monaco, 'Andale Mono', 'Ubuntu Mono', monospace;
	font-size: 1em;
	text-align: left;
	white-space: pre;
	word-spacing: normal;
	word-break: normal;
	word-wrap: normal;
	line-height: 1.5;

	-moz-tab-size: 4;
	-o-tab-size: 4;
	tab-size: 4;

	-webkit-hyphens: none;
	-moz-hyphens: none;
	-ms-hyphens: none;
	hyphens: none;
}

pre[class*="language-"]::-moz-selection, pre[class*="language-"] ::-moz-selection,
code[class*="language-"]::-moz-selection, code[class*="language-"] ::-moz-selection {
	text-shadow: none;
	background: #b3d4fc;
}

pre[class*="language-"]::selection, pre[class*="language-"] ::selection,
code[class*="language-"]::selection, code[class*="language-"] ::selection {
	text-shadow: none;
	background: #b3d4fc;
}

@media print {
	code[class*="language-"],
	pre[class*="language-"] {
		text-shadow: none;
	}
}

/* Code blocks */
pre[class*="language-"] {
	padding: 1em;
	margin: .5em 0;
	overflow: auto;
}

:not(pre) > code[class*="language-"],
pre[class*="language-"] {
	background: #f5f2f0;
}

/* Inline code */
:not(pre) > code[class*="language-"] {
	padding: .1em;
	border-radius: .3em;
	white-space: normal;
}

.token.comment,
.token.prolog,
.token.doctype,
.token.cdata {
	color: slategray;
}

.token.punctuation {
	color: #999;
}

.token.namespace {
	opacity: .7;
}

.token.property,
.token.tag,
.token.boolean,
.token.number,
.token.constant,
.token.symbol,
.token.deleted {
	color: #905;
}

.token.selector,
.token.attr-name,
.token.string,
.token.char,
.token.builtin,
.token.inserted {
	color: #690;
}

.token.operator,
.token.entity,
.token.url,
.language-css .token.string,
.style .token.string {
	color: #9a6e3a;
	/* This background color was intended by the author of this theme. */
	background: hsla(0, 0%, 100%, .5);
}

.token.atrule,
.token.attr-value,
.token.keyword {
	color: #07a;
}

.token.function,
.token.class-name {
	color: #DD4A68;
}

.token.regex,
.token.important,
.token.variable {
	color: #e90;
}

.token.important,
.token.bold {
	font-weight: bold;
}
.token.italic {
	font-style: italic;
}

.token.entity {
	cursor: help;
}
/*
 * New diff- syntax
 */

pre[class*="language-diff-"] {
	--eleventy-code-padding: 1.25em;
	padding-left: var(--eleventy-code-padding);
	padding-right: var(--eleventy-code-padding);
}
.token.deleted {
	background-color: hsl(0, 51%, 37%);
	color: inherit;
}
.token.inserted {
	background-color: hsl(126, 31%, 39%);
	color: inherit;
}

/* Make the + and - characters unselectable for copy/paste */
.token.prefix.unchanged,
.token.prefix.inserted,
.token.prefix.deleted {
	-webkit-user-select: none;
	user-select: none;
	display: inline-flex;
	align-items: center;
	justify-content: center;
	padding-top: 2px;
	padding-bottom: 2px;
}
.token.prefix.inserted,
.token.prefix.deleted {
	width: var(--eleventy-code-padding);
	background-color: rgba(0,0,0,.2);
}

/* Optional: full-width background color */
.token.inserted:not(.prefix),
.token.deleted:not(.prefix) {
	display: block;
	margin-left: calc(-1 * var(--eleventy-code-padding));
	margin-right: calc(-1 * var(--eleventy-code-padding));
	text-decoration: none; /* override del, ins, mark defaults */
	color: inherit; /* override del, ins, mark defaults */
}
.utterances {
  margin-left: inherit !important;
}</style>
		

    <!-- Global site tag (gtag.js) - Google Analytics -->
    <script async="" src="https://www.googletagmanager.com/gtag/js?id=G-4WQKBG0L4Y"></script>
    

	</head>
	<body>
		<a href="#main" id="skip-link" class="visually-hidden">Skip to main content</a>

		<header>
			<a href="/" class="home-link">DJ Adams</a>
			<nav>
				<h2 class="visually-hidden" id="top-level-navigation-menu">Top level navigation menu</h2>
				<ul class="nav">
					<li class="nav-item"><a href="/">Home</a></li>
					<li class="nav-item"><a href="/about/">About</a></li>
					<li class="nav-item"><a href="/blog/">Blog</a></li>
					<li class="nav-item"><a href="/feed/feed.xml">Feed</a></li>
				</ul>
			</nav>
		</header>

		<main id="main">
			<heading-anchors>
				


<h1 id="some-notes-on-modular-json-schema-definitions">Some notes on modular JSON Schema definitions</h1>

<ul class="post-metadata">
	<li><time datetime="2022-11-02">02 November 2022</time></li>
	<li><a href="/tags/json/" class="post-tag">json</a>, </li>
	<li><a href="/tags/schemas/" class="post-tag">schemas</a></li>
</ul>

<p class="post-description-main"></p>

<p>Here are a few rambling notes-to-self on understanding how a modular JSON Schema definition might be constructed. I've recently become acquainted with JSON Schema through the <a href="https://github.com/SAP-samples/btp-setup-automator">BTP Setup Automator</a> project.</p>
<blockquote>
<p>If you're not familiar with JSON Schema, there are some <a href="https://json-schema.org/learn/">great introductory tutorials</a> that I would recommend. The <a href="https://json-schema.org/slack">Slack channel</a> is friendly and welcoming too.</p>
</blockquote>
<p>OK, so I've been experimenting with how I might construct a schema in a modular way; this is as opposed to more monolithic ones which are arguably harder to read and manage. At least for me and my small brain.</p>
<h2 id="example-schema-and-data">Example schema and data</h2>
<p>I'm going to go for a deliberately contrived and boringly simple example, where I want to have JSON data sets that contain information about two types of things - people and vehicles.</p>
<p>A person has a first name and a last name (both are required). A vehicle has a make and a model (again, both are required).</p>
<p>A given JSON data set (represented by a single JSON file) can contain zero or more of these two types of things, where each thing is either a PERSON object or a VEHICLE object, represented by a category, contained within a &quot;things&quot; array, which is the single property of the outermost containing object. In other words, something like this:</p>
<pre class="language-json" tabindex="0"><code class="language-json"><span class="token punctuation">{</span>
  <span class="token property">"things"</span><span class="token operator">:</span> <span class="token punctuation">[</span>
    <span class="token punctuation">{</span>
      <span class="token property">"category"</span><span class="token operator">:</span> <span class="token string">"VEHICLE"</span><span class="token punctuation">,</span>
      <span class="token property">"make"</span><span class="token operator">:</span> <span class="token string">"Chevrolet"</span><span class="token punctuation">,</span>
      <span class="token property">"model"</span><span class="token operator">:</span> <span class="token string">"Caprice"</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">{</span>
      <span class="token property">"lastName"</span><span class="token operator">:</span> <span class="token string">"Adams"</span><span class="token punctuation">,</span>
      <span class="token property">"firstName"</span><span class="token operator">:</span> <span class="token string">"DJ"</span><span class="token punctuation">,</span>
      <span class="token property">"category"</span><span class="token operator">:</span> <span class="token string">"PERSON"</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">{</span>
      <span class="token property">"make"</span><span class="token operator">:</span> <span class="token string">"Tesla"</span><span class="token punctuation">,</span>
      <span class="token property">"model"</span><span class="token operator">:</span> <span class="token string">"Model 3"</span><span class="token punctuation">,</span>
      <span class="token property">"category"</span><span class="token operator">:</span> <span class="token string">"VEHICLE"</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">]</span>
<span class="token punctuation">}</span></code></pre>
<p>Let's imagine that this is in a file called <code>data.json</code>.</p>
<h2 id="initial-schema-construction">Initial schema construction</h2>
<p>What would a schema look like for this data set, and in particular, what might a modular schema look like?</p>
<p>I'll start with the outermost parts, and base the schema definition on draft 07. This is not the <a href="https://json-schema.org/specification.html">latest version of the JSON Schema specification</a> but it's the one <a href="https://github.com/SAP-samples/btp-setup-automator/blob/72a380268a3fca0d310dc539116a58c186a94933/libs/btpsa-usecase.json#L2">currently used to qualify the schemas in the BTP Setup Automator project</a> so I'll go with that.</p>
<pre class="language-json" tabindex="0"><code class="language-json"><span class="token punctuation">{</span>
  <span class="token property">"$schema"</span><span class="token operator">:</span> <span class="token string">"https://json-schema.org/draft-07/schema"</span><span class="token punctuation">,</span>
  <span class="token property">"description"</span><span class="token operator">:</span> <span class="token string">"Things which are either people or vehicles"</span><span class="token punctuation">,</span>
  <span class="token property">"type"</span><span class="token operator">:</span> <span class="token string">"object"</span><span class="token punctuation">,</span>
  <span class="token property">"required"</span><span class="token operator">:</span> <span class="token punctuation">[</span> <span class="token string">"things"</span> <span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token property">"additionalProperties"</span><span class="token operator">:</span> <span class="token boolean">false</span>
<span class="token punctuation">}</span></code></pre>
<p>Let's say this is in a file called <code>myschema.json</code>.</p>
<p>So far so good. This says that the JSON should be an object with a single property <code>things</code>, which is required. No other properties are allowed.</p>
<h3 id="digression-an-interesting-contradiction">Digression - an interesting contradiction</h3>
<p>Interestingly, as it stands right now (deliberately cut short, unfinished), this schema represents a contradiction. If I construct some JSON that is governed by this schema, I'm damned if I do include a <code>things</code> property and damned if I don't:</p>
<p>Just this:</p>
<pre class="language-json" tabindex="0"><code class="language-json"><span class="token punctuation">{</span><span class="token punctuation">}</span></code></pre>
<p>gives me an error: &quot;Missing property: things&quot;.</p>
<p>But if I add this property:</p>
<pre class="language-json" tabindex="0"><code class="language-json"><span class="token punctuation">{</span>
  <span class="token property">"things"</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
<span class="token punctuation">}</span></code></pre>
<p>an error is also surfaced to me: &quot;Property things is not allowed&quot; (regardless of what type of value I specify for it).</p>
<p>It was not my intention to include this in my notes, but I just discovered it, and thought it worth sharing. It makes sense - the schema so far says:</p>
<p><em>&quot;A <code>things</code> property is required, no other properties are allowed, but there's no list of actual properties defined.&quot;</em></p>
<p>Even more interesting - if I remove the <code>&quot;additionalProperties&quot;: false</code> constraint, then while <code>{}</code> still gives an error, <code>{ &quot;things&quot; [] }</code> does not, because the &quot;no other properties are allowed&quot; restriction is lifted.</p>
<p>Anyway.</p>
<h2 id="extending-the-schema">Extending the schema</h2>
<p>So clearly it's time to extend the schema now to allow for the actual <code>things</code> property, describing what it should be.</p>
<pre class="language-json" tabindex="0"><code class="language-json"><span class="token punctuation">{</span>
  <span class="token property">"$schema"</span><span class="token operator">:</span> <span class="token string">"https://json-schema.org/draft-07/schema"</span><span class="token punctuation">,</span>
  <span class="token property">"description"</span><span class="token operator">:</span> <span class="token string">"Things which are either people or vehicles"</span><span class="token punctuation">,</span>
  <span class="token property">"type"</span><span class="token operator">:</span> <span class="token string">"object"</span><span class="token punctuation">,</span>
  <span class="token property">"required"</span><span class="token operator">:</span> <span class="token punctuation">[</span> <span class="token string">"things"</span> <span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token property">"additionalProperties"</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
  <span class="token property">"properties"</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token property">"things"</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token property">"type"</span><span class="token operator">:</span> <span class="token string">"array"</span><span class="token punctuation">,</span>
      <span class="token property">"items"</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token property">"type"</span><span class="token operator">:</span> <span class="token string">"object"</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span></code></pre>
<p>I've added a minimal definition of the <code>things</code> property. It's an array of objects, that's about all this says so far.</p>
<p>But I need to constrain those object to reflect either a PERSON or a VEHICLE. And this is where I want to try out some modularisation.</p>
<p>The JSON Schema keyword <a href="https://json-schema.org/understanding-json-schema/reference/combining.html#oneof">oneOf</a> seems ideal for this job. The description even uses phrases like &quot;combining schemas from multiple files&quot; and &quot;the given data must be valid against exactly one of the given subschemas&quot;. This is exactly the sort of thing I had in mind, in that I want to think about the constraints for a PERSON, and the constraints for a VEHICLE, as separate modular subschemas.</p>
<blockquote>
<p>I say &quot;subschema&quot; but want to emphasise that these subschemas are perfectly valid and independent schemas, they aren't only valid within the context of a referencing schema.</p>
</blockquote>
<h3 id="trying-out-oneof">Trying out 'oneOf'</h3>
<p>Perhaps I should try out a simple example of <code>oneOf</code> first. In the <a href="https://json-schema.org/understanding-json-schema/reference/combining.html">Schema Composition section of Understanding JSON Schema</a> the example looks like this (<a href="https://en.wikipedia.org/wiki/Fizz_buzz">FizzBuzz</a>, anyone?):</p>
<pre class="language-json" tabindex="0"><code class="language-json"><span class="token punctuation">{</span>
  <span class="token property">"oneOf"</span><span class="token operator">:</span> <span class="token punctuation">[</span>
    <span class="token punctuation">{</span> <span class="token property">"type"</span><span class="token operator">:</span> <span class="token string">"number"</span><span class="token punctuation">,</span> <span class="token property">"multipleOf"</span><span class="token operator">:</span> <span class="token number">5</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">{</span> <span class="token property">"type"</span><span class="token operator">:</span> <span class="token string">"number"</span><span class="token punctuation">,</span> <span class="token property">"multipleOf"</span><span class="token operator">:</span> <span class="token number">3</span> <span class="token punctuation">}</span>
  <span class="token punctuation">]</span>
<span class="token punctuation">}</span></code></pre>
<p>I'll insert that verbatim into the schema I have so far; to do that, I'll have to temporarily remove the <code>&quot;type&quot;: &quot;object&quot;</code> constraint from the <code>items</code> property definition, as the <code>type</code> (both <code>number</code>) is defined in each of the two separate subschemas in this example (I'll come back to that in a minute, though):</p>
<pre class="language-json" tabindex="0"><code class="language-json"><span class="token punctuation">{</span>
  <span class="token property">"$schema"</span><span class="token operator">:</span> <span class="token string">"https://json-schema.org/draft-07/schema"</span><span class="token punctuation">,</span>
  <span class="token property">"description"</span><span class="token operator">:</span> <span class="token string">"Things which are either people or vehicles"</span><span class="token punctuation">,</span>
  <span class="token property">"type"</span><span class="token operator">:</span> <span class="token string">"object"</span><span class="token punctuation">,</span>
  <span class="token property">"required"</span><span class="token operator">:</span> <span class="token punctuation">[</span>
    <span class="token string">"things"</span>
  <span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token property">"additionalProperties"</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
  <span class="token property">"properties"</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token property">"things"</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token property">"type"</span><span class="token operator">:</span> <span class="token string">"array"</span><span class="token punctuation">,</span>
      <span class="token property">"items"</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token property">"oneOf"</span><span class="token operator">:</span> <span class="token punctuation">[</span>
          <span class="token punctuation">{</span> <span class="token property">"type"</span><span class="token operator">:</span> <span class="token string">"number"</span><span class="token punctuation">,</span> <span class="token property">"multipleOf"</span><span class="token operator">:</span> <span class="token number">5</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
          <span class="token punctuation">{</span> <span class="token property">"type"</span><span class="token operator">:</span> <span class="token string">"number"</span><span class="token punctuation">,</span> <span class="token property">"multipleOf"</span><span class="token operator">:</span> <span class="token number">3</span> <span class="token punctuation">}</span>
        <span class="token punctuation">]</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span></code></pre>
<p>As expected, this will appropriately validate the following data:</p>
<pre class="language-json" tabindex="0"><code class="language-json"><span class="token punctuation">{</span>
    <span class="token property">"things"</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">]</span>
<span class="token punctuation">}</span></code></pre>
<p>The values 1, 2 and 4 are marked in my editor as invalid (interestingly, but not completely unexpectedly, with errors relating to the first constraint in the list, namely &quot;Value is not divisible by 5&quot;).</p>
<h3 id="digression-floating-constraints-upwards">Digression - floating constraints upwards</h3>
<p>Just coming back to that <code>type</code> definition for a second; instead of removing the <code>&quot;type&quot;: &quot;object&quot;</code> constraint to make way for the two <code>type</code> definitions in what I was pasting in, I could have removed the two <code>type</code> definitions in what I was pasting in, and floated the constraint one level up, changing the value for the <code>type</code> property from <code>&quot;object&quot;</code> to <code>&quot;number&quot;</code>, like this:</p>
<pre class="language-json" tabindex="0"><code class="language-json"><span class="token property">"items"</span><span class="token operator">:</span> <span class="token punctuation">{</span>
  <span class="token property">"type"</span><span class="token operator">:</span> <span class="token string">"number"</span><span class="token punctuation">,</span>
  <span class="token property">"oneOf"</span><span class="token operator">:</span> <span class="token punctuation">[</span>
    <span class="token punctuation">{</span> <span class="token property">"multipleOf"</span><span class="token operator">:</span> <span class="token number">5</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">{</span> <span class="token property">"multipleOf"</span><span class="token operator">:</span> <span class="token number">3</span> <span class="token punctuation">}</span>
  <span class="token punctuation">]</span>
<span class="token punctuation">}</span></code></pre>
<p>This is much cleaner. But I digress (again).</p>
<h2 id="introducing-some-modularisation">Introducing some modularisation</h2>
<p>First, what do I actually mean by modularisation? Well I want to have the definitions for PERSON and VEHICLE in separate files, each representing a subschema, and then I want to be able to point to those two subschema files in the context of this <code>oneOf</code> section.</p>
<p>Why? Well, I feel as thought I'd be able to construct, think about and maintain schemas if they're smaller and self-contained, and then glue them together as I see fit.</p>
<h3 id="subschemas">Subschemas</h3>
<p>If I take the PERSON definition, I could define a self-contained schema that might look like this:</p>
<pre class="language-json" tabindex="0"><code class="language-json"><span class="token punctuation">{</span>
  <span class="token property">"$schema"</span><span class="token operator">:</span> <span class="token string">"https://json-schema.org/draft-07/schema"</span><span class="token punctuation">,</span>
  <span class="token property">"title"</span><span class="token operator">:</span> <span class="token string">"Person schema"</span><span class="token punctuation">,</span>
  <span class="token property">"properties"</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token property">"category"</span><span class="token operator">:</span> <span class="token punctuation">{</span> <span class="token property">"enum"</span><span class="token operator">:</span> <span class="token punctuation">[</span> <span class="token string">"PERSON"</span> <span class="token punctuation">]</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token property">"firstName"</span><span class="token operator">:</span> <span class="token punctuation">{</span> <span class="token property">"type"</span><span class="token operator">:</span> <span class="token string">"string"</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token property">"lastName"</span><span class="token operator">:</span> <span class="token punctuation">{</span> <span class="token property">"type"</span><span class="token operator">:</span> <span class="token string">"string"</span> <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token property">"required"</span><span class="token operator">:</span> <span class="token punctuation">[</span> <span class="token string">"firstName"</span><span class="token punctuation">,</span> <span class="token string">"lastName"</span><span class="token punctuation">,</span> <span class="token string">"category"</span> <span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token property">"additionalProperties"</span><span class="token operator">:</span> <span class="token boolean">false</span>
<span class="token punctuation">}</span></code></pre>
<p>Similarly, here's a self-contained schema for VEHICLE:</p>
<pre class="language-json" tabindex="0"><code class="language-json"><span class="token punctuation">{</span>
  <span class="token property">"$schema"</span><span class="token operator">:</span> <span class="token string">"https://json-schema.org/draft-07/schema"</span><span class="token punctuation">,</span>
  <span class="token property">"title"</span><span class="token operator">:</span> <span class="token string">"Vehicle schema"</span><span class="token punctuation">,</span>
  <span class="token property">"properties"</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token property">"category"</span><span class="token operator">:</span> <span class="token punctuation">{</span> <span class="token property">"enum"</span><span class="token operator">:</span> <span class="token punctuation">[</span> <span class="token string">"VEHICLE"</span> <span class="token punctuation">]</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token property">"make"</span><span class="token operator">:</span> <span class="token punctuation">{</span> <span class="token property">"type"</span><span class="token operator">:</span> <span class="token string">"string"</span><span class="token punctuation">,</span> <span class="token property">"enum"</span><span class="token operator">:</span> <span class="token punctuation">[</span> <span class="token string">"Tesla"</span><span class="token punctuation">,</span> <span class="token string">"Chevrolet"</span> <span class="token punctuation">]</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token property">"model"</span><span class="token operator">:</span> <span class="token punctuation">{</span> <span class="token property">"type"</span><span class="token operator">:</span> <span class="token string">"string"</span> <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token property">"required"</span><span class="token operator">:</span> <span class="token punctuation">[</span> <span class="token string">"make"</span><span class="token punctuation">,</span> <span class="token string">"model"</span><span class="token punctuation">,</span> <span class="token string">"category"</span> <span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token property">"additionalProperties"</span><span class="token operator">:</span> <span class="token boolean">false</span>
<span class="token punctuation">}</span></code></pre>
<blockquote>
<p>I've added some vehicle manufacturer constraints for a bit of spice.</p>
</blockquote>
<p>Each of these schemas is complete and self-contained, and each can be employed to validate data appropriately. But they can also be combined, as subschemas, with <code>oneOf</code>, into a larger whole.</p>
<p>I've put each of these into files in a subdirectory called <code>things/</code>, such that I now have this in my workspace:</p>
<pre class="language-text" tabindex="0"><code class="language-text">.
|-- myschema.json
`-- things
    |-- person.json
    `-- vehicle.json</code></pre>
<h3 id="referencing-another-schema">Referencing another schema</h3>
<p>The combining can be achieved through the use of the <a href="https://json-schema.org/understanding-json-schema/structuring.html#ref">$ref</a> keyword.</p>
<p>So to reference these two self-contained schemas to describe what the <code>items</code> can be, I can do this:</p>
<pre class="language-json" tabindex="0"><code class="language-json"><span class="token punctuation">{</span>
  <span class="token property">"$schema"</span><span class="token operator">:</span> <span class="token string">"https://json-schema.org/draft-07/schema"</span><span class="token punctuation">,</span>
  <span class="token property">"description"</span><span class="token operator">:</span> <span class="token string">"Things which are either people or vehicles"</span><span class="token punctuation">,</span>
  <span class="token property">"type"</span><span class="token operator">:</span> <span class="token string">"object"</span><span class="token punctuation">,</span>
  <span class="token property">"required"</span><span class="token operator">:</span> <span class="token punctuation">[</span> <span class="token string">"things"</span> <span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token property">"additionalProperties"</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
  <span class="token property">"properties"</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token property">"things"</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token property">"type"</span><span class="token operator">:</span> <span class="token string">"array"</span><span class="token punctuation">,</span>
      <span class="token property">"items"</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token property">"type"</span><span class="token operator">:</span> <span class="token string">"object"</span><span class="token punctuation">,</span>
        <span class="token property">"oneOf"</span><span class="token operator">:</span> <span class="token punctuation">[</span>
          <span class="token punctuation">{</span> <span class="token property">"$ref"</span><span class="token operator">:</span> <span class="token string">"./things/person.json"</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
          <span class="token punctuation">{</span> <span class="token property">"$ref"</span><span class="token operator">:</span> <span class="token string">"./things/vehicle.json"</span> <span class="token punctuation">}</span>
        <span class="token punctuation">]</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span></code></pre>
<h3 id="disambiguating-the-possibilities">Disambiguating the possibilities</h3>
<p>For me, there's a bit of magic that makes this sort of construction really well. Looking back at the two subschema definitions, each of them defines a <code>category</code> property, and in each case, only a single specific value for that property is valid. This constraint is achieved with the use of the <a href="https://json-schema.org/understanding-json-schema/reference/generic.html#enumerated-values">enum</a> keyword, where there's just a single value in the array of possible values.</p>
<p>Here's what the two definitions look like:</p>
<pre class="language-json" tabindex="0"><code class="language-json"><span class="token property">"category"</span><span class="token operator">:</span> <span class="token punctuation">{</span> <span class="token property">"enum"</span><span class="token operator">:</span> <span class="token punctuation">[</span> <span class="token string">"PERSON"</span> <span class="token punctuation">]</span> <span class="token punctuation">}</span></code></pre>
<p>and</p>
<pre class="language-json" tabindex="0"><code class="language-json"><span class="token property">"category"</span><span class="token operator">:</span> <span class="token punctuation">{</span> <span class="token property">"enum"</span><span class="token operator">:</span> <span class="token punctuation">[</span> <span class="token string">"VEHICLE"</span> <span class="token punctuation">]</span> <span class="token punctuation">}</span></code></pre>
<p>This means that for an item object to match the PERSON definition, the value of the <code>category</code> property in that object <em>must</em> be &quot;PERSON&quot;. Likewise, for an item object to match the VEHICLE definition, the value of the <code>category</code> property in that object <em>must</em> be &quot;VEHICLE&quot;.</p>
<h3 id="autocomplete-and-validation-examples">Autocomplete and validation examples</h3>
<p>This then has effects that are great for validation, and best illustrated by us imagining the creation of new <code>item</code> objects. Let's play a couple of examples out.</p>
<p>First, I'll add a vehicle object.</p>
<p>In the <code>data.json</code> file, in the array that is the value for the <code>things</code> property, I create a new empty object <code>{}</code>:</p>
<pre class="language-json" tabindex="0"><code class="language-json"><span class="token punctuation">{</span>
  <span class="token property">"things"</span><span class="token operator">:</span> <span class="token punctuation">[</span>
    <span class="token punctuation">{</span><span class="token punctuation">}</span>
  <span class="token punctuation">]</span>
<span class="token punctuation">}</span></code></pre>
<blockquote>
<p>This assumes that my editor has associated this <code>data.json</code> file with the JSON Schema in <code>myschema.json</code>. I'll talk about how this is done in another post.</p>
</blockquote>
<p>On entering <code>{}</code> I immediately get a message: &quot;Matches multiple schemas when only one must validate&quot;. Fair enough. Not enough data to go on yet.</p>
<p>I ask for suggestions and am presented with a combination of all the properties from the VEHICLE and PERSON schemas, i.e.:</p>
<ul>
<li><code>category</code></li>
<li><code>firstName</code></li>
<li><code>lastName</code></li>
<li><code>make</code></li>
<li><code>model</code></li>
</ul>
<p>Also fair. I'm still at the fork in the road.</p>
<p>I choose <code>make</code>, and request autocomplete, and then I'm presented with the following possible values:</p>
<ul>
<li>&quot;Chevrolet&quot;</li>
<li>&quot;Tesla&quot;</li>
</ul>
<p>Makes sense, these are the string values in the <code>enum</code> defined for that property, in the VEHICLE subschema. So I select &quot;Chevrolet&quot;, and ask for suggestions for the next property. This time I'm just presented with two:</p>
<ul>
<li><code>category</code></li>
<li><code>make</code></li>
</ul>
<p>This also makes sense - given that the object now has a <code>model</code> property, it will only match with the VEHICLE schema.</p>
<p>I choose <code>category</code> and request autocomplete. This time the value is automatically filled for me, it's &quot;VEHICLE&quot;. It can only be that value, and there were no other values suggested.</p>
<p>At this stage my object looks like this:</p>
<pre class="language-json" tabindex="0"><code class="language-json"><span class="token punctuation">{</span>
  <span class="token property">"things"</span><span class="token operator">:</span> <span class="token punctuation">[</span>
    <span class="token punctuation">{</span> <span class="token property">"make"</span><span class="token operator">:</span> <span class="token string">"Chevrolet"</span><span class="token punctuation">,</span> <span class="token property">"category"</span><span class="token operator">:</span> <span class="token string">"VEHICLE"</span> <span class="token punctuation">}</span>
  <span class="token punctuation">]</span>
<span class="token punctuation">}</span></code></pre>
<p>There's still an error showing, and this time it's &quot;Missing property model&quot;. Of course. The validation mechanism has matched the VEHICLE subschema, and according to the <code>required</code> property in that subschema ...</p>
<pre class="language-json" tabindex="0"><code class="language-json"><span class="token punctuation">{</span>
  <span class="token property">"required"</span><span class="token operator">:</span> <span class="token punctuation">[</span> <span class="token string">"make"</span><span class="token punctuation">,</span> <span class="token string">"model"</span><span class="token punctuation">,</span> <span class="token string">"category"</span> <span class="token punctuation">]</span>
<span class="token punctuation">}</span></code></pre>
<p>... the <code>model</code> property is also required.</p>
<p>So I add one (autocomplete has this property as its only suggestion anyway) and specify &quot;Caprice&quot; as the value.</p>
<p>I end up with my first thing, and everything is valid:</p>
<pre class="language-json" tabindex="0"><code class="language-json"><span class="token punctuation">{</span>
  <span class="token property">"things"</span><span class="token operator">:</span> <span class="token punctuation">[</span>
    <span class="token punctuation">{</span>
      <span class="token property">"make"</span><span class="token operator">:</span> <span class="token string">"Chevrolet"</span><span class="token punctuation">,</span>
      <span class="token property">"category"</span><span class="token operator">:</span> <span class="token string">"VEHICLE"</span><span class="token punctuation">,</span>
      <span class="token property">"model"</span><span class="token operator">:</span> <span class="token string">"Caprice"</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">]</span>
<span class="token punctuation">}</span></code></pre>
<p>For a second example, I'll add a person object.</p>
<p>I start out the same way as before, by adding a new <code>{}</code> empty object, and then select <code>category</code> as the property I want to create first:</p>
<pre class="language-json" tabindex="0"><code class="language-json"><span class="token punctuation">{</span>
  <span class="token property">"things"</span><span class="token operator">:</span> <span class="token punctuation">[</span>
    <span class="token punctuation">{</span>
      <span class="token property">"make"</span><span class="token operator">:</span> <span class="token string">"Chevrolet"</span><span class="token punctuation">,</span>
      <span class="token property">"category"</span><span class="token operator">:</span> <span class="token string">"VEHICLE"</span><span class="token punctuation">,</span>
      <span class="token property">"model"</span><span class="token operator">:</span> <span class="token string">"Caprice"</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">{</span> <span class="token property">"category"</span><span class="token operator">:</span> ... <span class="token punctuation">}</span>
  <span class="token punctuation">]</span>
<span class="token punctuation">}</span></code></pre>
<p>The autocomplete automatically suggests &quot;PERSON&quot; as the value. This strikes me as slightly odd, and perhaps a foible of the implementation of autocomplete in the editor I'm using. Because at this stage the choice of subschemas is still open, right?</p>
<p>I guess it's sort of understandable (almost?) in that if I've asked it to suggest a value, then it needs to suggest one, and picks the first possibility, which due to the simple fact that the PERSON subschema is listed first in the <code>oneOf</code> array ...</p>
<pre class="language-json" tabindex="0"><code class="language-json"><span class="token property">"oneOf"</span><span class="token operator">:</span> <span class="token punctuation">[</span>
  <span class="token punctuation">{</span> <span class="token property">"$ref"</span><span class="token operator">:</span> <span class="token string">"./things/person.json"</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">{</span> <span class="token property">"$ref"</span><span class="token operator">:</span> <span class="token string">"./things/vehicle.json"</span> <span class="token punctuation">}</span>
<span class="token punctuation">]</span></code></pre>
<p>... is &quot;PERSON&quot;. Makes sense, sort of.</p>
<p>So anyway I remove the suggested &quot;PERSON&quot; value and ask for suggestions again; this time, it gives me a choice of the two actual possibilities: &quot;PERSON&quot; and &quot;VEHICLE&quot;. I select &quot;PERSON&quot; anyway, but am happy to have seen that both were presented as options.</p>
<p>I then proceed to ask for and then select the only two remaining possible properties which are <code>firstName</code> and <code>lastName</code> because the choice of &quot;PERSON&quot; for <code>category</code> has locked this object into being constrained by the corresponding subschema, add the values, and end up with:</p>
<pre class="language-json" tabindex="0"><code class="language-json"><span class="token punctuation">{</span>
  <span class="token property">"things"</span><span class="token operator">:</span> <span class="token punctuation">[</span>
    <span class="token punctuation">{</span>
      <span class="token property">"make"</span><span class="token operator">:</span> <span class="token string">"Chevrolet"</span><span class="token punctuation">,</span>
      <span class="token property">"category"</span><span class="token operator">:</span> <span class="token string">"VEHICLE"</span><span class="token punctuation">,</span>
      <span class="token property">"model"</span><span class="token operator">:</span> <span class="token string">"Caprice"</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">{</span>
      <span class="token property">"category"</span><span class="token operator">:</span> <span class="token string">"PERSON"</span><span class="token punctuation">,</span>
      <span class="token property">"firstName"</span><span class="token operator">:</span> <span class="token string">"Arthur"</span><span class="token punctuation">,</span>
      <span class="token property">"lastName"</span><span class="token operator">:</span> <span class="token string">"Dent"</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">]</span>
<span class="token punctuation">}</span></code></pre>
<p>I've put the schema / subschemas combination through its paces and am happy with the result - it's what I'd expect (modulo the questionable editor behaviour mentioned) from the overall schema.</p>
<h3 id="improving-on-the-category-constraints">Improving on the category constraints</h3>
<p>One of the reasons I write rambling notes to myself (and to you, dear reader, if - by this point in the post - you're still here) is that at the end of it, my own understanding is better. Not only that, in looking up stuff that I can reference, I learn new things.</p>
<p>An example of this is that in looking up the content related to <a href="https://json-schema.org/understanding-json-schema/reference/generic.html#enumerated-values">enumerated values</a> I noticed, directly in the next section, that JSON Schema also has <a href="https://json-schema.org/understanding-json-schema/reference/generic.html#constant-values">constant values</a>! They're new from draft 06, so are fine for me to use.</p>
<p>This is a new discovery for me, and I can replace the magic earlier - <code>enums</code> with single values - with this <code>const</code> keyword.</p>
<p>Taking the VEHICLE subschema as an example, here's what it looks like now:</p>
<pre class="language-json" tabindex="0"><code class="language-json"><span class="token punctuation">{</span>
  <span class="token property">"$schema"</span><span class="token operator">:</span> <span class="token string">"https://json-schema.org/draft-07/schema"</span><span class="token punctuation">,</span>
  <span class="token property">"title"</span><span class="token operator">:</span> <span class="token string">"Vehicle schema"</span><span class="token punctuation">,</span>
  <span class="token property">"properties"</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token property">"category"</span><span class="token operator">:</span> <span class="token punctuation">{</span> <span class="token property">"const"</span><span class="token operator">:</span> <span class="token string">"VEHICLE"</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token property">"make"</span><span class="token operator">:</span> <span class="token punctuation">{</span> <span class="token property">"type"</span><span class="token operator">:</span> <span class="token string">"string"</span><span class="token punctuation">,</span> <span class="token property">"enum"</span><span class="token operator">:</span> <span class="token punctuation">[</span> <span class="token string">"Tesla"</span><span class="token punctuation">,</span> <span class="token string">"Chevrolet"</span> <span class="token punctuation">]</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token property">"model"</span><span class="token operator">:</span> <span class="token punctuation">{</span> <span class="token property">"type"</span><span class="token operator">:</span> <span class="token string">"string"</span> <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token property">"required"</span><span class="token operator">:</span> <span class="token punctuation">[</span> <span class="token string">"make"</span><span class="token punctuation">,</span> <span class="token string">"model"</span><span class="token punctuation">,</span> <span class="token string">"category"</span> <span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token property">"additionalProperties"</span><span class="token operator">:</span> <span class="token boolean">false</span>
<span class="token punctuation">}</span></code></pre>
<p>Using <code>const</code> makes more sense, and is more explicit. Nice!</p>
<h2 id="wrapping-up">Wrapping up</h2>
<p>I think the possibilities of managing schemas in a modular way are definitely there, and this brief foray into that area of JSON Schema has taught me a thing or two. I hope it has helped you become acquainted too.</p>
<p><img src="/images/2022/11/tdx13.jpg" alt="Chevrolet Caprice Classic Coupe"></p>
<p>Here's a pic of my 1973 Chevrolet Caprice Classic Coupe which I had in the 1990's. Long gone, never forgotten.</p>
<h2 id="further-reading">Further reading</h2>
<ul>
<li><a href="https://json-schema.org/understanding-json-schema/structuring.html">Structuring a complex schema</a></li>
</ul>



<script src="https://utteranc.es/client.js" repo="qmacro/qmacro.github.io" issue-term="title" crossorigin="anonymous" async=""></script>

<ul class="links-nextprev"><li class="links-nextprev-prev">← Previous<br> <a href="/blog/posts/2022/11/01/more-untappd-data-explorations-with-jq-my-top-ranking-beer-types-part-3/">More Untappd data explorations with jq - my top ranking beer types (part 3)</a></li><li class="links-nextprev-next">Next →<br><a href="/blog/posts/2022/11/08/extracting-blog-post-dates-from-urls-with-jq/">Extracting blog post dates from URLs with jq</a></li>
</ul>

			</heading-anchors>
		</main>

		<!-- This page `/blog/posts/2022/11/02/some-notes-on-modular-json-schema-definitions/` was built on 2025-09-29T18:34:05.959Z -->
		<script type="module" src="/dist/R1izrEYWYW.js"></script>
	</body>
</html>
