<!doctype html>
<html lang="en">
	<head>
		<meta charset="utf-8">
		<meta name="viewport" content="width=device-width, initial-scale=1.0">
		<title>More Untappd data explorations with jq - my top ranking beer types (part 3)</title>
		<meta name="description" content="Reserving the right to be wrong.">
		<link rel="alternate" href="/feed/feed.xml" type="application/atom+xml" title="DJ Adams">
		<link rel="icon" type="image/x-icon" href="/images/favicon.ico">
		
		
		
		<style>/* This is an arbitrary CSS string added to the bundle */
/* Defaults */
:root {
	--font-family: -apple-system, system-ui, sans-serif;
	--font-family-monospace: Consolas, Menlo, Monaco, Andale Mono WT, Andale Mono, Lucida Console, Lucida Sans Typewriter, DejaVu Sans Mono, Bitstream Vera Sans Mono, Liberation Mono, Nimbus Mono L, Courier New, Courier, monospace;
}

/* Theme colors */
:root {
	--color-gray-20: #e0e0e0;
	--color-gray-50: #C0C0C0;
	--color-gray-90: #333;

	--background-color: #fff;

	--text-color: var(--color-gray-90);
	--text-color-link: #2884d2;
	--text-color-link-active: #15b0ed;
	--text-color-link-visited: #9f4199;

	--syntax-tab-size: 2;
}

@media (prefers-color-scheme: dark) {
	:root {
		--color-gray-20: #e0e0e0;
		--color-gray-50: #C0C0C0;
		--color-gray-90: #dad8d8;

		/* --text-color is assigned to --color-gray-_ above */
		--text-color-link: #1493fb;
		--text-color-link-active: #6969f7;
		--text-color-link-visited: #a6a6f8;

		--background-color: #15202b;
	}
}


/* Global stylesheet */
* {
	box-sizing: border-box;
}

@view-transition {
	navigation: auto;
}

html,
body {
	padding: 0;
	margin: 0 auto;
	font-family: var(--font-family);
	color: var(--text-color);
	background-color: var(--background-color);
}
html {
	overflow-y: scroll;
}
body {
	max-width: 40em;
}

/* https://www.a11yproject.com/posts/how-to-hide-content/ */
.visually-hidden:not(:focus):not(:active) {
	clip: rect(0 0 0 0);
	clip-path: inset(50%);
	height: 1px;
	overflow: hidden;
	position: absolute;
	white-space: nowrap;
	width: 1px;
}

/* Fluid images via https://www.zachleat.com/web/fluid-images/ */
img{
  max-width: 100%;
}
img[width][height] {
  height: auto;
}
img[src$=".svg"] {
  width: 100%;
  height: auto;
  max-width: none;
}
video,
iframe {
	width: 100%;
	height: auto;
}
iframe {
	aspect-ratio: 16/9;
}

p:last-child {
	margin-bottom: 0;
}
p {
	line-height: 1.5;
}

li {
	line-height: 1.5;
}

a[href] {
	color: var(--text-color-link);
}
a[href]:visited {
	color: var(--text-color-link-visited);
}
a[href]:hover,
a[href]:active {
	color: var(--text-color-link-active);
}

main,
footer {
	padding: 1rem;
}
/* main :first-child { */
/* 	margin-top: 0; */
/* } */

header {
	border-bottom: 1px dashed var(--color-gray-20);
}

#skip-link {
	text-decoration: none;
	background: var(--background-color);
	color: var(--text-color);
	padding: 0.5rem 1rem;
	border: 1px solid var(--color-gray-90);
	border-radius: 2px;
}

/* Prevent visually-hidden skip link fom pushing content around when focused */
#skip-link.visually-hidden:focus {
	position: absolute;
	top: 1rem;
	left: 1rem;
	/* Ensure it is positioned on top of everything else when it is shown */
	z-index: 999;
}

.links-nextprev {
	display: flex;
	justify-content: space-between;
	gap: .5em 1em;
	list-style: "";
	border-top: 1px dashed var(--color-gray-20);
	padding: 1em 0;
}
.links-nextprev > * {
	flex-grow: 1;
}
.links-nextprev-next {
	text-align: right;
}

table {
	margin: 1em 0;
}
table td,
table th {
	padding-right: 1em;
}

pre,
code {
	font-family: var(--font-family-monospace);
	color: seagreen;
}

pre,code[class*="language-"] {
	line-height: 1.2em !important;
	font-size: 0.93em !important;
}

pre:not([class*="language-"]) {
	margin: .5em 0;
	line-height: 1.375; /* 22px /16 */
	-moz-tab-size: var(--syntax-tab-size);
	-o-tab-size: var(--syntax-tab-size);
	tab-size: var(--syntax-tab-size);
	-webkit-hyphens: none;
	-ms-hyphens: none;
	hyphens: none;
	direction: ltr;
	text-align: left;
	white-space: pre;
	word-spacing: normal;
	word-break: normal;
	overflow-x: auto;
}
code {
	word-break: break-all;
}

/* Header */
header {
	display: flex;
	gap: 1em;
	flex-wrap: wrap;
	justify-content: space-between;
	align-items: center;
	padding: 1em;
}
.home-link {
	flex-grow: 1;
	font-size: 1em; /* 16px /16 */
	font-weight: 700;
}
.home-link:link:not(:hover) {
	text-decoration: none;
}

/* Nav */
.nav {
	display: flex;
	gap: .5em 1em;
	padding: 0;
	margin: 0;
	list-style: none;
}
.nav-item {
	display: inline-block;
}
.nav-item a[href]:not(:hover) {
	text-decoration: none;
}
.nav a[href][aria-current="page"] {
	text-decoration: underline;
}

/* Posts list */
.postlist {
	counter-reset: start-from var(--postlist-index);
	list-style: none;
	padding: 0;
}
.postlist-item {
	display: flex;
	flex-wrap: wrap;
	align-items: baseline;
	counter-increment: start-from -1;
	margin-bottom: 1em;
}
.postlist-item:before {
	display: inline-block;
	pointer-events: none;
	line-height: 100%;
	text-align: right;
	margin-left: -1.5rem;
}
.postlist-date,
.postlist-item:before {
	font-size: 0.8125em; /* 13px /16 */
	color: var(--color-gray-90);
}
.postlist-date {
	word-spacing: -0.5px;
}
.postlist-link {
	font-size: 1.1875em; /* 19px /16 */
	font-weight: 700;
	flex-basis: calc(100% - 1.5rem);
	text-underline-position: from-font;
	text-underline-offset: 0;
	text-decoration-thickness: 1px;
}
.postlist-item-active .postlist-link {
	font-weight: bold;
}

/* Tags */
.post-tag {
	display: inline-flex;
	align-items: center;
	justify-content: center;
	font-style: italic;
}

/* may want to make the description text smaller at some stage */
.post-description-list {
	font-size: 1.0em;
}

.post-description-main {
	font-style: italic;
}

.postlist-item > .post-tag {
	align-self: center;
}

/* Tags list */
.post-metadata {
	display: inline-flex;
	flex-wrap: wrap;
	gap: .5em;
	list-style: none;
	padding: 0;
	margin: 0;
}
.post-metadata time {
	margin-right: 1em;
}

blockquote {
	margin-top: 0px;
	margin-left: 0px;
	margin-bottom: 15px;
	padding-left: 15px;
	border-left: 5px solid lightgray;
}
/**
 * prism.js default theme for JavaScript, CSS and HTML
 * Based on dabblet (http://dabblet.com)
 * @author Lea Verou
 */

code[class*="language-"],
pre[class*="language-"] {
	color: black;
	background: none;
	text-shadow: 0 1px white;
	font-family: Consolas, Monaco, 'Andale Mono', 'Ubuntu Mono', monospace;
	font-size: 1em;
	text-align: left;
	white-space: pre;
	word-spacing: normal;
	word-break: normal;
	word-wrap: normal;
	line-height: 1.5;

	-moz-tab-size: 4;
	-o-tab-size: 4;
	tab-size: 4;

	-webkit-hyphens: none;
	-moz-hyphens: none;
	-ms-hyphens: none;
	hyphens: none;
}

pre[class*="language-"]::-moz-selection, pre[class*="language-"] ::-moz-selection,
code[class*="language-"]::-moz-selection, code[class*="language-"] ::-moz-selection {
	text-shadow: none;
	background: #b3d4fc;
}

pre[class*="language-"]::selection, pre[class*="language-"] ::selection,
code[class*="language-"]::selection, code[class*="language-"] ::selection {
	text-shadow: none;
	background: #b3d4fc;
}

@media print {
	code[class*="language-"],
	pre[class*="language-"] {
		text-shadow: none;
	}
}

/* Code blocks */
pre[class*="language-"] {
	padding: 1em;
	margin: .5em 0;
	overflow: auto;
}

:not(pre) > code[class*="language-"],
pre[class*="language-"] {
	background: #f5f2f0;
}

/* Inline code */
:not(pre) > code[class*="language-"] {
	padding: .1em;
	border-radius: .3em;
	white-space: normal;
}

.token.comment,
.token.prolog,
.token.doctype,
.token.cdata {
	color: slategray;
}

.token.punctuation {
	color: #999;
}

.token.namespace {
	opacity: .7;
}

.token.property,
.token.tag,
.token.boolean,
.token.number,
.token.constant,
.token.symbol,
.token.deleted {
	color: #905;
}

.token.selector,
.token.attr-name,
.token.string,
.token.char,
.token.builtin,
.token.inserted {
	color: #690;
}

.token.operator,
.token.entity,
.token.url,
.language-css .token.string,
.style .token.string {
	color: #9a6e3a;
	/* This background color was intended by the author of this theme. */
	background: hsla(0, 0%, 100%, .5);
}

.token.atrule,
.token.attr-value,
.token.keyword {
	color: #07a;
}

.token.function,
.token.class-name {
	color: #DD4A68;
}

.token.regex,
.token.important,
.token.variable {
	color: #e90;
}

.token.important,
.token.bold {
	font-weight: bold;
}
.token.italic {
	font-style: italic;
}

.token.entity {
	cursor: help;
}
/*
 * New diff- syntax
 */

pre[class*="language-diff-"] {
	--eleventy-code-padding: 1.25em;
	padding-left: var(--eleventy-code-padding);
	padding-right: var(--eleventy-code-padding);
}
.token.deleted {
	background-color: hsl(0, 51%, 37%);
	color: inherit;
}
.token.inserted {
	background-color: hsl(126, 31%, 39%);
	color: inherit;
}

/* Make the + and - characters unselectable for copy/paste */
.token.prefix.unchanged,
.token.prefix.inserted,
.token.prefix.deleted {
	-webkit-user-select: none;
	user-select: none;
	display: inline-flex;
	align-items: center;
	justify-content: center;
	padding-top: 2px;
	padding-bottom: 2px;
}
.token.prefix.inserted,
.token.prefix.deleted {
	width: var(--eleventy-code-padding);
	background-color: rgba(0,0,0,.2);
}

/* Optional: full-width background color */
.token.inserted:not(.prefix),
.token.deleted:not(.prefix) {
	display: block;
	margin-left: calc(-1 * var(--eleventy-code-padding));
	margin-right: calc(-1 * var(--eleventy-code-padding));
	text-decoration: none; /* override del, ins, mark defaults */
	color: inherit; /* override del, ins, mark defaults */
}
.utterances {
  margin-left: inherit !important;
}</style>
		
	</head>
	<body>
		<a href="#main" id="skip-link" class="visually-hidden">Skip to main content</a>

		<header>
			<a href="/" class="home-link">DJ Adams</a>
			<nav>
				<h2 class="visually-hidden" id="top-level-navigation-menu">Top level navigation menu</h2>
				<ul class="nav">
					<li class="nav-item"><a href="/">Home</a></li>
					<li class="nav-item"><a href="/about/">About</a></li>
					<li class="nav-item"><a href="/blog/">Blog</a></li>
					<li class="nav-item"><a href="/feed/feed.xml">Feed</a></li>
				</ul>
			</nav>
		</header>

		<main id="main">
			<heading-anchors>
				


<h1 id="more-untappd-data-explorations-with-jq-my-top-ranking-beer-types-part-3">More Untappd data explorations with jq - my top ranking beer types (part 3)</h1>

<ul class="post-metadata">
	<li><time datetime="2022-11-01">01 November 2022</time></li>
	<li><a href="/tags/jq-series-top-beer-types/" class="post-tag">jq-series-top-beer-types</a>, </li>
	<li><a href="/tags/untappd/" class="post-tag">untappd</a>, </li>
	<li><a href="/tags/jq/" class="post-tag">jq</a>, </li>
	<li><a href="/tags/beer/" class="post-tag">beer</a></li>
</ul>

<p class="post-description-main"></p>

<p>This is a continuation of <a href="/blog/posts/2022/10/31/more-untappd-data-explorations-with-jq-my-top-ranking-beer-types-(part-2)/">part 2</a> which you should read first.</p>
<p><a href="https://untappd.com/user/qmacro/checkin/696856275"><img src="/images/2022/10/east-india-porter-checkin.png" alt="A checkin of Beer Nouveau's C18th recipe of East India Porter"></a></p>
<p>Part 2 finished with an array of category objects, each containing all the checkin ratings for that category, albeit in string form, with some empty strings:</p>
<pre class="language-jq" tabindex="0"><code class="language-jq"><span class="token punctuation">[</span>
  <span class="token punctuation">{</span>
    <span class="token property">"key"</span><span class="token punctuation">:</span> <span class="token string">"Altbier"</span><span class="token punctuation">,</span>
    <span class="token property">"value"</span><span class="token punctuation">:</span> <span class="token punctuation">[</span>
      <span class="token string">"4"</span><span class="token punctuation">,</span>
      <span class="token string">"3"</span><span class="token punctuation">,</span>
      <span class="token string">"3.75"</span><span class="token punctuation">,</span>
      <span class="token string">"3.5"</span><span class="token punctuation">,</span>
      <span class="token string">"3.25"</span>
    <span class="token punctuation">]</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">{</span>
    <span class="token property">"key"</span><span class="token punctuation">:</span> <span class="token string">"..."</span><span class="token punctuation">,</span>
    <span class="token property">"value"</span><span class="token punctuation">:</span> <span class="token punctuation">[</span>
      <span class="token string">"..."</span><span class="token punctuation">,</span>
      <span class="token string">"..."</span>
    <span class="token punctuation">]</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">{</span>
    <span class="token property">"key"</span><span class="token punctuation">:</span> <span class="token string">"Winter Warmer"</span><span class="token punctuation">,</span>
    <span class="token property">"value"</span><span class="token punctuation">:</span> <span class="token punctuation">[</span>
      <span class="token string">""</span><span class="token punctuation">,</span>
      <span class="token string">""</span><span class="token punctuation">,</span>
      <span class="token string">"4"</span><span class="token punctuation">,</span>
      <span class="token string">"4"</span><span class="token punctuation">,</span>
      <span class="token string">"4"</span><span class="token punctuation">,</span>
      <span class="token string">"3.5"</span><span class="token punctuation">,</span>
      <span class="token string">"4"</span><span class="token punctuation">,</span>
      <span class="token string">"4.25"</span><span class="token punctuation">,</span>
      <span class="token string">"3.25"</span><span class="token punctuation">,</span>
      <span class="token string">"4.25"</span><span class="token punctuation">,</span>
      <span class="token string">"3.75"</span><span class="token punctuation">,</span>
      <span class="token string">"3.4"</span>
    <span class="token punctuation">]</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">]</span></code></pre>
<p>This was achieved using a pattern now encapsulated into a function called <code>arrange</code>:</p>
<pre class="language-jq" tabindex="0"><code class="language-jq"><span class="token keyword">def</span> <span class="token function">major_type</span><span class="token punctuation">:</span> <span class="token c-style-function function">split</span><span class="token punctuation">(</span><span class="token string">" -"</span><span class="token punctuation">)</span> <span class="token operator pipe">|</span> first<span class="token punctuation">;</span>

<span class="token keyword">def</span> <span class="token function">arrange</span><span class="token punctuation">(</span>k<span class="token punctuation">;</span>v<span class="token punctuation">)</span><span class="token punctuation">:</span> 
  <span class="token c-style-function function">group_by</span><span class="token punctuation">(</span><span class="token punctuation">.</span><span class="token punctuation">[</span>k<span class="token punctuation">]</span><span class="token punctuation">)</span>
  <span class="token operator pipe">|</span> <span class="token c-style-function function">map</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token property-literal property">key</span><span class="token punctuation">:</span> <span class="token punctuation">(</span>first<span class="token operator pipe">|</span><span class="token punctuation">.</span><span class="token punctuation">[</span>k<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token property-literal property">value</span><span class="token punctuation">:</span> v<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token c-style-function function">map</span><span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token property-literal property">category</span><span class="token punctuation">:</span> <span class="token punctuation">.</span>beer_type<span class="token operator pipe">|</span>major_type<span class="token punctuation">,</span> rating_score <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token operator pipe">|</span> <span class="token c-style-function function">arrange</span><span class="token punctuation">(</span><span class="token string">"category"</span><span class="token punctuation">;</span> <span class="token c-style-function function">map</span><span class="token punctuation">(</span><span class="token punctuation">.</span>rating_score<span class="token punctuation">)</span><span class="token punctuation">)</span></code></pre>
<h2 id="dealing-with-bad-data">Dealing with bad data</h2>
<p>So, about those rating values. I'll take the ratings for the Winter Warmer category as an example to work on, and I can get a list of those by extending the current filter like this:</p>
<pre class="language-jq" tabindex="0"><code class="language-jq"><span class="token keyword">def</span> <span class="token function">category</span><span class="token punctuation">:</span> <span class="token c-style-function function">split</span><span class="token punctuation">(</span><span class="token string">" -"</span><span class="token punctuation">)</span> <span class="token operator pipe">|</span> first<span class="token punctuation">;</span>

<span class="token keyword">def</span> <span class="token function">arrange</span><span class="token punctuation">(</span>k<span class="token punctuation">;</span>v<span class="token punctuation">)</span><span class="token punctuation">:</span> 
  <span class="token c-style-function function">group_by</span><span class="token punctuation">(</span><span class="token punctuation">.</span><span class="token punctuation">[</span>k<span class="token punctuation">]</span><span class="token punctuation">)</span>
  <span class="token operator pipe">|</span> <span class="token c-style-function function">map</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token property-literal property">key</span><span class="token punctuation">:</span> <span class="token punctuation">(</span>first<span class="token operator pipe">|</span><span class="token punctuation">.</span><span class="token punctuation">[</span>k<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token property-literal property">value</span><span class="token punctuation">:</span> v<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token c-style-function function">map</span><span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token property-literal property">category</span><span class="token punctuation">:</span> <span class="token punctuation">.</span>beer_type<span class="token operator pipe">|</span>major_type<span class="token punctuation">,</span> rating_score <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token operator pipe">|</span> <span class="token c-style-function function">arrange</span><span class="token punctuation">(</span><span class="token string">"category"</span><span class="token punctuation">;</span> <span class="token c-style-function function">map</span><span class="token punctuation">(</span><span class="token punctuation">.</span>rating_score<span class="token punctuation">)</span><span class="token punctuation">)</span>

<span class="token comment"># Temporary selection of Winter Warmer ratings</span>
<span class="token operator pipe">|</span> <span class="token c-style-function function">map</span><span class="token punctuation">(</span><span class="token c-style-function function">select</span><span class="token punctuation">(</span><span class="token punctuation">.</span>key <span class="token operator">==</span> <span class="token string">"Winter Warmer"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token operator pipe">|</span>first<span class="token operator pipe">|</span><span class="token punctuation">.</span>value</code></pre>
<p>I've deliberately put some whitespace (and a comment) before this temporary extension, to make it clear it's not permanent.</p>
<p>The output looks like this:</p>
<pre class="language-json" tabindex="0"><code class="language-json"><span class="token punctuation">[</span>
  <span class="token string">""</span><span class="token punctuation">,</span>
  <span class="token string">""</span><span class="token punctuation">,</span>
  <span class="token string">"4"</span><span class="token punctuation">,</span>
  <span class="token string">"4"</span><span class="token punctuation">,</span>
  <span class="token string">"4"</span><span class="token punctuation">,</span>
  <span class="token string">"3.5"</span><span class="token punctuation">,</span>
  <span class="token string">"4"</span><span class="token punctuation">,</span>
  <span class="token string">"4.25"</span><span class="token punctuation">,</span>
  <span class="token string">"3.25"</span><span class="token punctuation">,</span>
  <span class="token string">"4.25"</span><span class="token punctuation">,</span>
  <span class="token string">"3.75"</span><span class="token punctuation">,</span>
  <span class="token string">"3.4"</span>
<span class="token punctuation">]</span></code></pre>
<p>OK, so it seems worthwhile building something to filter these values down to ones that are not null and to turn them from strings to numbers. While there isn't an explicit <code>filter</code> function, it's achieved by the combination of <code>map</code> and <code>select</code>, which is very common to see. In fact, I use it in this temporary extension: <code>map(select(.key == &quot;Winter Warmer&quot;))</code>.</p>
<blockquote>
<p>To be honest, I've often wondered why a simple syntactic sugar function isn't in the <a href="https://github.com/stedolan/jq/blob/master/src/builtin.jq">builtin</a> library, something like this:</p>
<pre class="language-jq" tabindex="0"><code class="language-jq"><span class="token keyword">def</span> <span class="token function">filter</span><span class="token punctuation">(</span>f<span class="token punctuation">)</span><span class="token punctuation">:</span> <span class="token c-style-function function">map</span><span class="token punctuation">(</span><span class="token c-style-function function">select</span><span class="token punctuation">(</span>f<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre>
<p>Then I could have expressed the above section like this: <code>filter(.key == &quot;Winter Warmer&quot;)</code>.</p>
</blockquote>
<p>Anyway, to the data. Filtering out anything except actual values could be done like this:</p>
<pre class="language-jq" tabindex="0"><code class="language-jq"><span class="token keyword">def</span> <span class="token function">category</span><span class="token punctuation">:</span> <span class="token c-style-function function">split</span><span class="token punctuation">(</span><span class="token string">" -"</span><span class="token punctuation">)</span> <span class="token operator pipe">|</span> first<span class="token punctuation">;</span>

<span class="token keyword">def</span> <span class="token function">arrange</span><span class="token punctuation">(</span>k<span class="token punctuation">;</span>v<span class="token punctuation">)</span><span class="token punctuation">:</span> 
  <span class="token c-style-function function">group_by</span><span class="token punctuation">(</span><span class="token punctuation">.</span><span class="token punctuation">[</span>k<span class="token punctuation">]</span><span class="token punctuation">)</span>
  <span class="token operator pipe">|</span> <span class="token c-style-function function">map</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token property-literal property">key</span><span class="token punctuation">:</span> <span class="token punctuation">(</span>first<span class="token operator pipe">|</span><span class="token punctuation">.</span><span class="token punctuation">[</span>k<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token property-literal property">value</span><span class="token punctuation">:</span> v<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token c-style-function function">map</span><span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token property-literal property">category</span><span class="token punctuation">:</span> <span class="token punctuation">.</span>beer_type<span class="token operator pipe">|</span>major_type<span class="token punctuation">,</span> rating_score <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token operator pipe">|</span> <span class="token c-style-function function">arrange</span><span class="token punctuation">(</span><span class="token string">"category"</span><span class="token punctuation">;</span> <span class="token c-style-function function">map</span><span class="token punctuation">(</span><span class="token punctuation">.</span>rating_score<span class="token punctuation">)</span><span class="token punctuation">)</span>

<span class="token comment"># Temporary selection of Winter Warmer ratings</span>
<span class="token operator pipe">|</span> <span class="token c-style-function function">map</span><span class="token punctuation">(</span><span class="token c-style-function function">select</span><span class="token punctuation">(</span><span class="token punctuation">.</span>key <span class="token operator">==</span> <span class="token string">"Winter Warmer"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token operator pipe">|</span>first<span class="token operator pipe">|</span><span class="token punctuation">.</span>value
<span class="token operator pipe">|</span> <span class="token c-style-function function">map</span><span class="token punctuation">(</span><span class="token c-style-function function">select</span><span class="token punctuation">(</span>length <span class="token operator">></span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">)</span></code></pre>
<p>Which reduces the array of values appropriately:</p>
<pre class="language-json" tabindex="0"><code class="language-json"><span class="token punctuation">[</span>
  <span class="token string">"4"</span><span class="token punctuation">,</span>
  <span class="token string">"4"</span><span class="token punctuation">,</span>
  <span class="token string">"4"</span><span class="token punctuation">,</span>
  <span class="token string">"3.5"</span><span class="token punctuation">,</span>
  <span class="token string">"4"</span><span class="token punctuation">,</span>
  <span class="token string">"4.25"</span><span class="token punctuation">,</span>
  <span class="token string">"3.25"</span><span class="token punctuation">,</span>
  <span class="token string">"4.25"</span><span class="token punctuation">,</span>
  <span class="token string">"3.75"</span><span class="token punctuation">,</span>
  <span class="token string">"3.4"</span>
<span class="token punctuation">]</span></code></pre>
<p>And conveniently, there's a function to parse input as a number, appropriately called <code>tonumber</code> (there's also <code>tostring</code>). Adding that to this filter like this:</p>
<pre class="language-jq" tabindex="0"><code class="language-jq"><span class="token keyword">def</span> <span class="token function">category</span><span class="token punctuation">:</span> <span class="token c-style-function function">split</span><span class="token punctuation">(</span><span class="token string">" -"</span><span class="token punctuation">)</span> <span class="token operator pipe">|</span> first<span class="token punctuation">;</span>

<span class="token keyword">def</span> <span class="token function">arrange</span><span class="token punctuation">(</span>k<span class="token punctuation">;</span>v<span class="token punctuation">)</span><span class="token punctuation">:</span> 
  <span class="token c-style-function function">group_by</span><span class="token punctuation">(</span><span class="token punctuation">.</span><span class="token punctuation">[</span>k<span class="token punctuation">]</span><span class="token punctuation">)</span>
  <span class="token operator pipe">|</span> <span class="token c-style-function function">map</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token property-literal property">key</span><span class="token punctuation">:</span> <span class="token punctuation">(</span>first<span class="token operator pipe">|</span><span class="token punctuation">.</span><span class="token punctuation">[</span>k<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token property-literal property">value</span><span class="token punctuation">:</span> v<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token c-style-function function">map</span><span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token property-literal property">category</span><span class="token punctuation">:</span> <span class="token punctuation">.</span>beer_type<span class="token operator pipe">|</span>major_type<span class="token punctuation">,</span> rating_score <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token operator pipe">|</span> <span class="token c-style-function function">arrange</span><span class="token punctuation">(</span><span class="token string">"category"</span><span class="token punctuation">;</span> <span class="token c-style-function function">map</span><span class="token punctuation">(</span><span class="token punctuation">.</span>rating_score<span class="token punctuation">)</span><span class="token punctuation">)</span>

<span class="token comment"># Temporary selection of Winter Warmer ratings</span>
<span class="token operator pipe">|</span> <span class="token c-style-function function">map</span><span class="token punctuation">(</span><span class="token c-style-function function">select</span><span class="token punctuation">(</span><span class="token punctuation">.</span>key <span class="token operator">==</span> <span class="token string">"Winter Warmer"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token operator pipe">|</span>first<span class="token operator pipe">|</span><span class="token punctuation">.</span>value
<span class="token operator pipe">|</span> <span class="token c-style-function function">map</span><span class="token punctuation">(</span><span class="token c-style-function function">select</span><span class="token punctuation">(</span>length <span class="token operator">></span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token operator pipe">|</span>tonumber<span class="token punctuation">)</span></code></pre>
<p>gives us:</p>
<pre class="language-json" tabindex="0"><code class="language-json"><span class="token punctuation">[</span>
  <span class="token number">4</span><span class="token punctuation">,</span>
  <span class="token number">4</span><span class="token punctuation">,</span>
  <span class="token number">4</span><span class="token punctuation">,</span>
  <span class="token number">3.5</span><span class="token punctuation">,</span>
  <span class="token number">4</span><span class="token punctuation">,</span>
  <span class="token number">4.25</span><span class="token punctuation">,</span>
  <span class="token number">3.25</span><span class="token punctuation">,</span>
  <span class="token number">4.25</span><span class="token punctuation">,</span>
  <span class="token number">3.75</span><span class="token punctuation">,</span>
  <span class="token number">3.4</span>
<span class="token punctuation">]</span></code></pre>
<p>That's what we want! Worth putting into a function, don't you agree? How about calling that function <code>numbers</code>, and then using it in our temporary &quot;Winter Warmer&quot; extension:</p>
<pre class="language-jq" tabindex="0"><code class="language-jq"><span class="token keyword">def</span> <span class="token function">category</span><span class="token punctuation">:</span> <span class="token c-style-function function">split</span><span class="token punctuation">(</span><span class="token string">" -"</span><span class="token punctuation">)</span> <span class="token operator pipe">|</span> first<span class="token punctuation">;</span>

<span class="token keyword">def</span> <span class="token function">arrange</span><span class="token punctuation">(</span>k<span class="token punctuation">;</span>v<span class="token punctuation">)</span><span class="token punctuation">:</span> 
  <span class="token c-style-function function">group_by</span><span class="token punctuation">(</span><span class="token punctuation">.</span><span class="token punctuation">[</span>k<span class="token punctuation">]</span><span class="token punctuation">)</span>
  <span class="token operator pipe">|</span> <span class="token c-style-function function">map</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token property-literal property">key</span><span class="token punctuation">:</span> <span class="token punctuation">(</span>first<span class="token operator pipe">|</span><span class="token punctuation">.</span><span class="token punctuation">[</span>k<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token property-literal property">value</span><span class="token punctuation">:</span> v<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">def</span> <span class="token function">numbers</span><span class="token punctuation">:</span> <span class="token punctuation">(</span><span class="token c-style-function function">map</span><span class="token punctuation">(</span><span class="token c-style-function function">select</span><span class="token punctuation">(</span>length <span class="token operator">></span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token operator pipe">|</span>tonumber<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token c-style-function function">map</span><span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token property-literal property">category</span><span class="token punctuation">:</span> <span class="token punctuation">.</span>beer_type<span class="token operator pipe">|</span>category<span class="token punctuation">,</span> rating_score <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token operator pipe">|</span> <span class="token c-style-function function">arrange</span><span class="token punctuation">(</span><span class="token string">"category"</span><span class="token punctuation">;</span> <span class="token c-style-function function">map</span><span class="token punctuation">(</span><span class="token punctuation">.</span>rating_score<span class="token punctuation">)</span><span class="token punctuation">)</span>

<span class="token comment"># Temporary selection of Winter Warmer ratings</span>
<span class="token operator pipe">|</span> <span class="token c-style-function function">map</span><span class="token punctuation">(</span><span class="token c-style-function function">select</span><span class="token punctuation">(</span><span class="token punctuation">.</span>key <span class="token operator">==</span> <span class="token string">"Winter Warmer"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token operator pipe">|</span>first<span class="token operator pipe">|</span><span class="token punctuation">.</span>value
<span class="token operator pipe">|</span> numbers</code></pre>
<h2 id="taking-the-average">Taking the average</h2>
<p>While I'm in the mood for functions, how about one that will give the average of an array of numbers?  I'll call it <code>average</code> and add it to <code>untappd.jq</code>:</p>
<pre class="language-jq" tabindex="0"><code class="language-jq"><span class="token keyword">def</span> <span class="token function">category</span><span class="token punctuation">:</span> <span class="token c-style-function function">split</span><span class="token punctuation">(</span><span class="token string">" -"</span><span class="token punctuation">)</span> <span class="token operator pipe">|</span> first<span class="token punctuation">;</span>

<span class="token keyword">def</span> <span class="token function">arrange</span><span class="token punctuation">(</span>k<span class="token punctuation">;</span>v<span class="token punctuation">)</span><span class="token punctuation">:</span> 
  <span class="token c-style-function function">group_by</span><span class="token punctuation">(</span><span class="token punctuation">.</span><span class="token punctuation">[</span>k<span class="token punctuation">]</span><span class="token punctuation">)</span>
  <span class="token operator pipe">|</span> <span class="token c-style-function function">map</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token property-literal property">key</span><span class="token punctuation">:</span> <span class="token punctuation">(</span>first<span class="token operator pipe">|</span><span class="token punctuation">.</span><span class="token punctuation">[</span>k<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token property-literal property">value</span><span class="token punctuation">:</span> v<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">def</span> <span class="token function">numbers</span><span class="token punctuation">:</span> <span class="token punctuation">(</span><span class="token c-style-function function">map</span><span class="token punctuation">(</span><span class="token c-style-function function">select</span><span class="token punctuation">(</span>length <span class="token operator">></span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token operator pipe">|</span>tonumber<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">def</span> <span class="token function">average</span><span class="token punctuation">:</span> <span class="token punctuation">(</span>add <span class="token operator">/</span> length<span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token number">10</span> <span class="token operator pipe">|</span> floor <span class="token operator">/</span> <span class="token number">10</span><span class="token punctuation">;</span>

<span class="token c-style-function function">map</span><span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token property-literal property">category</span><span class="token punctuation">:</span> <span class="token punctuation">.</span>beer_type<span class="token operator pipe">|</span>category<span class="token punctuation">,</span> rating_score <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token operator pipe">|</span> <span class="token c-style-function function">arrange</span><span class="token punctuation">(</span><span class="token string">"category"</span><span class="token punctuation">;</span> <span class="token c-style-function function">map</span><span class="token punctuation">(</span><span class="token punctuation">.</span>rating_score<span class="token punctuation">)</span><span class="token punctuation">)</span>

<span class="token comment"># Temporary selection of Winter Warmer ratings</span>
<span class="token operator pipe">|</span> <span class="token c-style-function function">map</span><span class="token punctuation">(</span><span class="token c-style-function function">select</span><span class="token punctuation">(</span><span class="token punctuation">.</span>key <span class="token operator">==</span> <span class="token string">"Winter Warmer"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token operator pipe">|</span>first<span class="token operator pipe">|</span><span class="token punctuation">.</span>value
<span class="token operator pipe">|</span> numbers
<span class="token operator pipe">|</span> average</code></pre>
<p>I added some numeric fettling to the <code>average</code> function to ensure I'd end up with an average rating with a single decimal place.</p>
<p>So, what does this temporary extension now produce?</p>
<pre class="language-json" tabindex="0"><code class="language-json"><span class="token number">3.8</span></code></pre>
<p>Lovely!</p>
<p>I can now remove that extension and inject the two functions to the expression I'm sending in the second parameter for the call to <code>arrange</code>, like this:</p>
<pre class="language-jq" tabindex="0"><code class="language-jq"><span class="token keyword">def</span> <span class="token function">category</span><span class="token punctuation">:</span> <span class="token c-style-function function">split</span><span class="token punctuation">(</span><span class="token string">" -"</span><span class="token punctuation">)</span> <span class="token operator pipe">|</span> first<span class="token punctuation">;</span>

<span class="token keyword">def</span> <span class="token function">arrange</span><span class="token punctuation">(</span>k<span class="token punctuation">;</span>v<span class="token punctuation">)</span><span class="token punctuation">:</span> 
  <span class="token c-style-function function">group_by</span><span class="token punctuation">(</span><span class="token punctuation">.</span><span class="token punctuation">[</span>k<span class="token punctuation">]</span><span class="token punctuation">)</span>
  <span class="token operator pipe">|</span> <span class="token c-style-function function">map</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token property-literal property">key</span><span class="token punctuation">:</span> <span class="token punctuation">(</span>first<span class="token operator pipe">|</span><span class="token punctuation">.</span><span class="token punctuation">[</span>k<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token property-literal property">value</span><span class="token punctuation">:</span> v<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">def</span> <span class="token function">numbers</span><span class="token punctuation">:</span> <span class="token punctuation">(</span><span class="token c-style-function function">map</span><span class="token punctuation">(</span><span class="token c-style-function function">select</span><span class="token punctuation">(</span>length <span class="token operator">></span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token operator pipe">|</span>tonumber<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">def</span> <span class="token function">average</span><span class="token punctuation">:</span> <span class="token punctuation">(</span>add <span class="token operator">/</span> length<span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token number">10</span> <span class="token operator pipe">|</span> floor <span class="token operator">/</span> <span class="token number">10</span><span class="token punctuation">;</span>

<span class="token c-style-function function">map</span><span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token property-literal property">category</span><span class="token punctuation">:</span> <span class="token punctuation">.</span>beer_type<span class="token operator pipe">|</span>category<span class="token punctuation">,</span> rating_score <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token operator pipe">|</span> <span class="token c-style-function function">arrange</span><span class="token punctuation">(</span><span class="token string">"category"</span><span class="token punctuation">;</span> <span class="token c-style-function function">map</span><span class="token punctuation">(</span><span class="token punctuation">.</span>rating_score<span class="token punctuation">)</span><span class="token operator pipe">|</span>numbers<span class="token operator pipe">|</span>average<span class="token punctuation">)</span></code></pre>
<p>This produces what I was hoping for, a nice list of objects, one per category, with that category's average rating. Here's the first and last couple in that list (for brevity):</p>
<pre class="language-json" tabindex="0"><code class="language-json"><span class="token punctuation">[</span>
  <span class="token punctuation">{</span>
    <span class="token property">"key"</span><span class="token operator">:</span> <span class="token string">"Altbier"</span><span class="token punctuation">,</span>
    <span class="token property">"value"</span><span class="token operator">:</span> <span class="token number">3.5</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">{</span>
    <span class="token property">"key"</span><span class="token operator">:</span> <span class="token string">"Barleywine"</span><span class="token punctuation">,</span>
    <span class="token property">"value"</span><span class="token operator">:</span> <span class="token number">4.4</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">{</span>
    <span class="token property">"key"</span><span class="token operator">:</span> <span class="token string">"Belgian Blonde"</span><span class="token punctuation">,</span>
    <span class="token property">"value"</span><span class="token operator">:</span> <span class="token number">3.7</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">{</span>
    <span class="token property">"key"</span><span class="token operator">:</span> <span class="token string">"Belgian Dubbel"</span><span class="token punctuation">,</span>
    <span class="token property">"value"</span><span class="token operator">:</span> <span class="token number">3.9</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">]</span></code></pre>
<h2 id="neatening-up-the-results-and-a-main-function">Neatening up the results, and a main function</h2>
<p>The nice thing about this sort of data structure is that it lends itself to further processing. In this case, I want to sort the categories by rating, in descending order.</p>
<p>I can achieve this with a call to <code>sort_by</code>, and then a call to <code>reverse</code> to swap the order.</p>
<p>While I'm at it, I'll also adopt a common programming approach of putting the main logic control in a <code>main</code> function and then calling that at the bottom of the script. It reminds me a lot of the Python style:</p>
<pre class="language-python" tabindex="0"><code class="language-python"><span class="token keyword">if</span> __name__ <span class="token operator">==</span> <span class="token string">"__main__"</span><span class="token punctuation">:</span>
  <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span></code></pre>
<p>So, here goes:</p>
<pre class="language-jq" tabindex="0"><code class="language-jq"><span class="token keyword">def</span> <span class="token function">category</span><span class="token punctuation">:</span> <span class="token c-style-function function">split</span><span class="token punctuation">(</span><span class="token string">" -"</span><span class="token punctuation">)</span> <span class="token operator pipe">|</span> first<span class="token punctuation">;</span>

<span class="token keyword">def</span> <span class="token function">arrange</span><span class="token punctuation">(</span>k<span class="token punctuation">;</span>v<span class="token punctuation">)</span><span class="token punctuation">:</span> 
  <span class="token c-style-function function">group_by</span><span class="token punctuation">(</span><span class="token punctuation">.</span><span class="token punctuation">[</span>k<span class="token punctuation">]</span><span class="token punctuation">)</span>
  <span class="token operator pipe">|</span> <span class="token c-style-function function">map</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token property-literal property">key</span><span class="token punctuation">:</span> <span class="token punctuation">(</span>first<span class="token operator pipe">|</span><span class="token punctuation">.</span><span class="token punctuation">[</span>k<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token property-literal property">value</span><span class="token punctuation">:</span> v<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">def</span> <span class="token function">numbers</span><span class="token punctuation">:</span> <span class="token punctuation">(</span><span class="token c-style-function function">map</span><span class="token punctuation">(</span><span class="token c-style-function function">select</span><span class="token punctuation">(</span>length <span class="token operator">></span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token operator pipe">|</span>tonumber<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">def</span> <span class="token function">average</span><span class="token punctuation">:</span> <span class="token punctuation">(</span>add <span class="token operator">/</span> length<span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token number">10</span> <span class="token operator pipe">|</span> floor <span class="token operator">/</span> <span class="token number">10</span><span class="token punctuation">;</span>

<span class="token keyword">def</span> <span class="token function">main</span><span class="token punctuation">:</span>
  <span class="token c-style-function function">map</span><span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token property-literal property">category</span><span class="token punctuation">:</span> <span class="token punctuation">.</span>beer_type<span class="token operator pipe">|</span>category<span class="token punctuation">,</span> rating_score <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token operator pipe">|</span> <span class="token c-style-function function">arrange</span><span class="token punctuation">(</span><span class="token string">"category"</span><span class="token punctuation">;</span> <span class="token c-style-function function">map</span><span class="token punctuation">(</span><span class="token punctuation">.</span>rating_score<span class="token punctuation">)</span><span class="token operator pipe">|</span>numbers<span class="token operator pipe">|</span>average<span class="token punctuation">)</span>
  <span class="token operator pipe">|</span> <span class="token c-style-function function">sort_by</span><span class="token punctuation">(</span><span class="token punctuation">.</span>value<span class="token punctuation">)</span>
  <span class="token operator pipe">|</span> reverse<span class="token punctuation">;</span>

main</code></pre>
<p>This produces an array of categories, ordered by their average rating. Here are the first and last two in that list:</p>
<pre class="language-json" tabindex="0"><code class="language-json"><span class="token punctuation">[</span>
  <span class="token punctuation">{</span>
    <span class="token property">"key"</span><span class="token operator">:</span> <span class="token string">"Rauchbier"</span><span class="token punctuation">,</span>
    <span class="token property">"value"</span><span class="token operator">:</span> <span class="token number">5</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">{</span>
    <span class="token property">"key"</span><span class="token operator">:</span> <span class="token string">"Freeze-Distilled Beer"</span><span class="token punctuation">,</span>
    <span class="token property">"value"</span><span class="token operator">:</span> <span class="token number">5</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">{</span>
    <span class="token property">"key"</span><span class="token operator">:</span> <span class="token string">"Mrzen"</span><span class="token punctuation">,</span>
    <span class="token property">"value"</span><span class="token operator">:</span> <span class="token number">2.9</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">{</span>
    <span class="token property">"key"</span><span class="token operator">:</span> <span class="token string">"Pilsner"</span><span class="token punctuation">,</span>
    <span class="token property">"value"</span><span class="token operator">:</span> <span class="token number">2.7</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">]</span></code></pre>
<p>That's nice, but I will go one stage further and take advantage of the <code>key/value</code> pattern, using <code>from_entries</code> to condense that:</p>
<pre class="language-jq" tabindex="0"><code class="language-jq"><span class="token keyword">def</span> <span class="token function">category</span><span class="token punctuation">:</span> <span class="token c-style-function function">split</span><span class="token punctuation">(</span><span class="token string">" -"</span><span class="token punctuation">)</span> <span class="token operator pipe">|</span> first<span class="token punctuation">;</span>

<span class="token keyword">def</span> <span class="token function">arrange</span><span class="token punctuation">(</span>k<span class="token punctuation">;</span>v<span class="token punctuation">)</span><span class="token punctuation">:</span> 
  <span class="token c-style-function function">group_by</span><span class="token punctuation">(</span><span class="token punctuation">.</span><span class="token punctuation">[</span>k<span class="token punctuation">]</span><span class="token punctuation">)</span>
  <span class="token operator pipe">|</span> <span class="token c-style-function function">map</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token property-literal property">key</span><span class="token punctuation">:</span> <span class="token punctuation">(</span>first<span class="token operator pipe">|</span><span class="token punctuation">.</span><span class="token punctuation">[</span>k<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token property-literal property">value</span><span class="token punctuation">:</span> v<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">def</span> <span class="token function">numbers</span><span class="token punctuation">:</span> <span class="token punctuation">(</span><span class="token c-style-function function">map</span><span class="token punctuation">(</span><span class="token c-style-function function">select</span><span class="token punctuation">(</span>length <span class="token operator">></span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token operator pipe">|</span>tonumber<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">def</span> <span class="token function">average</span><span class="token punctuation">:</span> <span class="token punctuation">(</span>add <span class="token operator">/</span> length<span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token number">10</span> <span class="token operator pipe">|</span> floor <span class="token operator">/</span> <span class="token number">10</span><span class="token punctuation">;</span>

<span class="token keyword">def</span> <span class="token function">main</span><span class="token punctuation">:</span>
  <span class="token c-style-function function">map</span><span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token property-literal property">category</span><span class="token punctuation">:</span> <span class="token punctuation">.</span>beer_type<span class="token operator pipe">|</span>category<span class="token punctuation">,</span> rating_score <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token operator pipe">|</span> <span class="token c-style-function function">arrange</span><span class="token punctuation">(</span><span class="token string">"category"</span><span class="token punctuation">;</span> <span class="token c-style-function function">map</span><span class="token punctuation">(</span><span class="token punctuation">.</span>rating_score<span class="token punctuation">)</span><span class="token operator pipe">|</span>numbers<span class="token operator pipe">|</span>average<span class="token punctuation">)</span>
  <span class="token operator pipe">|</span> <span class="token c-style-function function">sort_by</span><span class="token punctuation">(</span><span class="token punctuation">.</span>value<span class="token punctuation">)</span>
  <span class="token operator pipe">|</span> reverse
  <span class="token operator pipe">|</span> from_entries<span class="token punctuation">;</span>

main</code></pre>
<p>This produces a neat list, like this:</p>
<pre class="language-json" tabindex="0"><code class="language-json"><span class="token punctuation">{</span>
  <span class="token property">"Rauchbier"</span><span class="token operator">:</span> <span class="token number">5</span><span class="token punctuation">,</span>
  <span class="token property">"Freeze-Distilled Beer"</span><span class="token operator">:</span> <span class="token number">5</span><span class="token punctuation">,</span>
  <span class="token property">"Chilli / Chile Beer"</span><span class="token operator">:</span> <span class="token number">5</span><span class="token punctuation">,</span>
  <span class="token property">"Black &amp; Tan"</span><span class="token operator">:</span> <span class="token number">4.5</span><span class="token punctuation">,</span>
  <span class="token property">"Belgian Quadrupel"</span><span class="token operator">:</span> <span class="token number">4.5</span><span class="token punctuation">,</span>
  <span class="token property">"Barleywine"</span><span class="token operator">:</span> <span class="token number">4.4</span><span class="token punctuation">,</span>
  <span class="token property">"Wild Ale"</span><span class="token operator">:</span> <span class="token number">4.3</span><span class="token punctuation">,</span>
  <span class="token property">"Specialty Grain"</span><span class="token operator">:</span> <span class="token number">4.3</span><span class="token punctuation">,</span>
  <span class="token property">"Old Ale"</span><span class="token operator">:</span> <span class="token number">4.3</span><span class="token punctuation">,</span>
  <span class="token property">"Bire de Champagne / Bire Brut"</span><span class="token operator">:</span> <span class="token number">4.3</span><span class="token punctuation">,</span>
  <span class="token property">"Strong Ale"</span><span class="token operator">:</span> <span class="token number">4.2</span><span class="token punctuation">,</span>
  <span class="token property">"Sour"</span><span class="token operator">:</span> <span class="token number">4.2</span><span class="token punctuation">,</span>
  <span class="token property">"Stout"</span><span class="token operator">:</span> <span class="token number">4.1</span><span class="token punctuation">,</span>
  <span class="token property">"Rye Wine"</span><span class="token operator">:</span> <span class="token number">4.1</span><span class="token punctuation">,</span>
  <span class="token property">"IPA"</span><span class="token operator">:</span> <span class="token number">4.1</span><span class="token punctuation">,</span>
  <span class="token property">"Belgian Tripel"</span><span class="token operator">:</span> <span class="token number">4.1</span><span class="token punctuation">,</span>
  <span class="token property">"Winter Ale"</span><span class="token operator">:</span> <span class="token number">4</span><span class="token punctuation">,</span>
  <span class="token property">"Smoked Beer"</span><span class="token operator">:</span> <span class="token number">4</span><span class="token punctuation">,</span>
  <span class="token property">"Scotch Ale / Wee Heavy"</span><span class="token operator">:</span> <span class="token number">4</span><span class="token punctuation">,</span>
  <span class="token property">"Red Ale"</span><span class="token operator">:</span> <span class="token number">4</span><span class="token punctuation">,</span>
  <span class="token property">"Lambic"</span><span class="token operator">:</span> <span class="token number">4</span><span class="token punctuation">,</span>
  <span class="token property">"Historical Beer"</span><span class="token operator">:</span> <span class="token number">4</span><span class="token punctuation">,</span>
  <span class="token property">"Grape Ale"</span><span class="token operator">:</span> <span class="token number">4</span><span class="token punctuation">,</span>
  <span class="token property">"Brown Ale"</span><span class="token operator">:</span> <span class="token number">4</span><span class="token punctuation">,</span>
  <span class="token property">"Brett Beer"</span><span class="token operator">:</span> <span class="token number">4</span><span class="token punctuation">,</span>
  <span class="token property">"Belgian Strong Dark Ale"</span><span class="token operator">:</span> <span class="token number">4</span><span class="token punctuation">,</span>
  <span class="token property">"Traditional Ale"</span><span class="token operator">:</span> <span class="token number">3.9</span><span class="token punctuation">,</span>
  <span class="token property">"Rye Beer"</span><span class="token operator">:</span> <span class="token number">3.9</span><span class="token punctuation">,</span>
  <span class="token property">"Porter"</span><span class="token operator">:</span> <span class="token number">3.9</span><span class="token punctuation">,</span>
  <span class="token property">"Pale Ale"</span><span class="token operator">:</span> <span class="token number">3.9</span><span class="token punctuation">,</span>
  <span class="token property">"Mild"</span><span class="token operator">:</span> <span class="token number">3.9</span><span class="token punctuation">,</span>
  <span class="token property">"Farmhouse Ale"</span><span class="token operator">:</span> <span class="token number">3.9</span><span class="token punctuation">,</span>
  <span class="token property">"California Common"</span><span class="token operator">:</span> <span class="token number">3.9</span><span class="token punctuation">,</span>
  <span class="token property">"Belgian Dubbel"</span><span class="token operator">:</span> <span class="token number">3.9</span><span class="token punctuation">,</span>
  <span class="token property">"Winter Warmer"</span><span class="token operator">:</span> <span class="token number">3.8</span><span class="token punctuation">,</span>
  <span class="token property">"Spiced / Herbed Beer"</span><span class="token operator">:</span> <span class="token number">3.8</span><span class="token punctuation">,</span>
  <span class="token property">"Schwarzbier"</span><span class="token operator">:</span> <span class="token number">3.8</span><span class="token punctuation">,</span>
  <span class="token property">"Belgian Strong Golden Ale"</span><span class="token operator">:</span> <span class="token number">3.8</span><span class="token punctuation">,</span>
  <span class="token property">"Gluten-Free"</span><span class="token operator">:</span> <span class="token number">3.7</span><span class="token punctuation">,</span>
  <span class="token property">"Fruit Beer"</span><span class="token operator">:</span> <span class="token number">3.7</span><span class="token punctuation">,</span>
  <span class="token property">"Bock"</span><span class="token operator">:</span> <span class="token number">3.7</span><span class="token punctuation">,</span>
  <span class="token property">"Bitter"</span><span class="token operator">:</span> <span class="token number">3.7</span><span class="token punctuation">,</span>
  <span class="token property">"Belgian Blonde"</span><span class="token operator">:</span> <span class="token number">3.7</span><span class="token punctuation">,</span>
  <span class="token property">"Scottish Export Ale"</span><span class="token operator">:</span> <span class="token number">3.6</span><span class="token punctuation">,</span>
  <span class="token property">"Roggenbier"</span><span class="token operator">:</span> <span class="token number">3.6</span><span class="token punctuation">,</span>
  <span class="token property">"Dark Ale"</span><span class="token operator">:</span> <span class="token number">3.6</span><span class="token punctuation">,</span>
  <span class="token property">"Wheat Beer"</span><span class="token operator">:</span> <span class="token number">3.5</span><span class="token punctuation">,</span>
  <span class="token property">"Table Beer"</span><span class="token operator">:</span> <span class="token number">3.5</span><span class="token punctuation">,</span>
  <span class="token property">"Mead"</span><span class="token operator">:</span> <span class="token number">3.5</span><span class="token punctuation">,</span>
  <span class="token property">"Kellerbier / Zwickelbier"</span><span class="token operator">:</span> <span class="token number">3.5</span><span class="token punctuation">,</span>
  <span class="token property">"Honey Beer"</span><span class="token operator">:</span> <span class="token number">3.5</span><span class="token punctuation">,</span>
  <span class="token property">"Cream Ale"</span><span class="token operator">:</span> <span class="token number">3.5</span><span class="token punctuation">,</span>
  <span class="token property">"Cider"</span><span class="token operator">:</span> <span class="token number">3.5</span><span class="token punctuation">,</span>
  <span class="token property">"Altbier"</span><span class="token operator">:</span> <span class="token number">3.5</span><span class="token punctuation">,</span>
  <span class="token property">"Blonde Ale"</span><span class="token operator">:</span> <span class="token number">3.4</span><span class="token punctuation">,</span>
  <span class="token property">"Scottish Ale"</span><span class="token operator">:</span> <span class="token number">3.3</span><span class="token punctuation">,</span>
  <span class="token property">"Klsch"</span><span class="token operator">:</span> <span class="token number">3.3</span><span class="token punctuation">,</span>
  <span class="token property">"Golden Ale"</span><span class="token operator">:</span> <span class="token number">3.3</span><span class="token punctuation">,</span>
  <span class="token property">"Lager"</span><span class="token operator">:</span> <span class="token number">3.1</span><span class="token punctuation">,</span>
  <span class="token property">"Shandy / Radler"</span><span class="token operator">:</span> <span class="token number">3</span><span class="token punctuation">,</span>
  <span class="token property">"Mrzen"</span><span class="token operator">:</span> <span class="token number">2.9</span><span class="token punctuation">,</span>
  <span class="token property">"Pilsner"</span><span class="token operator">:</span> <span class="token number">2.7</span>
<span class="token punctuation">}</span></code></pre>
<p>That's very satisfying!</p>
<h2 id="whats-next">What's next</h2>
<p>Well I think I'm there, basically. But something bothers me. I know my favourite style is more towards the India Pale Ale (IPA) variety, but ranking well above that style (both IPAs and Imperial IPAs) are some rarer categories, such as Rauchbier and Freeze-Distilled Beer. Why is that? That's what I'll investigate in part 4.</p>



<script src="https://utteranc.es/client.js" repo="qmacro/qmacro.github.io" issue-term="title" crossorigin="anonymous" async=""></script>

<ul class="links-nextprev"><li class="links-nextprev-prev"> Previous<br> <a href="/blog/posts/2022/10/31/more-untappd-data-explorations-with-jq-my-top-ranking-beer-types-part-2/">More Untappd data explorations with jq - my top ranking beer types (part 2)</a></li><li class="links-nextprev-next">Next <br><a href="/blog/posts/2022/11/02/some-notes-on-modular-json-schema-definitions/">Some notes on modular JSON Schema definitions</a></li>
</ul>

			</heading-anchors>
		</main>

		<!-- This page `/blog/posts/2022/11/01/more-untappd-data-explorations-with-jq-my-top-ranking-beer-types-part-3/` was built on 2025-09-16T07:54:22.288Z -->
		<script type="module" src="/dist/xbxy_EL6cU.js"></script>
	</body>
</html>
