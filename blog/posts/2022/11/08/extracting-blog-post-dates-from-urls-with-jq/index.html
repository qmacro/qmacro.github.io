<!doctype html><html lang="en"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1"><link rel="canonical" href="https://qmacro.org/blog/posts/2022/11/08/extracting-blog-post-dates-from-urls-with-jq/"><link href="/assets/main.4654d4542dcb045c9ba3.css" rel="stylesheet"><link rel="preconnect" href="https://fonts.gstatic.com"><link href="https://fonts.googleapis.com/css2?family=IBM+Plex+Sans&display=swap" rel="stylesheet"><title>Extracting blog post dates from URLs with jq | DJ Adams</title><link rel="icon" type="“image/x-icon”" href="/images/favicon.ico"><meta property="og:title" content="Extracting blog post dates from URLs with jq"><meta property="og:site_name" content="DJ Adams"><meta property="og:type" content="website"><meta property="og:url" content="https://qmacro.org/blog/posts/2022/11/08/extracting-blog-post-dates-from-urls-with-jq/"><meta name="description" content="Extracting blog post dates from URLs with jq 08 Nov 2022 | 3 min read I had a JSON array of objects from a list of GitHub repo issues. Each..."><meta property="og:description" content="Extracting blog post dates from URLs with jq 08 Nov 2022 | 3 min read I had a JSON array of objects from a list of GitHub repo issues. Each..."><meta name="description" content="Extracting blog post dates from URLs with jq 08 Nov 2022 | 3 min read I had a JSON array of objects from a list of GitHub repo issues. Each..."><meta property="og:image" content="https://qmacro.org/images/site-image.png"><script src="https://cdn.jsdelivr.net/npm/mermaid/dist/mermaid.min.js"></script><script>mermaid.initialize({startOnLoad:true});</script><script async src="https://www.googletagmanager.com/gtag/js?id=G-4WQKBG0L4Y"></script><script>window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());

      gtag('config', 'G-4WQKBG0L4Y');</script></head><body><div class="layout-wrapper"><header class="header"><div class="header__content"><h1 class="site-title"><a href="/">DJ Adams</a></h1><nav class="nav"><ul class="nav__list"><li class="nav-item"><a href="/about">About Me</a></li><li class="nav-item"><a href="/talks">Talks</a></li><li class="nav-item"><a href="/blog">Blog</a></li><li class="nav-item"><a href="/feed.xml">Feed</a></li></ul></nav></div></header><main class="main"><article class="post"><header class="post__header"><h1>Extracting blog post dates from URLs with jq</h1><div class="post__details"><time datetime="2022-11-08">08 Nov 2022 </time><span>| </span><span>3 min read</span></div></header><main class="post__content"><p>I had a JSON array of objects from a list of GitHub repo issues. Each object contained a blog post URL and a title. The URL had the post date embedded in the path, and I wanted to sort them all based on the post date. Here's how I did it.</p><p>I have a working list of blog posts, as <a href="https://github.com/qmacro-org/db/issues?q=is%3Aissue">issues in a GitHub repo</a> (as a sort of temporary data store). Each issue has the blog post title as the issue title, and just the blog post URL in the issue body, like this:</p><p><img src="/images/2022/11/exampleissue.png" alt="example blog post issue"></p><h2>The base data</h2><p>I had retrieved the issue data as JSON like this:</p><pre class="language-bash"><code class="language-bash">gh issue list <span class="token punctuation">\</span><br>  <span class="token parameter variable">--limit</span> <span class="token number">500</span> <span class="token punctuation">\</span><br>  <span class="token parameter variable">--label</span> dj-adams-sap <span class="token punctuation">\</span><br>  <span class="token parameter variable">--json</span> number,title,body <span class="token punctuation">\</span><br>  <span class="token operator">></span> dj-adams-sap.json </code></pre><p>Here's what the first and last couple of items in <code>dj-adams-sap.json</code> look like (extracted with <code>jq '.[:2] + .[-2:]' dj-adams-sap.json</code>):</p><pre class="language-json"><code class="language-json"><span class="token punctuation">[</span><br>  <span class="token punctuation">{</span><br>    <span class="token property">"body"</span><span class="token operator">:</span> <span class="token string">"https://blogs.sap.com/2018/03/26/monday-morning-thoughts-cloud-native/"</span><span class="token punctuation">,</span><br>    <span class="token property">"number"</span><span class="token operator">:</span> <span class="token number">224</span><span class="token punctuation">,</span><br>    <span class="token property">"title"</span><span class="token operator">:</span> <span class="token string">"Monday morning thoughts- cloud native"</span><br>  <span class="token punctuation">}</span><span class="token punctuation">,</span><br>  <span class="token punctuation">{</span><br>    <span class="token property">"body"</span><span class="token operator">:</span> <span class="token string">"https://blogs.sap.com/2018/03/31/scripting-the-workflow-api-with-bash-and-curl/"</span><span class="token punctuation">,</span><br>    <span class="token property">"number"</span><span class="token operator">:</span> <span class="token number">223</span><span class="token punctuation">,</span><br>    <span class="token property">"title"</span><span class="token operator">:</span> <span class="token string">"Scripting the Workflow API with bash and curl"</span><br>  <span class="token punctuation">}</span><span class="token punctuation">,</span><br>  <span class="token punctuation">{</span><br>    <span class="token property">"body"</span><span class="token operator">:</span> <span class="token string">"https://blogs.sap.com/2022/08/04/introducing-sap-codejam-btp-a-new-group-and-a-first-event/"</span><span class="token punctuation">,</span><br>    <span class="token property">"number"</span><span class="token operator">:</span> <span class="token number">83</span><span class="token punctuation">,</span><br>    <span class="token property">"title"</span><span class="token operator">:</span> <span class="token string">"Introducing &amp;#8220;SAP CodeJam BTP&amp;#8221; - a new group, and a first event"</span><br>  <span class="token punctuation">}</span><span class="token punctuation">,</span><br>  <span class="token punctuation">{</span><br>    <span class="token property">"body"</span><span class="token operator">:</span> <span class="token string">"https://blogs.sap.com/2022/10/06/devtoberfest-2022-week-2/"</span><span class="token punctuation">,</span><br>    <span class="token property">"number"</span><span class="token operator">:</span> <span class="token number">82</span><span class="token punctuation">,</span><br>    <span class="token property">"title"</span><span class="token operator">:</span> <span class="token string">"Devtoberfest 2022 Week 2"</span><br>  <span class="token punctuation">}</span><br><span class="token punctuation">]</span></code></pre><h2>Extracting the dates</h2><p>The dates of the blog posts can be determined from the first part of the path info in the blog post URLs, clearly. So I decided to map over each object and add a new property <code>postdate</code> which would be a <code>YYYY-MM-DD</code> formatted string worked out from that data.</p><p>First, I decided to define a function to extract the date:</p><pre class="language-jq"><code class="language-jq"><span class="token keyword">def</span> <span class="token function">date</span><span class="token punctuation">:</span> <br>  <span class="token c-style-function function">sub</span><span class="token punctuation">(</span><br>    <span class="token string">"^https.+?com/(?&lt;yyyy>[0-9]{4})/(?&lt;mm>[0-9]{2})/(?&lt;dd>[0-9]{2})/.+$"</span><span class="token punctuation">;</span><br>    <span class="token string">"<span class="token interpolation"><span class="token punctuation">\(</span><span class="token content"><span class="token punctuation">.</span>yyyy</span><span class="token punctuation">)</span></span>-<span class="token interpolation"><span class="token punctuation">\(</span><span class="token content"><span class="token punctuation">.</span>mm</span><span class="token punctuation">)</span></span>-<span class="token interpolation"><span class="token punctuation">\(</span><span class="token content"><span class="token punctuation">.</span>dd</span><span class="token punctuation">)</span></span>"</span><br>  <span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><p>This uses the <a href="https://stedolan.github.io/jq/manual/#sub(regex;tostring)sub(regex;string;flags)">sub</a> function to perform a regexp based substitution, actually replacing the entire input string (the URL) with a new string made up from the capture groups defined.</p><p>These are named capture groups, here's one of them; this one matches 4 consecutive digits into a capture group named <code>yyyy</code>:</p><pre class="language-text"><code class="language-text">(?<yyyy>[0-9]{4})</yyyy></code></pre><p>Looking at the argument supplied for the second parameter of <code>sub/2</code>, the <code>\( ... )</code> syntax is <a href="https://stedolan.github.io/jq/manual/#Stringinterpolation-(foo">string interpolation</a>), to have an expression (in this example it's <code>.yyyy</code>, <code>.mm</code> and <code>.dd</code>) evaluated and expanded in a string.</p><h2>Adding the postdate property</h2><p>With the <code>date</code> function ready, I could then simply iterate over the items in the array, adding a new <code>postdate</code> property to each object, with the value of whatever the <code>date</code> function extracts from the item's <code>.body</code> property:</p><pre class="language-jq"><code class="language-jq"><span class="token c-style-function function">map</span><span class="token punctuation">(</span><span class="token dot important">.</span> <span class="token operator">+</span> <span class="token punctuation">{</span> <span class="token property-literal property">postdate</span><span class="token punctuation">:</span> <span class="token punctuation">.</span>body<span class="token operator pipe">|</span>date <span class="token punctuation">}</span><span class="token punctuation">)</span></code></pre><p>Based on the reduced data set above, this then produces:</p><pre class="language-json"><code class="language-json"><span class="token punctuation">[</span><br>  <span class="token punctuation">{</span><br>    <span class="token property">"body"</span><span class="token operator">:</span> <span class="token string">"https://blogs.sap.com/2018/03/26/monday-morning-thoughts-cloud-native/"</span><span class="token punctuation">,</span><br>    <span class="token property">"number"</span><span class="token operator">:</span> <span class="token number">224</span><span class="token punctuation">,</span><br>    <span class="token property">"title"</span><span class="token operator">:</span> <span class="token string">"Monday morning thoughts- cloud native"</span><span class="token punctuation">,</span><br>    <span class="token property">"postdate"</span><span class="token operator">:</span> <span class="token string">"2018-03-26"</span><br>  <span class="token punctuation">}</span><span class="token punctuation">,</span><br>  <span class="token punctuation">{</span><br>    <span class="token property">"body"</span><span class="token operator">:</span> <span class="token string">"https://blogs.sap.com/2018/03/31/scripting-the-workflow-api-with-bash-and-curl/"</span><span class="token punctuation">,</span><br>    <span class="token property">"number"</span><span class="token operator">:</span> <span class="token number">223</span><span class="token punctuation">,</span><br>    <span class="token property">"title"</span><span class="token operator">:</span> <span class="token string">"Scripting the Workflow API with bash and curl"</span><span class="token punctuation">,</span><br>    <span class="token property">"postdate"</span><span class="token operator">:</span> <span class="token string">"2018-03-31"</span><br>  <span class="token punctuation">}</span><span class="token punctuation">,</span><br>  <span class="token punctuation">{</span><br>    <span class="token property">"body"</span><span class="token operator">:</span> <span class="token string">"https://blogs.sap.com/2022/08/04/introducing-sap-codejam-btp-a-new-group-and-a-first-event/"</span><span class="token punctuation">,</span><br>    <span class="token property">"number"</span><span class="token operator">:</span> <span class="token number">83</span><span class="token punctuation">,</span><br>    <span class="token property">"title"</span><span class="token operator">:</span> <span class="token string">"Introducing &amp;#8220;SAP CodeJam BTP&amp;#8221; - a new group, and a first event"</span><span class="token punctuation">,</span><br>    <span class="token property">"postdate"</span><span class="token operator">:</span> <span class="token string">"2022-08-04"</span><br>  <span class="token punctuation">}</span><span class="token punctuation">,</span><br>  <span class="token punctuation">{</span><br>    <span class="token property">"body"</span><span class="token operator">:</span> <span class="token string">"https://blogs.sap.com/2019/10/06/devtoberfest-2022-week-2/"</span><span class="token punctuation">,</span><br>    <span class="token property">"number"</span><span class="token operator">:</span> <span class="token number">82</span><span class="token punctuation">,</span><br>    <span class="token property">"title"</span><span class="token operator">:</span> <span class="token string">"Devtoberfest 2022 Week 2"</span><span class="token punctuation">,</span><br>    <span class="token property">"postdate"</span><span class="token operator">:</span> <span class="token string">"2019-10-06"</span><br>  <span class="token punctuation">}</span><br><span class="token punctuation">]</span></code></pre><h2>Sorting</h2><p>Then it's just a simple case of using <code>sort_by</code> (followed optionally by <code>reverse</code>) to get the post date order I want:</p><pre class="language-jq"><code class="language-jq"><span class="token c-style-function function">map</span><span class="token punctuation">(</span><span class="token dot important">.</span> <span class="token operator">+</span> <span class="token punctuation">{</span> <span class="token property-literal property">postdate</span><span class="token punctuation">:</span> <span class="token punctuation">.</span>body<span class="token operator pipe">|</span>date <span class="token punctuation">}</span><span class="token punctuation">)</span><br><span class="token operator pipe">|</span> <span class="token c-style-function function">sort_by</span><span class="token punctuation">(</span><span class="token punctuation">.</span>postdate<span class="token punctuation">)</span></code></pre><p>Of course, I could combine the two parts if I didn't want the <code>postdate</code> property to be an explicit fixture in my downstream processing. Something like this:</p><pre class="language-jq"><code class="language-jq"><span class="token c-style-function function">sort_by</span><span class="token punctuation">(</span><span class="token punctuation">.</span>body <span class="token operator pipe">|</span> date<span class="token punctuation">)</span></code></pre><h2>Wrapping up</h2><p>It did occur to me that given the pattern of blog post URLs, I could just sort by them directly. Then again, it wasn't as interesting and I didn't learn anything about named capture groups. Anyway, this post is mostly for me, for when my future self forgets how to use capture groups and the <code>sub</code> function.</p></main><aside class="post__aside"><div class="post__tags"><a href="/tags/jq/">#jq</a> <a href="/tags/json/">#json</a> <a href="/tags/regexp/">#regexp</a></div><style>.utterances {
  margin-left: inherit !important;
}</style><script src="https://utteranc.es/client.js" repo="qmacro/qmacro.github.io" issue-term="title" crossorigin="anonymous" async></script><nav class="post__pagination"><a href="/blog/posts/2022/12/13/array-push-with-autovivification-in-jq/"><span>←</span> <span>Array push with autovivification in jq</span> </a><a href="/blog/posts/2022/11/02/some-notes-on-modular-json-schema-definitions/"><span>Some notes on modular JSON Schema definitions</span> <span>→</span></a></nav></aside></article></main><footer class="footer"><div class="footer__content"><ul class="hero__social-links"><li><a rel="me" href="https://github.com/qmacro" target="_blank" rel="noopener noreferrer">GitHub</a></li><li><a rel="me" href="https://www.youtube.com/djadams-qmacro" target="_blank" rel="noopener noreferrer">YouTube</a></li><li><a rel="me" href="https://hachyderm.io/@qmacro" target="_blank" rel="noopener noreferrer">Mastodon</a></li><li><a href="/feed.xml" target="_blank" rel="noopener noreferrer">RSS</a></li></ul></div></footer></div><script src="/assets/main.31d6cfe0d16ae931b73c.js"></script></body></html>