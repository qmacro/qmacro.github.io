<!doctype html><html lang="en"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1"><link rel="canonical" href="https://qmacro.org/blog/posts/2022/04/17/bash-notes-3/"><link rel="alternate" type="application/rss+xml" title="DJ's Weblog - Feed" href="https://qmacro.org/feed.xml"><link href="/assets/main.4654d4542dcb045c9ba3.css" rel="stylesheet"><link rel="preconnect" href="https://fonts.gstatic.com"><link href="https://fonts.googleapis.com/css2?family=IBM+Plex+Sans&display=swap" rel="stylesheet"><title>Bash notes 3 | DJ Adams</title><link rel="icon" type="“image/x-icon”" href="/images/favicon.ico"><meta property="og:title" content="Bash notes 3"><meta property="og:site_name" content="DJ Adams"><meta property="og:type" content="website"><meta property="og:url" content="https://qmacro.org/blog/posts/2022/04/17/bash-notes-3/"><meta name="description" content="Bash notes 3 17 Apr 2022 | 4 min read Another Exercism Bash track exercise, another opportunity to learn from the community solutions. This..."><meta property="og:description" content="Bash notes 3 17 Apr 2022 | 4 min read Another Exercism Bash track exercise, another opportunity to learn from the community solutions. This..."><meta name="description" content="Bash notes 3 17 Apr 2022 | 4 min read Another Exercism Bash track exercise, another opportunity to learn from the community solutions. This..."><meta property="og:image" content="https://qmacro.org/images/site-image.png"><script src="https://cdn.jsdelivr.net/npm/mermaid/dist/mermaid.min.js"></script><script>mermaid.initialize({startOnLoad:true});</script><script async src="https://www.googletagmanager.com/gtag/js?id=G-4WQKBG0L4Y"></script><script>window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());

      gtag('config', 'G-4WQKBG0L4Y');</script></head><body><div class="layout-wrapper"><header class="header"><div class="header__content"><h1 class="site-title"><a href="/">DJ Adams</a></h1><nav class="nav"><ul class="nav__list"><li class="nav-item"><a href="/about">About Me</a></li><li class="nav-item"><a href="/talks">Talks</a></li><li class="nav-item"><a href="/blog">Blog</a></li><li class="nav-item"><a href="/feed.xml">Feed</a></li></ul></nav></div></header><main class="main"><article class="post"><header class="post__header"><h1>Bash notes 3</h1><div class="post__details"><time datetime="2022-04-17">17 Apr 2022 </time><span>| </span><span>4 min read</span></div></header><main class="post__content"><p>Another Exercism Bash track exercise, another opportunity to learn from the community solutions. This time I came across a few nice Bash language features that I'd probably known about but forgotten due to lack of practice.</p><p>The exercise in question is <a href="https://exercism.org/tracks/bash/exercises/atbash-cipher">Atbash Cipher</a> and the features that I wanted to share with you are from user <a href="https://exercism.org/profiles/chicovg">Victor Guthrie</a>'s <a href="https://exercism.org/tracks/bash/exercises/atbash-cipher/solutions/chicovg">solution</a>.</p><h2>Array definition</h2><p>The first line in Victor's solution is as follows:</p><pre class="language-bash"><code class="language-bash"><span class="token assign-left variable">alphabet</span><span class="token operator">=</span><span class="token punctuation">(</span><span class="token punctuation">{</span>a<span class="token punctuation">..</span>z<span class="token punctuation">}</span><span class="token punctuation">)</span></code></pre><p>The concise nature of this is quite striking. There are two mechanisms at play here. The first is the outer brackets <code>(...)</code>. Brackets are used in different contexts in Bash, but here, without any leading symbol before the opening bracket, and in the context of an assignment to a variable, they represent the definition of an array.</p><p>Here's a simple example, with a variable <code>letters</code> declared thus:</p><pre class="language-bash"><code class="language-bash"><span class="token assign-left variable">letters</span><span class="token operator">=</span><span class="token punctuation">(</span>a b c<span class="token punctuation">)</span></code></pre><p>This results in <code>letters</code> being an array of three elements, the values <code>a</code>, <code>b</code> and <code>c</code>. We can check this as follows:</p><pre class="language-bash"><code class="language-bash"><span class="token keyword">for</span> <span class="token for-or-select variable">letter</span> <span class="token keyword">in</span> <span class="token variable">${letters<span class="token punctuation">[</span>@<span class="token punctuation">]</span>}</span><span class="token punctuation">;</span> <span class="token keyword">do</span> <span class="token builtin class-name">echo</span> <span class="token string">"-> <span class="token variable">$letter</span>"</span><span class="token punctuation">;</span> <span class="token keyword">done</span></code></pre><p>This produces:</p><pre><code>-&gt; a
-&gt; b
-&gt; c
</code></pre><h2>Brace expansion</h2><p>So what's the <code>{a..z}</code> inside of the brackets in this particular case? Well, given the variable name and the <code>a</code> and the <code>z</code> we can probably reasonably guess that it's all the letters in the alphabet.</p><p>And we'd be right. But what is that construct and how does it work? I find that one of the key aspects of learning Bash and any language is knowing what things are called, so you can research them in the documentation.</p><p>And the <code>{...}</code> construct is called <a href="https://www.gnu.org/software/bash/manual/html_node/Brace-Expansion.html">brace expansion</a>, which is described as:</p><blockquote><p>A mechanism by which arbitrary strings may be generated.</p></blockquote><p>There are plenty of other expansion mechanisms in Bash, which are documented in the <a href="https://www.gnu.org/software/bash/manual/html_node/Shell-Expansions.html">Shell Expansions</a> section of the manual.</p><p>Anyway, this example will expand the characters <code>a</code> and <code>z</code> lexicographically, using the default C locale, resulting in every letter of the alphabet. What brace expansion offers is more than this, and I'd recommend you take a quick look at the page in the manual. To give you a taste, you can do things like this:</p><pre class="language-bash"><code class="language-bash"><span class="token builtin class-name">echo</span> <span class="token punctuation">{</span>a,b<span class="token punctuation">}</span><span class="token punctuation">{</span><span class="token number">1</span><span class="token punctuation">..</span><span class="token number">3</span><span class="token punctuation">}</span></code></pre><p>which results in:</p><pre><code>a1 a2 a3 b1 b2 b3
</code></pre><p>You can even use numbers, with an optional increment value, like this:</p><pre class="language-bash"><code class="language-bash"><span class="token punctuation">;</span> <span class="token builtin class-name">echo</span> <span class="token punctuation">{</span><span class="token number">1</span><span class="token punctuation">..</span><span class="token number">10</span><span class="token punctuation">..</span><span class="token number">2</span><span class="token punctuation">}</span></code></pre><p>the <code>..2</code> is the optional increment, and this expands to:</p><pre><code>1 3 5 7 9
</code></pre><p>Nice!</p><h2>Character classes and bracket expressions</h2><p>In the <code>main</code> function of Victor's solution, the first line is this:</p><pre class="language-bash"><code class="language-bash"><span class="token builtin class-name">local</span> <span class="token assign-left variable">trimmed</span><span class="token operator">=</span><span class="token string">"<span class="token variable">${2<span class="token operator">/</span><span class="token operator">/</span><span class="token punctuation">[</span><span class="token operator">^</span><span class="token punctuation">[</span><span class="token operator">:</span>alnum<span class="token operator">:</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token operator">/</span>}</span>"</span></code></pre><p>We've come across some of the constructs here before, but let's break this down to get to something I'd vaguely known about but never could remember how to express it, until now.</p><p>The value being assigned to the locally declared variable <code>trimmed</code> is the result of a <a href="https://www.gnu.org/software/bash/manual/html_node/Shell-Parameter-Expansion.html">shell parameter expansion</a>. Specifically it's this construct, where <code>pattern</code> is replaced with <code>string</code> inside of the given <code>parameter</code>:</p><pre class="language-bash"><code class="language-bash"><span class="token variable">${parameter<span class="token operator">/</span>pattern<span class="token operator">/</span>string}</span></code></pre><p>In fact, the version we see in the solution is the &quot;all matches&quot; version, where <code>pattern</code> itself begins with a <code>/</code>; this is described in the manual thus:</p><blockquote><p>If pattern begins with ‘/’, all matches of pattern are replaced with string.</p></blockquote><p>In other words we should first see this in the expression:</p><pre class="language-bash"><code class="language-bash"><span class="token builtin class-name">local</span> <span class="token assign-left variable">trimmed</span><span class="token operator">=</span><span class="token string">"<span class="token variable">${2<span class="token operator">/</span><span class="token operator">/</span>...<span class="token operator">/</span>}</span>"</span></code></pre><p>By the way, the <code>2</code> here refers to the second positional parameter passed into the <code>main</code> function.</p><p>Note that the <code>string</code> is empty here; in other words, every occurrence of where <code>pattern</code> is matched is replaced with nothing, i.e. effectively removed.</p><p>So what is the pattern? Let's now stare at it for a second:</p><pre class="language-bash"><code class="language-bash"><span class="token punctuation">[</span>^<span class="token punctuation">[</span>:alnum:<span class="token punctuation">]</span><span class="token punctuation">]</span></code></pre><p>There are two things going on here. Well, three if you count the <code>^</code> separately. Working from the outside in, we start with a bracket expression, thus:</p><pre class="language-bash"><code class="language-bash"><span class="token punctuation">[</span><span class="token punctuation">..</span>.<span class="token punctuation">]</span></code></pre><p>This is simply a list of characters, where any of them can be matched. It's also possible to use a &quot;range expression&quot; instead of a list of characters, so <code>a-c</code> would match <code>a</code>, <code>b</code> or <code>c</code>. It's even possible to combine range expressions with single characters. For example, this:</p><pre class="language-bash"><code class="language-bash"><span class="token assign-left variable">fruit</span><span class="token operator">=</span>bananas<br><span class="token builtin class-name">echo</span> <span class="token variable">${fruit<span class="token operator">/</span><span class="token operator">/</span><span class="token punctuation">[</span>sa-c<span class="token punctuation">]</span><span class="token operator">/</span>_}</span></code></pre><p>would result in:</p><pre><code>__n_n__
</code></pre><p>A circumflex (<code>^</code>) in the first character position of the bracket expression negates the characters listed, so this:</p><pre class="language-bash"><code class="language-bash"><span class="token assign-left variable">fruit</span><span class="token operator">=</span>bananas<br><span class="token builtin class-name">echo</span> <span class="token variable">${fruit<span class="token operator">/</span><span class="token operator">/</span><span class="token punctuation">[</span><span class="token operator">^</span>sa-c<span class="token punctuation">]</span><span class="token operator">/</span>_}</span></code></pre><p>would result in:</p><pre><code>ba_a_as
</code></pre><p>So we can see that</p><pre class="language-bash"><code class="language-bash"><span class="token punctuation">[</span>^<span class="token punctuation">[</span>:alnum:<span class="token punctuation">]</span><span class="token punctuation">]</span></code></pre><p>has a brace expression which is negating something (<code>[^...]</code>) but it's neither one or more single characters nor a range expression. It's this:</p><pre class="language-bash"><code class="language-bash"><span class="token punctuation">[</span>:alnum:<span class="token punctuation">]</span></code></pre><p>This is a &quot;character class&quot;, of which there are several, described in the <a href="https://www.gnu.org/software/grep/manual/html_node/Character-Classes-and-Bracket-Expressions.html">Character Classes and Bracket Expressions</a> part of the manual, and &quot;alnum&quot; is short for &quot;alphanumeric&quot;, basically meaning letters and numbers. The equivalent brace expression for <code>[:alnum:]</code> would be <code>[0-9a-zA-Z]</code>.</p><p>With this in mind, we now know what's happening with this line:</p><pre class="language-bash"><code class="language-bash"><span class="token builtin class-name">local</span> <span class="token assign-left variable">trimmed</span><span class="token operator">=</span><span class="token string">"<span class="token variable">${2<span class="token operator">/</span><span class="token operator">/</span><span class="token punctuation">[</span><span class="token operator">^</span><span class="token punctuation">[</span><span class="token operator">:</span>alnum<span class="token operator">:</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token operator">/</span>}</span>"</span></code></pre><p>The variable <code>trimmed</code> is being given the value of <code>$2</code> (the second positional parameter passed to the function) but with anything that's not a letter or a number removed.</p><p>My problem in the past was that I hadn't taken enough time to stare at the different parts of expressions like this, and could therefore not quite remember whether the opening square brackets went together or not. But now I know that the outermost pair is the bracket expression, and the inner pair is the character class, it is now obvious that the <code>^</code> negation must go between the opening two square brackets, as they each belong to two completely separate parts.</p><h2>Arithmetic evaluation</h2><p>The final line in the solution that I want to stare at for a moment is this one:</p><pre class="language-bash"><code class="language-bash"><span class="token variable"><span class="token punctuation">((</span>i <span class="token operator">&lt;</span> length <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">))</span></span> <span class="token operator">&amp;&amp;</span> <span class="token variable"><span class="token punctuation">((</span>i <span class="token operator">%</span> <span class="token number">5</span> <span class="token operator">==</span> <span class="token number">4</span><span class="token punctuation">))</span></span> <span class="token operator">&amp;&amp;</span> <span class="token assign-left variable">output</span><span class="token operator">+=</span><span class="token string">' '</span></code></pre><p>In <a href="https://exercism.org/tracks/bash/exercises/atbash-cipher/solutions/qmacro">my first solution to this exercise</a> I had a similar approach to adding a space every few characters (this was part of the requirements for the encoding output in the task), but my equivalent line was a lot noisier. Victor's version is cleaner and very pleasant to read.</p><p>It uses the <a href="https://tldp.org/LDP/abs/html/dblparens.html">double parentheses construct</a> for a couple of arithmetic expression evaluations. As well as regular numeric expressions, <a href="https://www.gnu.org/software/bash/manual/bash.html#Shell-Arithmetic">shell arithmetic</a> allows for logical expressions too, which is what we see here in both examples, where the operator in the first example is <code>&lt;</code> (&quot;is i less than one less than the value of length?&quot;) and the operator in the second example is <code>==</code> (&quot;is i modulo 5 equal to 4?&quot;).</p><p>If both of these arithmetic expressions evaluate to true then the final expression</p><pre class="language-bash"><code class="language-bash"><span class="token assign-left variable">output</span><span class="token operator">+=</span><span class="token string">' '</span></code></pre><p>causes a space to be added to the end of the value in <code>output</code>.</p><p>That's about it for this community solution. There's always lots to learn from reading code, and I'm getting a lot out of the community solutions on Exercism. Thanks folks!</p></main><aside class="post__aside"><div class="post__tags"><a href="/tags/shell/">#shell</a> <a href="/tags/til/">#til</a> <a href="/tags/exercism/">#exercism</a></div><style>.utterances {
  margin-left: inherit !important;
}</style><script src="https://utteranc.es/client.js" repo="qmacro/qmacro.github.io" issue-term="title" crossorigin="anonymous" async></script><nav class="post__pagination"><a href="/blog/posts/2022/05/02/some-thoughts-on-jq-and-statelessness/"><span>←</span> <span>Some thoughts on jq and statelessness</span> </a><a href="/blog/posts/2022/04/15/a-classic-example-of-yak-shaving-and-some-stream-editing/"><span>A classic example of yak shaving, and some stream editing</span> <span>→</span></a></nav></aside></article></main><footer class="footer"><div class="footer__content"><ul class="hero__social-links"><li><a rel="me" href="https://github.com/qmacro" target="_blank" rel="noopener noreferrer">GitHub</a></li><li><a rel="me" href="https://www.youtube.com/djadams-qmacro" target="_blank" rel="noopener noreferrer">YouTube</a></li><li><a rel="me" href="https://hachyderm.io/@qmacro" target="_blank" rel="noopener noreferrer">Mastodon</a></li><li><a href="/feed.xml" target="_blank" rel="noopener noreferrer">RSS</a></li></ul></div></footer></div><script src="/assets/main.31d6cfe0d16ae931b73c.js"></script></body></html>