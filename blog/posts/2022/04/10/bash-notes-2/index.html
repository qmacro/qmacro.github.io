<!doctype html><html lang="en"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1"><link rel="canonical" href="https://qmacro.org/blog/posts/2022/04/10/bash-notes-2/"><link href="/assets/main.abc736e4654d9e4a3a50.css" rel="stylesheet"><link rel="preconnect" href="https://fonts.gstatic.com"><link href="https://fonts.googleapis.com/css2?family=IBM+Plex+Sans&display=swap" rel="stylesheet"><title>Bash notes 2 | DJ Adams</title><link rel="icon" type="“image/x-icon”" href="/images/favicon.ico"><meta property="og:title" content="Bash notes 2"><meta property="og:site_name" content="DJ Adams"><meta property="og:type" content="website"><meta property="og:url" content="https://qmacro.org/blog/posts/2022/04/10/bash-notes-2/"><meta name="twitter:card" content="summary_large_image"><meta name="twitter:creator" content="@qmacro"><meta name="description" content="Bash notes 2 10 Apr 2022 | 4 min read I looked at a couple of more solutions to another Exercism exercise in the Bash track - Scrabble..."><meta property="og:description" content="Bash notes 2 10 Apr 2022 | 4 min read I looked at a couple of more solutions to another Exercism exercise in the Bash track - Scrabble..."><meta name="description" content="Bash notes 2 10 Apr 2022 | 4 min read I looked at a couple of more solutions to another Exercism exercise in the Bash track - Scrabble..."><meta property="og:image" content="https://qmacro.org/images/DJA-head.png"><meta name="twitter:image" content="https://qmacro.org/images/DJA-head.png"><script src="https://cdn.jsdelivr.net/npm/mermaid/dist/mermaid.min.js"></script><script>mermaid.initialize({startOnLoad:true});</script><script async src="https://www.googletagmanager.com/gtag/js?id=G-4WQKBG0L4Y"></script><script>window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());

      gtag('config', 'G-4WQKBG0L4Y');</script></head><body><div class="layout-wrapper"><header class="header"><div class="header__content"><h1 class="site-title"><a href="/">DJ Adams</a></h1><nav class="nav"><ul class="nav__list"><li class="nav-item"><a href="/about">About Me</a></li><li class="nav-item"><a href="/talks">Talks</a></li><li class="nav-item"><a href="/blog">Blog</a></li><li class="nav-item"><a href="/feed.xml">Feed</a></li></ul></nav></div></header><main class="main"><article class="post"><header class="post__header"><h1>Bash notes 2</h1><div class="post__details"><time datetime="2022-04-10">10 Apr 2022 </time><span>| </span><span>4 min read</span></div></header><main class="post__content"><p>I looked at a couple of more solutions to another Exercism exercise in the Bash track - <a href="https://exercism.org/tracks/bash/exercises/scrabble-score">Scrabble Score</a>. I was reminded of one particular feature of the <code>case</code> statement, and another solution was rather splendid in its approach and it reminded me a little of some functional programming techniques, or perhaps MapReduce.</p><p>I find <a href="https://exercism.org">Exercism</a> great for practice but get as much if not more pleasure and insight from reading the Community Solutions - solutions to exercises that others have completed.</p><p>My initial solution to the Scrabble Score exercise was a little pedestrian, which I find acceptable at least as the first iteration, as long as it works. That said, I had been trying to write my solution to reflect, almost visually, the instructions, the core of which was this table:</p><pre><code>Letter                           Value
A, E, I, O, U, L, N, R, S, T       1
D, G                               2
B, C, M, P                         3
F, H, V, W, Y                      4
K                                  5
J, X                               8
Q, Z                               10
</code></pre><p>I'd ended up with this:</p><pre class="language-bash"><code class="language-bash"><span class="token builtin class-name">declare</span> <span class="token assign-left variable">word</span><span class="token operator">=</span><span class="token string">"<span class="token variable">${1<span class="token operator">^^</span>}</span>"</span><br><span class="token builtin class-name">declare</span> <span class="token assign-left variable">score</span><span class="token operator">=</span><span class="token number">0</span><br><span class="token keyword">for</span> <span class="token variable"><span class="token punctuation">((</span>i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> ${#word}<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">))</span></span><span class="token punctuation">;</span> <span class="token keyword">do</span><br>  <span class="token punctuation">[</span><span class="token punctuation">[</span> <span class="token string">"AEIOULNRST"</span> <span class="token operator">=~</span> <span class="token variable">${word<span class="token operator">:</span>$i<span class="token operator">:</span>1}</span> <span class="token punctuation">]</span><span class="token punctuation">]</span> <span class="token operator">&amp;&amp;</span> <span class="token variable"><span class="token punctuation">((</span>score <span class="token operator">+=</span> <span class="token number">1</span><span class="token punctuation">))</span></span><br>  <span class="token punctuation">[</span><span class="token punctuation">[</span> <span class="token string">"DG"</span> <span class="token operator">=~</span> <span class="token variable">${word<span class="token operator">:</span>$i<span class="token operator">:</span>1}</span> <span class="token punctuation">]</span><span class="token punctuation">]</span>         <span class="token operator">&amp;&amp;</span> <span class="token variable"><span class="token punctuation">((</span>score <span class="token operator">+=</span> <span class="token number">2</span><span class="token punctuation">))</span></span><br>  <span class="token punctuation">[</span><span class="token punctuation">[</span> <span class="token string">"BCMP"</span> <span class="token operator">=~</span> <span class="token variable">${word<span class="token operator">:</span>$i<span class="token operator">:</span>1}</span> <span class="token punctuation">]</span><span class="token punctuation">]</span>       <span class="token operator">&amp;&amp;</span> <span class="token variable"><span class="token punctuation">((</span>score <span class="token operator">+=</span> <span class="token number">3</span><span class="token punctuation">))</span></span><br>  <span class="token punctuation">[</span><span class="token punctuation">[</span> <span class="token string">"FHVWY"</span> <span class="token operator">=~</span> <span class="token variable">${word<span class="token operator">:</span>$i<span class="token operator">:</span>1}</span> <span class="token punctuation">]</span><span class="token punctuation">]</span>      <span class="token operator">&amp;&amp;</span> <span class="token variable"><span class="token punctuation">((</span>score <span class="token operator">+=</span> <span class="token number">4</span><span class="token punctuation">))</span></span><br>  <span class="token punctuation">[</span><span class="token punctuation">[</span> <span class="token string">"K"</span> <span class="token operator">=~</span> <span class="token variable">${word<span class="token operator">:</span>$i<span class="token operator">:</span>1}</span> <span class="token punctuation">]</span><span class="token punctuation">]</span>          <span class="token operator">&amp;&amp;</span> <span class="token variable"><span class="token punctuation">((</span>score <span class="token operator">+=</span> <span class="token number">5</span><span class="token punctuation">))</span></span><br>  <span class="token punctuation">[</span><span class="token punctuation">[</span> <span class="token string">"JX"</span> <span class="token operator">=~</span> <span class="token variable">${word<span class="token operator">:</span>$i<span class="token operator">:</span>1}</span> <span class="token punctuation">]</span><span class="token punctuation">]</span>         <span class="token operator">&amp;&amp;</span> <span class="token variable"><span class="token punctuation">((</span>score <span class="token operator">+=</span> <span class="token number">8</span><span class="token punctuation">))</span></span><br>  <span class="token punctuation">[</span><span class="token punctuation">[</span> <span class="token string">"QZ"</span> <span class="token operator">=~</span> <span class="token variable">${word<span class="token operator">:</span>$i<span class="token operator">:</span>1}</span> <span class="token punctuation">]</span><span class="token punctuation">]</span>         <span class="token operator">&amp;&amp;</span> <span class="token variable"><span class="token punctuation">((</span>score <span class="token operator">+=</span> <span class="token number">10</span><span class="token punctuation">))</span></span><br><span class="token keyword">done</span><br><span class="token builtin class-name">echo</span> <span class="token string">"<span class="token variable">$score</span>"</span></code></pre><p>It was ok, if not a little &quot;bulky&quot;.</p><p>In looking at other solutions, I came across one from user <a href="https://exercism.org/profiles/edwin0258">Devin Miller</a> which did what I'd been looking to achieve, but in a much neater way:</p><pre class="language-bash"><code class="language-bash"><span class="token assign-left variable">total</span><span class="token operator">=</span><span class="token number">0</span><br><span class="token keyword">for</span> <span class="token for-or-select variable">x</span> <span class="token keyword">in</span> <span class="token variable"><span class="token variable">$(</span><span class="token builtin class-name">echo</span> $<span class="token punctuation">{</span><span class="token number">1</span>^^<span class="token punctuation">}</span> <span class="token operator">|</span> <span class="token function">grep</span> -o <span class="token builtin class-name">.</span><span class="token variable">)</span></span><span class="token punctuation">;</span> <span class="token keyword">do</span><br>    <span class="token keyword">case</span> <span class="token variable">$x</span> <span class="token keyword">in</span><br>        <span class="token punctuation">[</span>AEIOULNRST<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token variable"><span class="token punctuation">((</span>total<span class="token operator">++</span><span class="token punctuation">))</span></span><span class="token punctuation">;</span><span class="token punctuation">;</span><br>        <span class="token punctuation">[</span>DG<span class="token punctuation">]</span><span class="token punctuation">)</span>         <span class="token variable"><span class="token punctuation">((</span>total<span class="token operator">+=</span><span class="token number">2</span><span class="token punctuation">))</span></span><span class="token punctuation">;</span><span class="token punctuation">;</span><br>        <span class="token punctuation">[</span>BCMP<span class="token punctuation">]</span><span class="token punctuation">)</span>       <span class="token variable"><span class="token punctuation">((</span>total<span class="token operator">+=</span><span class="token number">3</span><span class="token punctuation">))</span></span><span class="token punctuation">;</span><span class="token punctuation">;</span><br>        <span class="token punctuation">[</span>FHVWY<span class="token punctuation">]</span><span class="token punctuation">)</span>      <span class="token variable"><span class="token punctuation">((</span>total<span class="token operator">+=</span><span class="token number">4</span><span class="token punctuation">))</span></span><span class="token punctuation">;</span><span class="token punctuation">;</span><br>        K<span class="token punctuation">)</span>            <span class="token variable"><span class="token punctuation">((</span>total<span class="token operator">+=</span><span class="token number">5</span><span class="token punctuation">))</span></span><span class="token punctuation">;</span><span class="token punctuation">;</span><br>        <span class="token punctuation">[</span>JX<span class="token punctuation">]</span><span class="token punctuation">)</span>         <span class="token variable"><span class="token punctuation">((</span>total<span class="token operator">+=</span><span class="token number">8</span><span class="token punctuation">))</span></span><span class="token punctuation">;</span><span class="token punctuation">;</span><br>        *<span class="token punctuation">)</span>            <span class="token variable"><span class="token punctuation">((</span>total<span class="token operator">+=</span><span class="token number">10</span><span class="token punctuation">))</span></span><span class="token punctuation">;</span><span class="token punctuation">;</span><br>    <span class="token keyword">esac</span><br><span class="token keyword">done</span></code></pre><p>I'd forgotten that the <code>case</code> statement allows for pattern matching. The <a href="https://tldp.org/LDP/Bash-Beginners-Guide/html/sect_07_03.html">Simplified conditions section of the Bash Beginners Guide</a> states: &quot;Each case is an expression matching a pattern&quot;. What sort of pattern? Well, the Bash Manual explains, in <a href="https://www.gnu.org/software/bash/manual/html_node/Pattern-Matching.html#Pattern-Matching">section 3.5.8.1 on Pattern Matching</a>. In Devlin's solution here, the <code>[...]</code> construct is used for each case expression, which &quot;matches any of the enclosed characters&quot;. Of course! This makes for a much more concise way of expressing that scoring table. I think, for symmetry, I'd have used <code>((total+=1))</code> for the first case, just to match the rest, but there you go.</p><p>One note on the <a href="https://www.gnu.org/software/bash/manual/html_node/Command-Substitution.html">command substitution</a> in the <code>for</code> line above. There's nothing in the rules that says that external commands, that would normally and perhaps naturally be part of any Bash script solution (after all, Bash scripts are great for encoding UNIX style constructs) so the use of the external <code>grep</code> command here is fine. And it's an interesting way to iterate through the letters of the word passed to the scoring script.</p><p>The secret is in the <code>-o</code> option, short for <code>--only-matching</code>, and the man page describes this option thus:</p><blockquote><p>Print only the matched (non-empty) parts of a matching line, with each such part on a separate output line.</p></blockquote><p>Before we look at that, note that the <code>${1^^}</code> <a href="https://www.gnu.org/software/bash/manual/html_node/Shell-Parameter-Expansion.html">parameter expansion</a> results in an uppercased version of the value in <code>$1</code>.</p><p>So if <code>$1</code> had the value <code>hello</code>, then the result of <code>echo ${1^^} | grep -o .</code> would be:</p><pre><code>H
E
L
L
O
</code></pre><p>This feeds nicely into the <code>for ... in</code> style loop construct used. The effect, ultimately, is the same as the C-style for loop construct I used in my solution where I used a incrementing variable <code>i</code> to point to each letter of the word in turn, via the <code>${parameter:offset:length}</code> style of <a href="https://www.gnu.org/software/bash/manual/html_node/Shell-Parameter-Expansion.html">parameter expansion</a>.</p><p>I'd like to dwell briefly on <a href="https://exercism.org/tracks/bash/exercises/scrabble-score/solutions/kayhide">another solution to this exercise</a>, which looks like this:</p><pre class="language-bash"><code class="language-bash"><span class="token builtin class-name">set</span> -eu<br><span class="token function-name function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>    <span class="token builtin class-name">local</span> -l <span class="token assign-left variable">str</span><span class="token operator">=</span><span class="token string">"<span class="token variable">$1</span>"</span><br>    <span class="token assign-left variable">str</span><span class="token operator">=</span><span class="token variable">${str<span class="token operator">/</span><span class="token operator">/</span><span class="token punctuation">[</span><span class="token operator">^</span><span class="token punctuation">[</span><span class="token operator">:</span>alpha<span class="token operator">:</span><span class="token punctuation">]</span><span class="token punctuation">]</span>}</span><br>    <span class="token assign-left variable">str</span><span class="token operator">=</span><span class="token variable">${str<span class="token operator">/</span><span class="token operator">/</span><span class="token punctuation">[</span>aeioulnrst<span class="token punctuation">]</span><span class="token operator">/</span>_}</span>  <span class="token comment"># 1</span><br>    <span class="token assign-left variable">str</span><span class="token operator">=</span><span class="token variable">${str<span class="token operator">/</span><span class="token operator">/</span><span class="token punctuation">[</span>dg<span class="token punctuation">]</span><span class="token operator">/</span>__}</span>         <span class="token comment"># 2</span><br>    <span class="token assign-left variable">str</span><span class="token operator">=</span><span class="token variable">${str<span class="token operator">/</span><span class="token operator">/</span><span class="token punctuation">[</span>bcmp<span class="token punctuation">]</span><span class="token operator">/</span>___}</span>      <span class="token comment"># 3</span><br>    <span class="token assign-left variable">str</span><span class="token operator">=</span><span class="token variable">${str<span class="token operator">/</span><span class="token operator">/</span><span class="token punctuation">[</span>fhvwy<span class="token punctuation">]</span><span class="token operator">/</span>____}</span>    <span class="token comment"># 4</span><br>    <span class="token assign-left variable">str</span><span class="token operator">=</span><span class="token variable">${str<span class="token operator">/</span><span class="token operator">/</span><span class="token punctuation">[</span>k<span class="token punctuation">]</span><span class="token operator">/</span>_____}</span>       <span class="token comment"># 5</span><br>    <span class="token assign-left variable">str</span><span class="token operator">=</span><span class="token variable">${str<span class="token operator">/</span><span class="token operator">/</span><span class="token punctuation">[</span>jx<span class="token punctuation">]</span><span class="token operator">/</span>________}</span>   <span class="token comment"># 8</span><br>    <span class="token assign-left variable">str</span><span class="token operator">=</span><span class="token variable">${str<span class="token operator">/</span><span class="token operator">/</span><span class="token punctuation">[</span>qz<span class="token punctuation">]</span><span class="token operator">/</span>__________}</span> <span class="token comment"># 10</span><br>    <span class="token builtin class-name">echo</span> <span class="token variable">${<span class="token operator">#</span>str}</span><br><span class="token punctuation">}</span><br>main <span class="token string">"<span class="token variable">$@</span>"</span></code></pre><p>This is a really interesting approach that appeals to my sense of beauty and intrigue - all the heavy lifting is done with the <code>${parameter/pattern/string}</code> style of <a href="https://www.gnu.org/software/bash/manual/html_node/Shell-Parameter-Expansion.html">parameter expansion</a>, specifically the one where all matches are replaced because the pattern actually begins with a <code>/</code> (i.e. it's <code>${str//[aeioulnrst]/_}</code> rather than <code>${str/[aeioulnrst]/_}</code>).</p><p>What is happening here is that after removing any characters that are not in the &quot;alphabetic&quot; POSIX class (see the POSIX Character Classes section of <a href="https://tldp.org/LDP/abs/html/x17129.html">18.1. A Brief Introduction to Regular Expressions</a>), the letters are replaced by underscores, where the number of underscores in the replacement reflects the points for that letter. So for example an <code>a</code> is replaced with <code>_</code> reflecting a single point for that letter, whereas an <code>f</code> is replaced with <code>____</code> reflecting four points for that letter. After all the replacements are done, the string is just a sequence of underscores, and how many underscores reflects the total number of points for that word (which is reflected in yet another style of parameter expansion, the length of a variable, via <code>${#parameter}</code>). Lovely!</p><p>I don't know about you, but this sort of reminds me of the underlying philosophy of <a href="https://en.wikipedia.org/wiki/MapReduce">MapReduce</a>, where the input is reduced to a sequence of simple, countable atoms - in this case, underscore characters. Given the &quot;sequence&quot; feeling that this solution also conveys, I think there's an element of FP philosophy too.</p><hr><h2>Further reading</h2><ul><li><a href="/posts/2022-04-07-bash-notes-1/">Bash notes</a></li><li>Posts with the <a href="/tags/shell/">shell</a> tag</li></ul></main><aside class="post__aside"><div class="post__tags"><a href="/tags/shell/">#shell</a> <a href="/tags/til/">#til</a> <a href="/tags/exercism/">#exercism</a></div><style>.utterances {
  margin-left: inherit !important;
}</style><script src="https://utteranc.es/client.js" repo="qmacro/qmacro.github.io" issue-term="title" crossorigin="anonymous" async></script><nav class="post__pagination"><a href="/blog/posts/2022/04/15/a-classic-example-of-yak-shaving-and-some-stream-editing/"><span>←</span> <span>A classic example of yak shaving, and some stream editing</span> </a><a href="/blog/posts/2022/04/07/bash-notes/"><span>Bash notes</span> <span>→</span></a></nav></aside></article></main><footer class="footer"><div class="footer__content"><ul class="hero__social-links"><li><a href="https://github.com/qmacro" target="_blank" rel="noopener noreferrer">GitHub</a></li><li><a href="https://www.youtube.com/djadams-qmacro" target="_blank" rel="noopener noreferrer">YouTube</a></li><li><a href="https://twitter.com/qmacro" target="_blank" rel="noopener noreferrer">Twitter</a></li><li><a href="/feed.xml" target="_blank" rel="noopener noreferrer">RSS</a></li></ul></div></footer></div><script src="/assets/main.31d6cfe0d16ae931b73c.js"></script></body></html>