<!doctype html>
<html lang="en">
	<head>
		<meta charset="utf-8">
		<meta name="viewport" content="width=device-width, initial-scale=1.0">
		<title>A new REST handler / dispatcher for the ICF</title>
		<meta name="description" content="Reserving the right to be wrong.">
		<link rel="alternate" href="/feed/feed.xml" type="application/atom+xml" title="DJ Adams">
		<link rel="icon" type="image/x-icon" href="/images/favicon.ico">

      <meta property="og:title" content="A new REST handler / dispatcher for the ICF">
        <meta property="og:site_name" content="DJ Adams">
          <meta property="og:image" content="/images/site-image.png">
        <meta property="og:description" content="Reserving the right to be wrong.">
        <meta property="og:url" content="https://qmacro.org/blog/posts/2009/09/21/a-new-rest-handler-dispatcher-for-the-icf/">
		
		
		
		<style>/* This is an arbitrary CSS string added to the bundle */
/* Defaults */
:root {
	--font-family: -apple-system, system-ui, sans-serif;
	--font-family-monospace: Consolas, Menlo, Monaco, Andale Mono WT, Andale Mono, Lucida Console, Lucida Sans Typewriter, DejaVu Sans Mono, Bitstream Vera Sans Mono, Liberation Mono, Nimbus Mono L, Courier New, Courier, monospace;
}

/* Theme colors */
:root {
	--color-gray-20: #e0e0e0;
	--color-gray-50: #C0C0C0;
	--color-gray-90: #333;

	--background-color: #fff;

	--text-color: var(--color-gray-90);
	--text-color-link: #2884d2;
	--text-color-link-active: #15b0ed;
	--text-color-link-visited: #9f4199;

	--syntax-tab-size: 2;
}

@media (prefers-color-scheme: dark) {
	:root {
		--color-gray-20: #e0e0e0;
		--color-gray-50: #C0C0C0;
		--color-gray-90: #dad8d8;

		/* --text-color is assigned to --color-gray-_ above */
		--text-color-link: #1493fb;
		--text-color-link-active: #6969f7;
		--text-color-link-visited: #a6a6f8;

		--background-color: #15202b;
	}
}


/* Global stylesheet */
* {
	box-sizing: border-box;
}

@view-transition {
	navigation: auto;
}

html,
body {
	padding: 0;
	margin: 0 auto;
	font-family: var(--font-family);
	color: var(--text-color);
	background-color: var(--background-color);
}
html {
	overflow-y: scroll;
}
body {
	max-width: 40em;
}

/* https://www.a11yproject.com/posts/how-to-hide-content/ */
.visually-hidden:not(:focus):not(:active) {
	clip: rect(0 0 0 0);
	clip-path: inset(50%);
	height: 1px;
	overflow: hidden;
	position: absolute;
	white-space: nowrap;
	width: 1px;
}

/* Fluid images via https://www.zachleat.com/web/fluid-images/ */
img{
  max-width: 100%;
}
img[width][height] {
  height: auto;
}
img[src$=".svg"] {
  width: 100%;
  height: auto;
  max-width: none;
}
video,
iframe {
	width: 100%;
	height: auto;
}
iframe {
	aspect-ratio: 16/9;
}

p:last-child {
	margin-bottom: 0;
}
p {
	line-height: 1.5;
}

li {
	line-height: 1.5;
}

a[href] {
	color: var(--text-color-link);
}
a[href]:visited {
	color: var(--text-color-link-visited);
}
a[href]:hover,
a[href]:active {
	color: var(--text-color-link-active);
}

main,
footer {
	padding: 1rem;
}
/* main :first-child { */
/* 	margin-top: 0; */
/* } */

header {
	border-bottom: 1px dashed var(--color-gray-20);
}

#skip-link {
	text-decoration: none;
	background: var(--background-color);
	color: var(--text-color);
	padding: 0.5rem 1rem;
	border: 1px solid var(--color-gray-90);
	border-radius: 2px;
}

/* Prevent visually-hidden skip link fom pushing content around when focused */
#skip-link.visually-hidden:focus {
	position: absolute;
	top: 1rem;
	left: 1rem;
	/* Ensure it is positioned on top of everything else when it is shown */
	z-index: 999;
}

.links-nextprev {
	display: flex;
	justify-content: space-between;
	gap: .5em 1em;
	list-style: "";
	border-top: 1px dashed var(--color-gray-20);
	padding: 1em 0;
}
.links-nextprev > * {
	flex-grow: 1;
}
.links-nextprev-next {
	text-align: right;
}

table {
	margin: 1em 0;
}
table td,
table th {
	padding-right: 1em;
}

pre,
code {
	font-family: var(--font-family-monospace);
	color: seagreen;
}

pre,code[class*="language-"] {
	line-height: 1.2em !important;
	font-size: 0.93em !important;
}

pre:not([class*="language-"]) {
	margin: .5em 0;
	line-height: 1.375; /* 22px /16 */
	-moz-tab-size: var(--syntax-tab-size);
	-o-tab-size: var(--syntax-tab-size);
	tab-size: var(--syntax-tab-size);
	-webkit-hyphens: none;
	-ms-hyphens: none;
	hyphens: none;
	direction: ltr;
	text-align: left;
	white-space: pre;
	word-spacing: normal;
	word-break: normal;
	overflow-x: auto;
}
code {
	word-break: break-all;
}

/* Header */
header {
	display: flex;
	gap: 1em;
	flex-wrap: wrap;
	justify-content: space-between;
	align-items: center;
	padding: 1em;
}
.home-link {
	flex-grow: 1;
	font-size: 1em; /* 16px /16 */
	font-weight: 700;
}
.home-link:link:not(:hover) {
	text-decoration: none;
}

/* Nav */
.nav {
	display: flex;
	gap: .5em 1em;
	padding: 0;
	margin: 0;
	list-style: none;
}
.nav-item {
	display: inline-block;
}
.nav-item a[href]:not(:hover) {
	text-decoration: none;
}
.nav a[href][aria-current="page"] {
	text-decoration: underline;
}

/* Posts list */
.postlist {
	counter-reset: start-from var(--postlist-index);
	list-style: none;
	padding: 0;
}
.postlist-item {
	display: flex;
	flex-wrap: wrap;
	align-items: baseline;
	counter-increment: start-from -1;
	margin-bottom: 1em;
}
.postlist-item:before {
	display: inline-block;
	pointer-events: none;
	line-height: 100%;
	text-align: right;
	margin-left: -1.5rem;
}
.postlist-date,
.postlist-item:before {
	font-size: 0.8125em; /* 13px /16 */
	color: var(--color-gray-90);
}
.postlist-date {
	word-spacing: -0.5px;
}
.postlist-link {
	font-size: 1.1875em; /* 19px /16 */
	font-weight: 700;
	flex-basis: calc(100% - 1.5rem);
	text-underline-position: from-font;
	text-underline-offset: 0;
	text-decoration-thickness: 1px;
}
.postlist-item-active .postlist-link {
	font-weight: bold;
}

/* Tags */
.post-tag {
	display: inline-flex;
	align-items: center;
	justify-content: center;
	font-style: italic;
}

/* may want to make the description text smaller at some stage */
.post-description-list {
	font-size: 1.0em;
}

.post-description-main {
	font-style: italic;
}

.postlist-item > .post-tag {
	align-self: center;
}

/* Tags list */
.post-metadata {
	display: inline-flex;
	flex-wrap: wrap;
	gap: .5em;
	list-style: none;
	padding: 0;
	margin: 0;
}
.post-metadata time {
	margin-right: 1em;
}

blockquote {
	margin-top: 0px;
	margin-left: 0px;
	margin-bottom: 15px;
	padding-left: 15px;
	border-left: 5px solid lightgray;
}
/**
 * prism.js default theme for JavaScript, CSS and HTML
 * Based on dabblet (http://dabblet.com)
 * @author Lea Verou
 */

code[class*="language-"],
pre[class*="language-"] {
	color: black;
	background: none;
	text-shadow: 0 1px white;
	font-family: Consolas, Monaco, 'Andale Mono', 'Ubuntu Mono', monospace;
	font-size: 1em;
	text-align: left;
	white-space: pre;
	word-spacing: normal;
	word-break: normal;
	word-wrap: normal;
	line-height: 1.5;

	-moz-tab-size: 4;
	-o-tab-size: 4;
	tab-size: 4;

	-webkit-hyphens: none;
	-moz-hyphens: none;
	-ms-hyphens: none;
	hyphens: none;
}

pre[class*="language-"]::-moz-selection, pre[class*="language-"] ::-moz-selection,
code[class*="language-"]::-moz-selection, code[class*="language-"] ::-moz-selection {
	text-shadow: none;
	background: #b3d4fc;
}

pre[class*="language-"]::selection, pre[class*="language-"] ::selection,
code[class*="language-"]::selection, code[class*="language-"] ::selection {
	text-shadow: none;
	background: #b3d4fc;
}

@media print {
	code[class*="language-"],
	pre[class*="language-"] {
		text-shadow: none;
	}
}

/* Code blocks */
pre[class*="language-"] {
	padding: 1em;
	margin: .5em 0;
	overflow: auto;
}

:not(pre) > code[class*="language-"],
pre[class*="language-"] {
	background: #f5f2f0;
}

/* Inline code */
:not(pre) > code[class*="language-"] {
	padding: .1em;
	border-radius: .3em;
	white-space: normal;
}

.token.comment,
.token.prolog,
.token.doctype,
.token.cdata {
	color: slategray;
}

.token.punctuation {
	color: #999;
}

.token.namespace {
	opacity: .7;
}

.token.property,
.token.tag,
.token.boolean,
.token.number,
.token.constant,
.token.symbol,
.token.deleted {
	color: #905;
}

.token.selector,
.token.attr-name,
.token.string,
.token.char,
.token.builtin,
.token.inserted {
	color: #690;
}

.token.operator,
.token.entity,
.token.url,
.language-css .token.string,
.style .token.string {
	color: #9a6e3a;
	/* This background color was intended by the author of this theme. */
	background: hsla(0, 0%, 100%, .5);
}

.token.atrule,
.token.attr-value,
.token.keyword {
	color: #07a;
}

.token.function,
.token.class-name {
	color: #DD4A68;
}

.token.regex,
.token.important,
.token.variable {
	color: #e90;
}

.token.important,
.token.bold {
	font-weight: bold;
}
.token.italic {
	font-style: italic;
}

.token.entity {
	cursor: help;
}
/*
 * New diff- syntax
 */

pre[class*="language-diff-"] {
	--eleventy-code-padding: 1.25em;
	padding-left: var(--eleventy-code-padding);
	padding-right: var(--eleventy-code-padding);
}
.token.deleted {
	background-color: hsl(0, 51%, 37%);
	color: inherit;
}
.token.inserted {
	background-color: hsl(126, 31%, 39%);
	color: inherit;
}

/* Make the + and - characters unselectable for copy/paste */
.token.prefix.unchanged,
.token.prefix.inserted,
.token.prefix.deleted {
	-webkit-user-select: none;
	user-select: none;
	display: inline-flex;
	align-items: center;
	justify-content: center;
	padding-top: 2px;
	padding-bottom: 2px;
}
.token.prefix.inserted,
.token.prefix.deleted {
	width: var(--eleventy-code-padding);
	background-color: rgba(0,0,0,.2);
}

/* Optional: full-width background color */
.token.inserted:not(.prefix),
.token.deleted:not(.prefix) {
	display: block;
	margin-left: calc(-1 * var(--eleventy-code-padding));
	margin-right: calc(-1 * var(--eleventy-code-padding));
	text-decoration: none; /* override del, ins, mark defaults */
	color: inherit; /* override del, ins, mark defaults */
}
.utterances {
  margin-left: inherit !important;
}</style>
		

    <!-- Global site tag (gtag.js) - Google Analytics -->
    <script async="" src="https://www.googletagmanager.com/gtag/js?id=G-4WQKBG0L4Y"></script>
    

	</head>
	<body>
		<a href="#main" id="skip-link" class="visually-hidden">Skip to main content</a>

		<header>
			<a href="/" class="home-link">DJ Adams</a>
			<nav>
				<h2 class="visually-hidden" id="top-level-navigation-menu">Top level navigation menu</h2>
				<ul class="nav">
					<li class="nav-item"><a href="/">Home</a></li>
					<li class="nav-item"><a href="/about/">About</a></li>
					<li class="nav-item"><a href="/blog/">Blog</a></li>
					<li class="nav-item"><a href="/feed/feed.xml">Feed</a></li>
				</ul>
			</nav>
		</header>

		<main id="main">
			<heading-anchors>
				


<h1 id="a-new-rest-handler-dispatcher-for-the-icf">A new REST handler / dispatcher for the ICF</h1>

<ul class="post-metadata">
	<li><time datetime="2009-09-21">21 September 2009</time></li>
	<li><a href="/tags/sapcommunity/" class="post-tag">sapcommunity</a></li>
</ul>

<p class="post-description-main"></p>

<p>One of the best underlying mechanisms to be introduced into the Basis /
NetWeaver stack in the past few years is the Internet Communication
Framework (ICF), which is a collection of configuration, interfaces,
classes and a core set of processes that allow us to build HTTP
applications directly inside SAP.</p>
<p>If you're not directly familiar with the ICF, allow me to paraphrase a
part of Tim O'Reilly's <a href="http://www.oreillynet.com/pub/a/oreilly/tim/articles/paradigmshift_0504.html">Open Source Paradigm
Shift</a>,
where he gets audiences to realise that they all use Linux, by asking
them whether they've used Google, and so on. If you've used WebDynpro,
BSPs, the embedded ITS, SOAP, Web Services, or any number of other
similar services, you've used the ICF, the layer that sits underneath
and powers these subsystems.</p>
<p>One of my <a href="/tags/rest/">passions</a> is
<a href="http://en.wikipedia.org/wiki/Representational_State_Transfer">REpresentational State
Transfer</a>
(REST), the architectural approach to the development of web services in
the Resource Orientated Architecture (ROA) style, using HTTP for what it
is - an application protocol. While the ICF lends itself very well to
programming HTTP applications in general, I have found myself wanting to
be able to develop web applications and services that not only follow
the REST style, but also in a way that is more aligned with other web
programming environments I work with.</p>
<p>An example of one of these environments is the one used in Google's
<a href="http://code.google.com/appengine/">App Engine</a>. App Engine is a
cloud-based service that offers the ability to build and host web
applications on Google's infrastructure. In the Python flavour of
Google's App Engine, the <a href="http://pythonpaste.org/webob/">WebOb</a>
library, an interface for HTTP requests and responses, is used as part
of App Engine's <a href="http://code.google.com/appengine/docs/python/tools/webapp/">web application
framework</a>.</p>
<p>Generally (and in an oversimplified way!), in the WebOb-style
programming paradigm, you define a set of patterns matching various URLs
in your application's &quot;url space&quot; (usually the root), and for each of
the patterns, specify a handler class that is to be invoked to handle a
request for the URL matched. When a match is found, the handler method
invoked corresponds to the HTTP method in the request, and any
subpattern values captured in the match are passed in the invocation.</p>
<p>So for instance, if the incoming request were:</p>
<pre class="language-text" tabindex="0"><code class="language-text">GET /channel/100234/subscriber/91/</code></pre>
<p>and there was a pattern/handler class pair defined thus:</p>
<pre class="language-text" tabindex="0"><code class="language-text">'^/channel/([^/]+)/subscriber/([^/]+)/$', ChannelSubscriber</code></pre>
<p>then the URL would be matched, an object of class ChannelSubscriber
instantiated, the method GET of that class invoked, and the values
'100234' and '91' passed in the invocation. The GET method would
read the HTTP request, prepare the HTTP response, and hand off when
done.</p>
<p>For a real-world example, see
<a href="http://github.com/qmacro/coffeeshop/blob/master/coffeeshop.py">coffeeshop.py</a>
(part of my <a href="http://wiki.github.com/qmacro/coffeeshop">REST-orientated, HTTP-based publish/subscribe (pubsub)
mechanism</a>), in particular
from <a href="http://github.com/qmacro/coffeeshop/blob/master/coffeeshop.py#L524">line 524
onward</a>.
You can see how this model follows the paradigm described above.</p>
<pre class="language-python" tabindex="0"><code class="language-python"><span class="token keyword">def</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
  application <span class="token operator">=</span> webapp<span class="token punctuation">.</span>WSGIApplication<span class="token punctuation">(</span><span class="token punctuation">[</span>
    <span class="token punctuation">(</span><span class="token string">r'/'</span><span class="token punctuation">,</span>                                MainPageHandler<span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token punctuation">(</span><span class="token string">r'/channel/submissionform/?'</span><span class="token punctuation">,</span>        ChannelSubmissionformHandler<span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token punctuation">(</span><span class="token string">r'/channel/(.+?)/subscriber/(.+?)/'</span><span class="token punctuation">,</span> ChannelSubscriberHandler<span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token punctuation">(</span><span class="token string">r'/message/'</span><span class="token punctuation">,</span>                        MessageHandler<span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token punctuation">(</span><span class="token string">r'/distributor/(.+?)'</span><span class="token punctuation">,</span>               DistributorWorker<span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token punctuation">[</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">]</span>
  <span class="token punctuation">]</span><span class="token punctuation">,</span> debug<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>
  wsgiref<span class="token punctuation">.</span>handlers<span class="token punctuation">.</span>CGIHandler<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>run<span class="token punctuation">(</span>application<span class="token punctuation">)</span></code></pre>
<p>This model is absolutely great in helping you think about your
application in REST terms. What it does is help you focus on a couple of
the core entities in any proper web application or service -- the
<strong>nouns</strong> and the <strong>verbs</strong>. In other words, the <em>URLs</em>, and the HTTP
<em>methods</em>. The framework allows you to control and handle incoming
requests in a URL-and-method orientated fashion, and leaves you to
concentrate on actually fulfilling the requests and forming the
responses.</p>
<p>So where does this bring us? Well, while I'm a huge fan of the ICF, it
does have a few shortcomings from a REST point of view, so I built a new
generic handler / dispatcher class that I can use at any given node in
the ICF tree, in the same style as WebOb. Put simply, it allows me to
write an ICF node handler as simple as this:</p>
<pre class="language-abap" tabindex="0"><code class="language-abap"><span class="token keyword">method</span> IF_HTTP_EXTENSION<span class="token token-operator punctuation">~</span>HANDLE_REQUEST<span class="token punctuation">.</span>

  <span class="token keyword">handler</span><span class="token punctuation">(</span> p <span class="token operator">=</span> <span class="token string">'^/$'</span>                                          h <span class="token operator">=</span> <span class="token string">'Y_COF_H_MAINPAGE'</span> <span class="token punctuation">)</span><span class="token punctuation">.</span>
  <span class="token keyword">handler</span><span class="token punctuation">(</span> p <span class="token operator">=</span> <span class="token string">'^/channel/submissionform$'</span>                    h <span class="token operator">=</span> <span class="token string">'Y_COF_H_CHANSUBMITFORM'</span> <span class="token punctuation">)</span><span class="token punctuation">.</span>
  <span class="token keyword">handler</span><span class="token punctuation">(</span> p <span class="token operator">=</span> <span class="token string">'^/channel/([^/]+)/subscriber/submissionform$'</span> h <span class="token operator">=</span> <span class="token string">'Y_COF_H_CHNSUBSUBMITFORM'</span> <span class="token punctuation">)</span><span class="token punctuation">.</span>
  <span class="token keyword">handler</span><span class="token punctuation">(</span> p <span class="token operator">=</span> <span class="token string">'^/channel/([^/]+)/subscriber/$'</span>               h <span class="token operator">=</span> <span class="token string">'Y_COF_H_CHNSUBCNT'</span> <span class="token punctuation">)</span><span class="token punctuation">.</span>
  <span class="token keyword">handler</span><span class="token punctuation">(</span> p <span class="token operator">=</span> <span class="token string">'^/channel/([^/]+)/subscriber/([^/]+)/$'</span>       h <span class="token operator">=</span> <span class="token string">'Y_COF_H_CHNSUB'</span> <span class="token punctuation">)</span><span class="token punctuation">.</span>

  dispatch<span class="token punctuation">(</span> server <span class="token punctuation">)</span><span class="token punctuation">.</span>

<span class="token keyword">endmethod</span><span class="token punctuation">.</span></code></pre>
<p>The handler / dispatcher consists of a generic class that implements
interface IF_HTTP_EXTENSION (as all ICF handlers must), and provides a
set of attributes and methods that allow you, in subclassing this
generic class, to write handler code in the above style. Here's the
method tab of Y_DISP_COFFEESHOP, to give you a feel for how it fits
together:</p>
<p><img src="/images/2009/09/y_disp_coffeeshop_methodtab_97688.png" alt=""></p>
<p>The classes that are invoked (Y_COF_H_* in this example) all inherit
from a generic request handler class which provides a set of attributes
and methods that allow you to get down to the business of simply
providing GET, POST, PUT and other methods to handle the actual HTTP
requests.</p>
<p>Here's an example of the method list of one of the request handler
classes:</p>
<p><img src="/images/2009/09/y_cof_h_chnsub_97689.png" alt=""></p>
<p>One interesting advantage, arguably a side-effect of this approach, is
that you can use nodes in the ICF tree to 'root' your various web
applications and services more cleanly, and avoid the difficulties of
having different handlers defined at different levels in the child
hierarchy just to service various parts of your application's
particular url space.</p>
<p>I'd like to end this weblog post with a diagram that hopefully shows
what I've been describing:</p>
<p><img src="/images/2009/09/diagram_97690.png" alt=""></p>
<p>If you're interested in learning more, or sharing code, please let me
know. I'm using this for real in one of my projects, but it's still
early days.</p>
<p>For more information on the coffeeshop mechanism, checkout the videos in
this playlist:</p>
<p><a href="https://www.youtube.com/playlist?list=PLfctWmgNyOIcbRYRdPrbjN_ZM56Kc5YTL"><img src="/images/2009/09/Ehdcd1HWkAA60Zi-1.jpeg" alt=""></a></p>
<hr>
<p><em>Update 01/05/2012 I've re-added images to this post that were lost
when SDN went through the migration to the new platform. This project is
now called ADL - Alternative Dispatcher Layer and is on the SAP Code
Exchange here: <a href="https://cw.sdn.sap.com/cw/groups/adl">https://cw.sdn.sap.com/cw/groups/adl</a></em></p>
<p><em>Update 09/09/2020 Added a link to the coffeeshop playlist</em></p>
<hr>
<p><a href="https://community.sap.com/t5/application-development-blog-posts/a-new-rest-handler-dispatcher-for-the-icf/ba-p/12872642">Originally published on SAP Community</a></p>



<script src="https://utteranc.es/client.js" repo="qmacro/qmacro.github.io" issue-term="title" crossorigin="anonymous" async=""></script>

<ul class="links-nextprev"><li class="links-nextprev-prev">← Previous<br> <a href="/blog/posts/2009/09/09/mainframes-and-the-cloud-everything-old-is-new-again/">Mainframes and the cloud - everything old is new again</a></li><li class="links-nextprev-next">Next →<br><a href="/blog/posts/2009/09/30/rest-orientation-controlling-access-to-resources/">REST orientation - Controlling access to resources</a></li>
</ul>

			</heading-anchors>
		</main>

		<!-- This page `/blog/posts/2009/09/21/a-new-rest-handler-dispatcher-for-the-icf/` was built on 2026-01-01T11:07:44.115Z -->
		<script type="module" src="/dist/t-8sxMV3B9.js"></script>
	</body>
</html>
