<!doctype html>
<html lang="en">
	<head>
		<meta charset="utf-8">
		<meta name="viewport" content="width=device-width, initial-scale=1.0">
		<title>Reading List Mark 2 - Part 5</title>
		<meta name="description" content="Reserving the right to be wrong.">
		<link rel="alternate" href="/feed/feed.xml" type="application/atom+xml" title="DJ Adams">
		<link rel="icon" type="image/x-icon" href="/images/favicon.ico">
		
		
		
		<style>/* This is an arbitrary CSS string added to the bundle */
/* Defaults */
:root {
	--font-family: -apple-system, system-ui, sans-serif;
	--font-family-monospace: Consolas, Menlo, Monaco, Andale Mono WT, Andale Mono, Lucida Console, Lucida Sans Typewriter, DejaVu Sans Mono, Bitstream Vera Sans Mono, Liberation Mono, Nimbus Mono L, Courier New, Courier, monospace;
}

/* Theme colors */
:root {
	--color-gray-20: #e0e0e0;
	--color-gray-50: #C0C0C0;
	--color-gray-90: #333;

	--background-color: #fff;

	--text-color: var(--color-gray-90);
	--text-color-link: #2884d2;
	--text-color-link-active: #15b0ed;
	--text-color-link-visited: #9f4199;

	--syntax-tab-size: 2;
}

@media (prefers-color-scheme: dark) {
	:root {
		--color-gray-20: #e0e0e0;
		--color-gray-50: #C0C0C0;
		--color-gray-90: #dad8d8;

		/* --text-color is assigned to --color-gray-_ above */
		--text-color-link: #1493fb;
		--text-color-link-active: #6969f7;
		--text-color-link-visited: #a6a6f8;

		--background-color: #15202b;
	}
}


/* Global stylesheet */
* {
	box-sizing: border-box;
}

@view-transition {
	navigation: auto;
}

html,
body {
	padding: 0;
	margin: 0 auto;
	font-family: var(--font-family);
	color: var(--text-color);
	background-color: var(--background-color);
}
html {
	overflow-y: scroll;
}
body {
	max-width: 40em;
}

/* https://www.a11yproject.com/posts/how-to-hide-content/ */
.visually-hidden:not(:focus):not(:active) {
	clip: rect(0 0 0 0);
	clip-path: inset(50%);
	height: 1px;
	overflow: hidden;
	position: absolute;
	white-space: nowrap;
	width: 1px;
}

/* Fluid images via https://www.zachleat.com/web/fluid-images/ */
img{
  max-width: 100%;
}
img[width][height] {
  height: auto;
}
img[src$=".svg"] {
  width: 100%;
  height: auto;
  max-width: none;
}
video,
iframe {
	width: 100%;
	height: auto;
}
iframe {
	aspect-ratio: 16/9;
}

p:last-child {
	margin-bottom: 0;
}
p {
	line-height: 1.5;
}

li {
	line-height: 1.5;
}

a[href] {
	color: var(--text-color-link);
}
a[href]:visited {
	color: var(--text-color-link-visited);
}
a[href]:hover,
a[href]:active {
	color: var(--text-color-link-active);
}

main,
footer {
	padding: 1rem;
}
/* main :first-child { */
/* 	margin-top: 0; */
/* } */

header {
	border-bottom: 1px dashed var(--color-gray-20);
}

#skip-link {
	text-decoration: none;
	background: var(--background-color);
	color: var(--text-color);
	padding: 0.5rem 1rem;
	border: 1px solid var(--color-gray-90);
	border-radius: 2px;
}

/* Prevent visually-hidden skip link fom pushing content around when focused */
#skip-link.visually-hidden:focus {
	position: absolute;
	top: 1rem;
	left: 1rem;
	/* Ensure it is positioned on top of everything else when it is shown */
	z-index: 999;
}

.links-nextprev {
	display: flex;
	justify-content: space-between;
	gap: .5em 1em;
	list-style: "";
	border-top: 1px dashed var(--color-gray-20);
	padding: 1em 0;
}
.links-nextprev > * {
	flex-grow: 1;
}
.links-nextprev-next {
	text-align: right;
}

table {
	margin: 1em 0;
}
table td,
table th {
	padding-right: 1em;
}

pre,
code {
	font-family: var(--font-family-monospace);
	color: seagreen;
}

pre,code[class*="language-"] {
	line-height: 1.2em !important;
	font-size: 0.93em !important;
}

pre:not([class*="language-"]) {
	margin: .5em 0;
	line-height: 1.375; /* 22px /16 */
	-moz-tab-size: var(--syntax-tab-size);
	-o-tab-size: var(--syntax-tab-size);
	tab-size: var(--syntax-tab-size);
	-webkit-hyphens: none;
	-ms-hyphens: none;
	hyphens: none;
	direction: ltr;
	text-align: left;
	white-space: pre;
	word-spacing: normal;
	word-break: normal;
	overflow-x: auto;
}
code {
	word-break: break-all;
}

/* Header */
header {
	display: flex;
	gap: 1em;
	flex-wrap: wrap;
	justify-content: space-between;
	align-items: center;
	padding: 1em;
}
.home-link {
	flex-grow: 1;
	font-size: 1em; /* 16px /16 */
	font-weight: 700;
}
.home-link:link:not(:hover) {
	text-decoration: none;
}

/* Nav */
.nav {
	display: flex;
	gap: .5em 1em;
	padding: 0;
	margin: 0;
	list-style: none;
}
.nav-item {
	display: inline-block;
}
.nav-item a[href]:not(:hover) {
	text-decoration: none;
}
.nav a[href][aria-current="page"] {
	text-decoration: underline;
}

/* Posts list */
.postlist {
	counter-reset: start-from var(--postlist-index);
	list-style: none;
	padding: 0;
}
.postlist-item {
	display: flex;
	flex-wrap: wrap;
	align-items: baseline;
	counter-increment: start-from -1;
	margin-bottom: 1em;
}
.postlist-item:before {
	display: inline-block;
	pointer-events: none;
	line-height: 100%;
	text-align: right;
	margin-left: -1.5rem;
}
.postlist-date,
.postlist-item:before {
	font-size: 0.8125em; /* 13px /16 */
	color: var(--color-gray-90);
}
.postlist-date {
	word-spacing: -0.5px;
}
.postlist-link {
	font-size: 1.1875em; /* 19px /16 */
	font-weight: 700;
	flex-basis: calc(100% - 1.5rem);
	text-underline-position: from-font;
	text-underline-offset: 0;
	text-decoration-thickness: 1px;
}
.postlist-item-active .postlist-link {
	font-weight: bold;
}

/* Tags */
.post-tag {
	display: inline-flex;
	align-items: center;
	justify-content: center;
	font-style: italic;
}

/* may want to make the description text smaller at some stage */
.post-description-list {
	font-size: 1.0em;
}

.post-description-main {
	font-style: italic;
}

.postlist-item > .post-tag {
	align-self: center;
}

/* Tags list */
.post-metadata {
	display: inline-flex;
	flex-wrap: wrap;
	gap: .5em;
	list-style: none;
	padding: 0;
	margin: 0;
}
.post-metadata time {
	margin-right: 1em;
}

blockquote {
	margin-top: 0px;
	margin-left: 0px;
	margin-bottom: 15px;
	padding-left: 15px;
	border-left: 5px solid lightgray;
}
/**
 * prism.js default theme for JavaScript, CSS and HTML
 * Based on dabblet (http://dabblet.com)
 * @author Lea Verou
 */

code[class*="language-"],
pre[class*="language-"] {
	color: black;
	background: none;
	text-shadow: 0 1px white;
	font-family: Consolas, Monaco, 'Andale Mono', 'Ubuntu Mono', monospace;
	font-size: 1em;
	text-align: left;
	white-space: pre;
	word-spacing: normal;
	word-break: normal;
	word-wrap: normal;
	line-height: 1.5;

	-moz-tab-size: 4;
	-o-tab-size: 4;
	tab-size: 4;

	-webkit-hyphens: none;
	-moz-hyphens: none;
	-ms-hyphens: none;
	hyphens: none;
}

pre[class*="language-"]::-moz-selection, pre[class*="language-"] ::-moz-selection,
code[class*="language-"]::-moz-selection, code[class*="language-"] ::-moz-selection {
	text-shadow: none;
	background: #b3d4fc;
}

pre[class*="language-"]::selection, pre[class*="language-"] ::selection,
code[class*="language-"]::selection, code[class*="language-"] ::selection {
	text-shadow: none;
	background: #b3d4fc;
}

@media print {
	code[class*="language-"],
	pre[class*="language-"] {
		text-shadow: none;
	}
}

/* Code blocks */
pre[class*="language-"] {
	padding: 1em;
	margin: .5em 0;
	overflow: auto;
}

:not(pre) > code[class*="language-"],
pre[class*="language-"] {
	background: #f5f2f0;
}

/* Inline code */
:not(pre) > code[class*="language-"] {
	padding: .1em;
	border-radius: .3em;
	white-space: normal;
}

.token.comment,
.token.prolog,
.token.doctype,
.token.cdata {
	color: slategray;
}

.token.punctuation {
	color: #999;
}

.token.namespace {
	opacity: .7;
}

.token.property,
.token.tag,
.token.boolean,
.token.number,
.token.constant,
.token.symbol,
.token.deleted {
	color: #905;
}

.token.selector,
.token.attr-name,
.token.string,
.token.char,
.token.builtin,
.token.inserted {
	color: #690;
}

.token.operator,
.token.entity,
.token.url,
.language-css .token.string,
.style .token.string {
	color: #9a6e3a;
	/* This background color was intended by the author of this theme. */
	background: hsla(0, 0%, 100%, .5);
}

.token.atrule,
.token.attr-value,
.token.keyword {
	color: #07a;
}

.token.function,
.token.class-name {
	color: #DD4A68;
}

.token.regex,
.token.important,
.token.variable {
	color: #e90;
}

.token.important,
.token.bold {
	font-weight: bold;
}
.token.italic {
	font-style: italic;
}

.token.entity {
	cursor: help;
}
/*
 * New diff- syntax
 */

pre[class*="language-diff-"] {
	--eleventy-code-padding: 1.25em;
	padding-left: var(--eleventy-code-padding);
	padding-right: var(--eleventy-code-padding);
}
.token.deleted {
	background-color: hsl(0, 51%, 37%);
	color: inherit;
}
.token.inserted {
	background-color: hsl(126, 31%, 39%);
	color: inherit;
}

/* Make the + and - characters unselectable for copy/paste */
.token.prefix.unchanged,
.token.prefix.inserted,
.token.prefix.deleted {
	-webkit-user-select: none;
	user-select: none;
	display: inline-flex;
	align-items: center;
	justify-content: center;
	padding-top: 2px;
	padding-bottom: 2px;
}
.token.prefix.inserted,
.token.prefix.deleted {
	width: var(--eleventy-code-padding);
	background-color: rgba(0,0,0,.2);
}

/* Optional: full-width background color */
.token.inserted:not(.prefix),
.token.deleted:not(.prefix) {
	display: block;
	margin-left: calc(-1 * var(--eleventy-code-padding));
	margin-right: calc(-1 * var(--eleventy-code-padding));
	text-decoration: none; /* override del, ins, mark defaults */
	color: inherit; /* override del, ins, mark defaults */
}
.utterances {
  margin-left: inherit !important;
}</style>
		
	</head>
	<body>
		<a href="#main" id="skip-link" class="visually-hidden">Skip to main content</a>

		<header>
			<a href="/" class="home-link">DJ Adams</a>
			<nav>
				<h2 class="visually-hidden" id="top-level-navigation-menu">Top level navigation menu</h2>
				<ul class="nav">
					<li class="nav-item"><a href="/">Home</a></li>
					<li class="nav-item"><a href="/about/">About</a></li>
					<li class="nav-item"><a href="/blog/">Blog</a></li>
					<li class="nav-item"><a href="/feed/feed.xml">Feed</a></li>
				</ul>
			</nav>
		</header>

		<main id="main">
			<heading-anchors>
				


<h1 id="reading-list-mark-2-part-5">Reading List Mark 2 - Part 5</h1>

<ul class="post-metadata">
	<li><time datetime="2011-10-16">16 October 2011</time></li>
	<li><a href="/tags/appsscript/" class="post-tag">appsscript</a>, </li>
	<li><a href="/tags/google/" class="post-tag">google</a>, </li>
	<li><a href="/tags/gtug/" class="post-tag">gtug</a>, </li>
	<li><a href="/tags/madlab/" class="post-tag">madlab</a>, </li>
	<li><a href="/tags/mangtug/" class="post-tag">mangtug</a>, </li>
	<li><a href="/tags/tasks/" class="post-tag">tasks</a>, </li>
	<li><a href="/tags/ui/" class="post-tag">ui</a>, </li>
	<li><a href="/tags/urlfetch/" class="post-tag">urlfetch</a></li>
</ul>

<p class="post-description-main"></p>

<p>This is Part 5, the last part in a series about an example app that I put together to demonstrate and describe the use of various Google Apps Script features. See <a href="/blog/posts/2011/10/08/reading-list-mark-2-part-1/">Part 1</a> for an introduction.</p>
<p>This part is &quot;<strong>Putting it all together and using the OnOpen event to insert a new 2-item menu entry on the spreadsheet’s page</strong>&quot;.</p>
<h2 id="parts-overview">Parts Overview</h2>
<ol>
<li><a href="/blog/posts/2011/10/08/reading-list-mark-2-part-1/">Introduction to the app, and a short screencast showing the features</a></li>
<li><a href="/blog/posts/2011/10/10/reading-list-mark-2-part-2/">Using the Tasks API to retrieve and insert tasklists, and the Ui Services to build the tasklist chooser component</a></li>
<li><a href="/blog/posts/2011/10/14/reading-list-mark-2-part-3/">Using the UrlFetch Services to interact with the Google+ API and grab info on articles pointed to by users in their activity stream</a></li>
<li><a href="/blog/posts/2011/10/15/reading-list-mark-2-part-4/">Synchronising the URL list in the spreadsheet with corresponding tasks in the chosen tasklist</a></li>
<li><a href="/blog/posts/2011/10/16/reading-list-mark-2-part-5/">Putting it all together and using the OnOpen event to insert a new 2-item menu entry on the spreadsheet’s page</a> <strong>&lt;– you are here</strong></li>
</ol>
<h2 id="putting-it-all-together">Putting it all together</h2>
<p>So at this stage we’ve done pretty much everything required for this example app. The final task is to extend the standard Spreadsheet menu to give the user access to the custom features of selecting a tasklist, and kicking off an update (URL pull and synchronisation). It’s very easy to extend the menu; in a few lines of code we’re going to end up with something like this:</p>
<p><img src="/images/2017/12/menu.png" alt="Menu"></p>
<p>It’s as simple as this:</p>
<pre class="language-javascript" tabindex="0"><code class="language-javascript"><span class="token keyword">function</span> <span class="token function">onOpen</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">var</span> ss <span class="token operator">=</span> SpreadsheetApp<span class="token punctuation">.</span><span class="token function">getActiveSpreadsheet</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">var</span> menuEntries <span class="token operator">=</span> <span class="token punctuation">[</span>
    <span class="token punctuation">{</span><span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">"Update"</span><span class="token punctuation">,</span> <span class="token literal-property property">functionName</span><span class="token operator">:</span> <span class="token string">"update"</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">{</span><span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">"Select Task List"</span><span class="token punctuation">,</span> <span class="token literal-property property">functionName</span><span class="token operator">:</span> <span class="token string">"taskListUi"</span><span class="token punctuation">}</span>
  <span class="token punctuation">]</span><span class="token punctuation">;</span>
  ss<span class="token punctuation">.</span><span class="token function">addMenu</span><span class="token punctuation">(</span><span class="token string">"Articles"</span><span class="token punctuation">,</span> menuEntries<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre>
<p>We use the <a href="http://code.google.com/googleapps/appsscript/class_spreadsheet.html#addMenu">addMenu</a>() method of the Spreadsheet class to create a new menu entry with an array of objects representing menu items. And the function name? onOpen() is one of a number of <a href="http://code.google.com/googleapps/appsscript/guide_events.html">built-in simple event handler functions</a>; this one runs automatically when a spreadsheet is opened – an ideal time to extend the menu.</p>
<h2 id="the-complete-script">The complete script</h2>
<p>So we’re done with the final part! Let’s celebrate with the script in its entirety. And a beer. Cheers!</p>
<pre class="language-javascript" tabindex="0"><code class="language-javascript"><span class="token comment">// -------------------------------------------------------------------------</span>
<span class="token comment">// Constants</span>
<span class="token comment">// -------------------------------------------------------------------------</span>
<span class="token constant">APIKEY</span> <span class="token operator">=</span> <span class="token string">'AIzaSyANY6ebMr2bi1Fzn-53kysp0y4LsbZA488'</span><span class="token punctuation">;</span>
<span class="token constant">ACTIVITYLISTURL</span> <span class="token operator">=</span> <span class="token string">'https://www.googleapis.com/plus/v1/people/{userId}/activities/{collection}'</span><span class="token punctuation">;</span>
<span class="token constant">READINGLISTCELL</span> <span class="token operator">=</span> <span class="token string">'C1'</span><span class="token punctuation">;</span>
<span class="token constant">USERIDCELL</span> <span class="token operator">=</span> <span class="token string">'D1'</span>
<span class="token constant">USERID</span> <span class="token operator">=</span> <span class="token string">'106413090159067280619'</span><span class="token punctuation">;</span> <span class="token comment">// Mahemoff</span>

<span class="token comment">// -------------------------------------------------------------------------</span>
<span class="token comment">// update()</span>
<span class="token comment">// Pulls in article links into sheet and synchronises with task list</span>
<span class="token comment">// -------------------------------------------------------------------------</span>
<span class="token keyword">function</span> <span class="token function">update</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// First, check that we have a tasklist id already; it's stored in</span>
  <span class="token comment">// the comment section of the 'readinglistcell'</span>
  <span class="token keyword">var</span> sh <span class="token operator">=</span> SpreadsheetApp<span class="token punctuation">.</span><span class="token function">getActiveSpreadsheet</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getActiveSheet</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">var</span> taskListId <span class="token operator">=</span> sh<span class="token punctuation">.</span><span class="token function">getRange</span><span class="token punctuation">(</span><span class="token constant">READINGLISTCELL</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getComment</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment">// If we don't have an id, tell the user to choose a tasklist</span>
  <span class="token keyword">if</span><span class="token punctuation">(</span>taskListId <span class="token operator">===</span> <span class="token string">''</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    SpreadsheetApp<span class="token punctuation">.</span><span class="token function">getActiveSpreadsheet</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toast</span><span class="token punctuation">(</span>
      <span class="token string">"Use Articles -> Select Task List to choose a task list"</span><span class="token punctuation">,</span>
      <span class="token string">"No Task List"</span><span class="token punctuation">,</span>
      <span class="token number">5</span>
    <span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment">// Otherwise, we know which task list to synchronise with, so</span>
  <span class="token comment">// go and update the reading list with URLs from the Google+ activity</span>
  <span class="token comment">// list, and then sync that with the task list items</span>
  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
    <span class="token function">retrieveActivityUrls_</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">synchronise_</span><span class="token punctuation">(</span>taskListId<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token comment">// -------------------------------------------------------------------------</span>
<span class="token comment">// taskListUi()</span>
<span class="token comment">// Displays a Ui to allow the user to select a tasklist to manage</span>
<span class="token comment">// the reading tasks. Can select an existing task list or create a new one</span>
<span class="token comment">// -------------------------------------------------------------------------</span>
<span class="token keyword">function</span> <span class="token function">taskListUi</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">var</span> doc <span class="token operator">=</span> SpreadsheetApp<span class="token punctuation">.</span><span class="token function">getActiveSpreadsheet</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">var</span> app <span class="token operator">=</span> UiApp<span class="token punctuation">.</span><span class="token function">createApplication</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  app<span class="token punctuation">.</span><span class="token function">setTitle</span><span class="token punctuation">(</span><span class="token string">'Task Lists'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">// We'll have a grid and a button in this</span>
  <span class="token comment">// vertical panel</span>
  <span class="token keyword">var</span> panel <span class="token operator">=</span> app<span class="token punctuation">.</span><span class="token function">createVerticalPanel</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">// Use a listbox to display a choice of existing tasklists</span>
  <span class="token keyword">var</span> lb <span class="token operator">=</span> app<span class="token punctuation">.</span><span class="token function">createListBox</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  lb<span class="token punctuation">.</span><span class="token function">setName</span><span class="token punctuation">(</span><span class="token string">'existingList'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">var</span> tasklists <span class="token operator">=</span> <span class="token function">getTasklists_</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">var</span> tl <span class="token keyword">in</span> tasklists<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    lb<span class="token punctuation">.</span><span class="token function">addItem</span><span class="token punctuation">(</span>tasklists<span class="token punctuation">[</span>tl<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">getTitle</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token comment">// Use the grid to layout the listbox, a textbox for a new list,</span>
  <span class="token comment">// and some corresponding labels</span>
  <span class="token keyword">var</span> grid <span class="token operator">=</span> app<span class="token punctuation">.</span><span class="token function">createGrid</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  grid<span class="token punctuation">.</span><span class="token function">setWidget</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span> app<span class="token punctuation">.</span><span class="token function">createLabel</span><span class="token punctuation">(</span><span class="token string">"Existing:"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  grid<span class="token punctuation">.</span><span class="token function">setWidget</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span> lb<span class="token punctuation">)</span><span class="token punctuation">;</span>
  grid<span class="token punctuation">.</span><span class="token function">setWidget</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span> app<span class="token punctuation">.</span><span class="token function">createLabel</span><span class="token punctuation">(</span><span class="token string">"Or new:"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  grid<span class="token punctuation">.</span><span class="token function">setWidget</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span> app<span class="token punctuation">.</span><span class="token function">createTextBox</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">setName</span><span class="token punctuation">(</span><span class="token string">'newList'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">// The only button; handler will be linked to this button click event</span>
  <span class="token comment">// Remember to add the grid contents to the callback context</span>
  <span class="token keyword">var</span> button <span class="token operator">=</span> app<span class="token punctuation">.</span><span class="token function">createButton</span><span class="token punctuation">(</span><span class="token string">"Choose"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">var</span> chooseHandler <span class="token operator">=</span> app<span class="token punctuation">.</span><span class="token function">createServerClickHandler</span><span class="token punctuation">(</span><span class="token string">'handleChooseButton_'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  chooseHandler<span class="token punctuation">.</span><span class="token function">addCallbackElement</span><span class="token punctuation">(</span>grid<span class="token punctuation">)</span><span class="token punctuation">;</span>
  button<span class="token punctuation">.</span><span class="token function">addClickHandler</span><span class="token punctuation">(</span>chooseHandler<span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">// Put it all together and show it</span>
  panel<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>app<span class="token punctuation">.</span><span class="token function">createLabel</span><span class="token punctuation">(</span><span class="token string">"Select existing or create new list"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  panel<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>grid<span class="token punctuation">)</span><span class="token punctuation">;</span>
  panel<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>button<span class="token punctuation">)</span><span class="token punctuation">;</span>
  app<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>panel<span class="token punctuation">)</span><span class="token punctuation">;</span>
  doc<span class="token punctuation">.</span><span class="token function">show</span><span class="token punctuation">(</span>app<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">// -------------------------------------------------------------------------</span>
<span class="token comment">// handleChooseButton_(e)</span>
<span class="token comment">// Handler for 'Choose' button on taskListUi Ui; creates a new task list</span>
<span class="token comment">// if a new one has been specified; grabs the ID of the chosen task list</span>
<span class="token comment">// and stores the task list name and id in the TASKLISTCELL</span>
<span class="token comment">// -------------------------------------------------------------------------</span>
<span class="token keyword">function</span> <span class="token function">handleChooseButton_</span><span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>

  <span class="token comment">// Assume an existing list was chosen</span>
  <span class="token keyword">var</span> selectedList <span class="token operator">=</span> e<span class="token punctuation">.</span>parameter<span class="token punctuation">.</span>existingList<span class="token punctuation">;</span>

  <span class="token comment">// But check for a new list being specified; if it as, create</span>
  <span class="token comment">// a new task list</span>
  <span class="token keyword">if</span><span class="token punctuation">(</span>e<span class="token punctuation">.</span>parameter<span class="token punctuation">.</span>newList <span class="token operator">!=</span> <span class="token string">''</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    selectedList <span class="token operator">=</span> e<span class="token punctuation">.</span>parameter<span class="token punctuation">.</span>newList<span class="token punctuation">;</span>
    <span class="token keyword">var</span> newTaskList <span class="token operator">=</span> Tasks<span class="token punctuation">.</span><span class="token function">newTaskList</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">setTitle</span><span class="token punctuation">(</span>selectedList<span class="token punctuation">)</span><span class="token punctuation">;</span>
    Tasks<span class="token punctuation">.</span>Tasklists<span class="token punctuation">.</span><span class="token function">insert</span><span class="token punctuation">(</span>newTaskList<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token comment">// Grab the list of tasklists, because we'll need the id</span>
  <span class="token keyword">var</span> taskLists <span class="token operator">=</span> <span class="token function">getTasklists_</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">var</span> taskListId <span class="token operator">=</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span>
  <span class="token keyword">for</span><span class="token punctuation">(</span>tl <span class="token keyword">in</span> taskLists<span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span>taskLists<span class="token punctuation">[</span>tl<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">getTitle</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">===</span> selectedList<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      taskListId <span class="token operator">=</span> taskLists<span class="token punctuation">[</span>tl<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">getId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">break</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>

  <span class="token comment">// Record the list name and id</span>
  <span class="token keyword">var</span> sh <span class="token operator">=</span> SpreadsheetApp<span class="token punctuation">.</span><span class="token function">getActiveSheet</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">var</span> cell <span class="token operator">=</span> sh<span class="token punctuation">.</span><span class="token function">getRange</span><span class="token punctuation">(</span><span class="token constant">READINGLISTCELL</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  cell<span class="token punctuation">.</span><span class="token function">setValue</span><span class="token punctuation">(</span>selectedList<span class="token punctuation">)</span><span class="token punctuation">;</span>
  cell<span class="token punctuation">.</span><span class="token function">setComment</span><span class="token punctuation">(</span>taskListId<span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">// Close the Ui popup and display the name of the chosen list</span>
  <span class="token keyword">var</span> app <span class="token operator">=</span> UiApp<span class="token punctuation">.</span><span class="token function">getActiveApplication</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  app<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  SpreadsheetApp<span class="token punctuation">.</span><span class="token function">getActiveSpreadsheet</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toast</span><span class="token punctuation">(</span>selectedList<span class="token punctuation">,</span> <span class="token string">"Selected List"</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">return</span> app<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">// -------------------------------------------------------------------------</span>
<span class="token comment">// onOpen()</span>
<span class="token comment">// Event-based function called when the spreadsheet is opened; adds items</span>
<span class="token comment">// to the menu</span>
<span class="token comment">// -------------------------------------------------------------------------</span>
<span class="token keyword">function</span> <span class="token function">onOpen</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">var</span> ss <span class="token operator">=</span> SpreadsheetApp<span class="token punctuation">.</span><span class="token function">getActiveSpreadsheet</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">var</span> menuEntries <span class="token operator">=</span> <span class="token punctuation">[</span> <span class="token punctuation">{</span><span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">"Select Task List"</span><span class="token punctuation">,</span> <span class="token literal-property property">functionName</span><span class="token operator">:</span> <span class="token string">"taskListUi"</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
                     <span class="token punctuation">{</span><span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">"Update"</span><span class="token punctuation">,</span> <span class="token literal-property property">functionName</span><span class="token operator">:</span> <span class="token string">"update"</span><span class="token punctuation">}</span> <span class="token punctuation">]</span><span class="token punctuation">;</span>
  ss<span class="token punctuation">.</span><span class="token function">addMenu</span><span class="token punctuation">(</span><span class="token string">"Articles"</span><span class="token punctuation">,</span> menuEntries<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">// -------------------------------------------------------------------------</span>
<span class="token comment">// getTasklists()</span>
<span class="token comment">// Retrieve a list of the user's tasklists (uses the APIs Services)</span>
<span class="token comment">// Note that the Tasks Services docu is not accurate here; we would</span>
<span class="token comment">// expect to be able to use the TasklistsCollection class.</span>
<span class="token comment">// -------------------------------------------------------------------------</span>
<span class="token keyword">function</span> <span class="token function">getTasklists_</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">var</span> tasklistsList <span class="token operator">=</span> Tasks<span class="token punctuation">.</span>Tasklists<span class="token punctuation">.</span><span class="token function">list</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">return</span> tasklistsList<span class="token punctuation">.</span><span class="token function">getItems</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">// -------------------------------------------------------------------------</span>
<span class="token comment">// retrieveActivityUrls_()</span>
<span class="token comment">// Use UrlFetch to retrieve a Google+ API resource: activities for a person</span>
<span class="token comment">// Use Javascript data structures; restrict the number of API calls</span>
<span class="token comment">// -------------------------------------------------------------------------</span>
<span class="token keyword">function</span> <span class="token function">retrieveActivityUrls_</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>

  <span class="token comment">// Grab existing list of URLs</span>
  <span class="token keyword">var</span> sh <span class="token operator">=</span> SpreadsheetApp<span class="token punctuation">.</span><span class="token function">getActiveSheet</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">var</span> lastRow <span class="token operator">=</span> sh<span class="token punctuation">.</span><span class="token function">getLastRow</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">var</span> urlList <span class="token operator">=</span> sh<span class="token punctuation">.</span><span class="token function">getRange</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> lastRow <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">.</span><span class="token function">getValues</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">var</span> list <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token string-property property">'old'</span><span class="token operator">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token string-property property">'new'</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
  <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">var</span> i <span class="token keyword">in</span> urlList<span class="token punctuation">)</span><span class="token punctuation">{</span>
    list<span class="token punctuation">[</span><span class="token string">'old'</span><span class="token punctuation">]</span><span class="token punctuation">[</span>urlList<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token comment">// Use the userid in the sheet, fallback to a favourite :)</span>
  <span class="token keyword">var</span> userid <span class="token operator">=</span> sh<span class="token punctuation">.</span><span class="token function">getRange</span><span class="token punctuation">(</span><span class="token constant">USERIDCELL</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">||</span> <span class="token constant">USERID</span><span class="token punctuation">;</span>

  <span class="token comment">// Build Google+ API resource and retrieve it; parse JSON content</span>
  <span class="token keyword">var</span> actListUrl <span class="token operator">=</span> <span class="token function">buildActivityListUrl_</span><span class="token punctuation">(</span>userid<span class="token punctuation">,</span> <span class="token string">'public'</span><span class="token punctuation">,</span> <span class="token constant">APIKEY</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">var</span> jsonString <span class="token operator">=</span> UrlFetchApp<span class="token punctuation">.</span><span class="token function">fetch</span><span class="token punctuation">(</span>actListUrl<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getContentText</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token keyword">var</span> activities <span class="token operator">=</span> Utilities<span class="token punctuation">.</span><span class="token function">jsonParse</span><span class="token punctuation">(</span>jsonString<span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">// We're looking for the item object attachments, where the</span>
  <span class="token comment">// attachment's objectType is 'article'. We want the url and displayName</span>
  <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">var</span> i <span class="token keyword">in</span> activities<span class="token punctuation">.</span>items<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">var</span> attachments <span class="token operator">=</span> activities<span class="token punctuation">.</span>items<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>object<span class="token punctuation">.</span>attachments<span class="token punctuation">;</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">var</span> a <span class="token keyword">in</span> attachments<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">var</span> attachment <span class="token operator">=</span> attachments<span class="token punctuation">[</span>a<span class="token punctuation">]</span><span class="token punctuation">;</span>
      <span class="token comment">// We've got a URL and title; store it as new if it doesn't</span>
      <span class="token comment">// already exist. Store it as list of lists, ready for</span>
      <span class="token comment">// a setValues([][]) insert</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>attachment<span class="token punctuation">.</span>objectType <span class="token operator">==</span> <span class="token string">'article'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span> <span class="token punctuation">(</span>attachment<span class="token punctuation">.</span>url <span class="token keyword">in</span> list<span class="token punctuation">[</span><span class="token string">'old'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
          list<span class="token punctuation">[</span><span class="token string">'new'</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token punctuation">[</span>attachment<span class="token punctuation">.</span>url<span class="token punctuation">,</span> attachment<span class="token punctuation">.</span>displayName<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>

  <span class="token comment">// Blammo!</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>list<span class="token punctuation">[</span><span class="token string">'new'</span><span class="token punctuation">]</span><span class="token punctuation">.</span>length<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    sh<span class="token punctuation">.</span><span class="token function">getRange</span><span class="token punctuation">(</span>lastRow <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> list<span class="token punctuation">[</span><span class="token string">'new'</span><span class="token punctuation">]</span><span class="token punctuation">.</span>length<span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">setValues</span><span class="token punctuation">(</span>list<span class="token punctuation">[</span><span class="token string">'new'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

<span class="token punctuation">}</span>


<span class="token comment">// -------------------------------------------------------------------------</span>
<span class="token comment">// synchronise(taskListId)</span>
<span class="token comment">// Synchronise the URLs in the spreadsheet with items in the chosen tasklist</span>
<span class="token comment">// The task list item id for a URL is stored in the comment for that URL cell</span>
<span class="token comment">// -------------------------------------------------------------------------</span>
<span class="token keyword">function</span> <span class="token function">synchronise_</span><span class="token punctuation">(</span><span class="token parameter">taskListId</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>

  <span class="token comment">// Grab list of all URLs, and associated comments</span>
  <span class="token keyword">var</span> sh <span class="token operator">=</span> SpreadsheetApp<span class="token punctuation">.</span><span class="token function">getActiveSheet</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">var</span> urlRange <span class="token operator">=</span> sh<span class="token punctuation">.</span><span class="token function">getRange</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> sh<span class="token punctuation">.</span><span class="token function">getLastRow</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">var</span> urls <span class="token operator">=</span> urlRange<span class="token punctuation">.</span><span class="token function">getValues</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">var</span> comments <span class="token operator">=</span> urlRange<span class="token punctuation">.</span><span class="token function">getComments</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">// For each URL, check the status of the associated task.</span>
  <span class="token comment">// If there isn't an associated task, create one.</span>
  <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">var</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">,</span> j <span class="token operator">=</span> urls<span class="token punctuation">.</span>length<span class="token punctuation">;</span> i <span class="token operator">&lt;</span> j<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>comments<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token string">""</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      Logger<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">"New task"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">var</span> task <span class="token operator">=</span> Tasks<span class="token punctuation">.</span><span class="token function">newTask</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      task<span class="token punctuation">.</span><span class="token function">setTitle</span><span class="token punctuation">(</span>urls<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">var</span> newTask <span class="token operator">=</span> Tasks<span class="token punctuation">.</span>Tasks<span class="token punctuation">.</span><span class="token function">insert</span><span class="token punctuation">(</span>task<span class="token punctuation">,</span> taskListId<span class="token punctuation">)</span><span class="token punctuation">;</span>
      sh<span class="token punctuation">.</span><span class="token function">getRange</span><span class="token punctuation">(</span>i <span class="token operator">+</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">setComment</span><span class="token punctuation">(</span>newTask<span class="token punctuation">.</span><span class="token function">getId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
      Logger<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">"Existing task"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">var</span> existingTask <span class="token operator">=</span> Tasks<span class="token punctuation">.</span>Tasks<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>taskListId<span class="token punctuation">,</span> comments<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>existingTask<span class="token punctuation">.</span><span class="token function">getStatus</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">===</span> <span class="token string">"completed"</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        sh<span class="token punctuation">.</span><span class="token function">getRange</span><span class="token punctuation">(</span>i <span class="token operator">+</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">setFontLine</span><span class="token punctuation">(</span><span class="token string">'line-through'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token comment">// -------------------------------------------------------------------------</span>
<span class="token comment">// buildActivityListUrl_(userId, collection, apiKey)</span>
<span class="token comment">// Creates a specific resource address (URL) for the public activities</span>
<span class="token comment">// for a given person in Google+</span>
<span class="token comment">// See https://developers.google.com/+/api/latest/activities/list</span>
<span class="token comment">// This will be obsolete when there are direct Google+ Services for</span>
<span class="token comment">// Apps Script</span>
<span class="token comment">// -------------------------------------------------------------------------</span>
<span class="token keyword">function</span> <span class="token function">buildActivityListUrl_</span><span class="token punctuation">(</span><span class="token parameter">userId<span class="token punctuation">,</span> collection<span class="token punctuation">,</span> apiKey</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>

  <span class="token keyword">var</span> actListUrl <span class="token operator">=</span> <span class="token constant">ACTIVITYLISTURL</span><span class="token punctuation">;</span>
  actListUrl <span class="token operator">=</span> actListUrl<span class="token punctuation">.</span><span class="token function">replace</span><span class="token punctuation">(</span><span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">{userId}</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">,</span> userId<span class="token punctuation">)</span><span class="token punctuation">;</span>
  actListUrl <span class="token operator">=</span> actListUrl<span class="token punctuation">.</span><span class="token function">replace</span><span class="token punctuation">(</span><span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">{collection}</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">,</span> collection<span class="token punctuation">)</span><span class="token punctuation">;</span>
  actListUrl <span class="token operator">=</span> actListUrl <span class="token operator">+</span> <span class="token string">'?key='</span> <span class="token operator">+</span> apiKey<span class="token punctuation">;</span>

  <span class="token keyword">return</span> actListUrl<span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre>



<script src="https://utteranc.es/client.js" repo="qmacro/qmacro.github.io" issue-term="title" crossorigin="anonymous" async=""></script>

<ul class="links-nextprev"><li class="links-nextprev-prev">← Previous<br> <a href="/blog/posts/2011/10/15/reading-list-mark-2-part-4/">Reading List Mark 2 - Part 4</a></li><li class="links-nextprev-next">Next →<br><a href="/blog/posts/2011/10/25/review-of-milk-stout-from-left-handed-brewing-co/">Review of Milk Stout from Left Handed Brewing Co</a></li>
</ul>

			</heading-anchors>
		</main>

		<!-- This page `/blog/posts/2011/10/16/reading-list-mark-2-part-5/` was built on 2025-09-15T17:23:29.282Z -->
		<script type="module" src="/dist/xbxy_EL6cU.js"></script>
	</body>
</html>
