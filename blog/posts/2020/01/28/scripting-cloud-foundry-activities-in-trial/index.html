<!doctype html><html lang="en"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1"><link rel="canonical" href="https://qmacro.org/blog/posts/2020/01/28/scripting-cloud-foundry-activities-in-trial/"><link rel="alternate" type="application/atom+xml" title="DJ's Weblog - Feed" href="https://qmacro.org/feed.xml"><link href="/assets/main.54fe08380532f159e78f.css" rel="stylesheet"><link rel="preconnect" href="https://fonts.gstatic.com"><link href="https://fonts.googleapis.com/css2?family=IBM+Plex+Sans&display=swap" rel="stylesheet"><title>Scripting Cloud Foundry activities in trial | DJ Adams</title><link rel="icon" type="“image/x-icon”" href="/images/favicon.ico"><meta property="og:title" content="Scripting Cloud Foundry activities in trial"><meta property="og:site_name" content="DJ Adams"><meta property="og:type" content="website"><meta property="og:url" content="https://qmacro.org/blog/posts/2020/01/28/scripting-cloud-foundry-activities-in-trial/"><meta name="description" content="Scripting Cloud Foundry activities in trial 28 Jan 2020 | 4 min read In this post I share a simple script that I use to recreate my Business..."><meta property="og:description" content="Scripting Cloud Foundry activities in trial 28 Jan 2020 | 4 min read In this post I share a simple script that I use to recreate my Business..."><meta name="description" content="Scripting Cloud Foundry activities in trial 28 Jan 2020 | 4 min read In this post I share a simple script that I use to recreate my Business..."><meta property="og:image" content="https://qmacro.org/images/site-image.png"><script src="https://cdn.jsdelivr.net/npm/mermaid/dist/mermaid.min.js"></script><script>mermaid.initialize({startOnLoad:true});</script><script async src="https://www.googletagmanager.com/gtag/js?id=G-4WQKBG0L4Y"></script><script>window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());

      gtag('config', 'G-4WQKBG0L4Y');</script></head><body><div class="layout-wrapper"><header class="header"><div class="header__content"><h1 class="site-title"><a href="/">DJ Adams</a></h1><nav class="nav"><ul class="nav__list"><li class="nav-item"><a href="/about">About Me</a></li><li class="nav-item"><a href="/blog">Blog</a></li><li class="nav-item"><a href="/feed.xml">Feed</a></li></ul></nav></div></header><main class="main"><article class="post"><header class="post__header"><h1>Scripting Cloud Foundry activities in trial</h1><div class="post__details"><time datetime="2020-01-28">28 Jan 2020 </time><span>| </span><span>4 min read</span></div></header><main class="post__content"><p><em>In this post I share a simple script that I use to recreate my Business Rules environment in the Cloud Foundry environment of my SAP Cloud Platform trial account. Scripting and the CLI in general is very powerful in today's &quot;new mainframe&quot; era.</em></p><p>It's no secret that I feel that we're in the era of the new mainframe (it never really went away) and the power of the command line and terminal based user interfaces are more relevant and powerful than ever (yes, <a href="https://twitter.com/search?q=%23TheFutureIsTerminal&amp;src=typed_query">#TheFutureIsTerminal</a>!).</p><p>Scripting is a much misunderstood discipline, and is a whole universe of languages, techniques, and contexts. But it's worth putting yourself on the learning path here, because it can be incredibly useful even for small tasks.</p><p>While preparing and researching for content for the recent episodes of my <a href="https://bit.ly/handsonsapdev">#HandsOnSAPDev live stream series</a>, particularly in the area of exploring the Business Rules service in the Cloud Foundry environment on the SAP Cloud Platform (see in particular the annotated links for episodes <a href="https://blogs.sap.com/2019/11/26/annotated-links-episode-44-of-hands-on-sap-dev-with-qmacro/">44</a> and <a href="https://blogs.sap.com/2020/01/02/annotated-links-episode-48-of-hands-on-sap-dev-with-qmacro/">48</a>), I decided to write a short script to help me recreate the Business Rules service and Editor facility ... I often clean out my environment, and sometimes even recreate my Cloud Foundry organisation and spaces, to clear cruft ready for the next live stream episode.</p><p>It was so easy to write, I thought I'd share it, and perhaps encourage you to stare at it for a few minutes over a coffee to see how it works. It's very specific, and does what I want it to do (there's no smarts in there, but I have written it to be re-runnable).</p><p>Here it is, warts and all:</p><pre class="language-shell"><code class="language-shell"><span class="token shebang important">#!/bin/bash</span><br><br><span class="token comment"># Prerequisites:</span><br><span class="token comment"># - Cloud Foundry trial account on SAP Cloud Platform with </span><br><span class="token comment">#   entitlement for Business Rules service and application runtime</span><br><span class="token comment"># - Build tool 'mbt' installed globally</span><br><span class="token comment"># - cf CLI installed with the 'multiapps' plugin installed</span><br><span class="token comment"># - cf CLI already authenticated against the CF endpoint</span><br><br><span class="token comment"># Recommended:</span><br><span class="token comment"># - Role collection containing RuleRepositorySuperUser and</span><br><span class="token comment">#   RuleRuntimeSuperUser assigned tothe trial account user</span><br><br><br><span class="token comment"># Show current CF target</span><br><span class="token builtin class-name">echo</span> Deploying to:<br>cf target<br><br><span class="token comment"># Create an instance of the service, with the free 'lite' service plan, called businessrules</span><br><span class="token comment"># (reason for the name is because that's how it's referred to in the mta.yaml to come). If the</span><br><span class="token comment"># service instance 'businessrules' already exists it won't be re-created.</span><br>cf create-service business-rules lite businessrules<br><br><span class="token comment"># Download the project containing the multi target application descriptor for the rules editor</span><br><span class="token comment"># (see https://bit.ly/handsonsapdev#ep44 for background).</span><br><span class="token function">rm</span> <span class="token parameter variable">-rf</span> archive.zip editor/<br><span class="token function">curl</span> <span class="token parameter variable">-o</span> archive.zip <span class="token parameter variable">-s</span> https://raw.githubusercontent.com/SAP-samples/cloud-businessrules-samples/master/cf-apps/cf-businessruleseditor.zip<br><span class="token function">unzip</span> <span class="token parameter variable">-q</span> <span class="token parameter variable">-d</span> editor ./archive.zip<br><br><span class="token comment"># Kick off the build - this should produce an archive in mta_archives/ directory.</span><br><span class="token builtin class-name">cd</span> editor/<br>mbt build<br><br><span class="token comment"># Deploy the archive</span><br>cf deploy mta_archives/businessruleseditor_0.0.1.mtar</code></pre><p>Here's a brief description of each of the sections:</p><p>I use the <code>cf target</code> command to show the current Cloud Foundry target that my cf CLI tools is pointing to.</p><p>With the <code>cf create-service</code> command I create an instance of the 'business-rules' service, using the 'lite' service plan. Note that if an instance with this name exists already, another won't be created.</p><p>I grab the archive containing the <code>mta.yaml</code> file that describes the Business Rules Editor multi target application (it's <a href="https://github.com/SAP-samples/cloud-businessrules-samples/">available on GitHub</a>), and then unzip it into a new directory <code>editor/</code>.</p><p>Before deploying this Editor it needs to be built, so that's next - within the <code>editor/</code> directory I use the <a href="https://sap.github.io/cloud-mta-build-tool/">SAP Cloud MTA Build Tool</a> <code>mbt</code> to do this.</p><p>The result of a successful build is that an <code>mtar</code> archive file will be created in a new directory <code>mta_archives/</code> - this archive file contains everything that should be pushed up to the Cloud Foundry environment, and I do this with the <code>cf deploy</code> command.</p><p>That's pretty much it - it works very well for me, doing 80% of what I need, for 20% of the effort (I spent around 15 mins writing it).</p><p>In case you're interested, here's some sample output, so you can get a feel for how it runs.</p><pre class="language-shell"><code class="language-shell">qmacro@penguin:~/local/projects/github.com/qmacro/handsonsapdev/episodes/ep51<br>-<span class="token operator">></span> ./rules.bash<br>Deploying to:<br>api endpoint:   https://api.cf.eu10.hana.ondemand.com<br>api version:    <span class="token number">2.144</span>.0<br>user:           dj.adams<br>org:            I347491trial_qmacrosubdomain<br>space:          dev<br>Creating <span class="token function">service</span> instance businessrules <span class="token keyword">in</span> org I347491trial_qmacrosubdomain / space dev as dj.adams@sap.com<span class="token punctuation">..</span>.<br>OK<br><br>Service businessrules already exists<br><span class="token punctuation">[</span><span class="token number">2020</span>-01-28 <span class="token number">12</span>:09:52<span class="token punctuation">]</span>  INFO Cloud MTA Build Tool version <span class="token number">1.0</span>.8<br><span class="token punctuation">[</span><span class="token number">2020</span>-01-28 <span class="token number">12</span>:09:52<span class="token punctuation">]</span>  INFO generating the <span class="token string">"Makefile_20200128120952.mta"</span> file<span class="token punctuation">..</span>.<br><span class="token punctuation">[</span><span class="token number">2020</span>-01-28 <span class="token number">12</span>:09:52<span class="token punctuation">]</span>  INFO <span class="token keyword">done</span><br><span class="token punctuation">[</span><span class="token number">2020</span>-01-28 <span class="token number">12</span>:09:52<span class="token punctuation">]</span>  INFO executing the <span class="token string">"make -f Makefile_20200128120952.mta p=cf mtar= strict=true mode="</span> command<span class="token punctuation">..</span>.<br><span class="token punctuation">[</span><span class="token number">2020</span>-01-28 <span class="token number">12</span>:09:52<span class="token punctuation">]</span>  INFO validating the MTA project<br><span class="token punctuation">[</span><span class="token number">2020</span>-01-28 <span class="token number">12</span>:09:52<span class="token punctuation">]</span>  INFO validating the MTA project<br><span class="token punctuation">[</span><span class="token number">2020</span>-01-28 <span class="token number">12</span>:09:52<span class="token punctuation">]</span>  INFO building the <span class="token string">"businessruleseditor_appRouter"</span> module<span class="token punctuation">..</span>.<br><span class="token punctuation">[</span><span class="token number">2020</span>-01-28 <span class="token number">12</span>:09:52<span class="token punctuation">]</span>  INFO executing the <span class="token string">"npm install --production"</span> command<span class="token punctuation">..</span>.<br><span class="token punctuation">..</span><span class="token punctuation">..</span>.npm WARN deprecated scmp@1.0.0: scmp v2 uses improved core crypto comparison since Node v6.6.0<br><span class="token punctuation">..</span><span class="token punctuation">..</span>.<br><span class="token operator">></span> @sap/node-jwt@1.6.5 <span class="token function">install</span> /home/qmacro/local/projects/github.com/qmacro/handsonsapdev/episodes/ep51/editor/businessruleseditor_appRouter/node_modules/@sap/node-jwt<br><span class="token operator">></span> <span class="token function">node</span> ./build.js<br><br><span class="token variable"><span class="token variable">`</span>linux-x64-v8-6.8<span class="token variable">`</span></span> exists<span class="token punctuation">;</span> testing<br>Binary is fine<span class="token punctuation">;</span> exiting<br><span class="token function">npm</span> notice created a lockfile as package-lock.json. You should commit this file.<br><span class="token function">npm</span> WARN html5-apps-approuter@ No repository field.<br><span class="token function">npm</span> WARN html5-apps-approuter@ No license field.<br><br>added <span class="token number">236</span> packages from <span class="token number">133</span> contributors and audited <span class="token number">407</span> packages <span class="token keyword">in</span> <span class="token number">10</span>.319s<br>found <span class="token number">5</span> high severity vulnerabilities<br>  run <span class="token variable"><span class="token variable">`</span><span class="token function">npm</span> audit fix<span class="token variable">`</span></span> to fix them, or <span class="token variable"><span class="token variable">`</span><span class="token function">npm</span> audit<span class="token variable">`</span></span> <span class="token keyword">for</span> details<br><span class="token punctuation">[</span><span class="token number">2020</span>-01-28 <span class="token number">12</span>:10:03<span class="token punctuation">]</span>  INFO the build results of the <span class="token string">"businessruleseditor_appRouter"</span> modulewill be packed and saved <span class="token keyword">in</span> the <span class="token string">"/home/qmacro/local/projects/github.com/qmacro/handsonsapdev/episodes/ep51/editor/.editor_mta_build_tmp/businessruleseditor_appRouter"</span> folder<br><span class="token punctuation">[</span><span class="token number">2020</span>-01-28 <span class="token number">12</span>:10:04<span class="token punctuation">]</span>  INFO finished building the <span class="token string">"businessruleseditor_appRouter"</span> module<br><span class="token punctuation">[</span><span class="token number">2020</span>-01-28 <span class="token number">12</span>:10:04<span class="token punctuation">]</span>  INFO generating the metadata<span class="token punctuation">..</span>.<br><span class="token punctuation">[</span><span class="token number">2020</span>-01-28 <span class="token number">12</span>:10:04<span class="token punctuation">]</span>  INFO generating the MTA archive<span class="token punctuation">..</span>.<br><span class="token punctuation">[</span><span class="token number">2020</span>-01-28 <span class="token number">12</span>:10:05<span class="token punctuation">]</span>  INFO the MTA archive generated at: /home/qmacro/local/projects/github.com/qmacro/handsonsapdev/episodes/ep51/editor/mta_archives/businessruleseditor_0.0.1.mtar<br><span class="token punctuation">[</span><span class="token number">2020</span>-01-28 <span class="token number">12</span>:10:05<span class="token punctuation">]</span>  INFO cleaning temporary files<span class="token punctuation">..</span>.<br>Deploying multi-target app archive mta_archives/businessruleseditor_0.0.1.mtar <span class="token keyword">in</span> org I347491trial_qmacrosubdomain / space dev as dj.adams@sap.com<span class="token punctuation">..</span>.<br><br>Uploading <span class="token number">1</span> files<span class="token punctuation">..</span>.<br>  /home/qmacro/local/projects/github.com/qmacro/handsonsapdev/episodes/ep51/editor/mta_archives/businessruleseditor_0.0.1.mtar<br>OK<br>Deploying <span class="token keyword">in</span> org <span class="token string">"I347491trial_qmacrosubdomain"</span> and space <span class="token string">"dev"</span><br>Detected MTA schema version: <span class="token string">"3"</span><br>Detected deployed MTA with ID <span class="token string">"businessruleseditor"</span> and version <span class="token string">"0.0.1"</span><br>Detected new MTA version: <span class="token string">"0.0.1"</span><br>Deployed MTA version: <span class="token string">"0.0.1"</span><br>Processing <span class="token function">service</span> <span class="token string">"businessruleseditor_html5_repo_runtime"</span><span class="token punctuation">..</span>.<br>Processing <span class="token function">service</span> <span class="token string">"businessrules_uaa"</span><span class="token punctuation">..</span>.<br>Updating <span class="token function">service</span> <span class="token string">"businessrules_uaa"</span><span class="token punctuation">..</span>.<br>Updating application <span class="token string">"businessruleseditor_appRouter"</span><span class="token punctuation">..</span>.<br>Application <span class="token string">"businessruleseditor_appRouter"</span> attributes are not modified and will not be updated<br>Uploading application <span class="token string">"businessruleseditor_appRouter"</span><span class="token punctuation">..</span>.<br>Stopping application <span class="token string">"businessruleseditor_appRouter"</span><span class="token punctuation">..</span>.<br>Staging application <span class="token string">"businessruleseditor_appRouter"</span><span class="token punctuation">..</span>.<br>Application <span class="token string">"businessruleseditor_appRouter"</span> staged<br>Starting application <span class="token string">"businessruleseditor_appRouter"</span><span class="token punctuation">..</span>.<br>Application <span class="token string">"businessruleseditor_appRouter"</span> started and available at <span class="token string">"i347491trial-qmacrosubdomain-dev-businessruleseditor-approuter.cfapps.eu10.hana.ondemand.com"</span><br>Deleting discontinued configuration entries <span class="token keyword">for</span> application <span class="token string">"businessruleseditor_appRouter"</span><span class="token punctuation">..</span>.<br>Skipping deletion of services, because the <span class="token builtin class-name">command</span> line option <span class="token string">"--delete-services"</span> is not specified.<br>Process finished.<br>Use <span class="token string">"cf dmol -i 25e31dd8-41c7-11ea-a559-eeee0a8615fb"</span> to download the logs of the process.</code></pre><p>This results in what I'm looking for, which is the Business Rules Editor application and the service instances that support it - all described by the <code>mta.yaml</code> file mentioned earlier.</p><p><img src="/images/2020/01/Screenshot-2020-01-28-at-12.23.47.png" alt=""></p><p><img src="/images/2020/01/Screenshot-2020-01-28-at-12.23.37.png" alt=""></p><p>What have you automated with simple scripts? Let us know in the comments below. And happy scripting!</p><p>For more thoughts on mainframes today, see the following posts:</p><ul><li><a href="/blog/posts/2018/08/06/monday-morning-thoughts:-mainframes-and-message-documentation/">Monday morning thoughts: mainframes and message documentation</a></li><li><a href="/blog/posts/2018/04/16/monday-morning-thoughts:-upload-download-in-a-cloud-native-world/">Monday morning thoughts: upload / download in a cloud native world</a></li><li><a href="/blog/posts/2009/09/09/mainframes-and-the-cloud-everything-old-is-new-again/">Mainframes and the cloud - everything old is new again</a></li></ul><hr><p><a href="https://community.sap.com/t5/technology-blogs-by-sap/scripting-cloud-foundry-activities-in-trial/ba-p/13438137">Originally published on SAP Community</a></p></main><aside class="post__aside"><div class="post__tags"><a href="/tags/sapcommunity/">#sapcommunity</a> <a href="/tags/shell/">#shell</a> <a href="/tags/cloudfoundry/">#cloudfoundry</a> <a href="/tags/businessrules/">#businessrules</a> <a href="/tags/mainframes/">#mainframes</a></div><style>.utterances {
  margin-left: inherit !important;
}</style><script src="https://utteranc.es/client.js" repo="qmacro/qmacro.github.io" issue-term="title" crossorigin="anonymous" async></script><nav class="post__pagination"><a href="/blog/posts/2020/01/29/mini-adventures-with-mtas-and-the-cloud-foundry-cli/"><span>←</span> <span>Mini adventures with MTAs and the Cloud Foundry CLI</span> </a><a href="/blog/posts/2020/01/12/my-learning-list-for-2020/"><span>My learning list for 2020</span> <span>→</span></a></nav></aside></article></main><footer class="footer"><div class="footer__content"><ul class="hero__social-links"><li><a rel="me" href="https://github.com/qmacro" target="_blank" rel="noopener noreferrer">GitHub</a></li><li><a rel="me" href="https://www.youtube.com/djadams-qmacro" target="_blank" rel="noopener noreferrer">YouTube</a></li><li><a rel="me" href="https://www.linkedin.com/in/djadams/" target="_blank" rel="noopener noreferrer">LinkedIn</a></li><li><a rel="me" href="/tweets/">Tweet Archive</a></li><li><a rel="me" href="https://hachyderm.io/@qmacro" target="_blank" rel="noopener noreferrer">Mastodon</a></li><li><a rel="me" href="https://bsky.app/profile/qmacro.org" target="_blank" rel="noopener noreferrer">Bluesky</a></li><li><a href="/feed.xml" target="_blank" rel="noopener noreferrer">RSS</a></li></ul></div></footer></div><script src="/assets/main.31d6cfe0d16ae931b73c.js"></script></body></html>