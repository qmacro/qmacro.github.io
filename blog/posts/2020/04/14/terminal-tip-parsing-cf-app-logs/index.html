<!doctype html>
<html lang="en">
	<head>
		<meta charset="utf-8">
		<meta name="viewport" content="width=device-width, initial-scale=1.0">
		<title>Terminal Tip: parsing CF app logs</title>
		<meta name="description" content="Reserving the right to be wrong.">
		<link rel="alternate" href="/feed/feed.xml" type="application/atom+xml" title="DJ Adams">
		<link rel="icon" type="image/x-icon" href="/images/favicon.ico">

      <meta property="og:title" content="Terminal Tip: parsing CF app logs">
        <meta property="og:site_name" content="DJ Adams">
          <meta property="og:image" content="/images/site-image.png">
        <meta property="og:description" content="Reserving the right to be wrong.">
        <meta property="og:url" content="https://qmacro.org/blog/posts/2020/04/14/terminal-tip-parsing-cf-app-logs/">
		
		
		
		<style>/* This is an arbitrary CSS string added to the bundle */
/* Defaults */
:root {
	--font-family: -apple-system, system-ui, sans-serif;
	--font-family-monospace: Consolas, Menlo, Monaco, Andale Mono WT, Andale Mono, Lucida Console, Lucida Sans Typewriter, DejaVu Sans Mono, Bitstream Vera Sans Mono, Liberation Mono, Nimbus Mono L, Courier New, Courier, monospace;
}

/* Theme colors */
:root {
	--color-gray-20: #e0e0e0;
	--color-gray-50: #C0C0C0;
	--color-gray-90: #333;

	--background-color: #fff;

	--text-color: var(--color-gray-90);
	--text-color-link: #2884d2;
	--text-color-link-active: #15b0ed;
	--text-color-link-visited: #9f4199;

	--syntax-tab-size: 2;
}

@media (prefers-color-scheme: dark) {
	:root {
		--color-gray-20: #e0e0e0;
		--color-gray-50: #C0C0C0;
		--color-gray-90: #dad8d8;

		/* --text-color is assigned to --color-gray-_ above */
		--text-color-link: #1493fb;
		--text-color-link-active: #6969f7;
		--text-color-link-visited: #a6a6f8;

		--background-color: #15202b;
	}
}


/* Global stylesheet */
* {
	box-sizing: border-box;
}

@view-transition {
	navigation: auto;
}

html,
body {
	padding: 0;
	margin: 0 auto;
	font-family: var(--font-family);
	color: var(--text-color);
	background-color: var(--background-color);
}
html {
	overflow-y: scroll;
}
body {
	max-width: 40em;
}

/* https://www.a11yproject.com/posts/how-to-hide-content/ */
.visually-hidden:not(:focus):not(:active) {
	clip: rect(0 0 0 0);
	clip-path: inset(50%);
	height: 1px;
	overflow: hidden;
	position: absolute;
	white-space: nowrap;
	width: 1px;
}

/* Fluid images via https://www.zachleat.com/web/fluid-images/ */
img{
  max-width: 100%;
}
img[width][height] {
  height: auto;
}
img[src$=".svg"] {
  width: 100%;
  height: auto;
  max-width: none;
}
video,
iframe {
	width: 100%;
	height: auto;
}
iframe {
	aspect-ratio: 16/9;
}

p:last-child {
	margin-bottom: 0;
}
p {
	line-height: 1.5;
}

li {
	line-height: 1.5;
}

a[href] {
	color: var(--text-color-link);
}
a[href]:visited {
	color: var(--text-color-link-visited);
}
a[href]:hover,
a[href]:active {
	color: var(--text-color-link-active);
}

main,
footer {
	padding: 1rem;
}
/* main :first-child { */
/* 	margin-top: 0; */
/* } */

header {
	border-bottom: 1px dashed var(--color-gray-20);
}

#skip-link {
	text-decoration: none;
	background: var(--background-color);
	color: var(--text-color);
	padding: 0.5rem 1rem;
	border: 1px solid var(--color-gray-90);
	border-radius: 2px;
}

/* Prevent visually-hidden skip link fom pushing content around when focused */
#skip-link.visually-hidden:focus {
	position: absolute;
	top: 1rem;
	left: 1rem;
	/* Ensure it is positioned on top of everything else when it is shown */
	z-index: 999;
}

.links-nextprev {
	display: flex;
	justify-content: space-between;
	gap: .5em 1em;
	list-style: "";
	border-top: 1px dashed var(--color-gray-20);
	padding: 1em 0;
}
.links-nextprev > * {
	flex-grow: 1;
}
.links-nextprev-next {
	text-align: right;
}

table {
	margin: 1em 0;
}
table td,
table th {
	padding-right: 1em;
}

pre,
code {
	font-family: var(--font-family-monospace);
	color: seagreen;
}

pre,code[class*="language-"] {
	line-height: 1.2em !important;
	font-size: 0.93em !important;
}

pre:not([class*="language-"]) {
	margin: .5em 0;
	line-height: 1.375; /* 22px /16 */
	-moz-tab-size: var(--syntax-tab-size);
	-o-tab-size: var(--syntax-tab-size);
	tab-size: var(--syntax-tab-size);
	-webkit-hyphens: none;
	-ms-hyphens: none;
	hyphens: none;
	direction: ltr;
	text-align: left;
	white-space: pre;
	word-spacing: normal;
	word-break: normal;
	overflow-x: auto;
}
code {
	word-break: break-all;
}

/* Header */
header {
	display: flex;
	gap: 1em;
	flex-wrap: wrap;
	justify-content: space-between;
	align-items: center;
	padding: 1em;
}
.home-link {
	flex-grow: 1;
	font-size: 1em; /* 16px /16 */
	font-weight: 700;
}
.home-link:link:not(:hover) {
	text-decoration: none;
}

/* Nav */
.nav {
	display: flex;
	gap: .5em 1em;
	padding: 0;
	margin: 0;
	list-style: none;
}
.nav-item {
	display: inline-block;
}
.nav-item a[href]:not(:hover) {
	text-decoration: none;
}
.nav a[href][aria-current="page"] {
	text-decoration: underline;
}

/* Posts list */
.postlist {
	counter-reset: start-from var(--postlist-index);
	list-style: none;
	padding: 0;
}
.postlist-item {
	display: flex;
	flex-wrap: wrap;
	align-items: baseline;
	counter-increment: start-from -1;
	margin-bottom: 1em;
}
.postlist-item:before {
	display: inline-block;
	pointer-events: none;
	line-height: 100%;
	text-align: right;
	margin-left: -1.5rem;
}
.postlist-date,
.postlist-item:before {
	font-size: 0.8125em; /* 13px /16 */
	color: var(--color-gray-90);
}
.postlist-date {
	word-spacing: -0.5px;
}
.postlist-link {
	font-size: 1.1875em; /* 19px /16 */
	font-weight: 700;
	flex-basis: calc(100% - 1.5rem);
	text-underline-position: from-font;
	text-underline-offset: 0;
	text-decoration-thickness: 1px;
}
.postlist-item-active .postlist-link {
	font-weight: bold;
}

/* Tags */
.post-tag {
	display: inline-flex;
	align-items: center;
	justify-content: center;
	font-style: italic;
}

/* may want to make the description text smaller at some stage */
.post-description-list {
	font-size: 1.0em;
}

.post-description-main {
	font-style: italic;
}

.postlist-item > .post-tag {
	align-self: center;
}

/* Tags list */
.post-metadata {
	display: inline-flex;
	flex-wrap: wrap;
	gap: .5em;
	list-style: none;
	padding: 0;
	margin: 0;
}
.post-metadata time {
	margin-right: 1em;
}

blockquote {
	margin-top: 0px;
	margin-left: 0px;
	margin-bottom: 15px;
	padding-left: 15px;
	border-left: 5px solid lightgray;
}
/**
 * prism.js default theme for JavaScript, CSS and HTML
 * Based on dabblet (http://dabblet.com)
 * @author Lea Verou
 */

code[class*="language-"],
pre[class*="language-"] {
	color: black;
	background: none;
	text-shadow: 0 1px white;
	font-family: Consolas, Monaco, 'Andale Mono', 'Ubuntu Mono', monospace;
	font-size: 1em;
	text-align: left;
	white-space: pre;
	word-spacing: normal;
	word-break: normal;
	word-wrap: normal;
	line-height: 1.5;

	-moz-tab-size: 4;
	-o-tab-size: 4;
	tab-size: 4;

	-webkit-hyphens: none;
	-moz-hyphens: none;
	-ms-hyphens: none;
	hyphens: none;
}

pre[class*="language-"]::-moz-selection, pre[class*="language-"] ::-moz-selection,
code[class*="language-"]::-moz-selection, code[class*="language-"] ::-moz-selection {
	text-shadow: none;
	background: #b3d4fc;
}

pre[class*="language-"]::selection, pre[class*="language-"] ::selection,
code[class*="language-"]::selection, code[class*="language-"] ::selection {
	text-shadow: none;
	background: #b3d4fc;
}

@media print {
	code[class*="language-"],
	pre[class*="language-"] {
		text-shadow: none;
	}
}

/* Code blocks */
pre[class*="language-"] {
	padding: 1em;
	margin: .5em 0;
	overflow: auto;
}

:not(pre) > code[class*="language-"],
pre[class*="language-"] {
	background: #f5f2f0;
}

/* Inline code */
:not(pre) > code[class*="language-"] {
	padding: .1em;
	border-radius: .3em;
	white-space: normal;
}

.token.comment,
.token.prolog,
.token.doctype,
.token.cdata {
	color: slategray;
}

.token.punctuation {
	color: #999;
}

.token.namespace {
	opacity: .7;
}

.token.property,
.token.tag,
.token.boolean,
.token.number,
.token.constant,
.token.symbol,
.token.deleted {
	color: #905;
}

.token.selector,
.token.attr-name,
.token.string,
.token.char,
.token.builtin,
.token.inserted {
	color: #690;
}

.token.operator,
.token.entity,
.token.url,
.language-css .token.string,
.style .token.string {
	color: #9a6e3a;
	/* This background color was intended by the author of this theme. */
	background: hsla(0, 0%, 100%, .5);
}

.token.atrule,
.token.attr-value,
.token.keyword {
	color: #07a;
}

.token.function,
.token.class-name {
	color: #DD4A68;
}

.token.regex,
.token.important,
.token.variable {
	color: #e90;
}

.token.important,
.token.bold {
	font-weight: bold;
}
.token.italic {
	font-style: italic;
}

.token.entity {
	cursor: help;
}
/*
 * New diff- syntax
 */

pre[class*="language-diff-"] {
	--eleventy-code-padding: 1.25em;
	padding-left: var(--eleventy-code-padding);
	padding-right: var(--eleventy-code-padding);
}
.token.deleted {
	background-color: hsl(0, 51%, 37%);
	color: inherit;
}
.token.inserted {
	background-color: hsl(126, 31%, 39%);
	color: inherit;
}

/* Make the + and - characters unselectable for copy/paste */
.token.prefix.unchanged,
.token.prefix.inserted,
.token.prefix.deleted {
	-webkit-user-select: none;
	user-select: none;
	display: inline-flex;
	align-items: center;
	justify-content: center;
	padding-top: 2px;
	padding-bottom: 2px;
}
.token.prefix.inserted,
.token.prefix.deleted {
	width: var(--eleventy-code-padding);
	background-color: rgba(0,0,0,.2);
}

/* Optional: full-width background color */
.token.inserted:not(.prefix),
.token.deleted:not(.prefix) {
	display: block;
	margin-left: calc(-1 * var(--eleventy-code-padding));
	margin-right: calc(-1 * var(--eleventy-code-padding));
	text-decoration: none; /* override del, ins, mark defaults */
	color: inherit; /* override del, ins, mark defaults */
}
.utterances {
  margin-left: inherit !important;
}</style>
		

    <!-- Global site tag (gtag.js) - Google Analytics -->
    <script async="" src="https://www.googletagmanager.com/gtag/js?id=G-4WQKBG0L4Y"></script>
    

	</head>
	<body>
		<a href="#main" id="skip-link" class="visually-hidden">Skip to main content</a>

		<header>
			<a href="/" class="home-link">DJ Adams</a>
			<nav>
				<h2 class="visually-hidden" id="top-level-navigation-menu">Top level navigation menu</h2>
				<ul class="nav">
					<li class="nav-item"><a href="/">Home</a></li>
					<li class="nav-item"><a href="/about/">About</a></li>
					<li class="nav-item"><a href="/blog/">Blog</a></li>
					<li class="nav-item"><a href="/feed/feed.xml">Feed</a></li>
				</ul>
			</nav>
		</header>

		<main id="main">
			<heading-anchors>
				


<h1 id="terminal-tip-parsing-cf-app-logs">Terminal Tip: parsing CF app logs</h1>

<ul class="post-metadata">
	<li><time datetime="2020-04-14">14 April 2020</time></li>
	<li><a href="/tags/sapcommunity/" class="post-tag">sapcommunity</a>, </li>
	<li><a href="/tags/terminal/" class="post-tag">terminal</a>, </li>
	<li><a href="/tags/terminaltip/" class="post-tag">terminaltip</a></li>
</ul>

<p class="post-description-main"></p>

<p>Further to my last <a href="/blog/posts/2020/04/07/terminal-tip:-truncating-cf-output/">Terminal Tip on truncating CF
output</a>
I have another terminal tip for you that might help in the context of
reading log output from Cloud Foundry (CF) apps.</p>
<p><a href="https://docs.cloudfoundry.org/devguide/deploy-apps/streaming-logs.html">Application logging on
CF</a>
can be quite involved, and there's all sorts of useful information for
diagnostics and monitoring purposes. If you're just starting out using
the CF environment on SAP Cloud Platform, you might however be
overwhelmed, rather than overjoyed, at the amount of information and how
it's presented.</p>
<p>You can monitor the logs of an app on CF with the following command:</p>
<pre class="language-shell" tabindex="0"><code class="language-shell">cf logs <span class="token operator">&lt;</span>appname<span class="token operator">></span></code></pre>
<p>Here's a screenshot of the sort of thing you might see from this
command, at the startup of an app:</p>
<p><img src="/images/2020/04/Screenshot-2020-04-14-at-07.05.31.png" alt=""></p>
<p>I cut my commercial programming teeth working at Esso Petroleum in
London on IBM big iron - mainframes running MVS/ESA, upon which we ran
SAP R/2 systems with IMS DB/DC. While that was a rather proprietary OS
environment, it did leave many lasting positive impressions, one of
which was: logging is important and should be consistent, <a href="/blog/posts/2009/11/05/tech-skills-chat-with-jonerp-a-follow-on-story/#documentation">easily
referenced</a>,
and readable.</p>
<p>Just focusing on the last quality - readability - this log output may be
readable by machines, but if you ask me, it should be readable by humans
first, and machines second.</p>
<p>If you stare for a few seconds at the log output in the screenshot
above, you may discern that it's in the form of JSON (!), and produced
for the &quot;APP/PROC/WEB&quot; context. I've found myself interested in
knowing what's going on in this context, so I turned to my terminal,
and some venerable commands, to make this readable for humans too.</p>
<p>Like in the previous <a href="/blog/posts/2020/04/07/terminal-tip:-truncating-cf-output/">Terminal
Tip</a>,
I found myself creating a shell function &quot;lintlogs&quot; that I could pipe
the output of the cf logs command into, to parse and format it nicely.</p>
<p>Because, effectively, all I'm interested in here is a timestamp for
each log record, and the text details of what happened. Taking the last
log record from the above screenshot as an example, all I want is
something like this:</p>
<pre class="language-log" tabindex="0"><code class="language-log"><span class="token date number">2020-04-14T</span><span class="token time number">07:15:22.102Z</span> Application router is listening on port<span class="token operator">:</span> <span class="token number">8080</span></code></pre>
<p>So, here's what was involved. First, let's take a look at the
definition of the &quot;lintlogs&quot; function (printed here over separate
lines for readability):</p>
<pre class="language-shell" tabindex="0"><code class="language-shell"><span class="token function-name function">lintlogs</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> 
  <span class="token function">grep</span> --line-buffered <span class="token string">'OUT {'</span> 
  <span class="token operator">|</span> stdbuf <span class="token parameter variable">-oL</span> <span class="token function">cut</span> <span class="token parameter variable">-d</span> <span class="token string">' '</span> <span class="token parameter variable">-f</span> <span class="token number">7</span>- 
  <span class="token operator">|</span> jq <span class="token parameter variable">-r</span> <span class="token string">'.written_at + " " + .msg'</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre>
<p>First, remember that you define a shell function like this:</p>
<pre class="language-shell" tabindex="0"><code class="language-shell"><span class="token function-name function">functionname</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token punctuation">..</span>. <span class="token punctuation">;</span> <span class="token punctuation">}</span></code></pre>
<p>Once it's defined, you can treat it like any other command in the
shell, in particular in pipeline processing, i.e. you can pass data to
it via STDIO as normal. That means you can pipe the output of one
command and have it be the input to this function. That's exactly
what's going on here (in the screenshot):</p>
<pre class="language-shell" tabindex="0"><code class="language-shell">cf logs desttest <span class="token operator">|</span> lintlogs</code></pre>
<p>Now that's clear, let's take the function definition, one command at a
time.</p>
<pre class="language-shell" tabindex="0"><code class="language-shell"><span class="token function">grep</span> --line-buffered <span class="token string">'OUT {'</span></code></pre>
<p>Here, we're using the standard
<a href="https://en.wikipedia.org/wiki/Grep">grep</a> command to search for string
patterns in the input, in this case, we're looking for this highlighted
section of the log lines:</p>
<p><img src="/images/2020/04/Screenshot-2020-04-14-at-08.15.54.png" alt=""></p>
<p>This is a crude but good-enough way to identify this type of log output.</p>
<p>The --line-buffered option for grep turns on line buffering on output,
and is essential here so that the streaming output from cf logs makes
its way all the way through the pipeline to the end (data would normally
be buffered more for performance reasons, but we don't want that here,
we want each line to be sent as it arrives).</p>
<p>Now we pipe (|) the lines found by the grep command into the
following:</p>
<pre class="language-shell" tabindex="0"><code class="language-shell">stdbuf <span class="token parameter variable">-oL</span> <span class="token function">cut</span> <span class="token parameter variable">-d</span> <span class="token string">' '</span> <span class="token parameter variable">-f</span> <span class="token number">7</span>-</code></pre>
<p>This is actually two commands. The first is
<a href="https://linux.die.net/man/1/stdbuf">stdbuf</a>, which gives us the ability
to control STDIO stream buffering for other commands, in this case for
the command that follows it, i.e.
<a href="https://en.wikipedia.org/wiki/Cut_(Unix)">cut</a>. The option -oL sets the
standard output stream (STDOUT) buffering to line level buffering, the
same as what --line-buffered did for grep.</p>
<p>We've seen the use of <a href="https://en.wikipedia.org/wiki/Cut_(Unix)">cut</a>
in the previous Terminal Tip; here, we're saying, with the -d ' '
option, that the delimiter (separator) upon which cut should base its
slicing, is a space character. And then, given that we're separating on
spaces, with the -f 7- option, we're saying that we want the seventh
and subsequent fields, all the way to the end. The effect of this is
that we'll just get the JSON output. If you're wondering about why the
value 7 is required, look at the raw log output and how untidy it is:</p>
<pre class="language-log" tabindex="0"><code class="language-log"><span class="token date number">2020-04-14T</span><span class="token time number">08:15:21.60+0100</span> <span class="token punctuation">[</span>APP<span class="token operator">/</span>PROC<span class="token operator">/</span>WEB<span class="token operator">/</span><span class="token number">0</span><span class="token punctuation">]</span> OUT <span class="token operator">{</span><span class="token string">"written_at"</span><span class="token operator">:</span><span class="token punctuation">[</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">]</span></code></pre>
<p>There are actually three spaces at the start of the log line, meaning
that this part:</p>
<pre class="language-log" tabindex="0"><code class="language-log"><span class="token operator">{</span><span class="token string">"written_at"</span><span class="token operator">:</span><span class="token punctuation">[</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">]</span></code></pre>
<p>will be the seventh field, when separated by spaces.</p>
<p>Now we have the JSON only, we can pass it into our friend
<a href="https://stedolan.github.io/jq/">jq</a>, the command line JSON processor:</p>
<pre class="language-shell" tabindex="0"><code class="language-shell">jq <span class="token parameter variable">-r</span> <span class="token string">'.written_at + " " + .msg'</span></code></pre>
<p>Here we request just the value of the 'written_at' and 'msg'
properties, separated by a space. The -r option gets jq to give us raw
(i.e. unformatted) output.</p>
<p>Putting this altogether into the 'lintlogs' function, I can now
monitor apps in CF more comfortably. Here's what the same log lines
look like now when we pipe the output of cf logs desttest into the
lintlogs function:</p>
<p><img src="/images/2020/04/Screenshot-2020-04-14-at-08.01.21.png" alt=""></p>
<p>Much better, no?</p>
<p>You can see the definition and use of this function, and its inaugural
naming, in the <a href="https://bit.ly/handsonsapdev#ep63">#HandsOnSAPDev live
stream episode 63</a> &quot;Tracing the
OAuth 2.0 Authorisation Code grant type with approuter and CF&quot;.</p>
<p>Share &amp; enjoy, and
remember, <a href="https://twitter.com/search?q=%23TheFutureIsTerminal&amp;src=typed_query">#TheFutureIsTerminal</a>!</p>
<hr>
<p><a href="https://community.sap.com/t5/technology-blogs-by-sap/terminal-tip-parsing-cf-app-logs/ba-p/13436028">Originally published on SAP Community</a></p>



<script src="https://utteranc.es/client.js" repo="qmacro/qmacro.github.io" issue-term="title" crossorigin="anonymous" async=""></script>

<ul class="links-nextprev"><li class="links-nextprev-prev">← Previous<br> <a href="/blog/posts/2020/04/07/terminal-tip-truncating-cf-output/">Terminal Tip: truncating CF output</a></li><li class="links-nextprev-next">Next →<br><a href="/blog/posts/2020/04/23/terminal-tip-switching-cf-targets/">Terminal Tip: switching CF targets</a></li>
</ul>

			</heading-anchors>
		</main>

		<!-- This page `/blog/posts/2020/04/14/terminal-tip-parsing-cf-app-logs/` was built on 2026-01-01T11:07:44.153Z -->
		<script type="module" src="/dist/t-8sxMV3B9.js"></script>
	</body>
</html>
