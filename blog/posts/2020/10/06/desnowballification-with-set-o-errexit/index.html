<!doctype html><html lang="en"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1"><link rel="canonical" href="https://qmacro.org/blog/posts/2020/10/06/desnowballification-with-set-o-errexit/"><link rel="alternate" type="application/atom+xml" title="DJ's Weblog - Feed" href="https://qmacro.org/feed.xml"><link href="/assets/main.7884d8f8e9dd86c3b137.css" rel="stylesheet"><link rel="preconnect" href="https://fonts.gstatic.com"><link href="https://fonts.googleapis.com/css2?family=IBM+Plex+Sans&display=swap" rel="stylesheet"><title>Desnowballification with set -o errexit | DJ Adams</title><link rel="icon" type="“image/x-icon”" href="/images/favicon.ico"><meta property="og:title" content="Desnowballification with set -o errexit"><meta property="og:site_name" content="DJ Adams"><meta property="og:type" content="website"><meta property="og:url" content="https://qmacro.org/blog/posts/2020/10/06/desnowballification-with-set-o-errexit/"><meta name="description" content="Desnowballification with set -o errexit 06 Oct 2020 | 2 min read I&#39;ve started to use set -o errexit at the start of my scripts to make them..."><meta property="og:description" content="Desnowballification with set -o errexit 06 Oct 2020 | 2 min read I&#39;ve started to use set -o errexit at the start of my scripts to make them..."><meta name="description" content="Desnowballification with set -o errexit 06 Oct 2020 | 2 min read I&#39;ve started to use set -o errexit at the start of my scripts to make them..."><meta property="og:image" content="https://qmacro.org/images/site-image.png"><script src="https://cdn.jsdelivr.net/npm/mermaid/dist/mermaid.min.js"></script><script>mermaid.initialize({startOnLoad:true});</script><script async src="https://www.googletagmanager.com/gtag/js?id=G-4WQKBG0L4Y"></script><script>window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());

      gtag('config', 'G-4WQKBG0L4Y');</script></head><body><div class="layout-wrapper"><header class="header"><div class="header__content"><h1 class="site-title"><a href="/">DJ Adams</a></h1><nav class="nav"><ul class="nav__list"><li class="nav-item"><a href="/about">About Me</a></li><li class="nav-item"><a href="/blog">Blog</a></li><li class="nav-item"><a href="/feed.xml">Feed</a></li></ul></nav></div></header><main class="main"><article class="post"><header class="post__header"><h1>Desnowballification with set -o errexit</h1><div class="post__details"><time datetime="2020-10-06">06 Oct 2020 </time><span>| </span><span>2 min read</span></div></header><main class="post__content"><p><em>I've started to use <code>set -o errexit</code> at the start of my scripts to make them more robust.</em></p><p>There comes a time when you move from just hacking lines of shell script together into a file, to recognising that the file is now a script and that you want that script to run well, so you give it a little bit of help.</p><p>In a similar way to the <code>-w</code> flag for Perl scripts, or even perhaps the <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Strict_mode">strict mode</a> turned on in JavaScript files with <code>'use strict'</code>, there are flags that you can use for Bash scripts. A few weeks ago I read <a href="https://www.davidpashley.com/articles/writing-robust-shell-scripts/">Writing Robust Bash Shell Scripts</a> by David Pashley, and it taught me about a couple of flags:</p><table><thead><tr><th>Short form</th><th>Long form</th><th>Description</th></tr></thead><tbody><tr><td><code>set -e</code></td><td><code>set -o errexit</code></td><td>exit when a command fails</td></tr><tr><td><code>set -u</code></td><td><code>set -o nounset</code></td><td>exit when an undeclared variable is used</td></tr></tbody></table><p>There are short and long forms of these flags, as you can see. I would use the short forms on the command line, but prefer the long forms in scripts, because they're more readable (although the language nerd in me sees 'noun set' before 'no unset' in the latter). The <a href="https://google.github.io/styleguide/shellguide.html">Google Shell Style Guide</a>, to which I referred in <a href="https://qmacro.org/2020/10/05/improving-my-shell-scripting/">Improving my shell scripting</a> recently, also has something useful on using flags, in the <a href="https://google.github.io/styleguide/shellguide.html#which-shell-to-use">Which Shell to Use</a> section. It says that flags on the <a href="https://en.wikipedia.org/wiki/Shebang_(Unix)">hashbang</a> line (<code>#!/bin/bash</code>) should be used sparingly - in other words, they should be set with <code>set</code> on their own lines. The reason it gives, which makes sense, is that the script can then be run in the same way like this: <code>bash scriptname</code> (the hashbang is redundant in this case, along with any flags set on that line).</p><p>I honed in on <code>set -o errexit</code> as it seems to be a recommended standard and makes a lot of sense (although interestingly the Google Shell Style Guide makes no mention of it). This flag causes the script to be terminated if any statement returns a non-true value. As David put in his article, this &quot;prevents errors snowballing into serious issues when they could have been caught earlier&quot;.</p><p>As I was looking for further information on <code>set -o errexit</code> I came across another useful article <a href="https://kvz.io/bash-best-practices.html">Best Practices for Writing Bash Scripts</a> by Kev van Zonneveld - definitely worth a read, especially for other flags that are available (<code>xtrace</code> and <code>pipefail</code>).</p><p>So, I'm putting <code>set -o errexit</code> as one of the first lines in my Bash shell scripts. I notice that <a href="https://rwx.gg">Mr Rob</a> does the same (see his <a href="https://gitlab.com/rwxrob/dotfiles/-/blob/master/scripts/twitch#L3"><code>twitch</code> script</a> as an example). You should, too.</p></main><aside class="post__aside"><div class="post__tags"><a href="/tags/autodidactics/">#autodidactics</a> <a href="/tags/shell/">#shell</a></div><style>.utterances {
  margin-left: inherit !important;
}</style><script src="https://utteranc.es/client.js" repo="qmacro/qmacro.github.io" issue-term="title" crossorigin="anonymous" async></script><nav class="post__pagination"><a href="/blog/posts/2020/10/08/understanding-declare/"><span>←</span> <span>Understanding declare</span> </a><a href="/blog/posts/2020/10/05/improving-my-shell-scripting/"><span>Improving my shell scripting</span> <span>→</span></a></nav></aside></article></main><footer class="footer"><div class="footer__content"><ul class="hero__social-links"><li><a rel="me" href="https://github.com/qmacro" target="_blank" rel="noopener noreferrer">GitHub</a></li><li><a rel="me" href="https://www.youtube.com/djadams-qmacro" target="_blank" rel="noopener noreferrer">YouTube</a></li><li><a rel="me" href="https://www.linkedin.com/in/djadams/" target="_blank" rel="noopener noreferrer">LinkedIn</a></li><li><a rel="me" href="/tweets">Tweet Archive</a></li><li><a rel="me" href="https://hachyderm.io/@qmacro" target="_blank" rel="noopener noreferrer">Mastodon</a></li><li><a rel="me" href="https://bsky.app/profile/qmacro.bsky.social" target="_blank" rel="noopener noreferrer">Bluesky</a></li><li><a href="/feed.xml" target="_blank" rel="noopener noreferrer">RSS</a></li></ul></div></footer></div><script src="/assets/main.31d6cfe0d16ae931b73c.js"></script></body></html>