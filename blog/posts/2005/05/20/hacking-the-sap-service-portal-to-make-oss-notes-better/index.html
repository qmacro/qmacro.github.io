<!doctype html><html lang="en"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1"><link rel="canonical" href="https://qmacro.org/blog/posts/2005/05/20/hacking-the-sap-service-portal-to-make-oss-notes-better/"><link rel="alternate" type="application/atom+xml" title="DJ's Weblog - Feed" href="https://qmacro.org/feed.xml"><link href="/assets/main.7884d8f8e9dd86c3b137.css" rel="stylesheet"><link rel="preconnect" href="https://fonts.gstatic.com"><link href="https://fonts.googleapis.com/css2?family=IBM+Plex+Sans&display=swap" rel="stylesheet"><title>Hacking the SAP service portal to make OSS notes better | DJ Adams</title><link rel="icon" type="“image/x-icon”" href="/images/favicon.ico"><meta property="og:title" content="Hacking the SAP service portal to make OSS notes better"><meta property="og:site_name" content="DJ Adams"><meta property="og:type" content="website"><meta property="og:url" content="https://qmacro.org/blog/posts/2005/05/20/hacking-the-sap-service-portal-to-make-oss-notes-better/"><meta name="description" content="Hacking the SAP service portal to make OSS notes better 20 May 2005 | 4 min read Ahh, OSS notes – a topic close to my heart (see Improving..."><meta property="og:description" content="Hacking the SAP service portal to make OSS notes better 20 May 2005 | 4 min read Ahh, OSS notes – a topic close to my heart (see Improving..."><meta name="description" content="Hacking the SAP service portal to make OSS notes better 20 May 2005 | 4 min read Ahh, OSS notes – a topic close to my heart (see Improving..."><meta property="og:image" content="https://qmacro.org/images/site-image.png"><script src="https://cdn.jsdelivr.net/npm/mermaid/dist/mermaid.min.js"></script><script>mermaid.initialize({startOnLoad:true});</script><script async src="https://www.googletagmanager.com/gtag/js?id=G-4WQKBG0L4Y"></script><script>window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());

      gtag('config', 'G-4WQKBG0L4Y');</script></head><body><div class="layout-wrapper"><header class="header"><div class="header__content"><h1 class="site-title"><a href="/">DJ Adams</a></h1><nav class="nav"><ul class="nav__list"><li class="nav-item"><a href="/about">About Me</a></li><li class="nav-item"><a href="/blog">Blog</a></li><li class="nav-item"><a href="/feed.xml">Feed</a></li></ul></nav></div></header><main class="main"><article class="post"><header class="post__header"><h1>Hacking the SAP service portal to make OSS notes better</h1><div class="post__details"><time datetime="2005-05-20">20 May 2005 </time><span>| </span><span>4 min read</span></div></header><main class="post__content"><p>Ahh, OSS notes – a topic close to my heart (see <a href="/blog/posts/2003/07/30/improving-the-oss-note-experience/">Improving the OSS note experience</a> and <a href="/blog/posts/2004/02/20/fosdem-and-small-oss-notes-browser-hack/">FOSDEM, and small OSS Notes Browser Hack</a>).</p><h2>The OSS Notes Experience</h2><p>The other day I decided to stop going on about how painful using OSS notes on the web was, and do something about it. So I hacked up a <a href="http://greasemonkey.mozdev.org/">Greasemonkey</a> script, <code>OssNoteFix</code>, that addresses the three main issues I have:</p><ul><li>Not having the OSS note number in the title of the page makes it hard to manage more than a couple of notes at once</li><li>Not being able to click on a reference to a further OSS note to go straight to it</li><li>Having my basic browsing experience messed up by the use of frames</li></ul><h2>Enter Greasemonkey</h2><p>Greasemonkey, to quote <a href="https://web.archive.org/web/20060314091206/http://www.diveintomark.org/">Mark Pilgrim</a> in his very useful &quot;<a href="https://web.archive.org/web/20060315035242/http://diveintogreasemonkey.org/">Dive Into Greasemonkey</a>&quot; online book, &quot;is a Firefox extension that allows you to write scripts that alter the web pages you visit. You can use it to make a web site more readable or more usable. You can fix rendering bugs that the site owner can’t be bothered to fix themselves&quot;. The extension doesn’t do anything to web pages by itself, it’s the scripts that manipulate the pages once they’re loaded into the browser. (And yes, it’s for Firefox, a modern, standards-compliant browser. If you’re still using Internet Explorer, shame on you.)</p><h2>Laying The Groundwork</h2><p>But before we get to the script, let’s lay a bit of groundwork that will help smooth things along. Visit Dagfinn’s weblog post <a href="https://web.archive.org/web/20210616075331/https://blogs.sap.com/2004/12/30/easily-access-sap-notes-from-firefox/">Easily access SAP notes from Firefox</a> and follow his instructions to set up SSO access to service.sap.com, and to create a bookmark with a custom keyword so you can access OSS notes very simply. The SSO access avoids all those tiresome HTTP authentication popups your browser throws at you each time the front-end machine serving your request changes due to load balancing. The custom keyword bookmark allows you to request OSS notes directly by typing something like this into your address bar:</p><pre class="language-text"><code class="language-text">note 19466</code></pre><h2>Installing Greasemonkey and the OssNoteFix Script</h2><p>Once you’ve got these set up, it’s time to install Greasemonkey. Visit the Greasemonkey homepage and follow the link to install it (you might have to add the Greasemonkey site to the list of sites allowed to install software). You’ll have to restart Firefox to have this extension take effect.</p><p>Now it’s time to install the Greasemonkey script that I wrote, <code>OssNoteFix</code>. Go to <code>http://www.pipetree.com/~dj/2005/05/OssNoteFix/ossnotefix.user.js</code> (no longer available, see below instead). Because of the ending (.user.js), Greasemonkey recognises it and gives you the option of installing it: Tools-&gt;Install User Script.</p><p>Once you’ve got it installed, visit an OSS note page:</p><pre class="language-text"><code class="language-text">note 19466</code></pre><p>and notice that, once it’s loaded:</p><ul><li>the OSS note number is in the title</li><li>the numbers of the further notes referenced are clickable</li><li>there are no frames</li></ul><p>Hurrah!</p><h2>Watch the Screencast</h2><p>I put together <a href="/images/2005/05/ossnotefix.gif">a screencast</a> which demonstrates the creation of the OSS note bookmark, a visit to an OSS note page before OssNoteFix, the installation of the OssNoteFix user script, and the visit to an OSS note page after the installation. I’d already set up the SSO before I started recording, as that would have taken too long (and would be too boring to watch!) (Top tip: the screencast is at 800×600, so hit F11 to get fullscreen mode in your browser. Also, it’s a 3 Meg file, so please be patient while it comes down the pipe!).</p><h2>Caveat Emptor</h2><p>Of course, the usual caveats apply – it’s a beta, SAP’s service portal pages are horribly complex and any change may break the script, and your own mileage may vary, blah blah blah. Also, the script sometimes matches 5 or 6 digit numbers that aren’t OSS notes. But it works for me. It was especially useful this week as I was installing a CRM 4.0 system.</p><p>This script is free and open source software, use it as you see fit, and if you’re not happy, you can get your money back 🙂</p><h2>OssNoteFix script</h2><pre class="language-javascript"><code class="language-javascript"><span class="token comment">// OssNoteFix</span><br><span class="token comment">// version 0.1 BETA!</span><br><span class="token comment">// 2005-05-18</span><br><span class="token comment">// Copyright (c) 2005, DJ Adams</span><br><br><span class="token comment">// OssNoteFix</span><br><span class="token comment">//</span><br><span class="token comment">// ==UserScript==</span><br><span class="token comment">// @name          OssNoteFix</span><br><span class="token comment">// @namespace     http://www.pipetree.com/qmacro</span><br><span class="token comment">// @description   Make OSS note pages more useable</span><br><span class="token comment">// @include       https://*.sap-ag.de/*</span><br><span class="token comment">// ==/UserScript==</span><br><span class="token comment">//</span><br><span class="token comment">// --------------------------------------------------------------------</span><br><span class="token comment">//</span><br><br><span class="token keyword">var</span> textnodes<span class="token punctuation">,</span> node<span class="token punctuation">,</span> s<span class="token punctuation">,</span> newNode<span class="token punctuation">,</span> fnote<span class="token punctuation">;</span><br><br><span class="token comment">// This is the URL to invoke an OSS note. Ugly, eh?</span><br><span class="token keyword">var</span> linkurl <span class="token operator">=</span> <span class="token string">"&lt;a href='https://service.sap.com/~form/handler?_APP=01100107900000000342&amp;_EVENT=REDIR&amp;_NNUM=$1'>$1&lt;/a>"</span><span class="token punctuation">;</span><br><br><span class="token comment">// Right now, an OSS note number is 5 or 6 consecutive digits,</span><br><span class="token comment">// between two word boundaries. Should be good enough for now.</span><br><span class="token keyword">var</span> ossmatch <span class="token operator">=</span> <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">\b(\d{5,6})\b</span><span class="token regex-delimiter">/</span><span class="token regex-flags">g</span></span><span class="token punctuation">;</span><br><br><span class="token comment">// Act upon the 'main' framed document which has a form 'FNOTE'</span><br><span class="token comment">// and the title 'SAP Note'.</span><br><span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>fnote <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token constant">FNOTE</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> document<span class="token punctuation">.</span>title<span class="token punctuation">.</span><span class="token function">match</span><span class="token punctuation">(</span><span class="token string">'SAP Note'</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br><br>  <span class="token comment">// Get stuffed, evil frames!</span><br>  <span class="token keyword">if</span> <span class="token punctuation">(</span>top<span class="token punctuation">.</span>document<span class="token punctuation">.</span>location <span class="token operator">!=</span> document<span class="token punctuation">.</span>location<span class="token punctuation">)</span> <span class="token punctuation">{</span><br>    top<span class="token punctuation">.</span>document<span class="token punctuation">.</span>location <span class="token operator">=</span> document<span class="token punctuation">.</span>location<span class="token punctuation">;</span><br>  <span class="token punctuation">}</span><br><br>  <span class="token comment">// Make a useful document title from the OSS note number,</span><br>  <span class="token comment">// found in the FNOTE form's _NNUM input field, and the</span><br>  <span class="token comment">// OSS note title (which is in the first H1 element.</span><br>  <span class="token keyword">var</span> h1 <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getElementsByTagName</span><span class="token punctuation">(</span><span class="token string">'h1'</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">;</span><br>  <span class="token keyword">var</span> heading <span class="token operator">=</span> h1<span class="token punctuation">.</span>firstChild<span class="token punctuation">.</span>data<span class="token punctuation">;</span><br>  heading <span class="token operator">=</span> heading<span class="token punctuation">.</span><span class="token function">replace</span><span class="token punctuation">(</span><span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">^\s*(.+?)\s*$</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">,</span> <span class="token string">"$1"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>  document<span class="token punctuation">.</span>title <span class="token operator">=</span> fnote<span class="token punctuation">.</span>_NNUM<span class="token punctuation">.</span>value <span class="token operator">+</span> <span class="token string">" - "</span> <span class="token operator">+</span> heading<span class="token punctuation">;</span><br><br>  <span class="token comment">// Make the plain text references to OSS notes into a href links</span><br>  <span class="token comment">// pointing to their home in http://service.sap.com</span><br>  textnodes <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">evaluate</span><span class="token punctuation">(</span><br>    <span class="token string">"//http://text()"</span><span class="token punctuation">,</span><br>    document<span class="token punctuation">,</span><br>    <span class="token keyword">null</span><span class="token punctuation">,</span><br>    XPathResult<span class="token punctuation">.</span><span class="token constant">UNORDERED_NODE_SNAPSHOT_TYPE</span><span class="token punctuation">,</span><br>    <span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><br>  <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">var</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> textnodes<span class="token punctuation">.</span>snapshotLength<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>    node <span class="token operator">=</span> textnodes<span class="token punctuation">.</span><span class="token function">snapshotItem</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">;</span><br>    s <span class="token operator">=</span> node<span class="token punctuation">.</span>data<span class="token punctuation">;</span><br><br>    <span class="token comment">// Got a match? Make it into a link</span><br>    <span class="token keyword">if</span> <span class="token punctuation">(</span>s<span class="token punctuation">.</span><span class="token function">match</span><span class="token punctuation">(</span>ossmatch<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>      newNode <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span><span class="token string">'div'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>      newNode<span class="token punctuation">.</span>innerHTML <span class="token operator">=</span> s<span class="token punctuation">.</span><span class="token function">replace</span><span class="token punctuation">(</span>ossmatch<span class="token punctuation">,</span> linkurl<span class="token punctuation">)</span><span class="token punctuation">;</span><br>      node<span class="token punctuation">.</span>parentNode<span class="token punctuation">.</span><span class="token function">replaceChild</span><span class="token punctuation">(</span>newNode<span class="token punctuation">,</span> node<span class="token punctuation">)</span><br>    <span class="token punctuation">}</span><br><br>  <span class="token punctuation">}</span><br><br><span class="token punctuation">}</span></code></pre><p><a href="https://blogs.sap.com/2005/05/20/hacking-the-sap-service-portal-to-make-oss-notes-better/">Originally published on SAP Community</a></p></main><aside class="post__aside"><div class="post__tags"><a href="/tags/sapcommunity/">#sapcommunity</a></div><style>.utterances {
  margin-left: inherit !important;
}</style><script src="https://utteranc.es/client.js" repo="qmacro/qmacro.github.io" issue-term="title" crossorigin="anonymous" async></script><nav class="post__pagination"><a href="/blog/posts/2005/05/20/sap:-temporary-loss-of-touch-with-reality/"><span>←</span> <span>SAP: temporary loss of touch with reality?</span> </a><a href="/blog/posts/2005/04/25/ubuntu-thanks.-but-no-thanks./"><span>Ubuntu? Thanks. But no thanks.</span> <span>→</span></a></nav></aside></article></main><footer class="footer"><div class="footer__content"><ul class="hero__social-links"><li><a rel="me" href="https://github.com/qmacro" target="_blank" rel="noopener noreferrer">GitHub</a></li><li><a rel="me" href="https://www.youtube.com/djadams-qmacro" target="_blank" rel="noopener noreferrer">YouTube</a></li><li><a rel="me" href="https://www.linkedin.com/in/djadams/" target="_blank" rel="noopener noreferrer">LinkedIn</a></li><li><a rel="me" href="https://hachyderm.io/@qmacro" target="_blank" rel="noopener noreferrer">Mastodon</a></li><li><a rel="me" href="https://bsky.app/profile/qmacro.bsky.social" target="_blank" rel="noopener noreferrer">Bluesky</a></li><li><a href="/feed.xml" target="_blank" rel="noopener noreferrer">RSS</a></li></ul></div></footer></div><script src="/assets/main.31d6cfe0d16ae931b73c.js"></script></body></html>