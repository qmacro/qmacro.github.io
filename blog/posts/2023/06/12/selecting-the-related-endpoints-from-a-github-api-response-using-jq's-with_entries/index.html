<!doctype html><html lang="en"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1"><link rel="canonical" href="https://qmacro.org/blog/posts/2023/06/12/selecting-the-related-endpoints-from-a-github-api-response-using-jq&#39;s-with_entries/"><link rel="alternate" type="application/atom+xml" title="DJ's Weblog - Feed" href="https://qmacro.org/feed.xml"><link href="/assets/main.7884d8f8e9dd86c3b137.css" rel="stylesheet"><link rel="preconnect" href="https://fonts.gstatic.com"><link href="https://fonts.googleapis.com/css2?family=IBM+Plex+Sans&display=swap" rel="stylesheet"><title>Selecting the related endpoints from a GitHub API response using jq&#39;s with_entries | DJ Adams</title><link rel="icon" type="“image/x-icon”" href="/images/favicon.ico"><meta property="og:title" content="Selecting the related endpoints from a GitHub API response using jq&#39;s with_entries"><meta property="og:site_name" content="DJ Adams"><meta property="og:type" content="website"><meta property="og:url" content="https://qmacro.org/blog/posts/2023/06/12/selecting-the-related-endpoints-from-a-github-api-response-using-jq&#39;s-with_entries/"><meta name="description" content="Selecting the related endpoints from a GitHub API response using jq&amp;#39;s with_entries 12 Jun 2023 | 2 min read I often find myself..."><meta property="og:description" content="Selecting the related endpoints from a GitHub API response using jq&amp;#39;s with_entries 12 Jun 2023 | 2 min read I often find myself..."><meta name="description" content="Selecting the related endpoints from a GitHub API response using jq&amp;#39;s with_entries 12 Jun 2023 | 2 min read I often find myself..."><meta property="og:image" content="https://qmacro.org/images/site-image.png"><script src="https://cdn.jsdelivr.net/npm/mermaid/dist/mermaid.min.js"></script><script>mermaid.initialize({startOnLoad:true});</script><script async src="https://www.googletagmanager.com/gtag/js?id=G-4WQKBG0L4Y"></script><script>window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());

      gtag('config', 'G-4WQKBG0L4Y');</script></head><body><div class="layout-wrapper"><header class="header"><div class="header__content"><h1 class="site-title"><a href="/">DJ Adams</a></h1><nav class="nav"><ul class="nav__list"><li class="nav-item"><a href="/about">About Me</a></li><li class="nav-item"><a href="/blog">Blog</a></li><li class="nav-item"><a href="/feed.xml">Feed</a></li></ul></nav></div></header><main class="main"><article class="post"><header class="post__header"><h1>Selecting the related endpoints from a GitHub API response using jq&#39;s with_entries</h1><div class="post__details"><time datetime="2023-06-12">12 Jun 2023 </time><span>| </span><span>2 min read</span></div></header><main class="post__content"><p>I often find myself searching for the related API endpoints for any given chunk of data returned from a call to the <a href="https://docs.github.com/en/rest">GitHub REST API</a>. Let's take an issue as an example, one related to SAP's <a href="https://blogs.sap.com/2021/05/20/introducing-the-open-documentation-initiative/">Open Documentation Initiative</a>:</p><p>Feedback for &quot;Data Lake API&quot;: <a href="https://github.com/SAP-docs/sap-datasphere/issues/13">https://github.com/SAP-docs/sap-datasphere/issues/13</a></p><p>Taking the basic information available for this issue via <a href="https://docs.github.com/en/rest/issues/issues?apiVersion=2022-11-28#get-an-issue">one of the endpoints in the Issues API</a>, we get an object returned with properties that we can list like this:</p><pre class="language-shell"><code class="language-shell">gh api <span class="token punctuation">\</span><br>  <span class="token parameter variable">--cache</span> 1h <span class="token punctuation">\</span><br>  repos/SAP-docs/sap-datasphere/issues/13 <span class="token punctuation">\</span><br>  <span class="token operator">|</span> jq keys</code></pre><p>There are quite a few properties, many of them ending <code>_url</code>:</p><pre class="language-json"><code class="language-json"><span class="token punctuation">[</span><br>  <span class="token string">"active_lock_reason"</span><span class="token punctuation">,</span><br>  <span class="token string">"assignee"</span><span class="token punctuation">,</span><br>  <span class="token string">"assignees"</span><span class="token punctuation">,</span><br>  <span class="token string">"author_association"</span><span class="token punctuation">,</span><br>  <span class="token string">"body"</span><span class="token punctuation">,</span><br>  <span class="token string">"closed_at"</span><span class="token punctuation">,</span><br>  <span class="token string">"closed_by"</span><span class="token punctuation">,</span><br>  <span class="token string">"comments"</span><span class="token punctuation">,</span><br>  <span class="token string">"comments_url"</span><span class="token punctuation">,</span><br>  <span class="token string">"created_at"</span><span class="token punctuation">,</span><br>  <span class="token string">"events_url"</span><span class="token punctuation">,</span><br>  <span class="token string">"html_url"</span><span class="token punctuation">,</span><br>  <span class="token string">"id"</span><span class="token punctuation">,</span><br>  <span class="token string">"labels"</span><span class="token punctuation">,</span><br>  <span class="token string">"labels_url"</span><span class="token punctuation">,</span><br>  <span class="token string">"locked"</span><span class="token punctuation">,</span><br>  <span class="token string">"milestone"</span><span class="token punctuation">,</span><br>  <span class="token string">"node_id"</span><span class="token punctuation">,</span><br>  <span class="token string">"number"</span><span class="token punctuation">,</span><br>  <span class="token string">"performed_via_github_app"</span><span class="token punctuation">,</span><br>  <span class="token string">"reactions"</span><span class="token punctuation">,</span><br>  <span class="token string">"repository_url"</span><span class="token punctuation">,</span><br>  <span class="token string">"state"</span><span class="token punctuation">,</span><br>  <span class="token string">"state_reason"</span><span class="token punctuation">,</span><br>  <span class="token string">"timeline_url"</span><span class="token punctuation">,</span><br>  <span class="token string">"title"</span><span class="token punctuation">,</span><br>  <span class="token string">"updated_at"</span><span class="token punctuation">,</span><br>  <span class="token string">"url"</span><span class="token punctuation">,</span><br>  <span class="token string">"user"</span><br><span class="token punctuation">]</span></code></pre><p>A simple <a href="https://jqlang.github.io/jq/manual/#to_entries,from_entries,with_entries">with_entries</a>, which is actually just a combination of its two sibling functions: <code>to_entries | map(foo) | from_entries</code>, does the trick:</p><pre class="language-shell"><code class="language-shell">gh api <span class="token punctuation">\</span><br>  <span class="token parameter variable">--cache</span> 1h <span class="token punctuation">\</span><br>  repos/SAP-docs/sap-datasphere/issues/13 <span class="token punctuation">\</span><br>  <span class="token operator">|</span> jq <span class="token string">'with_entries(select(.key | endswith("_url")))'</span></code></pre><p>This gives:</p><pre class="language-shell"><code class="language-shell"><span class="token punctuation">{</span><br>  <span class="token string">"repository_url"</span><span class="token builtin class-name">:</span> <span class="token string">"https://api.github.com/repos/SAP-docs/sap-datasphere"</span>,<br>  <span class="token string">"labels_url"</span><span class="token builtin class-name">:</span> <span class="token string">"https://api.github.com/repos/SAP-docs/sap-datasphere/issues/13/labels{/name}"</span>,<br>  <span class="token string">"comments_url"</span><span class="token builtin class-name">:</span> <span class="token string">"https://api.github.com/repos/SAP-docs/sap-datasphere/issues/13/comments"</span>,<br>  <span class="token string">"events_url"</span><span class="token builtin class-name">:</span> <span class="token string">"https://api.github.com/repos/SAP-docs/sap-datasphere/issues/13/events"</span>,<br>  <span class="token string">"html_url"</span><span class="token builtin class-name">:</span> <span class="token string">"https://github.com/SAP-docs/sap-datasphere/issues/13"</span>,<br>  <span class="token string">"timeline_url"</span><span class="token builtin class-name">:</span> <span class="token string">"https://api.github.com/repos/SAP-docs/sap-datasphere/issues/13/timeline"</span><br><span class="token punctuation">}</span></code></pre><p>What <code>to_entries</code>, <code>from_entries</code> and <code>with_entries</code> gives us is a way to process properties the names of which are unknown to us until execution time. Each property is normalised into a static structure with well-known property names. Here's an example:</p><pre class="language-shell"><code class="language-shell">jq <span class="token parameter variable">-n</span> <span class="token string">'{question: "Life", answer: "Forty Two"} | to_entries'</span></code></pre><p>This emits a stable, predictable structure:</p><pre class="language-json"><code class="language-json"><span class="token punctuation">[</span><br>  <span class="token punctuation">{</span><br>    <span class="token property">"key"</span><span class="token operator">:</span> <span class="token string">"question"</span><span class="token punctuation">,</span><br>    <span class="token property">"value"</span><span class="token operator">:</span> <span class="token string">"Life"</span><br>  <span class="token punctuation">}</span><span class="token punctuation">,</span><br>  <span class="token punctuation">{</span><br>    <span class="token property">"key"</span><span class="token operator">:</span> <span class="token string">"answer"</span><span class="token punctuation">,</span><br>    <span class="token property">"value"</span><span class="token operator">:</span> <span class="token string">"Forty Two"</span><br>  <span class="token punctuation">}</span><br><span class="token punctuation">]</span></code></pre><p>And <code>from_entries</code> reverses the conversion that <code>to_entries</code> performs. For example:</p><pre class="language-shell"><code class="language-shell">jq <span class="token parameter variable">-n</span> <span class="token string">'<br>  {question: "Life", answer: "Forty Two"}<br>  | to_entries<br>  | map(.value |= ascii_upcase)<br>  | from_entries<br>'</span></code></pre><p>This emits:</p><pre class="language-json"><code class="language-json"><span class="token punctuation">{</span><br>  <span class="token property">"question"</span><span class="token operator">:</span> <span class="token string">"LIFE"</span><span class="token punctuation">,</span><br>  <span class="token property">"answer"</span><span class="token operator">:</span> <span class="token string">"FORTY TWO"</span><br><span class="token punctuation">}</span></code></pre><p>So this can be replaced simply with:</p><pre class="language-shell"><code class="language-shell">jq <span class="token parameter variable">-n</span> <span class="token string">'<br>  {question: "Life", answer: "Forty Two"}<br>  | with_entries(.value |= ascii_upcase)<br>'</span></code></pre><p>This has the same effect (because <a href="https://github.com/jqlang/jq/blob/a9f97e9e61a910a374a5d768244e8ad63f407d3e/src/builtin.jq#L43">it's just syntactic sugar for the version with <code>to_entries</code> and <code>from_entries</code></a>):</p><pre class="language-json"><code class="language-json"><span class="token punctuation">{</span><br>  <span class="token property">"question"</span><span class="token operator">:</span> <span class="token string">"LIFE"</span><span class="token punctuation">,</span><br>  <span class="token property">"answer"</span><span class="token operator">:</span> <span class="token string">"FORTY TWO"</span><br><span class="token punctuation">}</span></code></pre><hr><p>I'm going to try and write more of these short &quot;snippet&quot; posts, to break the cycle of only writing longer, more detailed and therefore less frequent ones. Let's see how it goes.</p></main><aside class="post__aside"><div class="post__tags"><a href="/tags/github/">#github</a> <a href="/tags/api/">#api</a> <a href="/tags/snippet/">#snippet</a> <a href="/tags/jq/">#jq</a></div><style>.utterances {
  margin-left: inherit !important;
}</style><script src="https://utteranc.es/client.js" repo="qmacro/qmacro.github.io" issue-term="title" crossorigin="anonymous" async></script><nav class="post__pagination"><a href="/blog/posts/2023/06/17/sap-codejam-report-service-integration-with-cap-in-guetersloh-de/"><span>←</span> <span>SAP CodeJam report - service integration with CAP in Guetersloh, DE</span> </a><a href="/blog/posts/2023/05/20/sap-codejam-on-service-integration-with-cap-in-brescia/"><span>SAP CodeJam on Service Integration with CAP in Brescia</span> <span>→</span></a></nav></aside></article></main><footer class="footer"><div class="footer__content"><ul class="hero__social-links"><li><a rel="me" href="https://github.com/qmacro" target="_blank" rel="noopener noreferrer">GitHub</a></li><li><a rel="me" href="https://www.youtube.com/djadams-qmacro" target="_blank" rel="noopener noreferrer">YouTube</a></li><li><a rel="me" href="https://www.linkedin.com/in/djadams/" target="_blank" rel="noopener noreferrer">LinkedIn</a></li><li><a rel="me" href="/tweets/">Tweet Archive</a></li><li><a rel="me" href="https://hachyderm.io/@qmacro" target="_blank" rel="noopener noreferrer">Mastodon</a></li><li><a rel="me" href="https://bsky.app/profile/qmacro.org" target="_blank" rel="noopener noreferrer">Bluesky</a></li><li><a href="/feed.xml" target="_blank" rel="noopener noreferrer">RSS</a></li></ul></div></footer></div><script src="/assets/main.31d6cfe0d16ae931b73c.js"></script></body></html>