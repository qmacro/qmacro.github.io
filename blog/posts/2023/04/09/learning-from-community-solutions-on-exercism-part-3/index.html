<!doctype html><html lang="en"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1"><link rel="canonical" href="https://qmacro.org/blog/posts/2023/04/09/learning-from-community-solutions-on-exercism-part-3/"><link rel="alternate" type="application/atom+xml" title="DJ's Weblog - Feed" href="https://qmacro.org/feed.xml"><link href="/assets/main.4654d4542dcb045c9ba3.css" rel="stylesheet"><link rel="preconnect" href="https://fonts.gstatic.com"><link href="https://fonts.googleapis.com/css2?family=IBM+Plex+Sans&display=swap" rel="stylesheet"><title>Learning from community solutions on Exercism - part 3 | DJ Adams</title><link rel="icon" type="“image/x-icon”" href="/images/favicon.ico"><meta property="og:title" content="Learning from community solutions on Exercism - part 3"><meta property="og:site_name" content="DJ Adams"><meta property="og:type" content="website"><meta property="og:url" content="https://qmacro.org/blog/posts/2023/04/09/learning-from-community-solutions-on-exercism-part-3/"><meta name="description" content="Learning from community solutions on Exercism - part 3 09 Apr 2023 | 5 min read In this post I continue to dwell on small details in the jq..."><meta property="og:description" content="Learning from community solutions on Exercism - part 3 09 Apr 2023 | 5 min read In this post I continue to dwell on small details in the jq..."><meta name="description" content="Learning from community solutions on Exercism - part 3 09 Apr 2023 | 5 min read In this post I continue to dwell on small details in the jq..."><meta property="og:image" content="https://qmacro.org/images/site-image.png"><script src="https://cdn.jsdelivr.net/npm/mermaid/dist/mermaid.min.js"></script><script>mermaid.initialize({startOnLoad:true});</script><script async src="https://www.googletagmanager.com/gtag/js?id=G-4WQKBG0L4Y"></script><script>window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());

      gtag('config', 'G-4WQKBG0L4Y');</script></head><body><div class="layout-wrapper"><header class="header"><div class="header__content"><h1 class="site-title"><a href="/">DJ Adams</a></h1><nav class="nav"><ul class="nav__list"><li class="nav-item"><a href="/about">About Me</a></li><li class="nav-item"><a href="/talks">Talks</a></li><li class="nav-item"><a href="/blog">Blog</a></li><li class="nav-item"><a href="/feed.xml">Feed</a></li></ul></nav></div></header><main class="main"><article class="post"><header class="post__header"><h1>Learning from community solutions on Exercism - part 3</h1><div class="post__details"><time datetime="2023-04-09">09 Apr 2023 </time><span>| </span><span>5 min read</span></div></header><main class="post__content"><p>In this post I continue to dwell on small details in the jq solutions to Exercism exercises. It follows on roughly from parts <a href="/blog/posts/2023/03/29/learning-from-community-solutions-on-exercism-part-1/">1</a> and <a href="/blog/posts/2023/04/02/learning-from-community-solutions-on-exercism-part-2/">2</a>.</p><p><a name="remote-control-car"></a></p><h2>Remote Control Car exercise</h2><p>I was just checking through my solution to this simple exercise, to compare it with the <a href="https://exercism.org/tracks/jq/exercises/remote-control-car/solutions">community solutions</a>. There was nothing earth shattering but a couple of things jumped out at me that I thought might be worthwhile mentioning. I solved tasks 1 and 2 in this exercise like this:</p><pre class="language-jq"><code class="language-jq"><span class="token keyword">def</span> <span class="token function">new_remote_control_car</span><span class="token punctuation">:</span><br>  <span class="token punctuation">{</span><br>    <span class="token property-literal property">battery_percentage</span><span class="token punctuation">:</span> <span class="token number">100</span><span class="token punctuation">,</span><br>    <span class="token property-literal property">distance_driven_in_meters</span><span class="token punctuation">:</span> <span class="token number">0</span><span class="token punctuation">,</span><br>    <span class="token property-literal property">nickname</span><span class="token punctuation">:</span> <span class="token keyword">null</span><br>  <span class="token punctuation">}</span><br><span class="token punctuation">;</span><br><br><span class="token keyword">def</span> <span class="token function">new_remote_control_car</span><span class="token punctuation">(</span>nickname<span class="token punctuation">)</span><span class="token punctuation">:</span><br>  new_remote_control_car <span class="token operator pipe">|</span> <span class="token punctuation">.</span>nickname <span class="token operator">=</span> nickname<br><span class="token punctuation">;</span></code></pre><h3>Multiple function definitions</h3><p>First, this is a pair of definitions of a function named <code>new_remote_control_car</code>. One that takes no arguments, and one that takes a single argument. One would refer to them as <code>new_remote_control_car/0</code> and <code>new_remote_control_car/1</code> respectively.</p><p>The jq wiki has a lot of interesting things to say here, and in the <a href="https://github.com/stedolan/jq/wiki/jq-Language-Description#Lexical-Symbol-Bindings-Function-Definitions-and-Data-Symbol-Bindings">Lexical Symbol Bindings: Function Definitions and Data Symbol Bindings</a> section of the <a href="https://github.com/stedolan/jq/wiki/jq-Language-Description">jq Language Description page</a>, we see that:</p><blockquote><p>Note well that foo, foo(expr), foo(expr0; expr1), and so on, are all different functions. The number of arguments passed determines which foo is applied. We can and do refer to the first as foo/0, the next as foo/1, and so on.</p></blockquote><p><em>I can't help notice the &quot;Note well&quot;, which is a direct English equivalent of the Latin-based initialism &quot;N.B.&quot; i.e. &quot;Nota bene&quot;. I wonder if it was deliberate. Anyway, I digress.</em></p><p>This is why the above approach works so well, and feels so clean. The call to <code>new_remote_control_car</code> in the second function definition will invoke the version from the first function definition as there are no arguments being passed. I was initially thinking this feature might be a way to variadic function definition, but on reflection, this is something that feels different, as there's only a single function definition in the latter case, as can be demonstrated in this JavaScript example of a variadic function, that uses the <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Operators/Spread_syntax">spread syntax</a>:</p><pre class="language-javascript"><code class="language-javascript"><span class="token function-variable function">myfun</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter"><span class="token operator">...</span>xs</span><span class="token punctuation">)</span> <span class="token operator">=></span> xs<span class="token punctuation">.</span><span class="token function">reduce</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">a<span class="token punctuation">,</span> x</span><span class="token punctuation">)</span> <span class="token operator">=></span> a <span class="token operator">+</span> x<span class="token punctuation">,</span> <span class="token string">''</span><span class="token punctuation">)</span><br><span class="token function">myfun</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">)</span><br><span class="token comment">// => '123'</span></code></pre><p>I had a fascinating conversation with my son Joseph about this (who is infinitely more knowledgeable than me in the area of programming, language paradigms, semantics and implementations) and he suggested that this multiple function definition approach could even be compared to how recursion is defined in Haskell, as illustrated in this classic factorial function definition:</p><pre class="language-haskell"><code class="language-haskell"><span class="token hvariable">factorial</span> <span class="token operator">::</span> <span class="token constant">Integer</span> <span class="token operator">-></span> <span class="token constant">Integer</span><br><span class="token hvariable">factorial</span> <span class="token number">1</span> <span class="token operator">=</span> <span class="token number">1</span><br><span class="token hvariable">factorial</span> <span class="token hvariable">n</span> <span class="token operator">=</span> <span class="token hvariable">n</span> <span class="token operator">*</span> <span class="token hvariable">factorial</span> <span class="token punctuation">(</span><span class="token hvariable">n</span> <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span></code></pre><p>In a way the <code>factorial</code> function is being defined multiple times (well, twice here), but one thinks about this in terms of a way to define a recursive based solution.</p><h3>Modifying or extending an object</h3><p>In the defintion of <code>new_remote_control_car/1</code> above, we have this:</p><pre class="language-jq"><code class="language-jq">new_remote_control_car <span class="token operator pipe">|</span> <span class="token punctuation">.</span>nickname <span class="token operator">=</span> nickname</code></pre><p>The output from a call to <code>new_remote_control_car</code> goes through the pipe where <code>.nickname = nickname</code> is then executed. This felt quite natural to me, defining (adding or replacing, or &quot;upserting&quot;, to use that database oriented word) a value for a property.</p><p>There was an alternative approach to adding or replacing a property in an object, used in solutions from users glennj and bewuethr:</p><pre class="language-jq"><code class="language-jq"><span class="token keyword">def</span> <span class="token function">new_remote_control_car</span><span class="token punctuation">(</span><span class="token variable">$nickname</span><span class="token punctuation">)</span><span class="token punctuation">:</span><br>  new_remote_control_car <span class="token operator">+</span> <span class="token punctuation">{</span><span class="token variable">$nickname</span><span class="token punctuation">}</span><br><span class="token punctuation">;</span></code></pre><p>This also works, because the <a href="https://stedolan.github.io/jq/manual/#Addition:+">addition operator</a> <code>+</code> can add objects:</p><blockquote><p>Objects are added by merging, that is, inserting all the key-value pairs from both objects into a single combined object. If both objects contain a value for the same key, the object on the right of the + wins.</p></blockquote><p>What makes this particular variation pleasing is the compact nature of the expression on the right of the <code>+</code>, i.e. simply <code>{$nickname}</code>.</p><p>This compactness comes about from:</p><ul><li>the use of a variable reference for the key expression, which of course resolves to the value of the variable</li><li>the ability to omit the double quotes for the key if the expression is &quot;identifier-like&quot;</li><li>the shortcut syntax that allows <code>{x: .x}</code> to be written as <code>{x}</code>:</li></ul><p>The &quot;full fat&quot; version of the expression would have been:</p><pre class="language-jq"><code class="language-jq">new_remote_control_car <span class="token operator">+</span> <span class="token punctuation">{</span> <span class="token property">"nickname"</span><span class="token punctuation">:</span> <span class="token variable">$nickname</span> <span class="token punctuation">}</span></code></pre><p>(There's also the difference between <code>def new_remote_control_car(nickname)</code> and <code>def new_remote_control_car($nickname)</code> but I'll leave that for another time.)</p><h2>Grade Stats exercise</h2><p>Another simple exercise, and this time I wanted to draw attention to the argument supplied as the &quot;initial value&quot; parameter of the <code>reduce</code> function.</p><p>With reduce functions in general, I suppose I've gone through some sort of &quot;journey of enlightenment&quot; with respect to what's supplied as this &quot;initial value&quot;:</p><ul><li>Stage 1: a literal scalar (for when you're doing something like adding a list of numbers)</li><li>Stage 2: a literal form of some sort of more complex value such as an array or object (for when you're doing something like implementing a map function)</li><li>Stage 3: something generated (for all sorts of things)</li></ul><p>Again, this is very obvious, but still worth calling out. Especially as I think that reduce is such a powerful and fundamental mechanism (if you're interested in reading more on reduce, see the <a href="#further-reading">Further reading</a> section below).</p><p>Anyway, many of the community solutions used jq's <a href="https://stedolan.github.io/jq/manual/#Reduce">reduce</a>, which looks like this (in pseudocode):</p><pre class="language-jq"><code class="language-jq"><span class="token keyword">reduce</span> stream<span class="token operator">-</span>of<span class="token operator">-</span>values <span class="token keyword">as</span> <span class="token variable">$x</span> <span class="token punctuation">(</span><br>  initial<span class="token operator">-</span>value<span class="token punctuation">;</span> <br>  generation of accumulated value using <span class="token dot important">.</span> <span class="token operator">and</span> <span class="token variable">$x</span><br><span class="token punctuation">)</span></code></pre><p>Nearly all of them had a literal object as the initial value, representing &quot;Stage 2&quot;, like this from user kruschk:</p><pre class="language-jq"><code class="language-jq"><span class="token keyword">def</span> <span class="token function">count_letter_grades</span><span class="token punctuation">:</span><br>    <span class="token keyword">reduce</span> <span class="token punctuation">.</span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token keyword">as</span> <span class="token variable">$grade</span> <span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token property-literal property">A</span><span class="token punctuation">:</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token property-literal property">B</span><span class="token punctuation">:</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token property-literal property">C</span><span class="token punctuation">:</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token property-literal property">D</span><span class="token punctuation">:</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token property-literal property">F</span><span class="token punctuation">:</span> <span class="token number">0</span><span class="token punctuation">}</span><span class="token punctuation">;</span><br>                          <span class="token punctuation">.</span><span class="token punctuation">[</span><span class="token variable">$grade</span> <span class="token operator pipe">|</span> letter_grade<span class="token punctuation">]</span> <span class="token operator">+=</span> <span class="token number">1</span><span class="token punctuation">)</span><br><span class="token punctuation">;</span></code></pre><p>This is already great, because it elevates the lowly &quot;initial value&quot; parameter to something more important than &quot;just a simple starting value&quot;. The fact that it takes up quite a bit of space in the actual call (i.e. <code>{A: 0, B: 0, C: 0, D: 0, F: 0}</code>) draws one's attention to it.</p><p>Instead of writing this starting object out literally, I wanted to generate it, so opted for &quot;Stage 3&quot;. This is in no way &quot;better&quot; than the community solutions*, but in a similar way I think it helps to elevate the &quot;initial value&quot; parameter to something more important than it might be, merely by passing an expression. Here's what I used:</p><pre class="language-jq"><code class="language-jq"><span class="token keyword">def</span> <span class="token function">count_letter_grades</span><span class="token punctuation">:</span><br>  <span class="token keyword">reduce</span> <span class="token punctuation">.</span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token keyword">as</span> <span class="token variable">$grade</span> <span class="token punctuation">(</span><br>    <span class="token string">"ABCDEF"</span><span class="token operator pipe">|</span><span class="token c-style-function function">split</span><span class="token punctuation">(</span><span class="token string">""</span><span class="token punctuation">)</span><span class="token operator pipe">|</span><span class="token c-style-function function">with_entries</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token property-literal property">key</span><span class="token punctuation">:</span><span class="token punctuation">.</span>value<span class="token punctuation">,</span><span class="token property-literal property">value</span><span class="token punctuation">:</span><span class="token number">0</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>    <span class="token punctuation">.</span><span class="token punctuation">[</span><span class="token punctuation">(</span><span class="token variable">$grade</span><span class="token operator pipe">|</span>letter_grade<span class="token punctuation">)</span><span class="token punctuation">]</span> <span class="token operator">+=</span> <span class="token number">1</span><br>  <span class="token punctuation">)</span><br><span class="token punctuation">;</span></code></pre><p>*<em>in fact it's worse in at least one way, in that I missed the fact that there's no &quot;E&quot; grade in the entire exercise!</em></p><p>With the expression <code>&quot;ABCDEF&quot;|split(&quot;&quot;)|with_entries({key:.value,value:0})</code> I wanted to construct that literal object, and also use it as an opportunity to practise using <code>with_entries</code> which is one of a set of three lovely functions. If you're interested, I wrote a post on this: <a href="/blog/posts/2022/05/30/reshaping-data-values-using-jq's-with_entries/">Reshaping data values using jq's with_entries</a>.</p><p>I'll admit that this solution is perhaps not as clear as the literal object construction; nevertheless, I like it because it makes me think more about the importance of that first parameter to <code>reduce</code>.</p><p><a name="further-reading"></a></p><h2>Further reading</h2><p>If you are still unfamiliar with reduce as a concept, I'd heartily recommend taking some time to become familiar with it. Here are a few posts from me on the topic, and the &quot;F3C&quot; ones have links to corresponding &quot;Fun Fun Function&quot; videos on the topic, from the awesome <a href="https://twitter.com/mpjme">mpjme</a>:</p><ul><li><a href="/blog/posts/2016/10/02/f3c-part-3-reduce-basics/">F3C Part 3 - Reduce basics</a></li><li><a href="blog/posts/2016/10/02/f3c-part-4-reduce-advanced/">F3C Part 4 - Reduce advanced</a></li><li><a href="/blog/posts/2019/04/08/es6-reduce-and-pipe/">ES6, reduce and pipe</a></li><li><a href="/blog/posts/2022/03/25/understanding-jq's-reduce-function/">Understanding jq's reduce function</a></li></ul><p>Until next time, happy solving!</p></main><aside class="post__aside"><div class="post__tags"><a href="/tags/jq/">#jq</a> <a href="/tags/exercism/">#exercism</a></div><style>.utterances {
  margin-left: inherit !important;
}</style><script src="https://utteranc.es/client.js" repo="qmacro/qmacro.github.io" issue-term="title" crossorigin="anonymous" async></script><nav class="post__pagination"><a href="/blog/posts/2023/04/09/recognising-patterns-and-embracing-the-stream/"><span>←</span> <span>Recognising patterns and embracing the stream</span> </a><a href="/blog/posts/2023/04/07/living-on-a-narrowboat-the-stove-as-the-heart-of-the-home/"><span>Living on a narrowboat - the stove as the heart of the home</span> <span>→</span></a></nav></aside></article></main><footer class="footer"><div class="footer__content"><ul class="hero__social-links"><li><a rel="me" href="https://github.com/qmacro" target="_blank" rel="noopener noreferrer">GitHub</a></li><li><a rel="me" href="https://www.youtube.com/djadams-qmacro" target="_blank" rel="noopener noreferrer">YouTube</a></li><li><a rel="me" href="https://hachyderm.io/@qmacro" target="_blank" rel="noopener noreferrer">Mastodon</a></li><li><a href="/feed.xml" target="_blank" rel="noopener noreferrer">RSS</a></li></ul></div></footer></div><script src="/assets/main.31d6cfe0d16ae931b73c.js"></script></body></html>