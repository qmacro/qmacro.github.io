<!doctype html><html lang="en"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1"><link rel="canonical" href="https://qmacro.org/blog/posts/2023/03/29/learning-from-community-solutions-on-exercism/"><link href="/assets/main.5954faabb414863081bd.css" rel="stylesheet"><link rel="preconnect" href="https://fonts.gstatic.com"><link href="https://fonts.googleapis.com/css2?family=IBM+Plex+Sans&display=swap" rel="stylesheet"><title>Learning from community solutions on Exercism | DJ Adams</title><link rel="icon" type="“image/x-icon”" href="/images/favicon.ico"><meta property="og:title" content="Learning from community solutions on Exercism"><meta property="og:site_name" content="DJ Adams"><meta property="og:type" content="website"><meta property="og:url" content="https://qmacro.org/blog/posts/2023/03/29/learning-from-community-solutions-on-exercism/"><meta name="twitter:card" content="summary_large_image"><meta name="twitter:creator" content="@qmacro"><meta name="description" content="Learning from community solutions on Exercism 29 Mar 2023 | 5 min read There&#39;s a relatively new jq track on Exercism, and I&#39;ve been working..."><meta property="og:description" content="Learning from community solutions on Exercism 29 Mar 2023 | 5 min read There&#39;s a relatively new jq track on Exercism, and I&#39;ve been working..."><meta name="description" content="Learning from community solutions on Exercism 29 Mar 2023 | 5 min read There&#39;s a relatively new jq track on Exercism, and I&#39;ve been working..."><meta property="og:image" content="https://qmacro.org/images/site-image.png"><meta name="twitter:image" content="https://qmacro.org/images/site-image.png"><script src="https://cdn.jsdelivr.net/npm/mermaid/dist/mermaid.min.js"></script><script>mermaid.initialize({startOnLoad:true});</script><script async src="https://www.googletagmanager.com/gtag/js?id=G-4WQKBG0L4Y"></script><script>window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());

      gtag('config', 'G-4WQKBG0L4Y');</script></head><body><div class="layout-wrapper"><header class="header"><div class="header__content"><h1 class="site-title"><a href="/">DJ Adams</a></h1><nav class="nav"><ul class="nav__list"><li class="nav-item"><a href="/about">About Me</a></li><li class="nav-item"><a href="/talks">Talks</a></li><li class="nav-item"><a href="/blog">Blog</a></li><li class="nav-item"><a href="/feed.xml">Feed</a></li></ul></nav></div></header><main class="main"><article class="post"><header class="post__header"><h1>Learning from community solutions on Exercism</h1><div class="post__details"><time datetime="2023-03-29">29 Mar 2023 </time><span>| </span><span>5 min read</span></div></header><main class="post__content"><p>There's a relatively new <a href="https://exercism.org/tracks/jq">jq track on Exercism</a>, and I've been working through some of the exercises. There are at least a couple of features that appeal to me; one is the ability to easily write and submit solutions from the command line (see <a href="https://exercism.org/docs/using/solving-exercises/working-locally">Working Locally</a>) and the other is the <a href="https://exercism.org/community">community</a> solutions that are available to you after you submit your own first solution.</p><p>As well as the direct benefit of practice, I've learned and been reminded of aspects of jq while looking through the community solutions. So I thought I'd write some of them up here, because writing will also help me remember.</p><p>I'll start with some simple observations.</p><h2>Shopping List exercise</h2><p>Even in the basic learning exercise <a href="https://exercism.org/tracks/jq/exercises/shopping">Shopping List</a> there are subtle points worth talking about.</p><p>It's based on determining information from a shopping list, that looks like this (reduced for brevity):</p><pre class="language-json"><code class="language-json"><span class="token punctuation">{</span><br>  <span class="token property">"name"</span><span class="token operator">:</span> <span class="token string">"Ingredients for pancakes"</span><span class="token punctuation">,</span><br>  <span class="token property">"ingredients"</span><span class="token operator">:</span> <span class="token punctuation">[</span><br>    <span class="token punctuation">{</span><br>      <span class="token property">"item"</span><span class="token operator">:</span> <span class="token string">"flour"</span><span class="token punctuation">,</span><br>      <span class="token property">"amount"</span><span class="token operator">:</span> <span class="token punctuation">{</span><br>        <span class="token property">"quantity"</span><span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span><br>        <span class="token property">"unit"</span><span class="token operator">:</span> <span class="token string">"cup"</span><br>      <span class="token punctuation">}</span><br>    <span class="token punctuation">}</span><span class="token punctuation">,</span><br>    <span class="token punctuation">{</span><br>      <span class="token property">"item"</span><span class="token operator">:</span> <span class="token string">"sugar"</span><span class="token punctuation">,</span><br>      <span class="token property">"amount"</span><span class="token operator">:</span> <span class="token punctuation">{</span><br>        <span class="token property">"quantity"</span><span class="token operator">:</span> <span class="token number">0.25</span><span class="token punctuation">,</span><br>        <span class="token property">"unit"</span><span class="token operator">:</span> <span class="token string">"cup"</span><br>      <span class="token punctuation">}</span><br>    <span class="token punctuation">}</span><span class="token punctuation">,</span><br>    <span class="token punctuation">{</span><br>      <span class="token property">"item"</span><span class="token operator">:</span> <span class="token string">"baking powder"</span><span class="token punctuation">,</span><br>      <span class="token property">"amount"</span><span class="token operator">:</span> <span class="token punctuation">{</span><br>        <span class="token property">"quantity"</span><span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span><br>        <span class="token property">"unit"</span><span class="token operator">:</span> <span class="token string">"teaspoon"</span><br>      <span class="token punctuation">}</span><br>    <span class="token punctuation">}</span><br>  <span class="token punctuation">]</span><span class="token punctuation">,</span><br>  <span class="token property">"optional ingredients"</span><span class="token operator">:</span> <span class="token punctuation">[</span><br>    <span class="token punctuation">{</span><br>      <span class="token property">"item"</span><span class="token operator">:</span> <span class="token string">"blueberries"</span><span class="token punctuation">,</span><br>      <span class="token property">"amount"</span><span class="token operator">:</span> <span class="token punctuation">{</span><br>        <span class="token property">"quantity"</span><span class="token operator">:</span> <span class="token number">0.25</span><span class="token punctuation">,</span><br>        <span class="token property">"unit"</span><span class="token operator">:</span> <span class="token string">"cup"</span><br>      <span class="token punctuation">}</span><span class="token punctuation">,</span><br>      <span class="token property">"substitute"</span><span class="token operator">:</span> <span class="token string">"chopped apple"</span><br>    <span class="token punctuation">}</span><br>  <span class="token punctuation">]</span><br><span class="token punctuation">}</span></code></pre><p>The first observation is about the contrast between the concept of arrays, with corresponding array functions like <code>map</code>, and the concept of streaming in jq.</p><p>The third task in this exercise was to identify the amount of sugar, which I determined like this:</p><pre class="language-jq"><code class="language-jq"><span class="token punctuation">(</span><br>  <span class="token punctuation">.</span>ingredients <br>  <span class="token operator pipe">|</span> <span class="token c-style-function function">map</span><span class="token punctuation">(</span><span class="token c-style-function function">select</span><span class="token punctuation">(</span><span class="token punctuation">.</span>item <span class="token operator">==</span> <span class="token string">"sugar"</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <br>  <span class="token operator pipe">|</span> first<span class="token punctuation">.</span>amount<span class="token punctuation">.</span>quantity<br><span class="token punctuation">)</span></code></pre><p>The value of the <code>ingredients</code> property is an array, and using <code>map</code> like this produces another array, albeit with a single element (the object that represents the sugar ingredient). So I then used <code>first</code> to grab that element, and navigated to the <code>quantity</code> property). All fine. Having used <code>map</code> in various languages, and learned to think about arrays and how functions such as <code>map</code>, <code>filter</code> and <code>reduce</code> work (see <a href="/blog/posts/2016/05/03/fofp-fundamentals-of-functional-programming/">FOFP Fundamentals of functional programming</a>) this felt natural to me.</p><p>That being said, jq is fundamentally stream oriented, which can be seen in <a href="https://exercism.org/tracks/jq/exercises/shopping/solutions/glennj">glennj's solution</a>:</p><pre class="language-jq"><code class="language-jq"><span class="token punctuation">(</span><br>  <span class="token punctuation">.</span>ingredients<span class="token punctuation">[</span><span class="token punctuation">]</span><br>  <span class="token operator pipe">|</span> <span class="token c-style-function function">select</span><span class="token punctuation">(</span><span class="token punctuation">.</span>item <span class="token operator">==</span> <span class="token string">"sugar"</span><span class="token punctuation">)</span><br>  <span class="token operator pipe">|</span> <span class="token punctuation">.</span>amount<span class="token punctuation">.</span>quantity<br><span class="token punctuation">)</span></code></pre><p>Note the use of the <a href="https://stedolan.github.io/jq/manual/#Array/ObjectValueIterator:.%5B%5D">array / object value iterator</a> on the <code>ingredients</code> property (<code>[]</code>), and the lack of <code>map</code> (and <code>first</code>).</p><p>Expressing <code>.ingredients[]</code> (as opposed to <code>.ingredients</code>) explodes into a stream of values (one for every array element) which are each passed downstream (to <code>select</code> and beyond). The <code>select</code> then only allows the journey to continue for the element(s) that satisfy the condition, which means that the data coming through the last pipe is not an array but an object*.</p><p>*theoretically there could be more than one object coming through, but in this case there is just one.</p><p>Streaming in jq is an important aspect and can be a powerful mechanism to use.</p><h2>Assembly Line exercise</h2><p><a href="https://exercism.org/tracks/jq/exercises/assembly-line">Assembly Line</a> is another learning exercise, where I decided to avoid an <code>if ... elif ... else ... end</code> structure and instead encode the computation for task 1 (calculation of the production rate per hour) using an array as a kind of lookup table:</p><pre class="language-jq"><code class="language-jq"><span class="token keyword">def</span> <span class="token function">production_rate_per_hour</span><span class="token punctuation">:</span><br>  <span class="token dot important">.</span> <span class="token keyword">as</span> <span class="token variable">$speed</span><br>  <span class="token operator pipe">|</span> <span class="token punctuation">(</span><span class="token number">221</span> <span class="token operator">*</span> <span class="token variable">$speed</span><span class="token punctuation">)</span><br>    <span class="token operator">*</span> <br>    <span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">100</span><span class="token punctuation">,</span> <span class="token number">100</span><span class="token punctuation">,</span> <span class="token number">100</span><span class="token punctuation">,</span> <span class="token number">100</span><span class="token punctuation">,</span> <span class="token number">90</span><span class="token punctuation">,</span> <span class="token number">90</span><span class="token punctuation">,</span> <span class="token number">90</span><span class="token punctuation">,</span> <span class="token number">90</span><span class="token punctuation">,</span> <span class="token number">80</span><span class="token punctuation">,</span> <span class="token number">77</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token variable">$speed</span><span class="token punctuation">]</span> <span class="token operator">/</span> <span class="token number">100</span><span class="token punctuation">)</span><br><span class="token punctuation">;</span></code></pre><p>I prefer the way this looks, over a multi-condition <code>if</code> structure, but there's a further improvement possible that I picked up, again from glennj <a href="https://exercism.org/tracks/jq/exercises/assembly-line/solutions/glennj">in his solution</a>, which was the avoidance of the <a href="https://stedolan.github.io/jq/manual/#Variable/SymbolicBindingOperator:...as$identifier%7C...">symbolic binding</a> of the input to <code>$speed</code> (the <code>. as $speed</code> part).</p><p>I'd used a symbolic binding because I knew I would need to refer to it both in the basic speed calculation (multiplying it by 221) and using it to index into the lookup table (<code>[$speed]</code>). But glennj reminded me that I could just as easily have used <code>.</code> directly:</p><pre class="language-jq"><code class="language-jq"><span class="token keyword">def</span> <span class="token function">production_rate_per_hour</span><span class="token punctuation">:</span><br>  <span class="token dot important">.</span> <span class="token operator">*</span> <span class="token number">221</span> <span class="token operator">*</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">0.9</span><span class="token punctuation">,</span><span class="token number">0.9</span><span class="token punctuation">,</span><span class="token number">0.9</span><span class="token punctuation">,</span><span class="token number">0.9</span><span class="token punctuation">,</span><span class="token number">0.8</span><span class="token punctuation">,</span><span class="token number">0.77</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token dot important">.</span> <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">]</span><br><span class="token punctuation">;</span></code></pre><p>Note that tHE subtraction of 1 from <code>.</code> here is because this lookup table was constructed without a dummy value of 0 for the theoretical 0 speed.</p><p>A useful reminder which helps me strive for better avoidance of all that is unnecessary.</p><h2>High Score Board exercise</h2><p>In reviewing my solutions for this post, I came upon what I'd written for the last task in the <a href="https://exercism.org/tracks/jq/exercises/high-score-board">High Score Board</a> exercise, which was to find the total score, as illustrated thus:</p><pre class="language-jq"><code class="language-jq"><span class="token punctuation">{</span><br>  <span class="token property">"Dave Thomas"</span><span class="token punctuation">:</span> <span class="token number">44</span><span class="token punctuation">,</span><br>  <span class="token property">"Freyja Ćirić"</span><span class="token punctuation">:</span> <span class="token number">539</span><span class="token punctuation">,</span><br>  <span class="token property">"José Valim"</span><span class="token punctuation">:</span> <span class="token number">265</span><br><span class="token punctuation">}</span><br><span class="token operator pipe">|</span> total_score<br><span class="token comment"># => 848</span></code></pre><p>I'd written the following:</p><pre class="language-jq"><code class="language-jq"><span class="token keyword">def</span> <span class="token function">total_score</span><span class="token punctuation">:</span><br>  <span class="token punctuation">[</span><span class="token punctuation">.</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">]</span> <span class="token operator pipe">|</span> add <span class="token operator">+</span> <span class="token number">0</span><span class="token punctuation">;</span></code></pre><p>As I mentioned earlier in this post, <code>.[]</code> is the <a href="https://stedolan.github.io/jq/manual/#Array/ObjectValueIterator:.%5B%5D">array / object value iterator</a>. When I mentioned it back then, it was used to iterate over array values, i.e. the elements of the <code>ingredients</code> array.</p><p>Now here it's being used to iterate over the values in an object. Not the keys, but the values, i.e. <code>44</code>, <code>539</code> and <code>265</code>. When I looked at it, I was reminded of the jq manual section on <a href="https://stedolan.github.io/jq/manual/#map(x),map_values(x)">map and map_values</a> which says:</p><blockquote><p><code>map(x)</code> is equivalent to <code>[.[] | x]</code>. In fact, this is how it's defined. Similarly, <code>map_values(x)</code> is defined as <code>.[] |= x</code>.</p></blockquote><p>Also as I mentioned earlier, this iterator will create a stream of values, rather than an array. In other words, this:</p><pre class="language-jq"><code class="language-jq"><span class="token punctuation">{</span><br>  <span class="token property">"Dave Thomas"</span><span class="token punctuation">:</span> <span class="token number">44</span><span class="token punctuation">,</span><br>  <span class="token property">"Freyja Ćirić"</span><span class="token punctuation">:</span> <span class="token number">539</span><span class="token punctuation">,</span><br>  <span class="token property">"José Valim"</span><span class="token punctuation">:</span> <span class="token number">265</span><br><span class="token punctuation">}</span><br><span class="token operator pipe">|</span> <span class="token punctuation">.</span><span class="token punctuation">[</span><span class="token punctuation">]</span></code></pre><p>produces:</p><pre class="language-text"><code class="language-text">44<br>539<br>265</code></pre><p>Note the lack of any semblance of an array - these are all single JSON values.</p><p>So in order to be able to use <code>add</code>, which takes an array as input, I therefore also had to wrap this in an <a href="https://stedolan.github.io/jq/manual/#Arrayconstruction:%5B%5D">array constructor</a> i.e. inside square brackets <code>[ ]</code>:</p><pre class="language-jq"><code class="language-jq"><span class="token punctuation">{</span><br>  <span class="token property">"Dave Thomas"</span><span class="token punctuation">:</span> <span class="token number">44</span><span class="token punctuation">,</span><br>  <span class="token property">"Freyja Ćirić"</span><span class="token punctuation">:</span> <span class="token number">539</span><span class="token punctuation">,</span><br>  <span class="token property">"José Valim"</span><span class="token punctuation">:</span> <span class="token number">265</span><br><span class="token punctuation">}</span><br><span class="token operator pipe">|</span> <span class="token punctuation">[</span><span class="token punctuation">.</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">]</span></code></pre><p>which gave me:</p><pre class="language-json"><code class="language-json"><span class="token punctuation">[</span><br>  <span class="token number">44</span><span class="token punctuation">,</span><br>  <span class="token number">539</span><span class="token punctuation">,</span><br>  <span class="token number">265</span><br><span class="token punctuation">]</span></code></pre><p>Anyway, forgetting this <code>.[]</code> was acting as an object value iterator, I then thought &quot;hmm, this is more or less the equivalent of <code>map</code>&quot;, given what the manual stated ... so I replaced <code>[.[]]</code> with <code>map(.)</code>, like this:</p><pre class="language-jq"><code class="language-jq"><span class="token punctuation">{</span><br>  <span class="token property">"Dave Thomas"</span><span class="token punctuation">:</span> <span class="token number">44</span><span class="token punctuation">,</span><br>  <span class="token property">"Freyja Ćirić"</span><span class="token punctuation">:</span> <span class="token number">539</span><span class="token punctuation">,</span><br>  <span class="token property">"José Valim"</span><span class="token punctuation">:</span> <span class="token number">265</span><br><span class="token punctuation">}</span><br><span class="token operator pipe">|</span> <span class="token c-style-function function">map</span><span class="token punctuation">(</span><span class="token dot important">.</span><span class="token punctuation">)</span></code></pre><p>This also gave me an array:</p><pre class="language-json"><code class="language-json"><span class="token punctuation">[</span><br>  <span class="token number">44</span><span class="token punctuation">,</span><br>  <span class="token number">539</span><span class="token punctuation">,</span><br>  <span class="token number">265</span><br><span class="token punctuation">]</span></code></pre><p>But the interesting thing was that this is <code>map</code> being applied to an object, not an array, and I'm guessing it does the right thing in a sort of <a href="https://en.wikipedia.org/wiki/DWIM">DWIM</a> way (which I first came across in Perl). Even more interestingly, this use of <code>map</code> on an object, which produces an array of the values in that object, contrasts nicely with <code>map</code>'s sibling <code>map_values</code>, which, perhaps confusingly, doesn't do that.</p><p>In fact, I used <code>map_values</code> in addressing the previous task in this exercise, to apply Monday bonus points, which I did like this:</p><pre class="language-jq"><code class="language-jq"><span class="token keyword">def</span> <span class="token function">apply_monday_bonus</span><span class="token punctuation">:</span><br>  <span class="token c-style-function function">map_values</span><span class="token punctuation">(</span><span class="token dot important">.</span> <span class="token operator">+</span> <span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><p>What <code>map_values</code> does is return the object but offer you the values to manipulate as each property is iterated over. So this:</p><pre class="language-jq"><code class="language-jq"><span class="token punctuation">{</span><br>  <span class="token property">"Dave Thomas"</span><span class="token punctuation">:</span> <span class="token number">44</span><span class="token punctuation">,</span><br>  <span class="token property">"Freyja Ćirić"</span><span class="token punctuation">:</span> <span class="token number">539</span><span class="token punctuation">,</span><br>  <span class="token property">"José Valim"</span><span class="token punctuation">:</span> <span class="token number">265</span><br><span class="token punctuation">}</span><br><span class="token operator pipe">|</span> <span class="token c-style-function function">map_values</span><span class="token punctuation">(</span><span class="token dot important">.</span> <span class="token operator">+</span> <span class="token number">100</span><span class="token punctuation">)</span></code></pre><p>produces this:</p><pre class="language-json"><code class="language-json"><span class="token punctuation">{</span><br>  <span class="token property">"Dave Thomas"</span><span class="token operator">:</span> <span class="token number">144</span><span class="token punctuation">,</span><br>  <span class="token property">"Freyja Ćirić"</span><span class="token operator">:</span> <span class="token number">639</span><span class="token punctuation">,</span><br>  <span class="token property">"José Valim"</span><span class="token operator">:</span> <span class="token number">365</span><br><span class="token punctuation">}</span></code></pre><p>and not this:</p><pre class="language-json"><code class="language-json"><span class="token punctuation">[</span><br>  <span class="token number">144</span><span class="token punctuation">,</span><br>  <span class="token number">639</span><span class="token punctuation">,</span><br>  <span class="token number">365</span><br><span class="token punctuation">]</span></code></pre><p>To complete the picture on this observation, I thought I'd mention the <code>+ 0</code> part in the solution:</p><pre class="language-jq"><code class="language-jq"><span class="token keyword">def</span> <span class="token function">total_score</span><span class="token punctuation">:</span><br>  <span class="token punctuation">[</span><span class="token punctuation">.</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">]</span> <span class="token operator pipe">|</span> add <span class="token operator">+</span> <span class="token number">0</span><span class="token punctuation">;</span></code></pre><p>If you supply an empty array to <code>add</code>, it will produce <code>null</code>:</p><pre class="language-jq"><code class="language-jq"><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token operator pipe">|</span> add<br><span class="token comment"># => null</span></code></pre><p>According to the <a href="https://stedolan.github.io/jq/manual/#Addition:+">addition</a> section of the jq manual:</p><blockquote><p>null can be added to any value, and returns the other value unchanged.</p></blockquote><p>[TO BE CONTINUED]</p></main><aside class="post__aside"><div class="post__tags"><a href="/tags/jq/">#jq</a> <a href="/tags/exercism/">#exercism</a></div><style>.utterances {
  margin-left: inherit !important;
}</style><script src="https://utteranc.es/client.js" repo="qmacro/qmacro.github.io" issue-term="title" crossorigin="anonymous" async></script><nav class="post__pagination"><a href="/blog/posts/2023/03/10/sap-community-memories/"><span>SAP community memories</span> <span>→</span></a></nav></aside></article></main><footer class="footer"><div class="footer__content"><ul class="hero__social-links"><li><a rel="me" href="https://github.com/qmacro" target="_blank" rel="noopener noreferrer">GitHub</a></li><li><a rel="me" href="https://www.youtube.com/djadams-qmacro" target="_blank" rel="noopener noreferrer">YouTube</a></li><li><a rel="me" href="https://twitter.com/qmacro" target="_blank" rel="noopener noreferrer">Twitter</a></li><li><a rel="me" href="https://hachyderm.io/@qmacro" target="_blank" rel="noopener noreferrer">Mastodon</a></li><li><a href="/feed.xml" target="_blank" rel="noopener noreferrer">RSS</a></li></ul></div></footer></div><script src="/assets/main.31d6cfe0d16ae931b73c.js"></script></body></html>