<!doctype html>
<html lang="en">
	<head>
		<meta charset="utf-8">
		<meta name="viewport" content="width=device-width, initial-scale=1.0">
		<title>Learning from community solutions on Exercism - part 1</title>
		<meta name="description" content="Reserving the right to be wrong.">
		<link rel="alternate" href="/feed/feed.xml" type="application/atom+xml" title="DJ Adams">
		<link rel="icon" type="image/x-icon" href="/images/favicon.ico">
		
		
		
		<style>/* This is an arbitrary CSS string added to the bundle */
/* Defaults */
:root {
	--font-family: -apple-system, system-ui, sans-serif;
	--font-family-monospace: Consolas, Menlo, Monaco, Andale Mono WT, Andale Mono, Lucida Console, Lucida Sans Typewriter, DejaVu Sans Mono, Bitstream Vera Sans Mono, Liberation Mono, Nimbus Mono L, Courier New, Courier, monospace;
}

/* Theme colors */
:root {
	--color-gray-20: #e0e0e0;
	--color-gray-50: #C0C0C0;
	--color-gray-90: #333;

	--background-color: #fff;

	--text-color: var(--color-gray-90);
	--text-color-link: #2884d2;
	--text-color-link-active: #15b0ed;
	--text-color-link-visited: #9f4199;

	--syntax-tab-size: 2;
}

@media (prefers-color-scheme: dark) {
	:root {
		--color-gray-20: #e0e0e0;
		--color-gray-50: #C0C0C0;
		--color-gray-90: #dad8d8;

		/* --text-color is assigned to --color-gray-_ above */
		--text-color-link: #1493fb;
		--text-color-link-active: #6969f7;
		--text-color-link-visited: #a6a6f8;

		--background-color: #15202b;
	}
}


/* Global stylesheet */
* {
	box-sizing: border-box;
}

@view-transition {
	navigation: auto;
}

html,
body {
	padding: 0;
	margin: 0 auto;
	font-family: var(--font-family);
	color: var(--text-color);
	background-color: var(--background-color);
}
html {
	overflow-y: scroll;
}
body {
	max-width: 40em;
}

/* https://www.a11yproject.com/posts/how-to-hide-content/ */
.visually-hidden:not(:focus):not(:active) {
	clip: rect(0 0 0 0);
	clip-path: inset(50%);
	height: 1px;
	overflow: hidden;
	position: absolute;
	white-space: nowrap;
	width: 1px;
}

/* Fluid images via https://www.zachleat.com/web/fluid-images/ */
img{
  max-width: 100%;
}
img[width][height] {
  height: auto;
}
img[src$=".svg"] {
  width: 100%;
  height: auto;
  max-width: none;
}
video,
iframe {
	width: 100%;
	height: auto;
}
iframe {
	aspect-ratio: 16/9;
}

p:last-child {
	margin-bottom: 0;
}
p {
	line-height: 1.5;
}

li {
	line-height: 1.5;
}

a[href] {
	color: var(--text-color-link);
}
a[href]:visited {
	color: var(--text-color-link-visited);
}
a[href]:hover,
a[href]:active {
	color: var(--text-color-link-active);
}

main,
footer {
	padding: 1rem;
}
/* main :first-child { */
/* 	margin-top: 0; */
/* } */

header {
	border-bottom: 1px dashed var(--color-gray-20);
}

#skip-link {
	text-decoration: none;
	background: var(--background-color);
	color: var(--text-color);
	padding: 0.5rem 1rem;
	border: 1px solid var(--color-gray-90);
	border-radius: 2px;
}

/* Prevent visually-hidden skip link fom pushing content around when focused */
#skip-link.visually-hidden:focus {
	position: absolute;
	top: 1rem;
	left: 1rem;
	/* Ensure it is positioned on top of everything else when it is shown */
	z-index: 999;
}

.links-nextprev {
	display: flex;
	justify-content: space-between;
	gap: .5em 1em;
	list-style: "";
	border-top: 1px dashed var(--color-gray-20);
	padding: 1em 0;
}
.links-nextprev > * {
	flex-grow: 1;
}
.links-nextprev-next {
	text-align: right;
}

table {
	margin: 1em 0;
}
table td,
table th {
	padding-right: 1em;
}

pre,
code {
	font-family: var(--font-family-monospace);
	color: seagreen;
}

pre,code[class*="language-"] {
	line-height: 1.2em !important;
	font-size: 0.93em !important;
}

pre:not([class*="language-"]) {
	margin: .5em 0;
	line-height: 1.375; /* 22px /16 */
	-moz-tab-size: var(--syntax-tab-size);
	-o-tab-size: var(--syntax-tab-size);
	tab-size: var(--syntax-tab-size);
	-webkit-hyphens: none;
	-ms-hyphens: none;
	hyphens: none;
	direction: ltr;
	text-align: left;
	white-space: pre;
	word-spacing: normal;
	word-break: normal;
	overflow-x: auto;
}
code {
	word-break: break-all;
}

/* Header */
header {
	display: flex;
	gap: 1em;
	flex-wrap: wrap;
	justify-content: space-between;
	align-items: center;
	padding: 1em;
}
.home-link {
	flex-grow: 1;
	font-size: 1em; /* 16px /16 */
	font-weight: 700;
}
.home-link:link:not(:hover) {
	text-decoration: none;
}

/* Nav */
.nav {
	display: flex;
	gap: .5em 1em;
	padding: 0;
	margin: 0;
	list-style: none;
}
.nav-item {
	display: inline-block;
}
.nav-item a[href]:not(:hover) {
	text-decoration: none;
}
.nav a[href][aria-current="page"] {
	text-decoration: underline;
}

/* Posts list */
.postlist {
	counter-reset: start-from var(--postlist-index);
	list-style: none;
	padding: 0;
}
.postlist-item {
	display: flex;
	flex-wrap: wrap;
	align-items: baseline;
	counter-increment: start-from -1;
	margin-bottom: 1em;
}
.postlist-item:before {
	display: inline-block;
	pointer-events: none;
	line-height: 100%;
	text-align: right;
	margin-left: -1.5rem;
}
.postlist-date,
.postlist-item:before {
	font-size: 0.8125em; /* 13px /16 */
	color: var(--color-gray-90);
}
.postlist-date {
	word-spacing: -0.5px;
}
.postlist-link {
	font-size: 1.1875em; /* 19px /16 */
	font-weight: 700;
	flex-basis: calc(100% - 1.5rem);
	text-underline-position: from-font;
	text-underline-offset: 0;
	text-decoration-thickness: 1px;
}
.postlist-item-active .postlist-link {
	font-weight: bold;
}

/* Tags */
.post-tag {
	display: inline-flex;
	align-items: center;
	justify-content: center;
	font-style: italic;
}

/* may want to make the description text smaller at some stage */
.post-description-list {
	font-size: 1.0em;
}

.post-description-main {
	font-style: italic;
}

.postlist-item > .post-tag {
	align-self: center;
}

/* Tags list */
.post-metadata {
	display: inline-flex;
	flex-wrap: wrap;
	gap: .5em;
	list-style: none;
	padding: 0;
	margin: 0;
}
.post-metadata time {
	margin-right: 1em;
}

blockquote {
	margin-top: 0px;
	margin-left: 0px;
	margin-bottom: 15px;
	padding-left: 15px;
	border-left: 5px solid lightgray;
}
/**
 * prism.js default theme for JavaScript, CSS and HTML
 * Based on dabblet (http://dabblet.com)
 * @author Lea Verou
 */

code[class*="language-"],
pre[class*="language-"] {
	color: black;
	background: none;
	text-shadow: 0 1px white;
	font-family: Consolas, Monaco, 'Andale Mono', 'Ubuntu Mono', monospace;
	font-size: 1em;
	text-align: left;
	white-space: pre;
	word-spacing: normal;
	word-break: normal;
	word-wrap: normal;
	line-height: 1.5;

	-moz-tab-size: 4;
	-o-tab-size: 4;
	tab-size: 4;

	-webkit-hyphens: none;
	-moz-hyphens: none;
	-ms-hyphens: none;
	hyphens: none;
}

pre[class*="language-"]::-moz-selection, pre[class*="language-"] ::-moz-selection,
code[class*="language-"]::-moz-selection, code[class*="language-"] ::-moz-selection {
	text-shadow: none;
	background: #b3d4fc;
}

pre[class*="language-"]::selection, pre[class*="language-"] ::selection,
code[class*="language-"]::selection, code[class*="language-"] ::selection {
	text-shadow: none;
	background: #b3d4fc;
}

@media print {
	code[class*="language-"],
	pre[class*="language-"] {
		text-shadow: none;
	}
}

/* Code blocks */
pre[class*="language-"] {
	padding: 1em;
	margin: .5em 0;
	overflow: auto;
}

:not(pre) > code[class*="language-"],
pre[class*="language-"] {
	background: #f5f2f0;
}

/* Inline code */
:not(pre) > code[class*="language-"] {
	padding: .1em;
	border-radius: .3em;
	white-space: normal;
}

.token.comment,
.token.prolog,
.token.doctype,
.token.cdata {
	color: slategray;
}

.token.punctuation {
	color: #999;
}

.token.namespace {
	opacity: .7;
}

.token.property,
.token.tag,
.token.boolean,
.token.number,
.token.constant,
.token.symbol,
.token.deleted {
	color: #905;
}

.token.selector,
.token.attr-name,
.token.string,
.token.char,
.token.builtin,
.token.inserted {
	color: #690;
}

.token.operator,
.token.entity,
.token.url,
.language-css .token.string,
.style .token.string {
	color: #9a6e3a;
	/* This background color was intended by the author of this theme. */
	background: hsla(0, 0%, 100%, .5);
}

.token.atrule,
.token.attr-value,
.token.keyword {
	color: #07a;
}

.token.function,
.token.class-name {
	color: #DD4A68;
}

.token.regex,
.token.important,
.token.variable {
	color: #e90;
}

.token.important,
.token.bold {
	font-weight: bold;
}
.token.italic {
	font-style: italic;
}

.token.entity {
	cursor: help;
}
/*
 * New diff- syntax
 */

pre[class*="language-diff-"] {
	--eleventy-code-padding: 1.25em;
	padding-left: var(--eleventy-code-padding);
	padding-right: var(--eleventy-code-padding);
}
.token.deleted {
	background-color: hsl(0, 51%, 37%);
	color: inherit;
}
.token.inserted {
	background-color: hsl(126, 31%, 39%);
	color: inherit;
}

/* Make the + and - characters unselectable for copy/paste */
.token.prefix.unchanged,
.token.prefix.inserted,
.token.prefix.deleted {
	-webkit-user-select: none;
	user-select: none;
	display: inline-flex;
	align-items: center;
	justify-content: center;
	padding-top: 2px;
	padding-bottom: 2px;
}
.token.prefix.inserted,
.token.prefix.deleted {
	width: var(--eleventy-code-padding);
	background-color: rgba(0,0,0,.2);
}

/* Optional: full-width background color */
.token.inserted:not(.prefix),
.token.deleted:not(.prefix) {
	display: block;
	margin-left: calc(-1 * var(--eleventy-code-padding));
	margin-right: calc(-1 * var(--eleventy-code-padding));
	text-decoration: none; /* override del, ins, mark defaults */
	color: inherit; /* override del, ins, mark defaults */
}
.utterances {
  margin-left: inherit !important;
}</style>
		
	</head>
	<body>
		<a href="#main" id="skip-link" class="visually-hidden">Skip to main content</a>

		<header>
			<a href="/" class="home-link">DJ Adams</a>
			<nav>
				<h2 class="visually-hidden" id="top-level-navigation-menu">Top level navigation menu</h2>
				<ul class="nav">
					<li class="nav-item"><a href="/">Home</a></li>
					<li class="nav-item"><a href="/about/">About</a></li>
					<li class="nav-item"><a href="/blog/">Blog</a></li>
					<li class="nav-item"><a href="/feed/feed.xml">Feed</a></li>
				</ul>
			</nav>
		</header>

		<main id="main">
			<heading-anchors>
				


<h1 id="learning-from-community-solutions-on-exercism-part-1">Learning from community solutions on Exercism - part 1</h1>

<ul class="post-metadata">
	<li><time datetime="2023-03-29">29 March 2023</time></li>
	<li><a href="/tags/jq/" class="post-tag">jq</a>, </li>
	<li><a href="/tags/exercism/" class="post-tag">exercism</a></li>
</ul>

<p class="post-description-main"></p>

<p>There's a relatively new <a href="https://exercism.org/tracks/jq">jq track on Exercism</a>, and I've been working through some of the exercises. There are at least a couple of features that appeal to me; one is the ability to easily write and submit solutions from the command line (see <a href="https://exercism.org/docs/using/solving-exercises/working-locally">Working Locally</a>) and the other is the <a href="https://exercism.org/community">community</a> solutions that are available to you after you submit your own first solution.</p>
<p>As well as the direct benefit of practice, I've learned and been reminded of aspects of jq while looking through the community solutions. So I thought I'd write some of them up here, because writing will also help me remember.</p>
<p>I'll start with some simple observations:</p>
<ul>
<li>in the <a href="#shopping-list-exercise">Shopping List exercise</a> I contrast array and stream based thinking</li>
<li>in the <a href="#assembly-line-exercise">Assembly Line exercise</a> I remember how to avoid unnecessary symbolic bindings</li>
<li>in the <a href="#high-score-board-exercise">High Score Board exercise</a> I dwell on <code>map</code>, <code>map_values</code> and the array/object iterator</li>
<li>in the <a href="#vehicle-purchase-exercise">Vehicle Purchase exercise</a> I fall into a rabbit hole about array element containment checks</li>
</ul>
<p><a name="shopping-list-exercise"></a></p>
<h2 id="shopping-list-exercise">Shopping List exercise</h2>
<p>Even in the basic learning exercise <a href="https://exercism.org/tracks/jq/exercises/shopping">Shopping List</a> there are subtle points worth talking about.</p>
<p>It's based on determining information from a shopping list, that looks like this (reduced for brevity):</p>
<pre class="language-json" tabindex="0"><code class="language-json"><span class="token punctuation">{</span>
  <span class="token property">"name"</span><span class="token operator">:</span> <span class="token string">"Ingredients for pancakes"</span><span class="token punctuation">,</span>
  <span class="token property">"ingredients"</span><span class="token operator">:</span> <span class="token punctuation">[</span>
    <span class="token punctuation">{</span>
      <span class="token property">"item"</span><span class="token operator">:</span> <span class="token string">"flour"</span><span class="token punctuation">,</span>
      <span class="token property">"amount"</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token property">"quantity"</span><span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
        <span class="token property">"unit"</span><span class="token operator">:</span> <span class="token string">"cup"</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">{</span>
      <span class="token property">"item"</span><span class="token operator">:</span> <span class="token string">"sugar"</span><span class="token punctuation">,</span>
      <span class="token property">"amount"</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token property">"quantity"</span><span class="token operator">:</span> <span class="token number">0.25</span><span class="token punctuation">,</span>
        <span class="token property">"unit"</span><span class="token operator">:</span> <span class="token string">"cup"</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">{</span>
      <span class="token property">"item"</span><span class="token operator">:</span> <span class="token string">"baking powder"</span><span class="token punctuation">,</span>
      <span class="token property">"amount"</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token property">"quantity"</span><span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
        <span class="token property">"unit"</span><span class="token operator">:</span> <span class="token string">"teaspoon"</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token property">"optional ingredients"</span><span class="token operator">:</span> <span class="token punctuation">[</span>
    <span class="token punctuation">{</span>
      <span class="token property">"item"</span><span class="token operator">:</span> <span class="token string">"blueberries"</span><span class="token punctuation">,</span>
      <span class="token property">"amount"</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token property">"quantity"</span><span class="token operator">:</span> <span class="token number">0.25</span><span class="token punctuation">,</span>
        <span class="token property">"unit"</span><span class="token operator">:</span> <span class="token string">"cup"</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token property">"substitute"</span><span class="token operator">:</span> <span class="token string">"chopped apple"</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">]</span>
<span class="token punctuation">}</span></code></pre>
<p>The first observation is about the contrast between the concept of arrays, with corresponding array functions like <code>map</code>, and the concept of streaming in jq.</p>
<p>The third task in this exercise was to identify the amount of sugar, which I determined like this:</p>
<pre class="language-jq" tabindex="0"><code class="language-jq"><span class="token punctuation">(</span>
  <span class="token punctuation">.</span>ingredients 
  <span class="token operator pipe">|</span> <span class="token c-style-function function">map</span><span class="token punctuation">(</span><span class="token c-style-function function">select</span><span class="token punctuation">(</span><span class="token punctuation">.</span>item <span class="token operator">==</span> <span class="token string">"sugar"</span><span class="token punctuation">)</span><span class="token punctuation">)</span> 
  <span class="token operator pipe">|</span> first<span class="token punctuation">.</span>amount<span class="token punctuation">.</span>quantity
<span class="token punctuation">)</span></code></pre>
<p>The value of the <code>ingredients</code> property is an array, and using <code>map</code> like this produces another array, albeit with a single element (the object that represents the sugar ingredient). So I then used <code>first</code> to grab that element, and navigated to the <code>quantity</code> property). All fine. Having used <code>map</code> in various languages, and learned to think about arrays and how functions such as <code>map</code>, <code>filter</code> and <code>reduce</code> work (see <a href="/blog/posts/2016/05/03/fofp-fundamentals-of-functional-programming/">FOFP Fundamentals of functional programming</a>) this felt natural to me.</p>
<p>That being said, jq is fundamentally stream oriented, which can be seen in <a href="https://exercism.org/tracks/jq/exercises/shopping/solutions/glennj">glennj's solution</a>:</p>
<pre class="language-jq" tabindex="0"><code class="language-jq"><span class="token punctuation">(</span>
  <span class="token punctuation">.</span>ingredients<span class="token punctuation">[</span><span class="token punctuation">]</span>
  <span class="token operator pipe">|</span> <span class="token c-style-function function">select</span><span class="token punctuation">(</span><span class="token punctuation">.</span>item <span class="token operator">==</span> <span class="token string">"sugar"</span><span class="token punctuation">)</span>
  <span class="token operator pipe">|</span> <span class="token punctuation">.</span>amount<span class="token punctuation">.</span>quantity
<span class="token punctuation">)</span></code></pre>
<p>Note the use of the <a href="https://stedolan.github.io/jq/manual/#Array/ObjectValueIterator:.%5B%5D">array / object value iterator</a> on the <code>ingredients</code> property (<code>[]</code>), and the lack of <code>map</code> (and <code>first</code>).</p>
<p>Expressing <code>.ingredients[]</code> (as opposed to <code>.ingredients</code>) explodes into a stream of values (one for every array element) which are each passed downstream (to <code>select</code> and beyond). The <code>select</code> then only allows the journey to continue for the element(s) that satisfy the condition, which means that the data coming through the last pipe is not an array but an object*.</p>
<p>*theoretically there could be more than one object coming through, but in this case there is just one.</p>
<p>Streaming in jq is an important aspect and can be a powerful mechanism to use.</p>
<p><a name="assembly-line-exercise"></a></p>
<h2 id="assembly-line-exercise">Assembly Line exercise</h2>
<p><a href="https://exercism.org/tracks/jq/exercises/assembly-line">Assembly Line</a> is another learning exercise, where I decided to avoid an <code>if ... elif ... else ... end</code> structure and instead encode the computation for task 1 (calculation of the production rate per hour) using an array as a kind of lookup table:</p>
<pre class="language-jq" tabindex="0"><code class="language-jq"><span class="token keyword">def</span> <span class="token function">production_rate_per_hour</span><span class="token punctuation">:</span>
  <span class="token dot important">.</span> <span class="token keyword">as</span> <span class="token variable">$speed</span>
  <span class="token operator pipe">|</span> <span class="token punctuation">(</span><span class="token number">221</span> <span class="token operator">*</span> <span class="token variable">$speed</span><span class="token punctuation">)</span>
    <span class="token operator">*</span> 
    <span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">100</span><span class="token punctuation">,</span> <span class="token number">100</span><span class="token punctuation">,</span> <span class="token number">100</span><span class="token punctuation">,</span> <span class="token number">100</span><span class="token punctuation">,</span> <span class="token number">90</span><span class="token punctuation">,</span> <span class="token number">90</span><span class="token punctuation">,</span> <span class="token number">90</span><span class="token punctuation">,</span> <span class="token number">90</span><span class="token punctuation">,</span> <span class="token number">80</span><span class="token punctuation">,</span> <span class="token number">77</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token variable">$speed</span><span class="token punctuation">]</span> <span class="token operator">/</span> <span class="token number">100</span><span class="token punctuation">)</span>
<span class="token punctuation">;</span></code></pre>
<p>I prefer the way this looks, over a multi-condition <code>if</code> structure, but there's a further improvement possible that I picked up, again from glennj <a href="https://exercism.org/tracks/jq/exercises/assembly-line/solutions/glennj">in his solution</a>, which was the avoidance of the <a href="https://stedolan.github.io/jq/manual/#Variable/SymbolicBindingOperator:...as$identifier%7C...">symbolic binding</a> of the input to <code>$speed</code> (the <code>. as $speed</code> part).</p>
<p>I'd used a symbolic binding because I knew I would need to refer to it both in the basic speed calculation (multiplying it by 221) and using it to index into the lookup table (<code>[$speed]</code>). But glennj reminded me that I could just as easily have used <code>.</code> directly:</p>
<pre class="language-jq" tabindex="0"><code class="language-jq"><span class="token keyword">def</span> <span class="token function">production_rate_per_hour</span><span class="token punctuation">:</span>
  <span class="token dot important">.</span> <span class="token operator">*</span> <span class="token number">221</span> <span class="token operator">*</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">0.9</span><span class="token punctuation">,</span><span class="token number">0.9</span><span class="token punctuation">,</span><span class="token number">0.9</span><span class="token punctuation">,</span><span class="token number">0.9</span><span class="token punctuation">,</span><span class="token number">0.8</span><span class="token punctuation">,</span><span class="token number">0.77</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token dot important">.</span> <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">]</span>
<span class="token punctuation">;</span></code></pre>
<p>Note that tHE subtraction of 1 from <code>.</code> here is because this lookup table was constructed without a dummy value of 0 for the theoretical 0 speed.</p>
<p>A useful reminder which helps me strive for better avoidance of all that is unnecessary.</p>
<p><a name="high-score-board-exercise"></a></p>
<h2 id="high-score-board-exercise">High Score Board exercise</h2>
<p>In reviewing my solutions for this post, I came upon what I'd written for the last task in the <a href="https://exercism.org/tracks/jq/exercises/high-score-board">High Score Board</a> exercise, which was to find the total score, as illustrated thus:</p>
<pre class="language-jq" tabindex="0"><code class="language-jq"><span class="token punctuation">{</span>
  <span class="token property">"Dave Thomas"</span><span class="token punctuation">:</span> <span class="token number">44</span><span class="token punctuation">,</span>
  <span class="token property">"Freyja Ćirić"</span><span class="token punctuation">:</span> <span class="token number">539</span><span class="token punctuation">,</span>
  <span class="token property">"José Valim"</span><span class="token punctuation">:</span> <span class="token number">265</span>
<span class="token punctuation">}</span>
<span class="token operator pipe">|</span> total_score
<span class="token comment"># => 848</span></code></pre>
<p>I'd written the following:</p>
<pre class="language-jq" tabindex="0"><code class="language-jq"><span class="token keyword">def</span> <span class="token function">total_score</span><span class="token punctuation">:</span>
  <span class="token punctuation">[</span><span class="token punctuation">.</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">]</span> <span class="token operator pipe">|</span> add <span class="token operator">+</span> <span class="token number">0</span><span class="token punctuation">;</span></code></pre>
<p>As I mentioned earlier in this post, <code>.[]</code> is the <a href="https://stedolan.github.io/jq/manual/#Array/ObjectValueIterator:.%5B%5D">array / object value iterator</a>. When I mentioned it back then, it was used to iterate over array values, i.e. the elements of the <code>ingredients</code> array.</p>
<p>Now here it's being used to iterate over the values in an object. Not the keys, but the values, i.e. <code>44</code>, <code>539</code> and <code>265</code>. When I looked at it, I was reminded of the jq manual section on <a href="https://stedolan.github.io/jq/manual/#map(x),map_values(x)">map and map_values</a> which says:</p>
<blockquote>
<p><code>map(x)</code> is equivalent to <code>[.[] | x]</code>. In fact, this is how it's defined. Similarly, <code>map_values(x)</code> is defined as <code>.[] |= x</code>.</p>
</blockquote>
<p>Also as I mentioned earlier, this iterator will create a stream of values, rather than an array. In other words, this:</p>
<pre class="language-jq" tabindex="0"><code class="language-jq"><span class="token punctuation">{</span>
  <span class="token property">"Dave Thomas"</span><span class="token punctuation">:</span> <span class="token number">44</span><span class="token punctuation">,</span>
  <span class="token property">"Freyja Ćirić"</span><span class="token punctuation">:</span> <span class="token number">539</span><span class="token punctuation">,</span>
  <span class="token property">"José Valim"</span><span class="token punctuation">:</span> <span class="token number">265</span>
<span class="token punctuation">}</span>
<span class="token operator pipe">|</span> <span class="token punctuation">.</span><span class="token punctuation">[</span><span class="token punctuation">]</span></code></pre>
<p>produces:</p>
<pre class="language-text" tabindex="0"><code class="language-text">44
539
265</code></pre>
<p>Note the lack of any semblance of an array - these are all single JSON values.</p>
<p>So in order to be able to use <code>add</code>, which takes an array as input, I therefore also had to wrap this in an <a href="https://stedolan.github.io/jq/manual/#Arrayconstruction:%5B%5D">array constructor</a> i.e. inside square brackets <code>[ ]</code>:</p>
<pre class="language-jq" tabindex="0"><code class="language-jq"><span class="token punctuation">{</span>
  <span class="token property">"Dave Thomas"</span><span class="token punctuation">:</span> <span class="token number">44</span><span class="token punctuation">,</span>
  <span class="token property">"Freyja Ćirić"</span><span class="token punctuation">:</span> <span class="token number">539</span><span class="token punctuation">,</span>
  <span class="token property">"José Valim"</span><span class="token punctuation">:</span> <span class="token number">265</span>
<span class="token punctuation">}</span>
<span class="token operator pipe">|</span> <span class="token punctuation">[</span><span class="token punctuation">.</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">]</span></code></pre>
<p>which gave me:</p>
<pre class="language-json" tabindex="0"><code class="language-json"><span class="token punctuation">[</span>
  <span class="token number">44</span><span class="token punctuation">,</span>
  <span class="token number">539</span><span class="token punctuation">,</span>
  <span class="token number">265</span>
<span class="token punctuation">]</span></code></pre>
<p>Anyway, forgetting this <code>.[]</code> was acting as an object value iterator, I then thought &quot;hmm, this is more or less the equivalent of <code>map</code>&quot;, given what the manual stated ... so I replaced <code>[.[]]</code> with <code>map(.)</code>, like this:</p>
<pre class="language-jq" tabindex="0"><code class="language-jq"><span class="token punctuation">{</span>
  <span class="token property">"Dave Thomas"</span><span class="token punctuation">:</span> <span class="token number">44</span><span class="token punctuation">,</span>
  <span class="token property">"Freyja Ćirić"</span><span class="token punctuation">:</span> <span class="token number">539</span><span class="token punctuation">,</span>
  <span class="token property">"José Valim"</span><span class="token punctuation">:</span> <span class="token number">265</span>
<span class="token punctuation">}</span>
<span class="token operator pipe">|</span> <span class="token c-style-function function">map</span><span class="token punctuation">(</span><span class="token dot important">.</span><span class="token punctuation">)</span></code></pre>
<p>This also gave me an array:</p>
<pre class="language-json" tabindex="0"><code class="language-json"><span class="token punctuation">[</span>
  <span class="token number">44</span><span class="token punctuation">,</span>
  <span class="token number">539</span><span class="token punctuation">,</span>
  <span class="token number">265</span>
<span class="token punctuation">]</span></code></pre>
<p>But the interesting thing was that this is <code>map</code> being applied to an object, not an array, and I'm guessing it does the right thing in a sort of <a href="https://en.wikipedia.org/wiki/DWIM">DWIM</a> way (which I first came across in Perl). Even more interestingly, this use of <code>map</code> on an object, which produces an array of the values in that object, contrasts nicely with <code>map</code>'s sibling <code>map_values</code>, which, perhaps confusingly, doesn't do that.</p>
<p>In fact, I used <code>map_values</code> in addressing the previous task in this exercise, to apply Monday bonus points, which I did like this:</p>
<pre class="language-jq" tabindex="0"><code class="language-jq"><span class="token keyword">def</span> <span class="token function">apply_monday_bonus</span><span class="token punctuation">:</span>
  <span class="token c-style-function function">map_values</span><span class="token punctuation">(</span><span class="token dot important">.</span> <span class="token operator">+</span> <span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre>
<p>What <code>map_values</code> does is return the object but offer you the values to manipulate as each property is iterated over. So this:</p>
<pre class="language-jq" tabindex="0"><code class="language-jq"><span class="token punctuation">{</span>
  <span class="token property">"Dave Thomas"</span><span class="token punctuation">:</span> <span class="token number">44</span><span class="token punctuation">,</span>
  <span class="token property">"Freyja Ćirić"</span><span class="token punctuation">:</span> <span class="token number">539</span><span class="token punctuation">,</span>
  <span class="token property">"José Valim"</span><span class="token punctuation">:</span> <span class="token number">265</span>
<span class="token punctuation">}</span>
<span class="token operator pipe">|</span> <span class="token c-style-function function">map_values</span><span class="token punctuation">(</span><span class="token dot important">.</span> <span class="token operator">+</span> <span class="token number">100</span><span class="token punctuation">)</span></code></pre>
<p>produces this:</p>
<pre class="language-json" tabindex="0"><code class="language-json"><span class="token punctuation">{</span>
  <span class="token property">"Dave Thomas"</span><span class="token operator">:</span> <span class="token number">144</span><span class="token punctuation">,</span>
  <span class="token property">"Freyja Ćirić"</span><span class="token operator">:</span> <span class="token number">639</span><span class="token punctuation">,</span>
  <span class="token property">"José Valim"</span><span class="token operator">:</span> <span class="token number">365</span>
<span class="token punctuation">}</span></code></pre>
<p>and not this:</p>
<pre class="language-json" tabindex="0"><code class="language-json"><span class="token punctuation">[</span>
  <span class="token number">144</span><span class="token punctuation">,</span>
  <span class="token number">639</span><span class="token punctuation">,</span>
  <span class="token number">365</span>
<span class="token punctuation">]</span></code></pre>
<p>To complete the picture on this observation, I thought I'd mention the <code>+ 0</code> part in the solution:</p>
<pre class="language-jq" tabindex="0"><code class="language-jq"><span class="token keyword">def</span> <span class="token function">total_score</span><span class="token punctuation">:</span>
  <span class="token punctuation">[</span><span class="token punctuation">.</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">]</span> <span class="token operator pipe">|</span> add <span class="token operator">+</span> <span class="token number">0</span><span class="token punctuation">;</span></code></pre>
<p>If you supply an empty array to <code>add</code>, it will produce <code>null</code>:</p>
<pre class="language-jq" tabindex="0"><code class="language-jq"><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token operator pipe">|</span> add
<span class="token comment"># => null</span></code></pre>
<p>According to the <a href="https://stedolan.github.io/jq/manual/#Addition:+">addition</a> section of the jq manual:</p>
<blockquote>
<p>null can be added to any value, and returns the other value unchanged.</p>
</blockquote>
<p><a name="vehicle-purchase-exercise"></a></p>
<h2 id="vehicle-purchase-exercise">Vehicle Purchase exercise</h2>
<p>The <a href="https://exercism.org/tracks/jq/exercises/vehicle-purchase">Vehicle Purchase</a> exercise is another learning one and was quite straightforward. My solution for the first task (&quot;Determine if you will need a drivers licence&quot;) looked like this:</p>
<pre class="language-jq" tabindex="0"><code class="language-jq"><span class="token keyword">def</span> <span class="token function">needs_license</span><span class="token punctuation">:</span>
  <span class="token dot important">.</span> <span class="token operator">==</span> <span class="token string">"car"</span> <span class="token operator">or</span> <span class="token dot important">.</span> <span class="token operator">==</span> <span class="token string">"truck"</span><span class="token punctuation">;</span></code></pre>
<p>While this is fine because there are only two possible values for which we want to return true, the way I expressed this bothered me slightly.</p>
<p>In JavaScript, for example, I would have used an array to contain the values, and then used <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Array/includes">includes</a> like this:</p>
<pre class="language-javascript" tabindex="0"><code class="language-javascript"><span class="token function-variable function">needs_license</span> <span class="token operator">=</span> <span class="token parameter">x</span> <span class="token operator">=></span> <span class="token punctuation">[</span><span class="token string">"car"</span><span class="token punctuation">,</span> <span class="token string">"truck"</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">includes</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span>
<span class="token comment">// needs_license("car") => true</span>
<span class="token comment">// needs_license("train") => false</span></code></pre>
<p>So after submitting my solution, I looked at what others had done. Quite a few used the same approach, as me, but there was <a href="https://exercism.org/tracks/jq/exercises/vehicle-purchase/solutions/IsaacG">a solution from IsaacG</a> that looked more appealing.</p>
<h3 id="considering-the-inside-filter">Considering the inside filter</h3>
<pre class="language-jq" tabindex="0"><code class="language-jq"><span class="token keyword">def</span> <span class="token function">needs_license</span><span class="token punctuation">:</span>
  <span class="token punctuation">[</span><span class="token dot important">.</span><span class="token punctuation">]</span> <span class="token operator pipe">|</span> <span class="token c-style-function function">inside</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">"car"</span><span class="token punctuation">,</span> <span class="token string">"truck"</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre>
<p>This <code>inside</code> filter looked to me like the JavaScript approach above. But my goodness, did it open up a rabbit hole of investigations!</p>
<p>Looking at it, one would think that this would do the job. I started looking at the definition of <a href="https://stedolan.github.io/jq/manual/#inside">inside</a> in the jq manual, and found that it was &quot;essentially an inversed version of <code>contains</code>&quot;. Before looking at the definition of <code>contains</code>, I took a quick look at some of the examples, and saw this one, which made me scratch my head:</p>
<pre class="language-text" tabindex="0"><code class="language-text">jq 'inside(["foobar", "foobaz", "blarp"])'
Input:	["baz", "bar"]
Output:	true</code></pre>
<p>This is not an element-wise check, it's a (sub)string based comparison, even when working with arrays.</p>
<p>I looked at <a href="https://stedolan.github.io/jq/manual/#contains(element)">contains</a> and the examples and description had me more convinced that actually the use of <code>inside</code> in the solution to this sort of task may not be ideal.</p>
<p>There's a sentence in the description of <code>contains</code> which looks fairly innocuous, but in fact masks a major gotcha (emphasis mine):</p>
<blockquote>
<p>[With <code>A | contains(B)</code> ...] an array B is contained in an array A if all elements in B <strong>are contained in</strong> any element in A.</p>
</blockquote>
<h3 id="digression-inside-as-inverse-of-contains">Digression: inside as inverse of contains</h3>
<p>Before continuing, let's just understand what does &quot;inside is an inversed version of contains&quot; mean? Well, we can look at the <a href="https://github.com/stedolan/jq/blob/a9f97e9e61a910a374a5d768244e8ad63f407d3e/src/builtin.jq#L211">source for <code>inside</code> in <code>builtin.jq</code></a>:</p>
<pre class="language-jq" tabindex="0"><code class="language-jq"><span class="token keyword">def</span> <span class="token function">inside</span><span class="token punctuation">(</span>xs<span class="token punctuation">)</span><span class="token punctuation">:</span> <span class="token dot important">.</span> <span class="token keyword">as</span> <span class="token variable">$x</span> <span class="token operator pipe">|</span> xs <span class="token operator pipe">|</span> <span class="token c-style-function function">contains</span><span class="token punctuation">(</span><span class="token variable">$x</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre>
<p>We can see that this is effectively just switching around the two arguments - here, <code>xs</code> is the absolute list of elements, and <code>.</code> (which is bound to <code>$x</code>) is what we want to look for.</p>
<h3 id="whats-the-issue">What's the issue?</h3>
<p>OK, digression over. Clearly, given the relationship between <code>inside</code> and <code>contains</code>, the gotcha also applies to <code>inside</code>.</p>
<p>To help me focus in on the significance of &quot;if [...] elements [...] are contained in any element [...]&quot; in the above description, I defined the two licensable vehicles as being &quot;cart&quot; (with a &quot;t&quot;) and &quot;truck&quot; instead of &quot;car&quot; and &quot;truck&quot;:</p>
<pre class="language-jq" tabindex="0"><code class="language-jq"><span class="token keyword">def</span> <span class="token function">licensable_vehicles</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">"cart"</span><span class="token punctuation">,</span> <span class="token string">"truck"</span><span class="token punctuation">]</span><span class="token punctuation">;</span></code></pre>
<p>I then recreated the function above to look like this*:</p>
<pre class="language-jq" tabindex="0"><code class="language-jq"><span class="token keyword">def</span> <span class="token function">needs_license_inside</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token dot important">.</span><span class="token punctuation">]</span> <span class="token operator pipe">|</span> <span class="token c-style-function function">inside</span><span class="token punctuation">(</span>licensable_vehicles<span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre>
<p>I then tested it with three vehicles, which gave me an unexpected result:</p>
<pre class="language-jq" tabindex="0"><code class="language-jq"><span class="token punctuation">[</span><span class="token string">"bus"</span><span class="token punctuation">,</span> <span class="token string">"cart"</span><span class="token punctuation">,</span> <span class="token string">"car"</span><span class="token punctuation">]</span> <span class="token operator pipe">|</span> <span class="token c-style-function function">map</span><span class="token punctuation">(</span>needs_license_inside<span class="token punctuation">)</span>
<span class="token comment"># => [false, true, true]</span></code></pre>
<p>The <code>inside</code> function returns <code>true</code> for &quot;car&quot; ... because the string <strong>is contained in</strong> one of the elements (&quot;cart&quot;). We can even unpick the inverse, to get closer to the source of the problem:</p>
<pre class="language-jq" tabindex="0"><code class="language-jq">licensable_vehicles <span class="token operator pipe">|</span> <span class="token c-style-function function">contains</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">"car"</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token comment"># => true</span></code></pre>
<p>Yikes!</p>
<p><a name="some-alternatives"></a></p>
<h3 id="some-alternatives">Some alternatives</h3>
<p>Rather than bemoan the slightly vague documentation combined with my misaligned expectations, I thought I'd look into how one might go about testing membership, if <code>inside</code> (or <code>contains</code>) is not the way.</p>
<h4 id="using-any-condition">Using any(condition)</h4>
<p>The <a href="https://stedolan.github.io/jq/manual/#any,any(condition),any(generator;condition)">any</a> filter has different forms (I guess known as <code>any/0</code>, <code>any/1</code> and <code>any/2</code>).
We can use the <code>any/1</code> form with a condition, like this:</p>
<pre class="language-jq" tabindex="0"><code class="language-jq"><span class="token keyword">def</span> <span class="token function">needs_license_any</span><span class="token punctuation">:</span> <span class="token dot important">.</span> <span class="token keyword">as</span> <span class="token variable">$v</span> <span class="token operator pipe">|</span> licensable_vehicles <span class="token operator pipe">|</span> <span class="token c-style-function function">any</span><span class="token punctuation">(</span><span class="token dot important">.</span><span class="token operator">==</span><span class="token variable">$v</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre>
<p>This will give us what we're looking for:</p>
<pre class="language-jq" tabindex="0"><code class="language-jq"><span class="token punctuation">[</span><span class="token string">"bus"</span><span class="token punctuation">,</span> <span class="token string">"cart"</span><span class="token punctuation">,</span> <span class="token string">"car"</span><span class="token punctuation">]</span> <span class="token operator pipe">|</span> <span class="token c-style-function function">map</span><span class="token punctuation">(</span>needs_license_any<span class="token punctuation">)</span>
<span class="token comment"># => [false, true, false]</span></code></pre>
<p>By the way, I had first created this version of the function as follows, and passed the vehicles under tests via a parameter:</p>
<pre class="language-jq" tabindex="0"><code class="language-jq"><span class="token keyword">def</span> <span class="token function">needs_license_any</span><span class="token punctuation">(</span><span class="token variable">$v</span><span class="token punctuation">)</span><span class="token punctuation">:</span> licensable_vehicles <span class="token operator pipe">|</span> <span class="token c-style-function function">any</span><span class="token punctuation">(</span><span class="token dot important">.</span><span class="token operator">==</span><span class="token variable">$v</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">[</span><span class="token string">"bus"</span><span class="token punctuation">,</span> <span class="token string">"cart"</span><span class="token punctuation">,</span> <span class="token string">"car"</span><span class="token punctuation">]</span> <span class="token operator pipe">|</span> <span class="token c-style-function function">map</span><span class="token punctuation">(</span><span class="token c-style-function function">needs_license_any</span><span class="token punctuation">(</span><span class="token dot important">.</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token comment"># => [false, true, false]</span></code></pre>
<p>But inspired by the <a href="https://github.com/stedolan/jq/blob/a9f97e9e61a910a374a5d768244e8ad63f407d3e/src/builtin.jq#L211">builtin definition of inside</a> I felt OK in using a symbolic binding (<code>. as $v</code>) after all, despite what I mentioned earlier in the section on the <a href="#assembly-line-exercise">Assembly Line exercise</a>.</p>
<h4 id="using-index">Using index</h4>
<p>In the jq manual, <a href="https://stedolan.github.io/jq/manual/#index(s),rindex(s)">index</a> is described in a vague way, and the examples are quite minimal, which might give the impression it relates to strings and substrings. But I'm learning that the limited examples can be deceiving, and the functions and filters have subtle depths and for the most part just work the way you might assume they might, in different circumstances.</p>
<p>Here, <code>index</code> will work for us in that it can return either an array index (for a given element, if it exists) or null (if it doesn't). A simple start with <code>index</code> might look like this:</p>
<pre class="language-jq" tabindex="0"><code class="language-jq"><span class="token keyword">def</span> <span class="token function">needs_license_index</span><span class="token punctuation">:</span> <span class="token dot important">.</span> <span class="token keyword">as</span> <span class="token variable">$v</span> <span class="token operator pipe">|</span> licensable_vehicles <span class="token operator pipe">|</span> <span class="token c-style-function function">index</span><span class="token punctuation">(</span><span class="token variable">$v</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre>
<p>However, this doesn't quite give us what we want:</p>
<pre class="language-jq" tabindex="0"><code class="language-jq"><span class="token punctuation">[</span><span class="token string">"bus"</span><span class="token punctuation">,</span> <span class="token string">"cart"</span><span class="token punctuation">,</span> <span class="token string">"car"</span><span class="token punctuation">]</span> <span class="token operator pipe">|</span> <span class="token c-style-function function">map</span><span class="token punctuation">(</span>needs_license_index<span class="token punctuation">)</span>
<span class="token comment"># => [null, 0, null]</span></code></pre>
<p>But <a href="https://stedolan.github.io/jq/manual/#and/or/not">and</a>ing values such as these with <code>true</code> does the trick, of course:</p>
<pre class="language-jq" tabindex="0"><code class="language-jq"><span class="token keyword">def</span> <span class="token function">needs_license_index</span><span class="token punctuation">:</span> 
  <span class="token dot important">.</span> <span class="token keyword">as</span> <span class="token variable">$v</span> <span class="token operator pipe">|</span> licensable_vehicles <span class="token operator pipe">|</span> <span class="token c-style-function function">index</span><span class="token punctuation">(</span><span class="token variable">$v</span><span class="token punctuation">)</span> <span class="token operator">and</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
<span class="token punctuation">[</span><span class="token string">"bus"</span><span class="token punctuation">,</span> <span class="token string">"cart"</span><span class="token punctuation">,</span> <span class="token string">"car"</span><span class="token punctuation">]</span> <span class="token operator pipe">|</span> <span class="token c-style-function function">map</span><span class="token punctuation">(</span>needs_license_index<span class="token punctuation">)</span>
<span class="token comment"># => [false, true, false]</span></code></pre>
<p>Note that in jq:</p>
<blockquote>
<p>false and null are considered &quot;false values&quot;, and anything else is a &quot;true value&quot;</p>
</blockquote>
<p>which is why <code>0 and true</code> evaluates to <code>true</code>.</p>
<p>I'm sure there are more options, but I'll leave it there for now. What is your goto approach for checking for elements in arrays? Let me know in the comments.</p>



<script src="https://utteranc.es/client.js" repo="qmacro/qmacro.github.io" issue-term="title" crossorigin="anonymous" async=""></script>

<ul class="links-nextprev"><li class="links-nextprev-prev">← Previous<br> <a href="/blog/posts/2023/03/10/sap-community-memories/">SAP community memories</a></li><li class="links-nextprev-next">Next →<br><a href="/blog/posts/2023/04/02/learning-from-community-solutions-on-exercism-part-2/">Learning from community solutions on Exercism - part 2</a></li>
</ul>

			</heading-anchors>
		</main>

		<!-- This page `/blog/posts/2023/03/29/learning-from-community-solutions-on-exercism-part-1/` was built on 2025-09-16T12:24:07.294Z -->
		<script type="module" src="/dist/xbxy_EL6cU.js"></script>
	</body>
</html>
