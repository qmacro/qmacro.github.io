<!doctype html>
<html lang="en">
	<head>
		<meta charset="utf-8">
		<meta name="viewport" content="width=device-width, initial-scale=1.0">
		<title>Bash shell expansion inside double quotes</title>
		<meta name="description" content="Reserving the right to be wrong.">
		<link rel="alternate" href="/feed/feed.xml" type="application/atom+xml" title="DJ Adams">
		<link rel="icon" type="image/x-icon" href="/images/favicon.ico">

      <meta property="og:title" content="Bash shell expansion inside double quotes">
        <meta property="og:site_name" content="DJ Adams">
          <meta property="og:image" content="/images/site-image.png">
        <meta property="og:description" content="Reserving the right to be wrong.">
        <meta property="og:url" content="https://qmacro.org/blog/posts/2023/08/25/bash-shell-expansion-inside-double-quotes/">
		
		
		
		<style>/* This is an arbitrary CSS string added to the bundle */
/* Defaults */
:root {
	--font-family: -apple-system, system-ui, sans-serif;
	--font-family-monospace: Consolas, Menlo, Monaco, Andale Mono WT, Andale Mono, Lucida Console, Lucida Sans Typewriter, DejaVu Sans Mono, Bitstream Vera Sans Mono, Liberation Mono, Nimbus Mono L, Courier New, Courier, monospace;
}

/* Theme colors */
:root {
	--color-gray-20: #e0e0e0;
	--color-gray-50: #C0C0C0;
	--color-gray-90: #333;

	--background-color: #fff;

	--text-color: var(--color-gray-90);
	--text-color-link: #2884d2;
	--text-color-link-active: #15b0ed;
	--text-color-link-visited: #9f4199;

	--syntax-tab-size: 2;
}

@media (prefers-color-scheme: dark) {
	:root {
		--color-gray-20: #e0e0e0;
		--color-gray-50: #C0C0C0;
		--color-gray-90: #dad8d8;

		/* --text-color is assigned to --color-gray-_ above */
		--text-color-link: #1493fb;
		--text-color-link-active: #6969f7;
		--text-color-link-visited: #a6a6f8;

		--background-color: #15202b;
	}
}


/* Global stylesheet */
* {
	box-sizing: border-box;
}

@view-transition {
	navigation: auto;
}

html,
body {
	padding: 0;
	margin: 0 auto;
	font-family: var(--font-family);
	color: var(--text-color);
	background-color: var(--background-color);
}
html {
	overflow-y: scroll;
}
body {
	max-width: 40em;
}

/* https://www.a11yproject.com/posts/how-to-hide-content/ */
.visually-hidden:not(:focus):not(:active) {
	clip: rect(0 0 0 0);
	clip-path: inset(50%);
	height: 1px;
	overflow: hidden;
	position: absolute;
	white-space: nowrap;
	width: 1px;
}

/* Fluid images via https://www.zachleat.com/web/fluid-images/ */
img{
  max-width: 100%;
}
img[width][height] {
  height: auto;
}
img[src$=".svg"] {
  width: 100%;
  height: auto;
  max-width: none;
}
video,
iframe {
	width: 100%;
	height: auto;
}
iframe {
	aspect-ratio: 16/9;
}

p:last-child {
	margin-bottom: 0;
}
p {
	line-height: 1.5;
}

li {
	line-height: 1.5;
}

a[href] {
	color: var(--text-color-link);
}
a[href]:visited {
	color: var(--text-color-link-visited);
}
a[href]:hover,
a[href]:active {
	color: var(--text-color-link-active);
}

main,
footer {
	padding: 1rem;
}
/* main :first-child { */
/* 	margin-top: 0; */
/* } */

header {
	border-bottom: 1px dashed var(--color-gray-20);
}

#skip-link {
	text-decoration: none;
	background: var(--background-color);
	color: var(--text-color);
	padding: 0.5rem 1rem;
	border: 1px solid var(--color-gray-90);
	border-radius: 2px;
}

/* Prevent visually-hidden skip link fom pushing content around when focused */
#skip-link.visually-hidden:focus {
	position: absolute;
	top: 1rem;
	left: 1rem;
	/* Ensure it is positioned on top of everything else when it is shown */
	z-index: 999;
}

.links-nextprev {
	display: flex;
	justify-content: space-between;
	gap: .5em 1em;
	list-style: "";
	border-top: 1px dashed var(--color-gray-20);
	padding: 1em 0;
}
.links-nextprev > * {
	flex-grow: 1;
}
.links-nextprev-next {
	text-align: right;
}

table {
	margin: 1em 0;
}
table td,
table th {
	padding-right: 1em;
}

pre,
code {
	font-family: var(--font-family-monospace);
	color: seagreen;
}

pre,code[class*="language-"] {
	line-height: 1.2em !important;
	font-size: 0.93em !important;
}

pre:not([class*="language-"]) {
	margin: .5em 0;
	line-height: 1.375; /* 22px /16 */
	-moz-tab-size: var(--syntax-tab-size);
	-o-tab-size: var(--syntax-tab-size);
	tab-size: var(--syntax-tab-size);
	-webkit-hyphens: none;
	-ms-hyphens: none;
	hyphens: none;
	direction: ltr;
	text-align: left;
	white-space: pre;
	word-spacing: normal;
	word-break: normal;
	overflow-x: auto;
}
code {
	word-break: break-all;
}

/* Header */
header {
	display: flex;
	gap: 1em;
	flex-wrap: wrap;
	justify-content: space-between;
	align-items: center;
	padding: 1em;
}
.home-link {
	flex-grow: 1;
	font-size: 1em; /* 16px /16 */
	font-weight: 700;
}
.home-link:link:not(:hover) {
	text-decoration: none;
}

/* Nav */
.nav {
	display: flex;
	gap: .5em 1em;
	padding: 0;
	margin: 0;
	list-style: none;
}
.nav-item {
	display: inline-block;
}
.nav-item a[href]:not(:hover) {
	text-decoration: none;
}
.nav a[href][aria-current="page"] {
	text-decoration: underline;
}

/* Posts list */
.postlist {
	counter-reset: start-from var(--postlist-index);
	list-style: none;
	padding: 0;
}
.postlist-item {
	display: flex;
	flex-wrap: wrap;
	align-items: baseline;
	counter-increment: start-from -1;
	margin-bottom: 1em;
}
.postlist-item:before {
	display: inline-block;
	pointer-events: none;
	line-height: 100%;
	text-align: right;
	margin-left: -1.5rem;
}
.postlist-date,
.postlist-item:before {
	font-size: 0.8125em; /* 13px /16 */
	color: var(--color-gray-90);
}
.postlist-date {
	word-spacing: -0.5px;
}
.postlist-link {
	font-size: 1.1875em; /* 19px /16 */
	font-weight: 700;
	flex-basis: calc(100% - 1.5rem);
	text-underline-position: from-font;
	text-underline-offset: 0;
	text-decoration-thickness: 1px;
}
.postlist-item-active .postlist-link {
	font-weight: bold;
}

/* Tags */
.post-tag {
	display: inline-flex;
	align-items: center;
	justify-content: center;
	font-style: italic;
}

/* may want to make the description text smaller at some stage */
.post-description-list {
	font-size: 1.0em;
}

.post-description-main {
	font-style: italic;
}

.postlist-item > .post-tag {
	align-self: center;
}

/* Tags list */
.post-metadata {
	display: inline-flex;
	flex-wrap: wrap;
	gap: .5em;
	list-style: none;
	padding: 0;
	margin: 0;
}
.post-metadata time {
	margin-right: 1em;
}

blockquote {
	margin-top: 0px;
	margin-left: 0px;
	margin-bottom: 15px;
	padding-left: 15px;
	border-left: 5px solid lightgray;
}
/**
 * prism.js default theme for JavaScript, CSS and HTML
 * Based on dabblet (http://dabblet.com)
 * @author Lea Verou
 */

code[class*="language-"],
pre[class*="language-"] {
	color: black;
	background: none;
	text-shadow: 0 1px white;
	font-family: Consolas, Monaco, 'Andale Mono', 'Ubuntu Mono', monospace;
	font-size: 1em;
	text-align: left;
	white-space: pre;
	word-spacing: normal;
	word-break: normal;
	word-wrap: normal;
	line-height: 1.5;

	-moz-tab-size: 4;
	-o-tab-size: 4;
	tab-size: 4;

	-webkit-hyphens: none;
	-moz-hyphens: none;
	-ms-hyphens: none;
	hyphens: none;
}

pre[class*="language-"]::-moz-selection, pre[class*="language-"] ::-moz-selection,
code[class*="language-"]::-moz-selection, code[class*="language-"] ::-moz-selection {
	text-shadow: none;
	background: #b3d4fc;
}

pre[class*="language-"]::selection, pre[class*="language-"] ::selection,
code[class*="language-"]::selection, code[class*="language-"] ::selection {
	text-shadow: none;
	background: #b3d4fc;
}

@media print {
	code[class*="language-"],
	pre[class*="language-"] {
		text-shadow: none;
	}
}

/* Code blocks */
pre[class*="language-"] {
	padding: 1em;
	margin: .5em 0;
	overflow: auto;
}

:not(pre) > code[class*="language-"],
pre[class*="language-"] {
	background: #f5f2f0;
}

/* Inline code */
:not(pre) > code[class*="language-"] {
	padding: .1em;
	border-radius: .3em;
	white-space: normal;
}

.token.comment,
.token.prolog,
.token.doctype,
.token.cdata {
	color: slategray;
}

.token.punctuation {
	color: #999;
}

.token.namespace {
	opacity: .7;
}

.token.property,
.token.tag,
.token.boolean,
.token.number,
.token.constant,
.token.symbol,
.token.deleted {
	color: #905;
}

.token.selector,
.token.attr-name,
.token.string,
.token.char,
.token.builtin,
.token.inserted {
	color: #690;
}

.token.operator,
.token.entity,
.token.url,
.language-css .token.string,
.style .token.string {
	color: #9a6e3a;
	/* This background color was intended by the author of this theme. */
	background: hsla(0, 0%, 100%, .5);
}

.token.atrule,
.token.attr-value,
.token.keyword {
	color: #07a;
}

.token.function,
.token.class-name {
	color: #DD4A68;
}

.token.regex,
.token.important,
.token.variable {
	color: #e90;
}

.token.important,
.token.bold {
	font-weight: bold;
}
.token.italic {
	font-style: italic;
}

.token.entity {
	cursor: help;
}
/*
 * New diff- syntax
 */

pre[class*="language-diff-"] {
	--eleventy-code-padding: 1.25em;
	padding-left: var(--eleventy-code-padding);
	padding-right: var(--eleventy-code-padding);
}
.token.deleted {
	background-color: hsl(0, 51%, 37%);
	color: inherit;
}
.token.inserted {
	background-color: hsl(126, 31%, 39%);
	color: inherit;
}

/* Make the + and - characters unselectable for copy/paste */
.token.prefix.unchanged,
.token.prefix.inserted,
.token.prefix.deleted {
	-webkit-user-select: none;
	user-select: none;
	display: inline-flex;
	align-items: center;
	justify-content: center;
	padding-top: 2px;
	padding-bottom: 2px;
}
.token.prefix.inserted,
.token.prefix.deleted {
	width: var(--eleventy-code-padding);
	background-color: rgba(0,0,0,.2);
}

/* Optional: full-width background color */
.token.inserted:not(.prefix),
.token.deleted:not(.prefix) {
	display: block;
	margin-left: calc(-1 * var(--eleventy-code-padding));
	margin-right: calc(-1 * var(--eleventy-code-padding));
	text-decoration: none; /* override del, ins, mark defaults */
	color: inherit; /* override del, ins, mark defaults */
}
.utterances {
  margin-left: inherit !important;
}</style>
		

    <!-- Global site tag (gtag.js) - Google Analytics -->
    <script async="" src="https://www.googletagmanager.com/gtag/js?id=G-4WQKBG0L4Y"></script>
    

	</head>
	<body>
		<a href="#main" id="skip-link" class="visually-hidden">Skip to main content</a>

		<header>
			<a href="/" class="home-link">DJ Adams</a>
			<nav>
				<h2 class="visually-hidden" id="top-level-navigation-menu">Top level navigation menu</h2>
				<ul class="nav">
					<li class="nav-item"><a href="/">Home</a></li>
					<li class="nav-item"><a href="/about/">About</a></li>
					<li class="nav-item"><a href="/blog/">Blog</a></li>
					<li class="nav-item"><a href="/feed/feed.xml">Feed</a></li>
				</ul>
			</nav>
		</header>

		<main id="main">
			<heading-anchors>
				


<h1 id="bash-shell-expansion-inside-double-quotes">Bash shell expansion inside double quotes</h1>

<ul class="post-metadata">
	<li><time datetime="2023-08-25">25 August 2023</time></li>
	<li><a href="/tags/bash/" class="post-tag">bash</a>, </li>
	<li><a href="/tags/command-line/" class="post-tag">command-line</a></li>
</ul>

<p class="post-description-main"></p>

<p>In the context of this month's <a href="https://blogs.sap.com/2023/08/01/sap-developer-challenge-apis/">SAP Developer Challenge on APIs</a>, some participants working through <a href="https://groups.community.sap.com/t5/application-development/sap-developer-challenge-apis-task-10-request-an-oauth-access/m-p/282016">today's task</a> have tripped up on a Bash feature, a feature which is one of a family of features relating to &quot;expansion&quot; of information. In this short post I dig into what that feature is, and how to ensure you don't trip yourselves up with it.</p>
<h2 id="special-characters">Special characters</h2>
<p>In <a href="https://groups.community.sap.com/t5/application-development/sap-developer-challenge-apis-task-10-request-an-oauth-access/m-p/282016">SAP Developer Challenge - APIs - Task 10 - Request an OAuth access token</a>, my good friend and colleague Daniel stumbled into a problem while conveying OAuth client ID and secret values in a call to <code>curl</code>. It would have been something like this:</p>
<pre class="language-shell" tabindex="0"><code class="language-shell"><span class="token function">curl</span> <span class="token string">'&lt;oauth-authorization-server>'</span> <span class="token punctuation">\</span>
<span class="token parameter variable">-u</span> <span class="token string">"&lt;clientid>:&lt;clientsecret>"</span> <span class="token punctuation">\</span> 
<span class="token parameter variable">-d</span> <span class="token string">"grant_type=&lt;grant-type>"</span>
<span class="token parameter variable">-d</span> <span class="token string">"..."</span></code></pre>
<p>With many services on the SAP Business Technology Platform, client ID and secret values contain special characters, notably here they contain exclamation marks. Here's an example:</p>
<ul>
<li>client ID: <code>sb-ut-f86082c9-7fbf-4e1e-8310-f5d018dab542-clone!b254751|cis-central!b14</code></li>
<li>client secret: <code>dfad81fe-a33d-4252-b612-d49cd9fd3a42$dE1F7W2F3-TrF9kIrkdQaliGqTKR_aCVcv-oaM7ZZ9x=</code></li>
</ul>
<p>They also contain dollar signs.</p>
<h2 id="bash-expansions">Bash expansions</h2>
<p>Bash is a venerable and extremely capable shell, and supports a number of so-called <a href="https://www.gnu.org/software/bash/manual/html_node/Shell-Expansions.html">Shell Expansions</a>, where values are substituted for tokens on the command line. This is before those values are then interpreted as part of whatever command is to be executed. These expansions are initiated by special characters, two of which are the dollar sign <code>$</code> and exclamation mark <code>!</code>.</p>
<h3 id="shell-parameter-expansion">Shell parameter expansion</h3>
<p>The <code>$</code> character introduces <a href="https://www.gnu.org/software/bash/manual/html_node/Shell-Parameter-Expansion.html">shell parameter expansion</a>, and in the very simplest of cases will substitute the value of a variable identified with the <code>$</code> character, replacing the parameter or symbol itself. For example, if we have a variable <code>ans</code> with the value <code>42</code>, then:</p>
<pre class="language-shell" tabindex="0"><code class="language-shell"><span class="token builtin class-name">echo</span> <span class="token string">"The answer is <span class="token variable">$ans</span>"</span></code></pre>
<p>will emit:</p>
<pre class="language-text" tabindex="0"><code class="language-text">The answer is 42</code></pre>
<h3 id="history-expansion">History expansion</h3>
<p>The <code>!</code> character introduces <a href="https://www.gnu.org/software/bash/manual/html_node/History-Interaction.html">history expansion</a>. In the Bash shell, commands are remembered in a history, and can be recalled with the <code>history</code> builtin. Here's an example of the output from <code>history</code>:</p>
<pre class="language-text" tabindex="0"><code class="language-text">1977  date
1978  git status
1979  git add .gitignore
1980  git commit -m 'do not track cache files'</code></pre>
<p>If I wanted to rerun the <code>git status</code> command, I could invoke it like this:</p>
<pre class="language-shell" tabindex="0"><code class="language-shell"><span class="token operator">!</span><span class="token number">1978</span></code></pre>
<p>That might not seem earth shatteringly exciting, but for longer more complex combinations of commands, it can be very useful. Remember also that some shells emit the current history number in the prompt, making it quick and easy to refer to a previous command. And in the older days of slower connections, especially serial terminal connections, the transmission of every character counted!</p>
<h2 id="quotes">Quotes</h2>
<p>Shell parameter and history expansion happen inside double quotes. So if I try:</p>
<pre class="language-shell" tabindex="0"><code class="language-shell"><span class="token builtin class-name">echo</span> <span class="token string">"everything!abc"</span></code></pre>
<p>Then I see this:</p>
<pre class="language-text" tabindex="0"><code class="language-text">-bash: !abc: event not found</code></pre>
<p>The word &quot;event&quot; here refers to a line selected from the history. And as <code>abc</code> isn't in my history as a reference, the error message makes sense.</p>
<p>But if I were to try:</p>
<pre class="language-shell" tabindex="0"><code class="language-shell"><span class="token builtin class-name">echo</span> <span class="token string">"everything!1978"</span></code></pre>
<p>I would see:</p>
<pre class="language-text" tabindex="0"><code class="language-text">everythinggit status</code></pre>
<h2 id="a-note-on-working-with-odata">A note on working with OData</h2>
<p>One thing to note for those of you working with OData, is that the OData system query options are all prefixed with the dollar sign. For example, there's <code>$top</code>, <code>$skip</code>, <code>$expand</code> and so on. So if you were to use <code>curl</code> to request a URL like this (elided for brevity):</p>
<pre class="language-shell" tabindex="0"><code class="language-shell"><span class="token function">curl</span> <span class="token punctuation">\</span>
  <span class="token parameter variable">--url</span> <span class="token string">"https://.../Northwind.svc/Products?<span class="token variable">$top</span>=2"</span></code></pre>
<p>then you'd get rather more product entities than you expected. Instead of receiving just the first two, you'd get all of them. Why? Because through shell parameter expansion, the <code>$top</code> part was expanded into the value of the <code>top</code> parameter, which is (most likely to be) empty, making the actual URL passed to <code>curl</code> this:</p>
<pre class="language-url" tabindex="0"><code class="language-url"><span class="token scheme">https<span class="token scheme-delimiter">:</span></span><span class="token authority"><span class="token authority-delimiter">//</span><span class="token host">...</span></span><span class="token path"><span class="token path-separator">/</span>Northwind.svc<span class="token path-separator">/</span>Products</span><span class="token query"><span class="token query-delimiter">?</span>=2</span>"</code></pre>
<p>Nicely, perhaps through <a href="https://en.wikipedia.org/wiki/Robustness_principle">Postel's Law</a>, the Northwind service quietly ignores the random <code>=2</code> which is thus sent as the query string part of the URL, and returns the entire products entity set.</p>
<h2 id="what-to-do">What to do</h2>
<p>These expansions work within double quotes in Bash. They explicitly and deliberately are not active within single quotes. There is in fact a lot more to know about the <a href="https://stackoverflow.com/questions/6697753/difference-between-single-and-double-quotes-in-bash">difference between single and double quotes in Bash</a>, but all you need to remember for now is that you should only use double quotes when you know you want something magic to happen (such as expansions). If you can get away with using single quotes, then that is often the better way, where the data within remains &quot;passive&quot;.</p>
<p>Here are those two examples from earlier, but expressed in single quotes. First, using an exclamation mark which in double quotes would invoke history expansion:</p>
<pre class="language-shell" tabindex="0"><code class="language-shell"><span class="token punctuation">;</span> <span class="token builtin class-name">echo</span> <span class="token string">'everything!abc'</span>
everything<span class="token operator">!</span>abc</code></pre>
<p>Now using a dollar sign, which in double quotes would invoke parameter expansion:</p>
<pre class="language-shell" tabindex="0"><code class="language-shell"><span class="token punctuation">;</span> <span class="token builtin class-name">echo</span> <span class="token string">'The answer is $ans'</span>
The answer is <span class="token variable">$ans</span></code></pre>
<p>The shell is a wonderful environment, but can be arcane and odd around some edges. But how is that different to the univese in general, right?</p>



<script src="https://utteranc.es/client.js" repo="qmacro/qmacro.github.io" issue-term="title" crossorigin="anonymous" async=""></script>

<ul class="links-nextprev"><li class="links-nextprev-prev">← Previous<br> <a href="/blog/posts/2023/08/08/odata-query-operations-and-url-encoding-the-system-query-options-with-curl/">OData query operations and URL encoding the system query options with curl</a></li><li class="links-nextprev-next">Next →<br><a href="/blog/posts/2023/09/18/devtoberfest-the-best-developer-prep-for-sap-teched/">Devtoberfest - the best developer prep for SAP TechEd</a></li>
</ul>

			</heading-anchors>
		</main>

		<!-- This page `/blog/posts/2023/08/25/bash-shell-expansion-inside-double-quotes/` was built on 2026-01-02T11:36:36.612Z -->
		<script type="module" src="/dist/t-8sxMV3B9.js"></script>
	</body>
</html>
