<!doctype html><html lang="en"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1"><link rel="canonical" href="https://qmacro.org/blog/posts/2021/04/06/sap-tech-bytes:-exploring-sap-samples-with-gh-and-fzf/"><link rel="alternate" type="application/atom+xml" title="DJ's Weblog - Feed" href="https://qmacro.org/feed.xml"><link href="/assets/main.54fe08380532f159e78f.css" rel="stylesheet"><link rel="preconnect" href="https://fonts.gstatic.com"><link href="https://fonts.googleapis.com/css2?family=IBM+Plex+Sans&display=swap" rel="stylesheet"><title>SAP Tech Bytes: Exploring SAP-samples with gh and fzf | DJ Adams</title><link rel="icon" type="“image/x-icon”" href="/images/favicon.ico"><meta property="og:title" content="SAP Tech Bytes: Exploring SAP-samples with gh and fzf"><meta property="og:site_name" content="DJ Adams"><meta property="og:type" content="website"><meta property="og:url" content="https://qmacro.org/blog/posts/2021/04/06/sap-tech-bytes:-exploring-sap-samples-with-gh-and-fzf/"><meta name="description" content="SAP Tech Bytes: Exploring SAP-samples with gh and fzf 06 Apr 2021 | 4 min read Discover repositories that might be useful for you by..."><meta property="og:description" content="SAP Tech Bytes: Exploring SAP-samples with gh and fzf 06 Apr 2021 | 4 min read Discover repositories that might be useful for you by..."><meta name="description" content="SAP Tech Bytes: Exploring SAP-samples with gh and fzf 06 Apr 2021 | 4 min read Discover repositories that might be useful for you by..."><meta property="og:image" content="https://qmacro.org/images/site-image.png"><script src="https://cdn.jsdelivr.net/npm/mermaid/dist/mermaid.min.js"></script><script>mermaid.initialize({startOnLoad:true});</script><script async src="https://www.googletagmanager.com/gtag/js?id=G-4WQKBG0L4Y"></script><script>window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());

      gtag('config', 'G-4WQKBG0L4Y');</script></head><body><div class="layout-wrapper"><header class="header"><div class="header__content"><h1 class="site-title"><a href="/">DJ Adams</a></h1><nav class="nav"><ul class="nav__list"><li class="nav-item"><a href="/about">About Me</a></li><li class="nav-item"><a href="/blog">Blog</a></li><li class="nav-item"><a href="/feed.xml">Feed</a></li></ul></nav></div></header><main class="main"><article class="post"><header class="post__header"><h1>SAP Tech Bytes: Exploring SAP-samples with gh and fzf</h1><div class="post__details"><time datetime="2021-04-06">06 Apr 2021 </time><span>| </span><span>4 min read</span></div></header><main class="post__content"><p><em>Discover repositories that might be useful for you by exploring them from the command line with a couple of powerful tools.</em></p><p>The <a href="https://github.com/SAP-samples">SAP-samples organisation on GitHub</a> contains many repositories with sample code on various SAP technology topics. There's also a new show <a href="https://www.youtube.com/playlist?list=PL6RpkC85SLQDS1XbEQIWG_h3fSj_jG_yQ">SAP Samples Spotlight</a> on our SAP Developers YouTube channel highlighting some of these repositories. We're not going to be able to cover all of them on the show, so here's a way of exploring what's on offer, using command line tools.</p><p><img src="/images/2021/04/org-sampler.gif" alt=""></p><p>GitHub's command line tool <a href="https://github.com/cli/cli">gh</a> gives us the ability to explore the API surface area. The latest release (1.8.1 at the time of writing) offers pagination, result cacheing and a built-in version of <a href="https://jqlang.org/">jq</a>, the JSON processor.</p><p>You can install <code>gh</code> and <code>fzf</code> locally, or even install them in the terminal of a dev space in the SAP Business Application Studio to try things out. See how we do this in the <a href="https://github.com/SAP-samples/teched2020-developer-keynote">SAP TechEd 2020 Developer Keynote repository</a> - take a look specifically at the <a href="https://github.com/SAP-samples/teched2020-developer-keynote/tree/main/usingappstudio#add-tools-to-your-dev-space">Add tools to your dev space</a> section.</p><p>Before you use <code>gh</code> for the first time, you'll need to authenticate - use <code>gh auth login</code> and follow the prompts. Then you're all set to use the <code>org-sampler</code> script as shown above.</p><h2>The script</h2><p>Let's break it down line by line (mostly <a href="/blog/posts/2021/01/26/columnar-layout-with-awk/#homage">in homage to a great teacher, Randal L Schwartz</a>).</p><pre class="language-shell"><code class="language-shell"> <span class="token number">1</span> <span class="token comment">#!/usr/bin/env bash</span><br> <span class="token number">2</span><br> <span class="token number">3</span> <span class="token builtin class-name">readonly</span> <span class="token assign-left variable">org</span><span class="token operator">=</span><span class="token string">"<span class="token variable">${1<span class="token operator">:?</span>Specify org name}</span>"</span><br> <span class="token number">4</span><br> <span class="token number">5</span> <span class="token function-name function">jqscript</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br> <span class="token number">6</span><br> <span class="token number">7</span>   <span class="token function">cat</span> <span class="token operator">&lt;&lt;</span> EOF<br> <span class="token number">8</span>   .<span class="token punctuation">[</span><span class="token punctuation">]</span><br> <span class="token number">9</span>   <span class="token operator">|</span> <span class="token punctuation">[</span><br><span class="token number">10</span>     .name,<br><span class="token number">11</span>     <span class="token string">"Name: \(.name)<span class="token entity" title="\n">\n</span><span class="token entity" title="\n">\n</span>Description: \(.description)<span class="token entity" title="\n">\n</span><span class="token entity" title="\n">\n</span>Language: \(.language)<span class="token entity" title="\n">\n</span>Watchers: \(.watchers_count)<span class="token entity" title="\n">\n</span>Stars: \(.stargazers_count)<span class="token entity" title="\n">\n</span>Forks: \(.forks_count)"</span><br><span class="token number">12</span>     <span class="token punctuation">]</span><br><span class="token number">13</span>   <span class="token operator">|</span> @tsv<br><span class="token number">14</span> EOF<br><span class="token number">15</span><br><span class="token number">16</span> <span class="token punctuation">}</span><br><span class="token number">17</span><br><span class="token number">18</span> gh api<br><span class="token number">19</span>   <span class="token string">"/orgs/<span class="token variable">$org</span>/repos"</span><br><span class="token number">20</span>   <span class="token parameter variable">--paginate</span><br><span class="token number">21</span>   <span class="token parameter variable">--cache</span> 1h<br><span class="token number">22</span>   <span class="token parameter variable">--jq</span> <span class="token string">"<span class="token variable"><span class="token variable">$(</span>jqscript<span class="token variable">)</span></span>"</span><br><span class="token number">23</span>   <span class="token operator">|</span> fzf<br><span class="token number">24</span>     --with-nth<span class="token operator">=</span><span class="token number">1</span><br><span class="token number">25</span>     <span class="token parameter variable">--delimiter</span><span class="token operator">=</span><span class="token string">'\t'</span><br><span class="token number">26</span>     <span class="token parameter variable">--preview</span><span class="token operator">=</span><span class="token string">'echo -e {2}'</span><br><span class="token number">27</span>     --preview-window<span class="token operator">=</span>up:sharp:wrap:40%</code></pre><p>1: the <a href="https://en.wikipedia.org/wiki/Shebang_(Unix)">shebang</a> uses <code>env</code> to find <code>bash</code> on my system to execute the contents of the file</p><p>3: the script expects a single argument to be specified - the name of the organisation on GitHub. For our purposes this should be SAP-samples</p><p>5-16: a simple function to encapsulate the small <code>jq</code> script that will be passed to the invocation of <code>gh</code> to parse the JSON output that is returned from the API call</p><p>8: the JSON output's outermost element is an array, which means we start with <code>.[]</code> to say &quot;take each of the array items&quot;; each array item represents a repository within the organisation, and has different properties</p><p>9: we flow the array items (via the <code>|</code>) into a list of fields that we keep together with <code>[</code> starting on this line, and ending with <code>]</code> on line 12</p><p>10: the first field in the list is simply the value of the <code>name</code> property (the name of the repository)</p><p>11: the second field is a string that's made up of literal and repository property values, combined into a multi-line string (note the newline characters in there <code>\n</code>); this string is what's to be shown in the preview (at the top, in the demo above)</p><p>13: finally each list of fields is flowed into <code>@tsv</code> which produces a tab separated values set of records</p><p>18-22: the main action is in these lines - the call to <code>gh</code>'s <code>api</code> facility</p><p>19: the API call is to the endpoint for <a href="https://docs.github.com/en/rest/reference/repos#list-organization-repositories">listing organisation repositories</a> - specifically for the organisation (in <code>$org</code>) specified when the script was invoked</p><p>20: there are a limited number of results returned by the API in any one response; the <code>--paginate</code> option tells <code>gh</code> to make enough calls to page through all of the results - very convenient!</p><p>21: the recent <code>--cache</code>option allows for cacheing of the results, to save on hitting the API endpoints too frequently and unnecessarily; it makes a lot of sense here given the frequency of new repository creations</p><p>22: the <code>--jq</code> option is also recent, and given that the API output is JSON, is very useful; we use the <code>jq</code> script defined earlier in the <code>jqscript</code> function here to produce that set of tab separated records (where the first field is the repository name and the second field is the multi-line string showing the repository details)</p><p>23: the (tab separated records) output is then passed into <code>fzf</code>to give us a chance to browse or search through the entire list and see the repositories' details</p><p>24: using <code>--with-nth=1</code> we can tell <code>fzf</code> to only show the first field in the actual selection list</p><p>25: we tell <code>fzf</code> how to know what the fields are with <code>--delimiter='\t'</code>, i.e. the fields are separated by tab characters</p><p>26: with <code>--preview='echo -e {2}'</code> we tell <code>fzf</code> that we want to have something shown in a preview window for each item; what is shown is the result of <code>echo -e {2}</code> where <code>{2}</code> is an <code>fzf</code> placeholder representing the second field in the list (i.e. the multi-line string) and the <code>-e</code> switch tells <code>echo</code> to actually interpret backslash escapes, meaning that the newline characters (<code>\n</code>) in the field will be rendered properly and the preview will indeed be multi-line</p><p>27: the <code>--preview-window=up:sharp:wrap:40%</code> option tells <code>fzf</code> how to display the preview window, including that it should be at the top, above the list (<code>up</code>), that any long text lines should be wrapped (this is good for the value of the repositories' description fields) and that the preview window should take up just less than half of the screen (<code>40%</code>)</p><p>And that's it.</p><p>The command line is a powerful environment and with it come powerful tools that can help you retrieve, bend and shape the information you need to work with.</p><h2>Trying it yourself</h2><p>There's a branch for this SAP Tech Bytes post in the accompanying <a href="https://github.com/SAP-samples/sap-tech-bytes">SAP Tech Bytes repository</a>, and it contains the version of the script <a href="https://github.com/SAP-samples/sap-tech-bytes/blob/2021-04-05-exploring-sap-samples-with-gh-and-fzf/org-sampler">org-sampler</a> described above:</p><p><a href="https://github.com/SAP-samples/sap-tech-bytes/tree/2021-04-05-exploring-sap-samples-with-gh-and-fzf">https://github.com/SAP-samples/sap-tech-bytes/tree/2021-04-05-exploring-sap-samples-with-gh-and-fzf</a></p><p><em>This post was inspired by <a href="https://seb.jambor.dev/posts/improving-shell-workflows-with-fzf/">Improving shell workflows with fzf</a>.</em></p><p><a href="#saptechbytes"><img src="/images/2021/02/screenshot-2021-02-22-at-11.00.25.png" alt=""></a></p><hr><p>SAP Tech Bytes is an initiative to bring you bite-sized information on all manner of topics, in <a href="https://www.youtube.com/playlist?list=PL6RpkC85SLQC3HBShmlMaPu_nL--4f20z">video</a> and <a href="/tags/sap-tech-bytes/">written</a> format. Enjoy!</p><hr><p><a href="https://community.sap.com/t5/technology-blogs-by-sap/sap-tech-bytes-exploring-sap-samples-with-gh-and-fzf/ba-p/13512644">Originally published on SAP Community</a></p></main><aside class="post__aside"><div class="post__tags"><a href="/tags/sapcommunity/">#sapcommunity</a> <a href="/tags/gh/">#gh</a> <a href="/tags/fzf/">#fzf</a> <a href="/tags/github/">#github</a> <a href="/tags/sap-tech-bytes/">#sap-tech-bytes</a></div><style>.utterances {
  margin-left: inherit !important;
}</style><script src="https://utteranc.es/client.js" repo="qmacro/qmacro.github.io" issue-term="title" crossorigin="anonymous" async></script><nav class="post__pagination"><a href="/blog/posts/2021/04/13/producing-json-with-jq-for-appending-issue-titles/"><span>←</span> <span>Producing JSON with jq for appending issue titles</span> </a><a href="/blog/posts/2021/04/04/mainframes-sdsf-and-github-actions/"><span>Mainframes, SDSF and GitHub Actions</span> <span>→</span></a></nav></aside></article></main><footer class="footer"><div class="footer__content"><ul class="hero__social-links"><li><a rel="me" href="https://github.com/qmacro" target="_blank" rel="noopener noreferrer">GitHub</a></li><li><a rel="me" href="https://www.youtube.com/djadams-qmacro" target="_blank" rel="noopener noreferrer">YouTube</a></li><li><a rel="me" href="https://www.linkedin.com/in/djadams/" target="_blank" rel="noopener noreferrer">LinkedIn</a></li><li><a rel="me" href="/tweets/">Tweet Archive</a></li><li><a rel="me" href="https://hachyderm.io/@qmacro" target="_blank" rel="noopener noreferrer">Mastodon</a></li><li><a rel="me" href="https://bsky.app/profile/qmacro.org" target="_blank" rel="noopener noreferrer">Bluesky</a></li><li><a href="/feed.xml" target="_blank" rel="noopener noreferrer">RSS</a></li></ul></div></footer></div><script src="/assets/main.31d6cfe0d16ae931b73c.js"></script></body></html>