<!doctype html><html lang="en"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1"><link rel="canonical" href="https://qmacro.org/blog/posts/2021/09/14/sap-tech-bytes:-btp-cli-managing-configuration/"><link rel="alternate" type="application/atom+xml" title="DJ's Weblog - Feed" href="https://qmacro.org/feed.xml"><link href="/assets/main.7884d8f8e9dd86c3b137.css" rel="stylesheet"><link rel="preconnect" href="https://fonts.gstatic.com"><link href="https://fonts.googleapis.com/css2?family=IBM+Plex+Sans&display=swap" rel="stylesheet"><title>SAP Tech Bytes: btp CLI - managing configuration | DJ Adams</title><link rel="icon" type="“image/x-icon”" href="/images/favicon.ico"><meta property="og:title" content="SAP Tech Bytes: btp CLI - managing configuration"><meta property="og:site_name" content="DJ Adams"><meta property="og:type" content="website"><meta property="og:url" content="https://qmacro.org/blog/posts/2021/09/14/sap-tech-bytes:-btp-cli-managing-configuration/"><meta name="description" content="SAP Tech Bytes: btp CLI - managing configuration 14 Sep 2021 | 4 min read Understand and manage the btp CLI client configuration. 🚨 Update:..."><meta property="og:description" content="SAP Tech Bytes: btp CLI - managing configuration 14 Sep 2021 | 4 min read Understand and manage the btp CLI client configuration. 🚨 Update:..."><meta name="description" content="SAP Tech Bytes: btp CLI - managing configuration 14 Sep 2021 | 4 min read Understand and manage the btp CLI client configuration. 🚨 Update:..."><meta property="og:image" content="https://qmacro.org/images/site-image.png"><script src="https://cdn.jsdelivr.net/npm/mermaid/dist/mermaid.min.js"></script><script>mermaid.initialize({startOnLoad:true});</script><script async src="https://www.googletagmanager.com/gtag/js?id=G-4WQKBG0L4Y"></script><script>window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());

      gtag('config', 'G-4WQKBG0L4Y');</script></head><body><div class="layout-wrapper"><header class="header"><div class="header__content"><h1 class="site-title"><a href="/">DJ Adams</a></h1><nav class="nav"><ul class="nav__list"><li class="nav-item"><a href="/about">About Me</a></li><li class="nav-item"><a href="/blog">Blog</a></li><li class="nav-item"><a href="/feed.xml">Feed</a></li></ul></nav></div></header><main class="main"><article class="post"><header class="post__header"><h1>SAP Tech Bytes: btp CLI - managing configuration</h1><div class="post__details"><time datetime="2021-09-14">14 Sep 2021 </time><span>| </span><span>4 min read</span></div></header><main class="post__content"><p><em>Understand and manage the btp CLI client configuration.</em></p><p>🚨 Update: See <a href="/blog/posts/2022/02/17/sap-tech-bytes:-btp-cli-new-home-for-configuration/">SAP Tech Bytes: btp CLI - new home for configuration</a> for new information.</p><p>This is a follow-on post from the previous one: <a href="/blog/posts/2021/09/07/sap-tech-bytes:-btp-cli-logging-in/">SAP Tech Bytes: btp CLI - logging in</a> and starts where we left off there, with you logged in.</p><p>When you connect and authenticate, the connection and login details are stored locally, as we noted from staring at the output from our initial invocation of <code>btp</code>.</p><pre class="language-text"><code class="language-text">Configuration:                     /home/user/.cache/.btp/config.json</code></pre><p>This is the default location that <code>btp</code> uses.</p><h2>App Studio lifecycle</h2><p>This post and the posts in the rest of this SAP Tech Bytes mini-series are based on running the btp CLI in the SAP Business Application Studio (App Studio). Certain directories in your App Studio dev space's work area are cleaned up when a dev space is stopped and restarted.</p><p>One of those directories is the <code>/home/user/.cache/</code> directory.</p><p>If we look at this in detail (with <code>ls -la | grep .cache</code>), it's fairly clear that it's ephemeral - here it's a symbolic link to a directory in <code>/tmp/</code>:</p><pre class="language-text"><code class="language-text">lrwxrwxrwx  1 root root    20 Sep  7 09:01 .cache -> /tmp/usertemp/.cache</code></pre><p>In general, in most Unix-like environments, nothing in <code>/tmp/</code> is guaranteed to be there after a restart. Given that this is where <code>btp</code> stores configuration, what happens when our App Studio dev space is stopped and then restarted? Well, let's find out.</p><p>First, let's make sure that we <em>are</em> still logged in, by invoking <code>btp</code> with no further parameters. If we're logged in, we should see something like this (i.e. <code>btp</code> shows us the details of our connection and identity):</p><pre class="language-text"><code class="language-text">SAP BTP command line interface (client v2.8.0)<br><br>Usage: btp [OPTIONS] ACTION [GROUP/OBJECT] [PARAMS]<br><br>CLI server URL:                    https://cpcli.cf.eu10.hana.ondemand.com (server v2.8.0)<br>User:                              P0003480944 (sapdeveloper@example.com)<br>Configuration:                     /home/user/.cache/.btp/config.json<br><br>Current target:<br>  Global account (subdomain: 82715b8dtrial-ga)<br>  └─ Subaccount (ID: b8a33bf9-b155-4736-aadf-582dae8fd65a)<br><br>Tips:<br>  For information about the targeting mechanism, use 'btp --help target'.<br>  To display general help, use 'btp --help'.<br><br>OK</code></pre><p>Next, go back to the App Studio &quot;Dev Space Manager&quot;, and stop the dev space you created for this btp CLI adventure (in <a href="/blog/posts/2021/09/01/sap-tech-bytes:-btp-cli-installation/">SAP Tech Bytes: btp CLI - installation</a>). Once it's stopped, restart it and re-enter it.</p><blockquote><p>I find the quickest way to get back to the App Studio's &quot;Dev Space Manager&quot; is just to remove the hashpath from the URL; in this example, it would be by removing <code>#ws-kvhjc</code> from <code>https://82715b8dtrial.eu10cf. ... .cloud.sap/index.html#ws-kvhjc</code> (this is the dev space's ID).</p></blockquote><h2>Starting over</h2><p>Now, in a new terminal, first have a look in the <code>.cache/</code> directory (we can refer to this relative name as we'll be in our home directory <code>/home/user/</code> by default in a newly created terminal anyway):</p><pre class="language-shell"><code class="language-shell"><span class="token function">ls</span> <span class="token parameter variable">--all</span> <span class="token parameter variable">--dereference</span> <span class="token parameter variable">--recursive</span> .cache/</code></pre><blockquote><p>the options given to <code>ls</code> here make sure we see hidden files (<code>--all</code>) (remember that <code>.btp</code> begins with a dot and is therefore hidden by default), that symbolic links are followed (<code>--dereference</code>) and that the list descends recursively (<code>--recursive</code>); normally I'd write this as <code>ls -aLR .cache/</code>.</p></blockquote><p>You won't see the <code>.btp/</code> directory or anything in it, because it's not there any more (any content that is there will have been recreated when the dev space was restarted).</p><p>Try <code>btp</code> again. This is the result:</p><pre class="language-text"><code class="language-text">Welcome to the SAP BTP command line interface (client v2.8.0)<br><br>Usage: btp [OPTIONS] ACTION [GROUP/OBJECT] [PARAMS]<br><br>CLI server URL:                    not set<br>User:                              not set<br>Configuration:                     /home/user/.cache/.btp/config.json<br><br>You are currently not logged in.<br><br>Tips:<br>  To log in to a global account of SAP BTP, use 'btp login'. For help on login, use 'btp --help login'.<br>  To display general help, use 'btp --help'.<br><br>OK</code></pre><p>Uh-oh! But not surprising, given that the configuration is gone. Actually, there <em>is</em> some configuration now there, as <code>btp</code> will create a <code>config.json</code> file on invocation. Use the <code>ls</code> command again to see, and you should see (amongst the other content that was there) this:</p><pre class="language-text"><code class="language-text">.cache:<br>.  ..  .btp<br><br>.cache/.btp:<br>.  ..  config.json</code></pre><p>What's in <code>config.json</code>? Basically, this:</p><pre class="language-json"><code class="language-json"><span class="token punctuation">{</span><br>  <span class="token property">"ServerURL"</span><span class="token operator">:</span> <span class="token string">""</span><span class="token punctuation">,</span><br>  <span class="token property">"SubDomain"</span><span class="token operator">:</span> <span class="token string">""</span><span class="token punctuation">,</span><br>  <span class="token property">"UserName"</span><span class="token operator">:</span> <span class="token string">""</span><span class="token punctuation">,</span><br>  <span class="token property">"RefreshToken"</span><span class="token operator">:</span> <span class="token string">""</span><span class="token punctuation">,</span><br>  <span class="token property">"Directory"</span><span class="token operator">:</span> <span class="token string">""</span><span class="token punctuation">,</span><br>  <span class="token property">"Subaccount"</span><span class="token operator">:</span> <span class="token string">""</span><span class="token punctuation">,</span><br>  <span class="token property">"Version"</span><span class="token operator">:</span> <span class="token string">"2.8.0"</span><span class="token punctuation">,</span><br>  <span class="token property">"Authentication"</span><span class="token operator">:</span> <span class="token punctuation">{</span><br>    <span class="token property">"User"</span><span class="token operator">:</span> <span class="token string">""</span><span class="token punctuation">,</span><br>    <span class="token property">"Mail"</span><span class="token operator">:</span> <span class="token string">""</span><br>  <span class="token punctuation">}</span><span class="token punctuation">,</span><br>  <span class="token property">"TrustedURLs"</span><span class="token operator">:</span> <span class="token null keyword">null</span><span class="token punctuation">,</span><br>  <span class="token property">"Autocomplete"</span><span class="token operator">:</span> <span class="token null keyword">null</span><br><span class="token punctuation">}</span></code></pre><p>(although it is flat, unformatted - it wasn't prettified like that).</p><p>So now we understand why <code>btp</code> shows nothing, and that we're not logged in any more.</p><h2>Managing our configuration</h2><p>We need to have the configuration stored in a different place, and used from there, so it persists. Personally, I'm a fan of the <a href="https://specifications.freedesktop.org/basedir-spec.latest.html">X Desktop Group (XDG) Base Directory Specification</a>, which defines environment variables that apps can heed. <code>XDG_CONFIG_HOME</code> is one of those, and &quot;<em>defines the base directory relative to which user-specific configuration files should be stored.</em>&quot;. Moreover, it goes on to say: &quot;<em>If $XDG_CONFIG_HOME is either not set or empty, a default equal to $HOME/.config should be used.</em>&quot;. That works as a nice default for me.</p><p>The btp CLI allows you to <a href="https://help.sap.com/viewer/65de2977205c403bbc107264b8eccf4b/Cloud/en-US/e57288d7f2aa4e59a8f70b08b82a933d.html">specify the location of the configuration file</a> either using the <code>--config</code> option, which you'll need to specify on each invocation of <code>btp</code>, or using the environment variable <code>SAPCP_CLIENTCONFIG</code>.</p><p>Let's tell the btp CLI that we want our configuration in this location (relative to our home directory):</p><pre class="language-text"><code class="language-text">.config/btp/config.json</code></pre><p>Environment variables are best set when a shell session starts, so let's add the appropriate assignment to <code>SAPCP_CLIENTCONFIG</code> in the same file as we added the <code>bin/</code> directory to our path in the <a href="/blog/posts/2021/09/01/sap-tech-bytes:-btp-cli-installation/">previous post</a>. This is the <code>.bashrc</code> file in our home directory.</p><p>You can edit this file using App Studio of course. First, open your home directory as a folder in the explorer, using the &quot;Open Folder&quot; button like this:</p><p><img src="https://raw.githubusercontent.com/SAP-samples/sap-tech-bytes/2021-09-01-btp-cli/draftposts/images/open-home-in-explorer.png" alt=""></p><p>Then find and open the <code>.bashrc</code> file from the Explorer, and at the bottom, add content so it looks like this:</p><pre class="language-shell"><code class="language-shell"><span class="token builtin class-name">export</span> <span class="token assign-left variable"><span class="token environment constant">PATH</span></span><span class="token operator">=</span><span class="token environment constant">$PATH</span><span class="token builtin class-name">:</span><span class="token environment constant">$HOME</span>/bin<br><span class="token builtin class-name">export</span> <span class="token assign-left variable">SAPCP_CLIENTCONFIG</span><span class="token operator">=</span><span class="token environment constant">$HOME</span>/.config/btp/config.json</code></pre><p>Close any existing terminal session and start a new one (Terminal -&gt; New Terminal); this will cause the <code>.bashrc</code> file to be processed, and you can then check that the <code>SAPCP_CLIENTCONFIG</code> environment variable is indeed now set:</p><pre class="language-shell"><code class="language-shell"><span class="token builtin class-name">echo</span> <span class="token variable">$SAPCP_CLIENTCONFIG</span></code></pre><p>It should show you this:</p><pre class="language-text"><code class="language-text">/home/user/.config/btp/config.json</code></pre><p>Now it's time to log back in with the btp CLI. Follow the same login procedure as described in the previous post <a href="/blog/posts/2021/09/07/sap-tech-bytes:-btp-cli-logging-in/">SAP Tech Bytes: btp CLI - logging in</a>. Use the <code>btp target</code> command to specify your trial subaccount too.</p><p>Invoking <code>btp</code> on its own now should show familiar information:</p><pre class="language-text"><code class="language-text">SAP BTP command line interface (client v2.8.0)<br><br>Usage: btp [OPTIONS] ACTION [GROUP/OBJECT] [PARAMS]<br><br>CLI server URL:                    https://cpcli.cf.eu10.hana.ondemand.com (server v2.8.0)<br>User:                              P0003480944 (sapdeveloper@example.com)<br>Configuration:                     /home/user/.config/btp/config.json<br><br>Current target:<br>  Global account (subdomain: 82715b8dtrial-ga)<br>  └─ Subaccount (ID: b8a33bf9-b155-4736-aadf-582dae8fd65a)<br><br>Tips:<br>  For information about the targeting mechanism, use 'btp --help target'.<br>  To display general help, use 'btp --help'.<br><br>OK</code></pre><p>But note the location of the configuration - it is honouring where we told the btp CLI to keep it, via <code>SAPCP_CLIENTCONFIG</code>. Great!</p><h2>Final checks</h2><p>Go through the process of restarting your dev space once more. When starting a new terminal after that, and invoking <code>btp</code>, you should see that your configuration has survived, and you're still logged in. Great!</p><p>In the next post, we look at adding a whole ton of comfort to invoking commands with the btp CLI: <a href="/blog/posts/2021/09/21/sap-tech-bytes:-btp-cli-autocompletion/">SAP Tech Bytes: btp CLI -- autocompletion</a>.</p><hr><p><img src="/images/2021/02/screenshot-2021-02-22-at-11.00.25.png" alt=""></p><p>SAP Tech Bytes is an initiative to bring you bite-sized information on all manner of topics, in <a href="https://www.youtube.com/playlist?list=PL6RpkC85SLQC3HBShmlMaPu_nL--4f20z">video</a> and <a href="https://community.sap.com/t5/tag/sap-tech-bytes/tg-p">written</a> format. Enjoy!</p><hr><p><a href="https://community.sap.com/t5/technology-blogs-by-sap/sap-tech-bytes-btp-cli-managing-configuration/ba-p/13496400">Originally published on SAP Community</a></p></main><aside class="post__aside"><div class="post__tags"><a href="/tags/sapcommunity/">#sapcommunity</a> <a href="/tags/btp/">#btp</a> <a href="/tags/cli/">#cli</a></div><style>.utterances {
  margin-left: inherit !important;
}</style><script src="https://utteranc.es/client.js" repo="qmacro/qmacro.github.io" issue-term="title" crossorigin="anonymous" async></script><nav class="post__pagination"><a href="/blog/posts/2021/09/15/using-functions-more/"><span>←</span> <span>Using functions more</span> </a><a href="/blog/posts/2021/09/12/improving-shell-fu-with-practice/"><span>Improving shell fu with practice</span> <span>→</span></a></nav></aside></article></main><footer class="footer"><div class="footer__content"><ul class="hero__social-links"><li><a rel="me" href="https://github.com/qmacro" target="_blank" rel="noopener noreferrer">GitHub</a></li><li><a rel="me" href="https://www.youtube.com/djadams-qmacro" target="_blank" rel="noopener noreferrer">YouTube</a></li><li><a rel="me" href="https://www.linkedin.com/in/djadams/" target="_blank" rel="noopener noreferrer">LinkedIn</a></li><li><a rel="me" href="/tweets/">Tweet Archive</a></li><li><a rel="me" href="https://hachyderm.io/@qmacro" target="_blank" rel="noopener noreferrer">Mastodon</a></li><li><a rel="me" href="https://bsky.app/profile/qmacro.org" target="_blank" rel="noopener noreferrer">Bluesky</a></li><li><a href="/feed.xml" target="_blank" rel="noopener noreferrer">RSS</a></li></ul></div></footer></div><script src="/assets/main.31d6cfe0d16ae931b73c.js"></script></body></html>