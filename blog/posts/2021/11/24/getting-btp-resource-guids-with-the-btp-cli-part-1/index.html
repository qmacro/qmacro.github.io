<!doctype html><html lang="en"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1"><link rel="canonical" href="https://qmacro.org/blog/posts/2021/11/24/getting-btp-resource-guids-with-the-btp-cli-part-1/"><link rel="alternate" type="application/atom+xml" title="DJ's Weblog - Feed" href="https://qmacro.org/feed.xml"><link href="/assets/main.54fe08380532f159e78f.css" rel="stylesheet"><link rel="preconnect" href="https://fonts.gstatic.com"><link href="https://fonts.googleapis.com/css2?family=IBM+Plex+Sans&display=swap" rel="stylesheet"><title>Getting BTP resource GUIDs with the btp CLI - part 1 | DJ Adams</title><link rel="icon" type="“image/x-icon”" href="/images/favicon.ico"><meta property="og:title" content="Getting BTP resource GUIDs with the btp CLI - part 1"><meta property="og:site_name" content="DJ Adams"><meta property="og:type" content="website"><meta property="og:url" content="https://qmacro.org/blog/posts/2021/11/24/getting-btp-resource-guids-with-the-btp-cli-part-1/"><meta name="description" content="Getting BTP resource GUIDs with the btp CLI - part 1 24 Nov 2021 | 9 min read Learn how to use the btp CLI to determine resource GUIDs in..."><meta property="og:description" content="Getting BTP resource GUIDs with the btp CLI - part 1 24 Nov 2021 | 9 min read Learn how to use the btp CLI to determine resource GUIDs in..."><meta name="description" content="Getting BTP resource GUIDs with the btp CLI - part 1 24 Nov 2021 | 9 min read Learn how to use the btp CLI to determine resource GUIDs in..."><meta property="og:image" content="https://qmacro.org/images/site-image.png"><script src="https://cdn.jsdelivr.net/npm/mermaid/dist/mermaid.min.js"></script><script>mermaid.initialize({startOnLoad:true});</script><script async src="https://www.googletagmanager.com/gtag/js?id=G-4WQKBG0L4Y"></script><script>window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());

      gtag('config', 'G-4WQKBG0L4Y');</script></head><body><div class="layout-wrapper"><header class="header"><div class="header__content"><h1 class="site-title"><a href="/">DJ Adams</a></h1><nav class="nav"><ul class="nav__list"><li class="nav-item"><a href="/about">About Me</a></li><li class="nav-item"><a href="/blog">Blog</a></li><li class="nav-item"><a href="/feed.xml">Feed</a></li></ul></nav></div></header><main class="main"><article class="post"><header class="post__header"><h1>Getting BTP resource GUIDs with the btp CLI - part 1</h1><div class="post__details"><time datetime="2021-11-24">24 Nov 2021 </time><span>| </span><span>9 min read</span></div></header><main class="post__content"><p><em>Learn how to use the btp CLI to determine resource GUIDs in your global account. This post is part 1, covering the <code>bgu</code> mechanism.</em></p><p>Update: the second blog post in this series is now also available: <a href="https://blogs.sap.com/2021/12/01/getting-btp-resource-guids-with-the-btp-cli-part-2-json-and-jq/">Getting BTP resource GUIDs with the btp CLI -- part 2 -- JSON and jq</a>.</p><p>In the <a href="https://reg.sapevents.sap.com/flow/sap/sapteched2021/portal/page/sessions/session/1632238684525001QKhY">Developer Keynote</a> during SAP TechEd, specifically in the Command Line Magic <a href="https://github.com/SAP-samples/teched2021-developer-keynote#sections">section</a>, I used a little mechanism I called <code>bgu</code> (for &quot;btp GUID&quot;), to determine the GUIDs for various resources (a subaccount, and later, a directory) in my global account. Here you can see <code>bgu</code> in action:</p><p><img src="/images/2021/11/bgu-trial-1.png" alt=""></p><p><img src="/images/2021/11/bgu-messaging-1.png" alt=""></p><p>In case you're interested in re-watching this section of the Developer Keynote, there's a link in the <a href="#furtherreading">Further reading and viewing</a> section later.</p><p>In this post I explain what this <code>bgu</code> mechanism is and how it works, because it may be useful to you too. Moreover, the background information and context should provide you with some extra knowledge about BTP and the command line interface tool, <code>btp</code>.</p><h2>Starting at a high level</h2><p>The <code>bgu</code> mechanism is actually a function in my shell environment, which calls a script called <code>btpguid</code>. This in turn uses the btp CLI to examine the global account's resource hierarchy and pick information out of it - specifically the GUID for a given resource name. Let's break that down.</p><p>We can ask what <code>bgu</code> is with the Bash shell's <code>type</code> builtin. This itself is an opportunity for us to enjoy a little bit of meta before we start, by asking what the type of <code>type</code> is:</p><pre class="language-shell"><code class="language-shell"><span class="token punctuation">;</span> <span class="token builtin class-name">type</span> <span class="token builtin class-name">type</span><br><span class="token builtin class-name">type</span> is a shell <span class="token builtin class-name">builtin</span></code></pre><p>Anyway, enough of that, let's ask what <code>bgu</code> is:</p><pre class="language-shell"><code class="language-shell"><span class="token punctuation">;</span> <span class="token builtin class-name">type</span> bgu<br>bgu is a <span class="token keyword">function</span><br><span class="token function-name function">bgu</span> <span class="token punctuation">(</span><span class="token punctuation">)</span><br><span class="token punctuation">{</span><br>    btpguid <span class="token string">"<span class="token variable">$@</span>"</span><span class="token punctuation">;</span><br>    <span class="token keyword">if</span> <span class="token punctuation">[</span><span class="token punctuation">[</span> <span class="token variable">$#</span> <span class="token parameter variable">-gt</span> <span class="token number">1</span> <span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token keyword">then</span><br>        btpctx <span class="token operator">></span> <span class="token string">"<span class="token environment constant">$HOME</span>/.status"</span><span class="token punctuation">;</span><br>    <span class="token keyword">fi</span><br><span class="token punctuation">}</span></code></pre><p>So there we are, <code>bgu</code> is a function that I've defined and made available in my shell. All it does is call <code>btpguid</code> with all of the arguments that were passed:</p><pre class="language-shell"><code class="language-shell">btpguid <span class="token string">"<span class="token variable">$@</span>"</span></code></pre><p>Then, depending on circumstances, it calls another script (<code>btpctx</code>) to write some info to a status file. This is not relevant here (it's related to my <code>tmux</code>-based status line in my terminal) so let's just focus on the call to <code>btpguid</code>.</p><p>So what is <code>btpguid</code>? Let's find out:</p><pre class="language-shell"><code class="language-shell"><span class="token punctuation">;</span> <span class="token builtin class-name">type</span> btpguid<br>btpguid is /home/user/.dotfiles/scripts/btp/btpguid</code></pre><p>So <code>btpguid</code> is a script. Great, let's have a look at it!</p><p><a name="the-btpguid-script"></a></p><h2>The btpguid script</h2><pre class="language-shell"><code class="language-shell"><span class="token shebang important">#!/usr/bin/env bash</span><br><br><span class="token comment"># btpguid - return BTP subaccount/directory GUIDs</span><br><br><span class="token comment"># Usage: btpguid [-t|--target] displayname</span><br><br><span class="token comment"># Returns the GUID for the given subaccount or directory, which is</span><br><span class="token comment"># specified by name. If the option -t or --target is specified, it</span><br><span class="token comment"># will also set that subaccount or directory as the target.</span><br><br><span class="token comment"># Requires the btp CLI. Will direct you to log in first if you're</span><br><span class="token comment"># not already logged in.</span><br><br><span class="token comment"># It uses the detail from the output of this command:</span><br><span class="token comment"># btp get accounts/global-account --show-hierarchy</span><br><br><span class="token comment"># The output looks like this:</span><br><br><span class="token comment"># Showing details for global account af39080b-1527-40a1-b78a-3b605af7e811...</span><br><span class="token comment">#</span><br><span class="token comment"># ├─ c35b11e4trial (af39080b-1527-40a1-b78a-3b605af7e811 - global account)</span><br><span class="token comment"># │  ├─ trial (b6501bff-e0ac-4fdf-8898-81f305d25335 - subaccount)</span><br><span class="token comment"># │  ├─ techedhouse (e57c5b13-9480-4a68-9c04-a603d7a017a9 - directory)</span><br><span class="token comment">#</span><br><span class="token comment"># type:            id:                                    display name:   parent id:</span><br><span class="token comment"># global account   af39080b-1527-40a1-b78a-3b605af7e811   c35b11e4trial</span><br><span class="token comment"># subaccount       b6501bff-e0ac-4fdf-8898-81f305d25335   trial           af39080b-...</span><br><span class="token comment"># directory        e57c5b13-9480-4a68-9c04-a603d7a017a9   techedhouse     af39080b-...</span><br><br><span class="token comment"># It's the second part of the output (the table) that is used.</span><br><br><span class="token comment"># Uses the "${2:-$1}" technique seen in fff - see</span><br><span class="token comment"># https://qmacro.org/autodidactics/2021/09/03/exploring-fff-part-1-main/</span><br><span class="token comment"># for details.</span><br><br><span class="token function-name function">gethier</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>  btp get accounts/global-account --show-hierarchy <span class="token operator"><span class="token file-descriptor important">2</span>></span> /dev/null<br><span class="token punctuation">}</span><br><br><span class="token function-name function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br><br>  <span class="token builtin class-name">local</span> hierarchy subtype guid displayname <span class="token assign-left variable">rc</span><span class="token operator">=</span><span class="token number">0</span><br><br>  <span class="token assign-left variable">displayname</span><span class="token operator">=</span><span class="token string">"<span class="token variable">${2<span class="token operator">:-</span>$1}</span>"</span><br><br>  <span class="token punctuation">[</span><span class="token punctuation">[</span> <span class="token parameter variable">-z</span> <span class="token variable">$displayname</span> <span class="token punctuation">]</span><span class="token punctuation">]</span> <span class="token operator">&amp;&amp;</span> <span class="token punctuation">{</span><br>    <span class="token builtin class-name">echo</span> <span class="token string">"No display name specified"</span><br>    <span class="token builtin class-name">exit</span> <span class="token number">1</span><br>  <span class="token punctuation">}</span><br><br>  <span class="token assign-left variable">hierarchy</span><span class="token operator">=</span><span class="token string">"<span class="token variable"><span class="token variable">$(</span>gethier<span class="token variable">)</span></span>"</span> <span class="token operator">||</span> <span class="token punctuation">{</span> btp login <span class="token operator">&amp;&amp;</span> <span class="token assign-left variable">hierarchy</span><span class="token operator">=</span><span class="token string">"<span class="token variable"><span class="token variable">$(</span>gethier<span class="token variable">)</span></span>"</span><span class="token punctuation">;</span> <span class="token punctuation">}</span><br>  <span class="token builtin class-name">read</span> <span class="token parameter variable">-r</span> subtype guid <span class="token operator">&lt;&lt;&lt;</span> <span class="token string">"$(grep -P -o "^(subaccount|directory)\s+(\S+)(?=\s+<span class="token variable">$displayname</span>)"</span> <span class="token operator">&lt;&lt;&lt;</span> <span class="token string">"<span class="token variable">$hierarchy</span>"</span><span class="token punctuation">)</span><span class="token string">"<br><br>  # Set the subtype as target if requested<br>  [[ <span class="token variable">$1</span> == -t ]] || [[ <span class="token variable">$1</span> == --target ]] &amp;&amp; {<br>    btp target "</span>--<span class="token variable">${subtype}</span><span class="token string">" "</span><span class="token variable">$guid</span><span class="token string">" &amp;> /dev/null<br>    rc=<span class="token variable">$?</span><br>  }<br><br>  echo "</span><span class="token variable">$guid</span><span class="token string">"<br>  return <span class="token variable">$rc</span><br><br>}<br><br>main "</span><span class="token variable">$@</span>"</code></pre><p>Hopefully the comments provide the general idea - given the name of a resource, say &quot;trial&quot; or &quot;techedhouse&quot;, this script will find and return that resource's GUID. In addition, if the <code>--target</code> option is specified, it will also <a href="https://help.sap.com/products/BTP/65de2977205c403bbc107264b8eccf4b/720645a3ed3945bd8d97a670b948ac07.html?locale=en-US">set the default command context</a>, but we'll leave that for another time.</p><h2>An overview of structure in BTP</h2><p>Before we dig in to some of the details of the script, let's just spend a few moments thinking about subaccounts and the hierarchies that can be built using directories.</p><p>Basically, within a global account, you can create subaccounts, and you can set up those subaccounts using directories. This is a flexible and simple way to organise resources, assignments, adminstrative access and more using a well understood paradigm.</p><p>You can read more about this on the SAP Help Portal in <a href="https://help.sap.com/products/BTP/df50977d8bfa4c9a8a063ddb37113c43/b5a6b58694784d0c9f4ff85f9b7336dd.html?locale=en-US">Account Models With Directories and Subaccounts [Feature Set B]</a>.</p><p>Let's look at an example. The structure that existed at the end of the Command Line Magic section of the Developer Keynote looked like this:</p><pre class="language-text"><code class="language-text">├─ 1a99110dtrial (c63c501e-e589-467d-8875-1821927ea713 - global account)<br>│  ├─ trial (00516298-b174-418e-9824-8824de04bfa3 - subaccount)<br>│  ├─ techedhouse (2558794c-f8cd-4422-b071-3b21c2922a02 - directory)<br>│  │  ├─ messaging (3ea88c9c-010b-4bf0-9fdb-5c29c9087660 - subaccount)</code></pre><p>We saw, very briefly, a representation of this structure in the BTP cockpit too, right at the end of this section of the keynote:</p><p><img src="/images/2021/11/hierarchy-1.png" alt=""></p><p>Staring at this structure for a few seconds, we see that it's made up of directories and subaccounts; the &quot;messaging&quot; subaccount sits within the &quot;techedhouse&quot; directory, which itself sits alongside (at the same level as) the default &quot;trial&quot; subaccount that was set up automatically for me when my global account was created.</p><h2>Resources, GUIDs and command substitution</h2><p>When managing these subaccount and directory resources, GUIDs are used. We saw multiple examples where GUIDs are required - here are three of them. However, note that each time, instead of finding and specifying a GUID manually, a <a href="https://www.gnu.org/software/bash/manual/html_node/Command-Substitution.html">command substitution</a> (they look like this: <code>$(...)</code>) is used, to make things easier:</p><ul><li><a href="https://github.com/SAP-samples/teched2021-developer-keynote/tree/main/section/command-line-magic#reducing-existing-entitlement-quota-to-zero">Reducing quota for a subaccount</a>: <code>btp assign accounts/entitlement --for-service enterprise-messaging --plan dev --to-subaccount $(bgu trial) --amount 0</code></li><li><a href="https://github.com/SAP-samples/teched2021-developer-keynote/tree/main/section/command-line-magic#assigning-service-quota-to-directory">Assigning quota to a directory</a>: <code>btp assign accounts/entitlement --for-service enterprise-messaging --plan dev --to-directory $(bgu techedhouse) --amount 1 --auto-assign</code></li><li><a href="https://github.com/SAP-samples/teched2021-developer-keynote/tree/main/section/command-line-magic#creating-the-new-subaccount">Creating the subaccount within a directory</a>: <code>btp create accounts/subaccount --region us10 --display-name messaging --beta-enabled true --subdomain $(uuidgen) --directory $(bgu techedhouse)</code></li></ul><p>In each case, instead of manually looking up the GUID for a resource, and then copy-pasting that in for the value to use with <code>--to-subaccount</code>, <code>--to-directory</code> and <code>--directory</code> above, the <code>bgu</code> mechanism was used to do that for us. As the <a href="https://www.gnu.org/software/bash/manual/html_node/Command-Substitution.html">manual section on command substitution</a> says:</p><blockquote><p>&quot;<em>command substitution allows the output of a command to replace the command itself</em>&quot;</p></blockquote><p>In other words, when you see something like this (taken from the first example above):</p><pre class="language-text"><code class="language-text">--to-subaccount $(bgu trial)</code></pre><p>then what happens is that the command <code>bgu trial</code> is executed, and the output is then substituted as the value for the <code>--to-subaccount</code> parameter.</p><p>(In case you're wondering, command substitution comes in two forms: <code>`...`</code> and <code>$(...)</code>; the former is now deprecated.)</p><p><a name="determining-the-guids"></a></p><h2>Determining the GUIDs</h2><p>Now that we understand the structure of resources in BTP accounts, we can turn our attention to the heart of the <code>btpguid</code> script. This incarnation of the script, which was used in the Developer Keynote, invokes a btp CLI command (which we'll see shortly), and parses some of its output:</p><pre class="language-shell"><code class="language-shell"><span class="token assign-left variable">hierarchy</span><span class="token operator">=</span><span class="token string">"<span class="token variable"><span class="token variable">$(</span>gethier<span class="token variable">)</span></span>"</span> <span class="token operator">||</span> <span class="token punctuation">{</span> btp login <span class="token operator">&amp;&amp;</span> <span class="token assign-left variable">hierarchy</span><span class="token operator">=</span><span class="token string">"<span class="token variable"><span class="token variable">$(</span>gethier<span class="token variable">)</span></span>"</span><span class="token punctuation">;</span> <span class="token punctuation">}</span><br><span class="token builtin class-name">read</span> <span class="token parameter variable">-r</span> subtype guid <span class="token operator">&lt;&lt;&lt;</span> <span class="token string">"$(grep -P -o "^(subaccount|directory)\s+(\S+)(?=\s+<span class="token variable">$displayname</span>)"</span> <span class="token operator">&lt;&lt;&lt;</span> <span class="token string">"<span class="token variable">$hierarchy</span>"</span><span class="token punctuation">)</span>"</code></pre><p>Let's break that down so we understand what's going on.</p><p>The first line executes the <code>gethier</code> function which is defined earlier in the script.</p><blockquote><p>In case you're wondering about the rest of the first line, this is to deal with the situation where you're not yet (or no longer) logged in with <code>btp</code>, and if that's the case, you're guided to log in first, and then the call is re-tried.</p></blockquote><p>The <code>gethier</code> function just runs the following <code>btp</code> command:</p><pre class="language-shell"><code class="language-shell">btp get accounts/global-account --show-hierarchy <span class="token operator"><span class="token file-descriptor important">2</span>></span> /dev/null</code></pre><blockquote><p>I'm redirecting standard error (with <code>2&gt;</code>) to <code>/dev/null</code>, to get rid of anything printed there. Currently the btp CLI outputs an &quot;OK&quot; to standard error, and I don't want to see that anywhere.</p></blockquote><p>The <code>--show-hierarchy</code> parameter is responsible for the lovely detail that you saw earlier. Let's look at an example of that detail before diving into the second line, so we know what we're dealing with. This example is from the script's comments above:</p><pre class="language-text"><code class="language-text">Showing details for global account af39080b-1527-40a1-b78a-3b605af7e811...<br><br>├─ c35b11e4trial (af39080b-1527-40a1-b78a-3b605af7e811 - global account)<br>│  ├─ trial (b6501bff-e0ac-4fdf-8898-81f305d25335 - subaccount)<br>│  ├─ techedhouse (e57c5b13-9480-4a68-9c04-a603d7a017a9 - directory)<br><br>type:            id:                                    display name:   parent id:<br>global account   af39080b-1527-40a1-b78a-3b605af7e811   c35b11e4trial<br>subaccount       b6501bff-e0ac-4fdf-8898-81f305d25335   trial           af39080b-...<br>directory        e57c5b13-9480-4a68-9c04-a603d7a017a9   techedhouse     af39080b-...</code></pre><p>Right, so what is the second line doing? From a high level, it's looking for lines in this output starting with either &quot;subaccount&quot; or &quot;directory&quot;, grabbing the GUID and resource type on the line that's found, and assigning them to two variables, <code>guid</code> and <code>subtype</code> respectively:</p><pre class="language-shell"><code class="language-shell"><span class="token builtin class-name">read</span> <span class="token parameter variable">-r</span> subtype guid <span class="token operator">&lt;&lt;&lt;</span> <span class="token string">"$(grep -P -o "^(subaccount|directory)\s+(\S+)(?=\s+<span class="token variable">$displayname</span>)"</span> <span class="token operator">&lt;&lt;&lt;</span> <span class="token string">"<span class="token variable">$hierarchy</span>"</span><span class="token punctuation">)</span>"</code></pre><p>It looks a little complex, but if you stare at it for a few minutes, this pattern emerges:</p><blockquote><p>read [into two variables] from the results of searching and extracting values from the hierarchy data</p></blockquote><p>A couple of &quot;here strings&quot; in the form of the <code>&lt;&lt;&lt;</code> construct are used (see section 3.6.7 of the <a href="https://www.gnu.org/software/bash/manual/html_node/Redirections.html">Bash manual section on redirections</a>). Such &quot;here strings&quot; allow us to supply the value of a variable as input data to a command or builtin that would normally expect to read from standard input (STDIN). If you're interested in understanding here strings and how they fit in, have a look at <a href="/blog/posts/2021/11/07/exploring-fff-part-2-get_ls_colors/">Input/output redirection, here documents and here strings</a>.</p><p>Knowing this, we can break the line down into parts. The first part is this, inside the command substitution construct <code>$(...)</code>:</p><pre class="language-shell"><code class="language-shell"><span class="token function">grep</span> <span class="token parameter variable">-P</span> <span class="token parameter variable">-o</span> <span class="token string">"^(subaccount|directory)\s+(\S+)(?=\s+<span class="token variable">$displayname</span>)"</span> <span class="token operator">&lt;&lt;&lt;</span> <span class="token string">"<span class="token variable">$hierarchy</span>"</span></code></pre><p>Here are some notes to help you interpret this:</p><table><thead><tr><th>Part</th><th>Description</th></tr></thead><tbody><tr><td><code>grep</code></td><td>this is the command to search for patterns in data</td></tr><tr><td><code>-P</code></td><td>this tells <code>grep</code> that we're going to use a Perl Compatible Regular Expression (PCRE)</td></tr><tr><td><code>-o</code></td><td>this tells <code>grep</code> to output not the entire matched line, but only the parts that are matched and captured (via parentheses)</td></tr><tr><td><code>&quot;$hierarchy&quot;</code></td><td>this is the value of the <code>hierarchy</code> variable that holds the output from <code>btp get accounts/global-account --show-hierarchy</code></td></tr><tr><td><code>^</code></td><td>this anchors the pattern to the beginning of the line (in other words, either &quot;subaccount&quot; or &quot;directory&quot; needs to be right at the start of the line for the match to be successful)</td></tr><tr><td><code>\s</code> and <code>\S</code></td><td>these are very common metacharacters used in regular expressions, and represent &quot;a whitespace character&quot; and &quot;anything but a whitespace character&quot; respectively</td></tr><tr><td><code>+</code></td><td>this is a modifier which represents &quot;at least one, possibly more&quot; and is different from <code>\*</code> which is &quot;zero or more&quot; and <code>?</code> which means &quot;optional (i.e. either no occurrence or just one occurrence)&quot;</td></tr><tr><td><code>$displayname</code></td><td>because the entire pattern is enclosed in double quotes (<code>&quot;...&quot;</code>) the shell will substitute the value of this variable into the pattern; the variable holds the value specified when <code>btpguid</code> is invoked, i.e. the name of the resource we're looking for</td></tr><tr><td><code>(...)</code></td><td>these are matching parentheses, called &quot;capturing groups&quot;, to identify and grab what we want from the match</td></tr><tr><td><code>(?=...)</code></td><td>this is a positive lookahead assertion which allows us to say things like &quot;must be followed by&quot; without consuming anything in the match; note also that despite there being parentheses, this is not itself a capturing group and therefore what's being asserted is not grabbed</td></tr><tr><td><code>&lt;&lt;&lt;</code></td><td>this is a here string construct that provides the input to <code>grep</code> from the value of the <code>hierarchy</code> variable instead of from standard input</td></tr></tbody></table><p>With that in mind, let's look again at the pattern, in quotes:</p><pre class="language-shell"><code class="language-shell"><span class="token string">"^(subaccount|directory)\s+(\S+)(?=\s+<span class="token variable">$displayname</span>)"</span></code></pre><p>If the <code>displayname</code> variable contains &quot;techedhouse&quot;, then, after parameter substitution within these double quotes (i.e. at the shell level), we have this as the actual pattern:</p><pre class="language-shell"><code class="language-shell">^<span class="token punctuation">(</span>subaccount<span class="token operator">|</span>directory<span class="token punctuation">)</span><span class="token punctuation">\</span>s+<span class="token punctuation">(</span><span class="token punctuation">\</span>S+<span class="token punctuation">)</span><span class="token punctuation">(</span>?<span class="token operator">=</span><span class="token punctuation">\</span>s+techedhouse<span class="token punctuation">)</span></code></pre><p>Spoken out loud we might say: <em>the line must start with either 'subaccount' or 'directory' right at the beginning, and whichever it is, we want to capture it; that must be directly followed by at least one whitespace character (<code>\s+</code>), followed by at least one non-whitespace character (<code>\S+</code>), and we want to capture those non-whitespace characters*; oh, but also this must be followed (<code>(?=</code>) by at least one whitespace character (<code>\s+</code>) and then 'techedhouse'</em>.</p><p>* those non-whitespace characters will be the GUID</p><p>Let's test this out manually, to see what happens. Let's assume that we're looking for the GUID of a resource with a display name of &quot;techedhouse&quot;:</p><pre class="language-shell"><code class="language-shell"><span class="token punctuation">;</span> btp get accounts/global-account --show-hierarchy <span class="token operator"><span class="token file-descriptor important">2</span>></span>/dev/null<br>  <span class="token operator">|</span> <span class="token function">grep</span> <span class="token parameter variable">-P</span> <span class="token parameter variable">-o</span> <span class="token string">'^(subaccount|directory)\s+(\S+)(?=\s+techedhouse)'</span><br>directory        2558794c-f8cd-4422-b071-3b21c2922a02</code></pre><p>Note that the whitespace and &quot;techedhouse&quot; inside the positive lookahead assertion (i.e. <code>(?=\s+techedhouse)</code>) is not captured and therefore we don't see it as a third value in the output.</p><p>With the two values output like this:</p><pre class="language-text"><code class="language-text">directory        2558794c-f8cd-4422-b071-3b21c2922a02</code></pre><p>we can better understand what's happening with the <code>read</code> builtin; let's substitute the output to see it in action:</p><pre class="language-shell"><code class="language-shell"><span class="token builtin class-name">read</span> <span class="token parameter variable">-r</span> subtype guid <span class="token operator">&lt;&lt;&lt;</span> <span class="token string">"directory        2558794c-f8cd-4422-b071-3b21c2922a02"</span></code></pre><p>And guess what - after this, the <code>subtype</code> variable will contain &quot;directory&quot; and the <code>guid</code> variable will contain &quot;2558794c-f8cd-4422-b071-3b21c2922a02&quot;. And then with the <code>echo</code> a little bit further on in the script, this GUID is emitted to standard output before the script ends. Nice!</p><p>In case you're wondering about the <code>-r</code> option to the <code>read</code> builtin, it's to stop any backslashes in the input being interpreted inappropriately. I wrote about this in a recent post on my <a href="/tags/autodidactics/">Autodidactics blog</a> - see <a href="/blog/posts/2021/11/07/exploring-fff-part-2-get_ls_colors/#readcommand">The read command</a> section of <a href="/blog/posts/2021/11/07/exploring-fff-part-2-get_ls_colors/">Exploring fff part 2 - get_ls_colors</a>.</p><h2>Wrapping up this part</h2><p>We can see how the power of the <a href="https://en.wikipedia.org/wiki/Unix_philosophy">Unix Philosophy</a> helps us prepare, run, and handle output of executables on the command line. Here we put together just a few lines to help us level up and be even more efficient, by allowing us to determine our SAP Business Technology Platform account's resource GUIDs with zero effort, and use those determined GUIDs in the context of other commands.</p><p>In part 2 we'll learn a little bit more about the Unix Philosophy and then examine alternative output formats for complex data structures and relationships; formats that are more predictable and - with the right tools - more reliably parseable.</p><h2>Further reading and viewing</h2><p>Here's a quick list of resources that you may wish to consume, relating to what you've read in this post:</p><ul><li>The replay of the SAP TechEd Developer Keynote itself: <a href="https://www.youtube.com/watch?v=kOFuwDSXBZg">Improve Developers' Lives: Developer Keynote and Open Discussion</a></li><li>A link to the part of that Developer Keynote replay which goes directly to the relevant demo part: <a href="https://youtu.be/kOFuwDSXBZg?t=193">Command Line Magic</a></li><li>More on the Developer Keynote in this blog post from Thomas Jung: <a href="https://blogs.sap.com/2021/11/17/sap-teched-2021-developer-keynote/">SAP TechEd 2021 Developer Keynote</a></li><li>The SAP btp CLI branch of our SAP Tech Bytes repository on GitHub, which has links to related blog posts: <a href="https://github.com/SAP-samples/sap-tech-bytes/tree/2021-09-01-btp-cli">SAP btp CLI</a></li><li>The official place to download the btp CLI: <a href="https://tools.hana.ondemand.com/#cloud">SAP Development Tools - Cloud</a></li><li>A script that will download, unpack and set up the btp CLI for you: <a href="https://github.com/SAP-samples/sap-tech-bytes/blob/2021-09-01-btp-cli/getbtpcli">getbtpcli</a></li><li>A mini-series on the SAP btp CLI from the Hands-on SAP Dev show on the SAP Developers YouTube channel: <a href="https://www.youtube.com/playlist?list=PL6RpkC85SLQDXx827kdjKc6HRvdMRZ8P5">The SAP btp CLI</a></li><li>A reference manual for Bash: <a href="https://www.gnu.org/software/bash/manual/html_node/index.html">Bash Reference Manual</a></li><li>Documentation from the SAP Help Portal: <a href="https://help.sap.com/products/BTP/65de2977205c403bbc107264b8eccf4b/a21360fa19714751a7c49c796d39ac3d.html?locale=en-US&amp;state=DRAFT&amp;version=Cloud">Setting up a Trial Account via the Command Line [Feature Set B]</a></li><li>The official SAP btp CLI documentation: <a href="https://help.sap.com/products/BTP/65de2977205c403bbc107264b8eccf4b/7c6df2db6332419ea7a862191525377c.html?locale=en-US&amp;version=Cloud">Account Administration Using the SAP BTP Command Line Interface (btp CLI) [Feature Set B]</a></li><li>More deep dives into Bash script arcana: <a href="/blog/posts/2021/09/03/exploring-fff-part-1-main/">Exploring fff part 1 - main</a> and <a href="/blog/posts/2021/11/07/exploring-fff-part-2-get_ls_colors/">Exploring fff part 2 - get_ls_colors</a></li></ul><p>The second blog post in this series is now also available: <a href="https://blogs.sap.com/2021/12/01/getting-btp-resource-guids-with-the-btp-cli-part-2-json-and-jq/">Getting BTP resource GUIDs with the btp CLI -- part 2 -- JSON and jq</a>.</p><hr><p><a href="https://community.sap.com/t5/technology-blogs-by-sap/getting-btp-resource-guids-with-the-btp-cli-part-1/ba-p/13511167">Originally published on SAP Community</a></p></main><aside class="post__aside"><div class="post__tags"><a href="/tags/sapcommunity/">#sapcommunity</a> <a href="/tags/btp/">#btp</a> <a href="/tags/cli/">#cli</a> <a href="/tags/shell/">#shell</a></div><style>.utterances {
  margin-left: inherit !important;
}</style><script src="https://utteranc.es/client.js" repo="qmacro/qmacro.github.io" issue-term="title" crossorigin="anonymous" async></script><nav class="post__pagination"><a href="/blog/posts/2021/12/01/getting-btp-resource-guids-with-the-btp-cli-part-2-json-and-jq/"><span>←</span> <span>Getting BTP resource GUIDs with the btp CLI – part 2 - JSON and jq</span> </a><a href="/blog/posts/2021/11/15/utfrw-unofficial-teched-fun-run-walk-roll-share-your-pics!/"><span>UTFRW - Unofficial TechEd Fun Run / Walk / Roll - Share Your Pics!</span> <span>→</span></a></nav></aside></article></main><footer class="footer"><div class="footer__content"><ul class="hero__social-links"><li><a rel="me" href="https://github.com/qmacro" target="_blank" rel="noopener noreferrer">GitHub</a></li><li><a rel="me" href="https://www.youtube.com/djadams-qmacro" target="_blank" rel="noopener noreferrer">YouTube</a></li><li><a rel="me" href="https://www.linkedin.com/in/djadams/" target="_blank" rel="noopener noreferrer">LinkedIn</a></li><li><a rel="me" href="/tweets/">Tweet Archive</a></li><li><a rel="me" href="https://hachyderm.io/@qmacro" target="_blank" rel="noopener noreferrer">Mastodon</a></li><li><a rel="me" href="https://bsky.app/profile/qmacro.org" target="_blank" rel="noopener noreferrer">Bluesky</a></li><li><a href="/feed.xml" target="_blank" rel="noopener noreferrer">RSS</a></li></ul></div></footer></div><script src="/assets/main.31d6cfe0d16ae931b73c.js"></script></body></html>