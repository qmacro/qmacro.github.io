<!doctype html><html lang="en"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1"><link rel="canonical" href="https://qmacro.org/blog/posts/2021/03/15/aborting-a-script-with-parameter-expansion/"><link href="/assets/main.c8613da530e0f001ce67.css" rel="stylesheet"><link rel="preconnect" href="https://fonts.gstatic.com"><link href="https://fonts.googleapis.com/css2?family=IBM+Plex+Sans&display=swap" rel="stylesheet"><title>Aborting a script with parameter expansion | DJ Adams</title><link rel="icon" type="“image/x-icon”" href="/images/favicon.ico"><meta property="og:title" content="Aborting a script with parameter expansion"><meta property="og:site_name" content="DJ Adams"><meta property="og:type" content="website"><meta property="og:url" content="https://qmacro.org/blog/posts/2021/03/15/aborting-a-script-with-parameter-expansion/"><meta name="twitter:card" content="summary_large_image"><meta name="twitter:creator" content="@qmacro"><meta name="description" content="Aborting a script with parameter expansion 15 Mar 2021 | 2 min read Use the :? form of shell parameter expansion to abort a script if a..."><meta property="og:description" content="Aborting a script with parameter expansion 15 Mar 2021 | 2 min read Use the :? form of shell parameter expansion to abort a script if a..."><meta name="description" content="Aborting a script with parameter expansion 15 Mar 2021 | 2 min read Use the :? form of shell parameter expansion to abort a script if a..."><meta property="og:image" content="https://qmacro.org/images/site-image-square.png"><meta name="twitter:image" content="https://qmacro.org/images/site-image-square.png"><script src="https://cdn.jsdelivr.net/npm/mermaid/dist/mermaid.min.js"></script><script>mermaid.initialize({startOnLoad:true});</script><script async src="https://www.googletagmanager.com/gtag/js?id=G-4WQKBG0L4Y"></script><script>window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());

      gtag('config', 'G-4WQKBG0L4Y');</script></head><body><div class="layout-wrapper"><header class="header"><div class="header__content"><h1 class="site-title"><a href="/">DJ Adams</a></h1><nav class="nav"><ul class="nav__list"><li class="nav-item"><a href="/about">About Me</a></li><li class="nav-item"><a href="/talks">Talks</a></li><li class="nav-item"><a href="/blog">Blog</a></li><li class="nav-item"><a href="/feed.xml">Feed</a></li></ul></nav></div></header><main class="main"><article class="post"><header class="post__header"><h1>Aborting a script with parameter expansion</h1><div class="post__details"><time datetime="2021-03-15">15 Mar 2021 </time><span>| </span><span>2 min read</span></div></header><main class="post__content"><p><em>Use the :? form of shell parameter expansion to abort a script if a required parameter value is not set.</em></p><p>I'm attracted to the somewhat arcane details of <a href="https://www.gnu.org/software/bash/manual/html_node/Shell-Expansions.html">Bash shell expansions</a> and it was while looking up something completely different (more on that another time) that I decided to re-read the <a href="https://www.gnu.org/software/bash/manual/html_node/Shell-Parameter-Expansion.html">parameter expansion</a> section of the GNU Bash manual.</p><p>In many of my scripts, like a good shell scripting citizen I check to ensure that there's a value for a parameter I want to use, and if there isn't, I abort with a message. In this case, abort implies returning a non-zero code, indicating failure.</p><p>The most recent example is in a little script that I've started to use to retrieve the image related to a YouTube live stream episode; this requires the YouTube video ID. The relevant part of this <a href="https://github.com/qmacro/dotfiles/blob/master/scripts/getepisodeimage"><code>getepisodeimage</code></a> script currently looks like this:</p><pre class="language-bash"><code class="language-bash"><span class="token comment"># Requires YouTube video ID</span><br><span class="token builtin class-name">readonly</span> <span class="token assign-left variable">id</span><span class="token operator">=</span><span class="token variable">$1</span><br><br><span class="token keyword">if</span> <span class="token punctuation">[</span> -z <span class="token string">"<span class="token variable">$id</span>"</span> <span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token keyword">then</span><br>  <span class="token builtin class-name">echo</span> <span class="token string">"Usage: <span class="token variable">$scriptname</span> &lt;YOUTUBE VIDEO ID>"</span><br>  <span class="token builtin class-name">exit</span> <span class="token number">1</span><br><span class="token keyword">fi</span></code></pre><p>(And yes, before you say it, I could have saved myself the execution of a binary by replacing the <code>[ ... ]</code> with <code>[[ ... ]]</code>. If you're curious, see <a href="https://qmacro.org/autodidactics/2020/08/21/open-square-bracket/">The open square bracket [ is an executable</a>.)</p><p>Anyway, rather than test for the emptiness of the value of the <code>id</code> parameter (with <code>-z</code>), in a standalone <code>if ... fi</code> section, I could have used the following shell parameter expansion pattern:</p><pre class="language-bash"><code class="language-bash"><span class="token variable">${parameter<span class="token operator">:?</span>word}</span></code></pre><p>The description for this is as follows:</p><blockquote><p>If parameter is null or unset, the expansion of word (or a message to that effect if word is not present) is written to the standard error and the shell, if it is not interactive, exits. Otherwise, the value of parameter is substituted.</p></blockquote><p>I've written about another shell parameter expansion pattern before (see <a href="https://qmacro.org/autodidactics/2020/09/27/shell-parameter-expansion-with-+/">Shell parameter expansion with :+ is useful</a>) but I'd forgotten about this one.</p><p>Using this pattern, I can replace the code above with this:</p><pre class="language-bash"><code class="language-bash"><span class="token builtin class-name">readonly</span> <span class="token assign-left variable">id</span><span class="token operator">=</span><span class="token variable">${1<span class="token operator">:?</span>Usage<span class="token operator">:</span> $scriptname &lt;YOUTUBE VIDEO ID>}</span></code></pre><p>Much more succinct - I like it!</p></main><aside class="post__aside"><div class="post__tags"><a href="/tags/autodidactics/">#autodidactics</a> <a href="/tags/shell/">#shell</a></div><style>.utterances {
  margin-left: inherit !important;
}</style><script src="https://utteranc.es/client.js" repo="qmacro/qmacro.github.io" issue-term="title" crossorigin="anonymous" async></script><nav class="post__pagination"><a href="/blog/posts/2021/03/25/a-new-journal-experiment-thinking-aloud/"><span>←</span> <span>A new journal experiment - Thinking Aloud</span> </a><a href="/blog/posts/2021/02/07/fzf-the-basics-part-2-search-results/"><span>fzf - the basics part 2 - search results</span> <span>→</span></a></nav></aside></article></main><footer class="footer"><div class="footer__content"><ul class="hero__social-links"><li><a href="https://github.com/qmacro" target="_blank" rel="noopener noreferrer">GitHub</a></li><li><a href="https://www.youtube.com/djadams-qmacro" target="_blank" rel="noopener noreferrer">YouTube</a></li><li><a href="https://twitter.com/qmacro" target="_blank" rel="noopener noreferrer">Twitter</a></li><li><a href="/feed.xml" target="_blank" rel="noopener noreferrer">RSS</a></li></ul></div></footer></div><script src="/assets/main.31d6cfe0d16ae931b73c.js"></script></body></html>