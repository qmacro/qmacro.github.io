<!doctype html>
<html lang="en">
	<head>
		<meta charset="utf-8">
		<meta name="viewport" content="width=device-width, initial-scale=1.0">
		<title>SAP Tech Bytes: Approuter User API Service</title>
		<meta name="description" content="Reserving the right to be wrong.">
		<link rel="alternate" href="/feed/feed.xml" type="application/atom+xml" title="DJ Adams">
		<link rel="icon" type="image/x-icon" href="/images/favicon.ico">

      <meta property="og:title" content="SAP Tech Bytes: Approuter User API Service">
        <meta property="og:site_name" content="DJ Adams">
          <meta property="og:image" content="/images/site-image.png">
        <meta property="og:description" content="Reserving the right to be wrong.">
        <meta property="og:url" content="https://qmacro.org/blog/posts/2021/02/20/sap-tech-bytes-approuter-user-api-service/">
		
		
		
		<style>/* This is an arbitrary CSS string added to the bundle */
/* Defaults */
:root {
	--font-family: -apple-system, system-ui, sans-serif;
	--font-family-monospace: Consolas, Menlo, Monaco, Andale Mono WT, Andale Mono, Lucida Console, Lucida Sans Typewriter, DejaVu Sans Mono, Bitstream Vera Sans Mono, Liberation Mono, Nimbus Mono L, Courier New, Courier, monospace;
}

/* Theme colors */
:root {
	--color-gray-20: #e0e0e0;
	--color-gray-50: #C0C0C0;
	--color-gray-90: #333;

	--background-color: #fff;

	--text-color: var(--color-gray-90);
	--text-color-link: #2884d2;
	--text-color-link-active: #15b0ed;
	--text-color-link-visited: #9f4199;

	--syntax-tab-size: 2;
}

@media (prefers-color-scheme: dark) {
	:root {
		--color-gray-20: #e0e0e0;
		--color-gray-50: #C0C0C0;
		--color-gray-90: #dad8d8;

		/* --text-color is assigned to --color-gray-_ above */
		--text-color-link: #1493fb;
		--text-color-link-active: #6969f7;
		--text-color-link-visited: #a6a6f8;

		--background-color: #15202b;
	}
}


/* Global stylesheet */
* {
	box-sizing: border-box;
}

@view-transition {
	navigation: auto;
}

html,
body {
	padding: 0;
	margin: 0 auto;
	font-family: var(--font-family);
	color: var(--text-color);
	background-color: var(--background-color);
}
html {
	overflow-y: scroll;
}
body {
	max-width: 40em;
}

/* https://www.a11yproject.com/posts/how-to-hide-content/ */
.visually-hidden:not(:focus):not(:active) {
	clip: rect(0 0 0 0);
	clip-path: inset(50%);
	height: 1px;
	overflow: hidden;
	position: absolute;
	white-space: nowrap;
	width: 1px;
}

/* Fluid images via https://www.zachleat.com/web/fluid-images/ */
img{
  max-width: 100%;
}
img[width][height] {
  height: auto;
}
img[src$=".svg"] {
  width: 100%;
  height: auto;
  max-width: none;
}
video,
iframe {
	width: 100%;
	height: auto;
}
iframe {
	aspect-ratio: 16/9;
}

p:last-child {
	margin-bottom: 0;
}
p {
	line-height: 1.5;
}

li {
	line-height: 1.5;
}

a[href] {
	color: var(--text-color-link);
}
a[href]:visited {
	color: var(--text-color-link-visited);
}
a[href]:hover,
a[href]:active {
	color: var(--text-color-link-active);
}

main,
footer {
	padding: 1rem;
}
/* main :first-child { */
/* 	margin-top: 0; */
/* } */

header {
	border-bottom: 1px dashed var(--color-gray-20);
}

#skip-link {
	text-decoration: none;
	background: var(--background-color);
	color: var(--text-color);
	padding: 0.5rem 1rem;
	border: 1px solid var(--color-gray-90);
	border-radius: 2px;
}

/* Prevent visually-hidden skip link fom pushing content around when focused */
#skip-link.visually-hidden:focus {
	position: absolute;
	top: 1rem;
	left: 1rem;
	/* Ensure it is positioned on top of everything else when it is shown */
	z-index: 999;
}

.links-nextprev {
	display: flex;
	justify-content: space-between;
	gap: .5em 1em;
	list-style: "";
	border-top: 1px dashed var(--color-gray-20);
	padding: 1em 0;
}
.links-nextprev > * {
	flex-grow: 1;
}
.links-nextprev-next {
	text-align: right;
}

table {
	margin: 1em 0;
}
table td,
table th {
	padding-right: 1em;
}

pre,
code {
	font-family: var(--font-family-monospace);
	color: seagreen;
}

pre,code[class*="language-"] {
	line-height: 1.2em !important;
	font-size: 0.93em !important;
}

pre:not([class*="language-"]) {
	margin: .5em 0;
	line-height: 1.375; /* 22px /16 */
	-moz-tab-size: var(--syntax-tab-size);
	-o-tab-size: var(--syntax-tab-size);
	tab-size: var(--syntax-tab-size);
	-webkit-hyphens: none;
	-ms-hyphens: none;
	hyphens: none;
	direction: ltr;
	text-align: left;
	white-space: pre;
	word-spacing: normal;
	word-break: normal;
	overflow-x: auto;
}
code {
	word-break: break-all;
}

/* Header */
header {
	display: flex;
	gap: 1em;
	flex-wrap: wrap;
	justify-content: space-between;
	align-items: center;
	padding: 1em;
}
.home-link {
	flex-grow: 1;
	font-size: 1em; /* 16px /16 */
	font-weight: 700;
}
.home-link:link:not(:hover) {
	text-decoration: none;
}

/* Nav */
.nav {
	display: flex;
	gap: .5em 1em;
	padding: 0;
	margin: 0;
	list-style: none;
}
.nav-item {
	display: inline-block;
}
.nav-item a[href]:not(:hover) {
	text-decoration: none;
}
.nav a[href][aria-current="page"] {
	text-decoration: underline;
}

/* Posts list */
.postlist {
	counter-reset: start-from var(--postlist-index);
	list-style: none;
	padding: 0;
}
.postlist-item {
	display: flex;
	flex-wrap: wrap;
	align-items: baseline;
	counter-increment: start-from -1;
	margin-bottom: 1em;
}
.postlist-item:before {
	display: inline-block;
	pointer-events: none;
	line-height: 100%;
	text-align: right;
	margin-left: -1.5rem;
}
.postlist-date,
.postlist-item:before {
	font-size: 0.8125em; /* 13px /16 */
	color: var(--color-gray-90);
}
.postlist-date {
	word-spacing: -0.5px;
}
.postlist-link {
	font-size: 1.1875em; /* 19px /16 */
	font-weight: 700;
	flex-basis: calc(100% - 1.5rem);
	text-underline-position: from-font;
	text-underline-offset: 0;
	text-decoration-thickness: 1px;
}
.postlist-item-active .postlist-link {
	font-weight: bold;
}

/* Tags */
.post-tag {
	display: inline-flex;
	align-items: center;
	justify-content: center;
	font-style: italic;
}

/* may want to make the description text smaller at some stage */
.post-description-list {
	font-size: 1.0em;
}

.post-description-main {
	font-style: italic;
}

.postlist-item > .post-tag {
	align-self: center;
}

/* Tags list */
.post-metadata {
	display: inline-flex;
	flex-wrap: wrap;
	gap: .5em;
	list-style: none;
	padding: 0;
	margin: 0;
}
.post-metadata time {
	margin-right: 1em;
}

blockquote {
	margin-top: 0px;
	margin-left: 0px;
	margin-bottom: 15px;
	padding-left: 15px;
	border-left: 5px solid lightgray;
}
/**
 * prism.js default theme for JavaScript, CSS and HTML
 * Based on dabblet (http://dabblet.com)
 * @author Lea Verou
 */

code[class*="language-"],
pre[class*="language-"] {
	color: black;
	background: none;
	text-shadow: 0 1px white;
	font-family: Consolas, Monaco, 'Andale Mono', 'Ubuntu Mono', monospace;
	font-size: 1em;
	text-align: left;
	white-space: pre;
	word-spacing: normal;
	word-break: normal;
	word-wrap: normal;
	line-height: 1.5;

	-moz-tab-size: 4;
	-o-tab-size: 4;
	tab-size: 4;

	-webkit-hyphens: none;
	-moz-hyphens: none;
	-ms-hyphens: none;
	hyphens: none;
}

pre[class*="language-"]::-moz-selection, pre[class*="language-"] ::-moz-selection,
code[class*="language-"]::-moz-selection, code[class*="language-"] ::-moz-selection {
	text-shadow: none;
	background: #b3d4fc;
}

pre[class*="language-"]::selection, pre[class*="language-"] ::selection,
code[class*="language-"]::selection, code[class*="language-"] ::selection {
	text-shadow: none;
	background: #b3d4fc;
}

@media print {
	code[class*="language-"],
	pre[class*="language-"] {
		text-shadow: none;
	}
}

/* Code blocks */
pre[class*="language-"] {
	padding: 1em;
	margin: .5em 0;
	overflow: auto;
}

:not(pre) > code[class*="language-"],
pre[class*="language-"] {
	background: #f5f2f0;
}

/* Inline code */
:not(pre) > code[class*="language-"] {
	padding: .1em;
	border-radius: .3em;
	white-space: normal;
}

.token.comment,
.token.prolog,
.token.doctype,
.token.cdata {
	color: slategray;
}

.token.punctuation {
	color: #999;
}

.token.namespace {
	opacity: .7;
}

.token.property,
.token.tag,
.token.boolean,
.token.number,
.token.constant,
.token.symbol,
.token.deleted {
	color: #905;
}

.token.selector,
.token.attr-name,
.token.string,
.token.char,
.token.builtin,
.token.inserted {
	color: #690;
}

.token.operator,
.token.entity,
.token.url,
.language-css .token.string,
.style .token.string {
	color: #9a6e3a;
	/* This background color was intended by the author of this theme. */
	background: hsla(0, 0%, 100%, .5);
}

.token.atrule,
.token.attr-value,
.token.keyword {
	color: #07a;
}

.token.function,
.token.class-name {
	color: #DD4A68;
}

.token.regex,
.token.important,
.token.variable {
	color: #e90;
}

.token.important,
.token.bold {
	font-weight: bold;
}
.token.italic {
	font-style: italic;
}

.token.entity {
	cursor: help;
}
/*
 * New diff- syntax
 */

pre[class*="language-diff-"] {
	--eleventy-code-padding: 1.25em;
	padding-left: var(--eleventy-code-padding);
	padding-right: var(--eleventy-code-padding);
}
.token.deleted {
	background-color: hsl(0, 51%, 37%);
	color: inherit;
}
.token.inserted {
	background-color: hsl(126, 31%, 39%);
	color: inherit;
}

/* Make the + and - characters unselectable for copy/paste */
.token.prefix.unchanged,
.token.prefix.inserted,
.token.prefix.deleted {
	-webkit-user-select: none;
	user-select: none;
	display: inline-flex;
	align-items: center;
	justify-content: center;
	padding-top: 2px;
	padding-bottom: 2px;
}
.token.prefix.inserted,
.token.prefix.deleted {
	width: var(--eleventy-code-padding);
	background-color: rgba(0,0,0,.2);
}

/* Optional: full-width background color */
.token.inserted:not(.prefix),
.token.deleted:not(.prefix) {
	display: block;
	margin-left: calc(-1 * var(--eleventy-code-padding));
	margin-right: calc(-1 * var(--eleventy-code-padding));
	text-decoration: none; /* override del, ins, mark defaults */
	color: inherit; /* override del, ins, mark defaults */
}
.utterances {
  margin-left: inherit !important;
}</style>
		

    <!-- Global site tag (gtag.js) - Google Analytics -->
    <script async="" src="https://www.googletagmanager.com/gtag/js?id=G-4WQKBG0L4Y"></script>
    

	</head>
	<body>
		<a href="#main" id="skip-link" class="visually-hidden">Skip to main content</a>

		<header>
			<a href="/" class="home-link">DJ Adams</a>
			<nav>
				<h2 class="visually-hidden" id="top-level-navigation-menu">Top level navigation menu</h2>
				<ul class="nav">
					<li class="nav-item"><a href="/">Home</a></li>
					<li class="nav-item"><a href="/about/">About</a></li>
					<li class="nav-item"><a href="/blog/">Blog</a></li>
					<li class="nav-item"><a href="/feed/feed.xml">Feed</a></li>
				</ul>
			</nav>
		</header>

		<main id="main">
			<heading-anchors>
				


<h1 id="sap-tech-bytes-approuter-user-api-service">SAP Tech Bytes: Approuter User API Service</h1>

<ul class="post-metadata">
	<li><time datetime="2021-02-20">20 February 2021</time></li>
	<li><a href="/tags/sapcommunity/" class="post-tag">sapcommunity</a>, </li>
	<li><a href="/tags/saptechbytes/" class="post-tag">saptechbytes</a></li>
</ul>

<p class="post-description-main"></p>

<p><em>Use a simple example to kick the tyres of the new User API Service
available in the <code>@sap/approuter</code> NPM package.</em></p>
<p>In the <a href="https://www.youtube.com/watch?t=461&amp;v=PgCaIHp1JFY&amp;feature=youtu.be">SAP Developer News episode for calendar week
04</a>,
there was an
<a href="https://www.youtube.com/watch?v=PgCaIHp1JFY&amp;list=PL6RpkC85SLQAVBSQXN9522_1jNvPavBgg&amp;index=4&amp;t=462s">item</a>
covering updates to some NPM packages, including
<a href="https://www.npmjs.com/package/@sap/approuter">@sap/approuter</a> - which
now has a <a href="https://www.npmjs.com/package/@sap/approuter#user-api-service">User API
Service</a>.
If you're interested in kicking the tyres of this new User API and
getting a simple example up and running, this quick post is for you
(there's a link to files in our GitHub repo at the end).</p>
<p>The simplest thing that could possibly work is an
<code>@sap/approuter</code>
based app with a minimal configuration as described in the <a href="https://www.npmjs.com/package/@sap/approuter#user-api-service">User API
Service
section</a>.
That app needs to be bound to a minimally configured instance of the
Authorization &amp; Trust Management service (aka &quot;xsuaa&quot;) and running in
Cloud Foundry (CF).</p>
<h2 id="app-with-minimal-configuration">App with minimal configuration</h2>
<p>While the app is still effectively a Node.js package, there is no code,
just configuration. First, in the form of the Node.js <code>package.json</code>
file, which looks like this:</p>
<pre class="language-json" tabindex="0"><code class="language-json"><span class="token punctuation">{</span>
  <span class="token property">"name"</span><span class="token operator">:</span> <span class="token string">"userapitest"</span><span class="token punctuation">,</span>
  <span class="token property">"scripts"</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token property">"start"</span><span class="token operator">:</span> <span class="token string">"node node_modules/@sap/approuter/approuter.js"</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token property">"dependencies"</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token property">"@sap/approuter"</span><span class="token operator">:</span> <span class="token string">"^9.1.0"</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span></code></pre>
<p>The built-in <code>approuter.js</code> script is run directly when the app is
started. It will look for configuration and find it in an
<code>xs-app.json</code> file, the contents of which should look like this:</p>
<pre class="language-json" tabindex="0"><code class="language-json"><span class="token punctuation">{</span>
  <span class="token property">"welcomeFile"</span><span class="token operator">:</span> <span class="token string">"/user-api/attributes"</span><span class="token punctuation">,</span>
  <span class="token property">"routes"</span><span class="token operator">:</span> <span class="token punctuation">[</span>
    <span class="token punctuation">{</span>
      <span class="token property">"source"</span><span class="token operator">:</span> <span class="token string">"^/user-api(.*)"</span><span class="token punctuation">,</span>
      <span class="token property">"target"</span><span class="token operator">:</span> <span class="token string">"$1"</span><span class="token punctuation">,</span>
      <span class="token property">"service"</span><span class="token operator">:</span> <span class="token string">"sap-approuter-userapi"</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">]</span>
<span class="token punctuation">}</span></code></pre>
<p>Note that the welcomeFile property is used to automatically redirect us
to one of the two endpoints supported by the User API Service - the
&quot;attributes&quot; endpoint. The rest of the configuration is taken directly
from the
<a href="https://www.npmjs.com/package/@sap/approuter#user-api-service">documentation</a>.</p>
<p>The xsuaa instance needs some minimal configuration - an app name and
the tenant mode in which it is to run. Here it is, in an
<code>xs-security.json</code> file:</p>
<pre class="language-json" tabindex="0"><code class="language-json"><span class="token punctuation">{</span>
  <span class="token property">"xsappname"</span><span class="token operator">:</span> <span class="token string">"userapitest"</span><span class="token punctuation">,</span>
  <span class="token property">"tenant-mode"</span><span class="token operator">:</span> <span class="token string">"dedicated"</span>
<span class="token punctuation">}</span></code></pre>
<p>We can use a simple manifest for the CF command <code>cf push</code>, to save on
typing. This defines what we need (although it doesn't cause the
creation of the xsuaa service instance, like an MTA based approach
would, but we're keeping things as simple as possible here). The
contents of that manifest - in the <code>manifest.yml</code> file, are as
follows:</p>
<pre class="language-yaml" tabindex="0"><code class="language-yaml">    <span class="token key atrule">applications</span><span class="token punctuation">:</span>
    <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> userapitest
      <span class="token key atrule">disk_quota</span><span class="token punctuation">:</span> 256M
      <span class="token key atrule">instances</span><span class="token punctuation">:</span> <span class="token number">1</span>
      <span class="token key atrule">memory</span><span class="token punctuation">:</span> 256M
      <span class="token key atrule">random-route</span><span class="token punctuation">:</span> <span class="token boolean important">true</span>
      <span class="token key atrule">services</span><span class="token punctuation">:</span>
     <span class="token punctuation">-</span> xsuaa<span class="token punctuation">-</span>application
      <span class="token key atrule">stack</span><span class="token punctuation">:</span> cflinuxfs3</code></pre>
<h3 id="setting-things-up"><strong>Setting things up</strong></h3>
<p>So all we need to do now is to create the xsuaa service instance, with
the &quot;application&quot; plan &amp; those <code>xs-security.json</code> settings, specifying
the name <code>xsuaa-application</code> (as that's what is expected via the
entry in the manifest), and then run the <code>cf push</code>.</p>
<p>Let's take those steps now. First, the service instance creation:</p>
<pre class="language-shell" tabindex="0"><code class="language-shell"><span class="token punctuation">;</span> cf create-service xsuaa application xsuaa-application <span class="token parameter variable">-c</span> xs-security.json 
Creating <span class="token function">service</span> instance xsuaa-application <span class="token keyword">in</span> org xde3af75trial / space dev as sapdeveloper@example.com<span class="token punctuation">..</span>.
OK</code></pre>
<p>Now the xsuaa service instance exists, we can create &amp; deploy the app
and have it bound to that service instance:</p>
<pre class="language-shell" tabindex="0"><code class="language-shell"><span class="token punctuation">;</span> cf push <span class="token parameter variable">-f</span> manifest.yml
Pushing from manifest to org xde3af75trial / space dev as sapdeveloper@example.com<span class="token punctuation">..</span>.
Using manifest <span class="token function">file</span> /Users/sapdeveloper/Projects/userapitest/manifest.yml
Getting app info<span class="token punctuation">..</span>.
Creating app with these attributes<span class="token punctuation">..</span>.
+ name:         userapitest
  path:         /Users/i347491/Projects/userapitest
+ disk quota:   256M
+ instances:    <span class="token number">1</span>
+ memory:       256M
+ stack:        cflinuxfs3
  services:
+   xsuaa-application
  routes:
+   userapitest-grouchy-chimpanzee-nx.cfapps.eu10.hana.ondemand.com
<span class="token punctuation">[</span><span class="token punctuation">..</span>.<span class="token punctuation">]</span>
Waiting <span class="token keyword">for</span> app to start<span class="token punctuation">..</span>.
<span class="token punctuation">[</span><span class="token punctuation">..</span>.<span class="token punctuation">]</span>
     state     since                  cpu    memory          disk         details
<span class="token comment">#0   running   2021-02-19T17:55:10Z   0.0%   35.6K of 256M   8K of 256M</span>
<span class="token punctuation">;</span></code></pre>
<p>And that's it!</p>
<h2 id="checking-the-results">Checking the results</h2>
<p>Accessing the route given in the output (the
&quot;userapitest-grouchy-chimpanzee.nz&quot; route, here) in the browser
results in this output, generated directly by the User API Service for
the <code>/user-api/attributes</code> path:</p>
<pre class="language-shell" tabindex="0"><code class="language-shell"><span class="token punctuation">{</span>
  firstname: <span class="token string">"SAP"</span>,
  lastname: <span class="token string">"Developer"</span>,
  email: <span class="token string">"sapdeveloper@example.com"</span>,
  name: <span class="token string">"sapdeveloper@example.com"</span>,
<span class="token punctuation">}</span></code></pre>
<p>And the output for the <code>/user-api/currentUser</code> path looks like this:</p>
<pre class="language-shell" tabindex="0"><code class="language-shell"><span class="token punctuation">{</span>
  firstname: <span class="token string">"SAP"</span>,
  lastname: <span class="token string">"Developer"</span>,
  email: <span class="token string">"sapdeveloper@example.com"</span>,
  name: <span class="token string">"sapdeveloper@example.com"</span>,
  displayName: <span class="token string">"SAP Developer (sapdeveloper@example.com)"</span>,
<span class="token punctuation">}</span></code></pre>
<h3 id="trying-it-yourself"><strong>Trying it yourself</strong></h3>
<p>There's a branch for this SAP Tech Bytes post in the accompanying <a href="https://github.com/SAP-samples/sap-tech-bytes">SAP
Tech Bytes repository</a>:
Check it out and follow the simple instructions here:</p>
<p><a href="https://github.com/SAP-samples/sap-tech-bytes/tree/2021-02-20-approuter-user-api-service">https://github.com/SAP-samples/sap-tech-bytes/tree/2021-02-20-approuter-user-api-service</a></p>
<hr>
<p><a href="#saptechbytes"><img src="/images/2021/02/screenshot-2021-02-22-at-11.00.25.png" alt=""></a></p>
<p>SAP Tech Bytes is an initiative to bring you bite-sized information on
all manner of topics, in
<a href="https://www.youtube.com/playlist?list=PL6RpkC85SLQC3HBShmlMaPu_nL--4f20z">video</a>
and <a href="https://blogs.sap.com/tag/sap-tech-bytes/">written</a> format. Enjoy!</p>
<hr>
<p><a href="https://community.sap.com/t5/technology-blogs-by-sap/sap-tech-bytes-approuter-user-api-service/ba-p/13488396">Originally published on SAP Community</a></p>



<script src="https://utteranc.es/client.js" repo="qmacro/qmacro.github.io" issue-term="title" crossorigin="anonymous" async=""></script>

<ul class="links-nextprev"><li class="links-nextprev-prev">← Previous<br> <a href="/blog/posts/2021/02/07/fzf-the-basics-part-2-search-results/">fzf - the basics part 2 - search results</a></li><li class="links-nextprev-next">Next →<br><a href="/blog/posts/2021/02/23/sap-teched-developer-keynote-info-central/">SAP TechEd Developer Keynote - Info Central</a></li>
</ul>

			</heading-anchors>
		</main>

		<!-- This page `/blog/posts/2021/02/20/sap-tech-bytes-approuter-user-api-service/` was built on 2025-11-12T11:18:57.584Z -->
		<script type="module" src="/dist/R1izrEYWYW.js"></script>
	</body>
</html>
