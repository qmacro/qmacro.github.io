<!doctype html><html lang="en"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1"><link rel="canonical" href="https://qmacro.org/blog/posts/2021/02/20/sap-tech-bytes:-approuter-user-api-service/"><link rel="alternate" type="application/atom+xml" title="DJ's Weblog - Feed" href="https://qmacro.org/feed.xml"><link href="/assets/main.54fe08380532f159e78f.css" rel="stylesheet"><link rel="preconnect" href="https://fonts.gstatic.com"><link href="https://fonts.googleapis.com/css2?family=IBM+Plex+Sans&display=swap" rel="stylesheet"><title>SAP Tech Bytes: Approuter User API Service | DJ Adams</title><link rel="icon" type="“image/x-icon”" href="/images/favicon.ico"><meta property="og:title" content="SAP Tech Bytes: Approuter User API Service"><meta property="og:site_name" content="DJ Adams"><meta property="og:type" content="website"><meta property="og:url" content="https://qmacro.org/blog/posts/2021/02/20/sap-tech-bytes:-approuter-user-api-service/"><meta name="description" content="SAP Tech Bytes: Approuter User API Service 20 Feb 2021 | 3 min read Use a simple example to kick the tyres of the new User API Service..."><meta property="og:description" content="SAP Tech Bytes: Approuter User API Service 20 Feb 2021 | 3 min read Use a simple example to kick the tyres of the new User API Service..."><meta name="description" content="SAP Tech Bytes: Approuter User API Service 20 Feb 2021 | 3 min read Use a simple example to kick the tyres of the new User API Service..."><meta property="og:image" content="https://qmacro.org/images/site-image.png"><script src="https://cdn.jsdelivr.net/npm/mermaid/dist/mermaid.min.js"></script><script>mermaid.initialize({startOnLoad:true});</script><script async src="https://www.googletagmanager.com/gtag/js?id=G-4WQKBG0L4Y"></script><script>window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());

      gtag('config', 'G-4WQKBG0L4Y');</script></head><body><div class="layout-wrapper"><header class="header"><div class="header__content"><h1 class="site-title"><a href="/">DJ Adams</a></h1><nav class="nav"><ul class="nav__list"><li class="nav-item"><a href="/about">About Me</a></li><li class="nav-item"><a href="/blog">Blog</a></li><li class="nav-item"><a href="/feed.xml">Feed</a></li></ul></nav></div></header><main class="main"><article class="post"><header class="post__header"><h1>SAP Tech Bytes: Approuter User API Service</h1><div class="post__details"><time datetime="2021-02-20">20 Feb 2021 </time><span>| </span><span>3 min read</span></div></header><main class="post__content"><p><em>Use a simple example to kick the tyres of the new User API Service available in the <code>@sap/approuter</code> NPM package.</em></p><p>In the <a href="https://www.youtube.com/watch?t=461&amp;v=PgCaIHp1JFY&amp;feature=youtu.be">SAP Developer News episode for calendar week 04</a>, there was an <a href="https://www.youtube.com/watch?v=PgCaIHp1JFY&amp;list=PL6RpkC85SLQAVBSQXN9522_1jNvPavBgg&amp;index=4&amp;t=462s">item</a> covering updates to some NPM packages, including <a href="https://www.npmjs.com/package/@sap/approuter">@sap/approuter</a> - which now has a <a href="https://www.npmjs.com/package/@sap/approuter#user-api-service">User API Service</a>. If you're interested in kicking the tyres of this new User API and getting a simple example up and running, this quick post is for you (there's a link to files in our GitHub repo at the end).</p><p>The simplest thing that could possibly work is an <code>@sap/approuter</code> based app with a minimal configuration as described in the <a href="https://www.npmjs.com/package/@sap/approuter#user-api-service">User API Service section</a>. That app needs to be bound to a minimally configured instance of the Authorization &amp; Trust Management service (aka &quot;xsuaa&quot;) and running in Cloud Foundry (CF).</p><h2>App with minimal configuration</h2><p>While the app is still effectively a Node.js package, there is no code, just configuration. First, in the form of the Node.js <code>package.json</code> file, which looks like this:</p><pre class="language-json"><code class="language-json"><span class="token punctuation">{</span><br>  <span class="token property">"name"</span><span class="token operator">:</span> <span class="token string">"userapitest"</span><span class="token punctuation">,</span><br>  <span class="token property">"scripts"</span><span class="token operator">:</span> <span class="token punctuation">{</span><br>    <span class="token property">"start"</span><span class="token operator">:</span> <span class="token string">"node node_modules/@sap/approuter/approuter.js"</span><br>  <span class="token punctuation">}</span><span class="token punctuation">,</span><br>  <span class="token property">"dependencies"</span><span class="token operator">:</span> <span class="token punctuation">{</span><br>    <span class="token property">"@sap/approuter"</span><span class="token operator">:</span> <span class="token string">"^9.1.0"</span><br>  <span class="token punctuation">}</span><br><span class="token punctuation">}</span></code></pre><p>The built-in <code>approuter.js</code> script is run directly when the app is started. It will look for configuration and find it in an <code>xs-app.json</code> file, the contents of which should look like this:</p><pre class="language-json"><code class="language-json"><span class="token punctuation">{</span><br>  <span class="token property">"welcomeFile"</span><span class="token operator">:</span> <span class="token string">"/user-api/attributes"</span><span class="token punctuation">,</span><br>  <span class="token property">"routes"</span><span class="token operator">:</span> <span class="token punctuation">[</span><br>    <span class="token punctuation">{</span><br>      <span class="token property">"source"</span><span class="token operator">:</span> <span class="token string">"^/user-api(.*)"</span><span class="token punctuation">,</span><br>      <span class="token property">"target"</span><span class="token operator">:</span> <span class="token string">"$1"</span><span class="token punctuation">,</span><br>      <span class="token property">"service"</span><span class="token operator">:</span> <span class="token string">"sap-approuter-userapi"</span><br>    <span class="token punctuation">}</span><br>  <span class="token punctuation">]</span><br><span class="token punctuation">}</span></code></pre><p>Note that the welcomeFile property is used to automatically redirect us to one of the two endpoints supported by the User API Service - the &quot;attributes&quot; endpoint. The rest of the configuration is taken directly from the <a href="https://www.npmjs.com/package/@sap/approuter#user-api-service">documentation</a>.</p><p>The xsuaa instance needs some minimal configuration - an app name and the tenant mode in which it is to run. Here it is, in an <code>xs-security.json</code> file:</p><pre class="language-json"><code class="language-json"><span class="token punctuation">{</span><br>  <span class="token property">"xsappname"</span><span class="token operator">:</span> <span class="token string">"userapitest"</span><span class="token punctuation">,</span><br>  <span class="token property">"tenant-mode"</span><span class="token operator">:</span> <span class="token string">"dedicated"</span><br><span class="token punctuation">}</span></code></pre><p>We can use a simple manifest for the CF command <code>cf push</code>, to save on typing. This defines what we need (although it doesn't cause the creation of the xsuaa service instance, like an MTA based approach would, but we're keeping things as simple as possible here). The contents of that manifest - in the <code>manifest.yml</code> file, are as follows:</p><pre class="language-yaml"><code class="language-yaml">    <span class="token key atrule">applications</span><span class="token punctuation">:</span><br>    <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> userapitest<br>      <span class="token key atrule">disk_quota</span><span class="token punctuation">:</span> 256M<br>      <span class="token key atrule">instances</span><span class="token punctuation">:</span> <span class="token number">1</span><br>      <span class="token key atrule">memory</span><span class="token punctuation">:</span> 256M<br>      <span class="token key atrule">random-route</span><span class="token punctuation">:</span> <span class="token boolean important">true</span><br>      <span class="token key atrule">services</span><span class="token punctuation">:</span><br>     <span class="token punctuation">-</span> xsuaa<span class="token punctuation">-</span>application<br>      <span class="token key atrule">stack</span><span class="token punctuation">:</span> cflinuxfs3</code></pre><h3><strong>Setting things up</strong></h3><p>So all we need to do now is to create the xsuaa service instance, with the &quot;application&quot; plan &amp; those <code>xs-security.json</code> settings, specifying the name <code>xsuaa-application</code> (as that's what is expected via the entry in the manifest), and then run the <code>cf push</code>.</p><p>Let's take those steps now. First, the service instance creation:</p><pre class="language-shell"><code class="language-shell"><span class="token punctuation">;</span> cf create-service xsuaa application xsuaa-application <span class="token parameter variable">-c</span> xs-security.json <br>Creating <span class="token function">service</span> instance xsuaa-application <span class="token keyword">in</span> org xde3af75trial / space dev as sapdeveloper@example.com<span class="token punctuation">..</span>.<br>OK</code></pre><p>Now the xsuaa service instance exists, we can create &amp; deploy the app and have it bound to that service instance:</p><pre class="language-shell"><code class="language-shell"><span class="token punctuation">;</span> cf push <span class="token parameter variable">-f</span> manifest.yml<br>Pushing from manifest to org xde3af75trial / space dev as sapdeveloper@example.com<span class="token punctuation">..</span>.<br>Using manifest <span class="token function">file</span> /Users/sapdeveloper/Projects/userapitest/manifest.yml<br>Getting app info<span class="token punctuation">..</span>.<br>Creating app with these attributes<span class="token punctuation">..</span>.<br>+ name:         userapitest<br>  path:         /Users/i347491/Projects/userapitest<br>+ disk quota:   256M<br>+ instances:    <span class="token number">1</span><br>+ memory:       256M<br>+ stack:        cflinuxfs3<br>  services:<br>+   xsuaa-application<br>  routes:<br>+   userapitest-grouchy-chimpanzee-nx.cfapps.eu10.hana.ondemand.com<br><span class="token punctuation">[</span><span class="token punctuation">..</span>.<span class="token punctuation">]</span><br>Waiting <span class="token keyword">for</span> app to start<span class="token punctuation">..</span>.<br><span class="token punctuation">[</span><span class="token punctuation">..</span>.<span class="token punctuation">]</span><br>     state     since                  cpu    memory          disk         details<br><span class="token comment">#0   running   2021-02-19T17:55:10Z   0.0%   35.6K of 256M   8K of 256M</span><br><span class="token punctuation">;</span></code></pre><p>And that's it!</p><h2>Checking the results</h2><p>Accessing the route given in the output (the &quot;userapitest-grouchy-chimpanzee.nz&quot; route, here) in the browser results in this output, generated directly by the User API Service for the <code>/user-api/attributes</code> path:</p><pre class="language-shell"><code class="language-shell"><span class="token punctuation">{</span><br>  firstname: <span class="token string">"SAP"</span>,<br>  lastname: <span class="token string">"Developer"</span>,<br>  email: <span class="token string">"sapdeveloper@example.com"</span>,<br>  name: <span class="token string">"sapdeveloper@example.com"</span>,<br><span class="token punctuation">}</span></code></pre><p>And the output for the <code>/user-api/currentUser</code> path looks like this:</p><pre class="language-shell"><code class="language-shell"><span class="token punctuation">{</span><br>  firstname: <span class="token string">"SAP"</span>,<br>  lastname: <span class="token string">"Developer"</span>,<br>  email: <span class="token string">"sapdeveloper@example.com"</span>,<br>  name: <span class="token string">"sapdeveloper@example.com"</span>,<br>  displayName: <span class="token string">"SAP Developer (sapdeveloper@example.com)"</span>,<br><span class="token punctuation">}</span></code></pre><h3><strong>Trying it yourself</strong></h3><p>There's a branch for this SAP Tech Bytes post in the accompanying <a href="https://github.com/SAP-samples/sap-tech-bytes">SAP Tech Bytes repository</a>: Check it out and follow the simple instructions here:</p><p><a href="https://github.com/SAP-samples/sap-tech-bytes/tree/2021-02-20-approuter-user-api-service">https://github.com/SAP-samples/sap-tech-bytes/tree/2021-02-20-approuter-user-api-service</a></p><hr><p><a href="#saptechbytes"><img src="/images/2021/02/screenshot-2021-02-22-at-11.00.25.png" alt=""></a></p><p>SAP Tech Bytes is an initiative to bring you bite-sized information on all manner of topics, in <a href="https://www.youtube.com/playlist?list=PL6RpkC85SLQC3HBShmlMaPu_nL--4f20z">video</a> and <a href="https://blogs.sap.com/tag/sap-tech-bytes/">written</a> format. Enjoy!</p><hr><p><a href="https://community.sap.com/t5/technology-blogs-by-sap/sap-tech-bytes-approuter-user-api-service/ba-p/13488396">Originally published on SAP Community</a></p></main><aside class="post__aside"><div class="post__tags"><a href="/tags/sapcommunity/">#sapcommunity</a> <a href="/tags/saptechbytes/">#saptechbytes</a></div><style>.utterances {
  margin-left: inherit !important;
}</style><script src="https://utteranc.es/client.js" repo="qmacro/qmacro.github.io" issue-term="title" crossorigin="anonymous" async></script><nav class="post__pagination"><a href="/blog/posts/2021/02/23/sap-teched-developer-keynote-info-central/"><span>←</span> <span>SAP TechEd Developer Keynote - Info Central</span> </a><a href="/blog/posts/2021/02/07/fzf-the-basics-part-2-search-results/"><span>fzf - the basics part 2 - search results</span> <span>→</span></a></nav></aside></article></main><footer class="footer"><div class="footer__content"><ul class="hero__social-links"><li><a rel="me" href="https://github.com/qmacro" target="_blank" rel="noopener noreferrer">GitHub</a></li><li><a rel="me" href="https://www.youtube.com/djadams-qmacro" target="_blank" rel="noopener noreferrer">YouTube</a></li><li><a rel="me" href="https://www.linkedin.com/in/djadams/" target="_blank" rel="noopener noreferrer">LinkedIn</a></li><li><a rel="me" href="/tweets/">Tweet Archive</a></li><li><a rel="me" href="https://hachyderm.io/@qmacro" target="_blank" rel="noopener noreferrer">Mastodon</a></li><li><a rel="me" href="https://bsky.app/profile/qmacro.org" target="_blank" rel="noopener noreferrer">Bluesky</a></li><li><a href="/feed.xml" target="_blank" rel="noopener noreferrer">RSS</a></li></ul></div></footer></div><script src="/assets/main.31d6cfe0d16ae931b73c.js"></script></body></html>