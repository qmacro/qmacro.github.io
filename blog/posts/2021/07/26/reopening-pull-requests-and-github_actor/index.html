<!doctype html><html lang="en"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1"><link rel="canonical" href="https://qmacro.org/blog/posts/2021/07/26/reopening-pull-requests-and-github_actor/"><link rel="alternate" type="application/rss+xml" title="DJ's Weblog - Feed" href="https://qmacro.org/feed.xml"><link href="/assets/main.4654d4542dcb045c9ba3.css" rel="stylesheet"><link rel="preconnect" href="https://fonts.gstatic.com"><link href="https://fonts.googleapis.com/css2?family=IBM+Plex+Sans&display=swap" rel="stylesheet"><title>Reopening pull requests and GITHUB_ACTOR | DJ Adams</title><link rel="icon" type="“image/x-icon”" href="/images/favicon.ico"><meta property="og:title" content="Reopening pull requests and GITHUB_ACTOR"><meta property="og:site_name" content="DJ Adams"><meta property="og:type" content="website"><meta property="og:url" content="https://qmacro.org/blog/posts/2021/07/26/reopening-pull-requests-and-github_actor/"><meta name="description" content="Reopening pull requests and GITHUB_ACTOR 26 Jul 2021 | 2 min read Today I learned that the GITHUB_ACTOR on a re-opened pull request reflects..."><meta property="og:description" content="Reopening pull requests and GITHUB_ACTOR 26 Jul 2021 | 2 min read Today I learned that the GITHUB_ACTOR on a re-opened pull request reflects..."><meta name="description" content="Reopening pull requests and GITHUB_ACTOR 26 Jul 2021 | 2 min read Today I learned that the GITHUB_ACTOR on a re-opened pull request reflects..."><meta property="og:image" content="https://qmacro.org/images/site-image.png"><script src="https://cdn.jsdelivr.net/npm/mermaid/dist/mermaid.min.js"></script><script>mermaid.initialize({startOnLoad:true});</script><script async src="https://www.googletagmanager.com/gtag/js?id=G-4WQKBG0L4Y"></script><script>window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());

      gtag('config', 'G-4WQKBG0L4Y');</script></head><body><div class="layout-wrapper"><header class="header"><div class="header__content"><h1 class="site-title"><a href="/">DJ Adams</a></h1><nav class="nav"><ul class="nav__list"><li class="nav-item"><a href="/about">About Me</a></li><li class="nav-item"><a href="/talks">Talks</a></li><li class="nav-item"><a href="/blog">Blog</a></li><li class="nav-item"><a href="/feed.xml">Feed</a></li></ul></nav></div></header><main class="main"><article class="post"><header class="post__header"><h1>Reopening pull requests and GITHUB_ACTOR</h1><div class="post__details"><time datetime="2021-07-26">26 Jul 2021 </time><span>| </span><span>2 min read</span></div></header><main class="post__content"><p><em>Today I learned that the <code>GITHUB_ACTOR</code> on a re-opened pull request reflects the person re-opening it, not the original creator.</em></p><p>Over on the <a href="https://github.com/SAP-docs/contribution-guidelines">Community Guidelines</a> content for SAP's <a href="https://blogs.sap.com/2021/05/20/introducing-the-open-documentation-initiative/">Open Documentation Initiative</a> there was a <a href="https://github.com/SAP-docs/contribution-guidelines/pull/64">recent pull request</a> (PR) that was opened by user <code>cyberpinguin</code>.</p><p>We have a GitHub Actions workflow <a href="https://github.com/SAP-docs/contribution-guidelines/blob/main/.github/workflows/disallowed-content-checks.yaml">Disallowed content checker</a> that ensures that contributions coming in via PRs are targeting the appropriate content. The workflow <a href="https://github.com/SAP-docs/contribution-guidelines/runs/2953360170?check_suite_focus=true">was duly triggered</a>, as expected, and appropriately <a href="https://github.com/SAP-docs/contribution-guidelines/pull/64#issuecomment-871460299">alerted</a> the user that the contribution was outside of the desired target location.</p><p>We want to allow administrators of the repo to be able to maintain content across the whole repo, rather than restrict them, and we want those who are not administrators to be restricted. We do this by checking the collaborator permissions, using the <a href="https://docs.github.com/en/rest/reference/repos#get-repository-permissions-for-a-user">Collaborators</a> section of the GitHub API, like this:</p><pre class="language-shell"><code class="language-shell">gh api <span class="token punctuation">\</span><br>  <span class="token parameter variable">--jq</span> .permission <span class="token punctuation">\</span><br>  <span class="token string">"/repos/<span class="token variable">$GITHUB_REPOSITORY</span>/collaborators/<span class="token variable">$GITHUB_ACTOR</span>/permission"</span></code></pre><p>So far so good.</p><p>Shortly after opening the PR, the user <a href="https://github.com/SAP-docs/contribution-guidelines/pull/64#event-4983349361">closed</a> it (by mistake, I think), and it was <a href="https://github.com/SAP-docs/contribution-guidelines/pull/64#event-4987076185">re-opened</a> by my colleague and fellow Contribution Guidelines administrator <a href="https://github.com/je-hal">Jens</a>. As a result of this re-opening of the PR, the workflow was triggered again.</p><p>However, this time, no disallowed content alert was raised. Why was this?</p><p>Looking at <a href="https://github.com/SAP-docs/contribution-guidelines/runs/3006185835?check_suite_focus=true">the execution for that workflow run</a>, it's clear that the steps that would have caused an alert to be issued were skipped; the skip logic looks like this:</p><pre class="language-yaml"><code class="language-yaml"><span class="token punctuation">-</span> <span class="token key atrule">id</span><span class="token punctuation">:</span> check_files_changed<br>  <span class="token key atrule">name</span><span class="token punctuation">:</span> Checks if disallowed content has been changed<br>  <span class="token key atrule">if</span><span class="token punctuation">:</span> env.repo_permission <span class="token tag">!=</span> 'admin'<br>  <span class="token key atrule">uses</span><span class="token punctuation">:</span> dorny/paths<span class="token punctuation">-</span>filter@v2<br>  <span class="token key atrule">with</span><span class="token punctuation">:</span><br>    <span class="token key atrule">list-files</span><span class="token punctuation">:</span> <span class="token string">'shell'</span><br>    <span class="token key atrule">filters</span><span class="token punctuation">:</span> <span class="token punctuation">|</span><span class="token scalar string"><br>      disallowed:<br>        - '!docs/**'</span><br><span class="token punctuation">-</span> <span class="token key atrule">id</span><span class="token punctuation">:</span> comment_on_disallowed<br>  <span class="token key atrule">if</span><span class="token punctuation">:</span> steps.check_files_changed.outputs.disallowed == 'true'<br>  <span class="token punctuation">...</span></code></pre><p>So it would seem that the permissions for the <code>GITHUB_ACTOR</code> in this subsequent execution were 'admin'. Why?</p><p>Because, as it turns out (and I confirmed this with a simple test just now) the value of <code>GITHUB_ACTOR</code> is set to the user who opens -- or re-opens -- a PR. In this case it was Jens, an administrator.</p><p>This is not what I'd expected, so I thought I'd write it up and share it.</p></main><aside class="post__aside"><div class="post__tags"><a href="/tags/autodidactics/">#autodidactics</a> <a href="/tags/github-actions/">#github-actions</a></div><style>.utterances {
  margin-left: inherit !important;
}</style><script src="https://utteranc.es/client.js" repo="qmacro/qmacro.github.io" issue-term="title" crossorigin="anonymous" async></script><nav class="post__pagination"><a href="/blog/posts/2021/08/06/tmux-output-formatting/"><span>←</span> <span>tmux output formatting</span> </a><a href="/blog/posts/2021/07/21/unix-tooling-join-don&#39;t-extend/"><span>Unix tooling - join, don&#39;t extend</span> <span>→</span></a></nav></aside></article></main><footer class="footer"><div class="footer__content"><ul class="hero__social-links"><li><a rel="me" href="https://github.com/qmacro" target="_blank" rel="noopener noreferrer">GitHub</a></li><li><a rel="me" href="https://www.youtube.com/djadams-qmacro" target="_blank" rel="noopener noreferrer">YouTube</a></li><li><a rel="me" href="https://hachyderm.io/@qmacro" target="_blank" rel="noopener noreferrer">Mastodon</a></li><li><a href="/feed.xml" target="_blank" rel="noopener noreferrer">RSS</a></li></ul></div></footer></div><script src="/assets/main.31d6cfe0d16ae931b73c.js"></script></body></html>