2023-08-09-sap-developer-challenge-apis-task-3-have-a-northbreeze-product-selected-for
SAP Developer Challenge - APIs - Task 3 - Have a Northbreeze product selected for you
application-developmentforum-board
2023-08-09
https://community.sap.com/t5/application-development-discussions/sap-developer-challenge-apis-task-3-have-a-northbreeze-product-selected-for/td-p/277972
<P>(Check out the <A href="https://blogs.sap.com/2023/08/01/sap-developer-challenge-apis/" target="_blank" rel="noopener noreferrer">SAP Developer Challenge - APIs</A> blog post for everything you need to know about the challenge to which this task relates!)</P><P>In this task you'll learn a bit about actions and functions in OData V4.</P><H2 id="toc-hId-1651263202">Background</H2><P>While OData V2 did have function imports, the advent of OData V4 brought about enhancements in this area and we now have a clean distinction between different types of orthogonal endpoints that can be presented in an OData service alongside the entity sets, singletons and more. See the <A href="https://github.com/qmacro/odata-v4-and-cap/blob/main/slides.md#actions-and-functions" target="_blank" rel="noopener nofollow noreferrer">Actions and functions</A> sections of the <A href="https://github.com/qmacro/odata-v4-and-cap/blob/main/slides.md" target="_blank" rel="noopener nofollow noreferrer">OData V4 and SAP Cloud Application Programming Model</A> talk slides for more info.</P><P>With CAP's support for OData V4's actions and functions ready for us to enjoy, it's a good opportunity to try things out here.</P><P>In addition to the entity sets we saw in the previous task, the <A href="https://developer-challenge.cfapps.eu10.hana.ondemand.com/odata/v4/northbreeze" target="_blank" rel="noopener nofollow noreferrer">Northbreeze OData V4 service</A> also sports an action. If you check the service's <A href="https://developer-challenge.cfapps.eu10.hana.ondemand.com/odata/v4/northbreeze/$metadata" target="_blank" rel="noopener nofollow noreferrer">metadata document</A> document you'll see the evidence of this action.</P><P>First, it appears alongside the EntitySet elements within the EntityContainer element:</P><DIV class=""><PRE><SPAN><SPAN class="">&lt;EntityContainer</SPAN><SPAN class=""> Name=</SPAN><SPAN class="">"EntityContainer"</SPAN><SPAN class="">&gt;</SPAN></SPAN>
<SPAN>  <SPAN class="">&lt;EntitySet</SPAN><SPAN class=""> Name=</SPAN><SPAN class="">"Products"</SPAN><SPAN class=""> EntityType=</SPAN><SPAN class="">"Northbreeze.Products"</SPAN><SPAN class="">&gt;</SPAN></SPAN>
<SPAN>    <SPAN class="">&lt;NavigationPropertyBinding</SPAN><SPAN class=""> Path=</SPAN><SPAN class="">"Category"</SPAN><SPAN class=""> Target=</SPAN><SPAN class="">"Categories"</SPAN><SPAN class="">/&gt;</SPAN></SPAN>
<SPAN>    <SPAN class="">&lt;NavigationPropertyBinding</SPAN><SPAN class=""> Path=</SPAN><SPAN class="">"Supplier"</SPAN><SPAN class=""> Target=</SPAN><SPAN class="">"Suppliers"</SPAN><SPAN class="">/&gt;</SPAN></SPAN>
<SPAN>  <SPAN class="">&lt;/EntitySet&gt;</SPAN></SPAN>
<SPAN>  <SPAN class="">&lt;EntitySet</SPAN><SPAN class=""> Name=</SPAN><SPAN class="">"Suppliers"</SPAN><SPAN class=""> EntityType=</SPAN><SPAN class="">"Northbreeze.Suppliers"</SPAN><SPAN class="">&gt;</SPAN></SPAN>
<SPAN>    <SPAN class="">&lt;NavigationPropertyBinding</SPAN><SPAN class=""> Path=</SPAN><SPAN class="">"Products"</SPAN><SPAN class=""> Target=</SPAN><SPAN class="">"Products"</SPAN><SPAN class="">/&gt;</SPAN></SPAN>
<SPAN>  <SPAN class="">&lt;/EntitySet&gt;</SPAN></SPAN>
<SPAN>  <SPAN class="">&lt;EntitySet</SPAN><SPAN class=""> Name=</SPAN><SPAN class="">"Categories"</SPAN><SPAN class=""> EntityType=</SPAN><SPAN class="">"Northbreeze.Categories"</SPAN><SPAN class="">&gt;</SPAN></SPAN>
<SPAN>    <SPAN class="">&lt;NavigationPropertyBinding</SPAN><SPAN class=""> Path=</SPAN><SPAN class="">"Products"</SPAN><SPAN class=""> Target=</SPAN><SPAN class="">"Products"</SPAN><SPAN class="">/&gt;</SPAN></SPAN>
<SPAN>  <SPAN class="">&lt;/EntitySet&gt;</SPAN></SPAN>
<SPAN>  <SPAN class="">&lt;EntitySet</SPAN><SPAN class=""> Name=</SPAN><SPAN class="">"Summary_of_Sales_by_Years"</SPAN><SPAN class=""> EntityType=</SPAN><SPAN class="">"Northbreeze.Summary_of_Sales_by_Years"</SPAN><SPAN class="">/&gt;</SPAN></SPAN>
<SPAN>  <SPAN class="">&lt;EntitySet</SPAN><SPAN class=""> Name=</SPAN><SPAN class="">"TotalProducts"</SPAN><SPAN class=""> EntityType=</SPAN><SPAN class="">"Northbreeze.TotalProducts"</SPAN><SPAN class="">/&gt;</SPAN></SPAN>
<SPAN>  <SPAN class="">&lt;ActionImport</SPAN><SPAN class=""> Name=</SPAN><SPAN class="">"selectProduct"</SPAN><SPAN class=""> Action=</SPAN><SPAN class="">"Northbreeze.selectProduct"</SPAN><SPAN class="">/&gt;</SPAN></SPAN>
<SPAN><SPAN class="">&lt;/EntityContainer&gt;</SPAN></SPAN></PRE></DIV><P>The action itself is described in more detail along with the EntityType elements. Here it is in full:</P><DIV class=""><PRE><SPAN><SPAN class="">&lt;Action</SPAN><SPAN class=""> Name=</SPAN><SPAN class="">"selectProduct"</SPAN><SPAN class=""> IsBound=</SPAN><SPAN class="">"false"</SPAN><SPAN class="">&gt;</SPAN></SPAN>
<SPAN>  <SPAN class="">&lt;Parameter</SPAN><SPAN class=""> Name=</SPAN><SPAN class="">"communityid"</SPAN><SPAN class=""> Type=</SPAN><SPAN class="">"Edm.String"</SPAN><SPAN class="">/&gt;</SPAN></SPAN>
<SPAN>  <SPAN class="">&lt;ReturnType</SPAN><SPAN class=""> Type=</SPAN><SPAN class="">"Edm.String"</SPAN><SPAN class="">/&gt;</SPAN></SPAN>
<SPAN><SPAN class="">&lt;/Action&gt;</SPAN></SPAN></PRE></DIV><P>You can see from this detail that:</P><UL><LI>it's an unbound action</LI><LI>it expects a single parameter communityid</LI><LI>it returns a result</LI></UL><P>Basically, this action expects to receive your SAP Community ID as input, and, based on that ID, will choose a product for you.</P><BLOCKQUOTE><P>Actions vs functions: One of the key differences between actions and functions in OData V4 is that while functions may not have side effects, actions may well have side effects. This means that normally functions will be used for read-only operations, while actions can be used for operations that make some sort of change. But they don't have to. And here, we're using an action, rather than a function, mostly because actions require the POST HTTP method (because they may have side effects), rather than GET. And requiring you to use HTTP POST for this task makes things more interesting.</P></BLOCKQUOTE><H2 id="toc-hId--900893759">Your task</H2><P>Your task is to call this unbound action, supplying your SAP Community ID for the communityid parameter. The response you will receive is a JSON representation, containing a value property, the value for which is the product that has been selected for you (based on your SAP Community ID).</P><P>This is the value you must hash and then post that hash as a new reply to this discussion thread, as described in <A href="https://groups.community.sap.com/t5/application-development/sap-developer-challenge-apis-task-0-learn-to-share-your-task/m-p/276058" target="_blank" rel="noopener noreferrer">Task 0 - Learn to share your task results</A>.</P><P>Here's an example. Calling the action with qmacro as the value for communityid causes this to be returned in response (pretty printed for readability):</P><DIV class=""><PRE><SPAN><SPAN class="">{</SPAN></SPAN>
<SPAN>  <SPAN class="">"@odata.context"</SPAN><SPAN class="">:</SPAN> <SPAN class="">"$metadata#Edm.String"</SPAN><SPAN class="">,</SPAN></SPAN>
<SPAN>  <SPAN class="">"value"</SPAN><SPAN class="">:</SPAN> <SPAN class="">"Rössle Sauerkraut"</SPAN></SPAN>
<SPAN><SPAN class="">}</SPAN></SPAN></PRE></DIV><P>The product name Rössle Sauerkraut is what needs to be hashed. Note, in this case, that any value passed in the URL path must be properly URL encoded. So while the value test, for example, needs no specific URL encoding, this value must be URL encoded, in order to be successfully transported in the URL path and accurately received and parsed by the hash service. In other words, the value:</P><PRE>Rössle Sauerkraut</PRE><P>needs to be URL encoded so it looks like this:</P><PRE>R%C3%B6ssle%20Sauerkraut</PRE><P>When inserted into the URL path, it will therefore look like this:</P><PRE>/v1/hash(value='R%C3%B6ssle%20Sauerkraut')</PRE><H2 id="toc-hId-841916576">Hints and tips</H2><P>You may want to peruse the content of the talk <A href="https://github.com/qmacro/odata-v4-and-cap/blob/main/slides.md" target="_blank" rel="noopener nofollow noreferrer">OData V4 and SAP Cloud Application Programming Model</A>, in particular the short <A href="https://github.com/qmacro/odata-v4-and-cap/blob/main/slides.md#actions-and-functions" target="_blank" rel="noopener nofollow noreferrer">Actions and functions</A> section.</P><P>You may also wish to watch the replay of the Hands-on SAP Dev live stream episode <A href="https://www.youtube.com/watch?v=tmwglig2mbw" target="_blank" rel="noopener nofollow noreferrer">Back to basics: OData - the Open Data Protocol - Part 5 - Actions &amp; functions</A>.</P><P>You can find out what URL encoding is all about in the <A href="https://en.wikipedia.org/wiki/URL_encoding" target="_blank" rel="noopener nofollow noreferrer">Wikipedia entry for URL encoding</A>. You're likely to find either a built-in or a library function in your favorite language to do that, for example JavaScript has <A href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/encodeURIComponent" target="_blank" rel="noopener nofollow noreferrer">encodeURIComponent</A> and Python has a quote function in <A href="https://docs.python.org/3/library/urllib.parse.html" target="_blank" rel="noopener nofollow noreferrer">urllib.parse</A>.</P><P>Finally, you may wish to read this short post <A href="https://qmacro.org/blog/posts/2023/08/08/odata-query-operations-and-url-encoding-the-system-query-options-with-curl/" target="_self" rel="nofollow noopener noreferrer">OData query operations and URL encoding the system query options with curl</A>, written in part as a response to <A href="https://groups.community.sap.com/t5/application-development/sap-developer-challenge-apis-task-2-calculate-northbreeze/m-p/277635/highlight/true#M2656" target="_self" rel="noopener noreferrer">a great comment on the previous task</A>.</P><H2 id="toc-hId--1710240385">For discussion</H2><P>What's the difference between the meanings of "bound" and "unbound" in this context? What does the fact that the selectProduct action is "unbound" suggest to us?</P><P>Remember, if you're posting your thoughts on these discussion questions, remember to do it in a reply separate from your hash reply!</P>
