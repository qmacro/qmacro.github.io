2013-01-11-jump-to-shell-workset-item-from-url
Jump to Shell Workset Item from URL
technology-blog-members
2013-01-11
https://community.sap.com/t5/technology-blogs-by-members/jump-to-shell-workset-item-from-url/ba-p/12989959
<DIV class="jive-rendered-content"><P>During SAP TechEd 2012 I attended CD163 "SAP HANA - Application Services Basics" which really helped firm up my knowledge of XS, thanks to the great presentation and exercises. What was interesting was that not only was SAPUI5 used for the UI components of the demos and exercises, but even the code snippets that the attendees would have to type in were made available to copy-n-paste, via a simple SAPUI5 Shell interface. </P><P></P><P>On reviewing the exercise text today, I noticed this bit:</P><P></P><P><IMG class="migrated-image" src="https://community.sap.com/legacyfs/online/storage/blog_attachments/2013/01/urlsub2_173826.png" /></P><P></P><P>The URL that pointed to the SAPUI5 Shell that contained the code to copy-n-paste had a query string in it, and that sub=3.1 caused the browser to go straight to a subitem in the Shell's workset item collection:</P><P></P><P><IMG class="migrated-image" src="https://community.sap.com/legacyfs/online/storage/blog_attachments/2013/01/sub3_2_173827.png" width="620" /></P><P></P><P>(please ignore the 256-colour quality of that shot)</P><P></P><P>I thought that was a nice touch, and dug around to see what they'd done. I was pretty certain I hadn't seen that as a feature described in the official and comprehensive SAPUI5 docu, so was curious. </P><P></P><P>What they'd done is added a small function to parse out the value of the "sub" parameter in the query string, and set the selected workset item accordingly. Here's that small function, getURLParameter: </P><P></P><P><SPAN style="font-size: 13px;font-family: 'courier new', courier">function getURLParameter(name) {</SPAN></P><P><SPAN style="font-size: 13px;font-family: 'courier new', courier">&nbsp;&nbsp;&nbsp; return decodeURI(</SPAN></P><P><SPAN style="font-size: 13px;font-family: 'courier new', courier">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; (RegExp(name + '=' + '(.+?)(&amp;|$)').exec(location.search)||[,null])[1]</SPAN></P><P><SPAN style="font-size: 13px;font-family: 'courier new', courier">&nbsp;&nbsp;&nbsp; );</SPAN></P><P><SPAN style="font-size: 13px;font-family: 'courier new', courier">}</SPAN></P><P></P><P>(In case you're wondering, the ||[,null] bit towards the end just makes sure there's no exception when the requested parameter isn't found by the regex).</P><P></P><P>The workset items were defined in the Shell object like this:</P><P></P><P><SPAN style="font-size: 13px;font-family: 'courier new', courier">oController.oShell = new sap.ui.ux3.Shell("myShell", {</SPAN></P><P><SPAN style="font-size: 13px;font-family: 'courier new', courier">&nbsp; appIcon : "./images/sap_18.png",</SPAN></P><P><SPAN style="font-size: 13px;font-family: 'courier new', courier">&nbsp; appIconTooltip : "SAP",</SPAN></P><P><SPAN style="font-size: 13px;font-family: 'courier new', courier">&nbsp; appTitle : "CD163 Exercise Templates",</SPAN></P><P><SPAN style="font-size: 13px;font-family: 'courier new', courier">&nbsp; showInspectorTool : false,</SPAN></P><P><SPAN style="font-size: 13px;font-family: 'courier new', courier">&nbsp; showFeederTool : false,</SPAN></P><P><SPAN style="font-size: 13px;font-family: 'courier new', courier">&nbsp; showSearchTool : false,</SPAN></P><P><SPAN style="font-size: 13px;font-family: 'courier new', courier">&nbsp; content: html21, </SPAN></P><P><SPAN style="font-size: 13px;font-family: 'courier new', courier">&nbsp; worksetItems: [new sap.ui.ux3.NavigationItem("NI_2",{key:"ni_2",text:"Exercise 2", subItems:[</SPAN></P><P><SPAN style="font-size: 13px;font-family: 'courier new', courier">&nbsp;&nbsp;&nbsp; new sap.ui.ux3.NavigationItem("NI_2_1",{key:"ni_2_1",text:"2.1 Hello World"})]}),</SPAN></P><P><SPAN style="font-family: 'courier new', courier">&nbsp;&nbsp;&nbsp; new sap.ui.ux3.NavigationItem("NI_3",{key:"ni_3",text:"Exercise 3", subItems:[</SPAN></P><P><SPAN style="font-size: 13px;font-family: 'courier new', courier">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; new sap.ui.ux3.NavigationItem("NI_3_1",{key:"ni_3_1",text:"3.1 Simple OData"}),</SPAN></P><P><SPAN style="font-size: 13px;font-family: 'courier new', courier">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; [...]<BR /></SPAN></P><P></P><P></P><P>and the requested workset item was set as selected, with the corresponding content, in a large switch statement like this:</P><P></P><P><SPAN style="font-size: 13px;font-family: 'courier new', courier">&nbsp; switch (getURLParameter("sub")){</SPAN></P><P><SPAN style="font-size: 13px;font-family: 'courier new', courier">&nbsp;&nbsp;&nbsp; case "2.1":</SPAN></P><P><SPAN style="font-size: 13px;font-family: 'courier new', courier">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; oController.oShell.setSelectedWorksetItem("NI_2_1");</SPAN></P><P><SPAN style="font-size: 13px;font-family: 'courier new', courier">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; oController.oShell.setContent(html21); </SPAN></P><P><SPAN style="font-size: 13px;font-family: 'courier new', courier">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; break; </SPAN></P><P><SPAN style="font-size: 13px;font-family: 'courier new', courier">&nbsp;&nbsp;&nbsp; case "3.1":</SPAN></P><P><SPAN style="font-size: 13px;font-family: 'courier new', courier">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; oController.oShell.setSelectedWorksetItem("NI_3_1");</SPAN></P><P><SPAN style="font-size: 13px;font-family: 'courier new', courier">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; oController.oShell.setContent(html31); </SPAN></P><P><SPAN style="font-size: 13px;font-family: 'courier new', courier">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; break; </SPAN></P><P><SPAN style="font-size: 13px;font-family: 'courier new', courier">&nbsp;&nbsp;&nbsp; case "3.2":</SPAN></P><P><SPAN style="font-size: 13px;font-family: 'courier new', courier">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; oController.oShell.setSelectedWorksetItem("NI_3_2");</SPAN></P><P><SPAN style="font-size: 13px;font-family: 'courier new', courier">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; oController.oShell.setContent(html32); </SPAN></P><P><SPAN style="font-size: 13px;font-family: 'courier new', courier">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; break;</SPAN></P><P><SPAN style="font-size: 13px;font-family: Consolas"><SPAN style="font-family: 'courier new', courier">&nbsp;&nbsp;&nbsp; [...]</SPAN><BR /></SPAN></P><P></P><P>Nice effect. </P><P></P><P>I wanted to confirm this for myself, and try to use fewer lines of code than SAP had done, as it looked a little bit verbose. So I wrote a little standalone snippet, available in my Github repo '<A class="jive-link-external-small" href="https://github.com/qmacro/sapui5bin" target="_blank" rel="nofollow noopener noreferrer">sapui5bin</A>'. The snippet is <A class="jive-link-external-small" href="https://github.com/qmacro/sapui5bin/blob/master/snippets/shell_wsi_nav.html" target="_blank" rel="nofollow noopener noreferrer">https://github.com/qmacro/sapui5bin/blob/master/snippets/shell_wsi_nav.html</A> and defines a Shell with a few items / subitems like this:</P><P></P><P> <SPAN style="font-family: 'courier new', courier">&nbsp; var oShell = new sap.ui.ux3.Shell({&nbsp;&nbsp;&nbsp;&nbsp; </SPAN></P><P><SPAN style="font-family: 'courier new', courier">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; appTitle: "Shell WorksetItem Navigation",</SPAN></P><P><SPAN style="font-family: 'courier new', courier">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; worksetItems:[</SPAN></P><P><SPAN style="font-family: 'courier new', courier">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; new sap.ui.ux3.NavigationItem("id_wsiA", {key:"wsiA",text:"A",subItems:[ ]}),</SPAN></P><P><SPAN style="font-family: 'courier new', courier">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; new sap.ui.ux3.NavigationItem("id_wsiB", {key:"wsiB",text:"B",subItems:[</SPAN></P><P><SPAN style="font-family: 'courier new', courier">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; new sap.ui.ux3.NavigationItem("id_wsiB.1", {key:"wsiB.1", text:"B.1"}),</SPAN></P><P><SPAN style="font-family: 'courier new', courier">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; new sap.ui.ux3.NavigationItem("id_wsiB.2", {key:"wsiB.2", text:"B.2"}),</SPAN></P><P><SPAN style="font-family: 'courier new', courier">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ]}),</SPAN></P><P><SPAN style="font-family: 'courier new', courier">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ]</SPAN></P><P><SPAN style="font-family: 'courier new', courier">&nbsp;&nbsp;&nbsp; });</SPAN></P><P></P><P>Note that my convention is to name the IDs the same as the keys, but with a prefix of 'id_'.</P><P></P><P>I used the same getUrlParameter() function, but then used a simpler method to dynamically set the selected workitem and content based on the value of the 'sub' query parameter, like this:</P><P></P><P><SPAN style="font-family: 'courier new', courier">&nbsp; var subId = "id_wsi" + getUrlParameter("sub");</SPAN></P><P><SPAN style="font-family: 'courier new', courier">&nbsp;&nbsp;&nbsp; var wsi = sap.ui.getCore().byId(subId) ? subId : 'id_wsiA';</SPAN></P><P><SPAN style="font-family: 'courier new', courier">&nbsp;&nbsp;&nbsp; oShell.setSelectedWorksetItem(wsi);</SPAN></P><P><SPAN style="font-family: 'courier new', courier">&nbsp;&nbsp;&nbsp; oShell.setContent(getContent(wsi));</SPAN></P><P></P><P>In the second of these 4 lines, I'm just making sure I handle the case where the user hacks the URL query string to specify a sub item that doesn't exist: I make sure that I can find an element with the ID specified (knowing that if it begins 'id_wsi' then it's a workset item) and defaulting to the first workset item if I can't.</P><P></P><P><IMG class="migrated-image" src="https://community.sap.com/legacyfs/online/storage/blog_attachments/2013/01/b2_173831.png" /></P><P></P><P>And that's it. Not a huge deal, but I was intrigued, and thought you might be too. For more info, see the complete snippet <A class="jive-link-external-small" href="https://github.com/qmacro/sapui5bin/blob/master/snippets/shell_wsi_nav.html" target="_blank" rel="nofollow noopener noreferrer">shell_wsi_nav.html</A>.</P><P></P><P>Share and enjoy!</P></DIV>
