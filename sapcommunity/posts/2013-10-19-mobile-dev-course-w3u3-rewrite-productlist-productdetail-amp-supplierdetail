2013-10-19-mobile-dev-course-w3u3-rewrite-productlist-productdetail-amp-supplierdetail
Mobile Dev Course W3U3 Rewrite - ProductList, ProductDetail & SupplierDetail
technology-blog-members
2013-10-19
https://community.sap.com/t5/technology-blogs-by-members/mobile-dev-course-w3u3-rewrite-productlist-productdetail-amp-supplierdetail/ba-p/13034234
<DIV class="jive-rendered-content"><P><SPAN style="color: #333333;font-size: 12px;background-color: #ffffff">I </SPAN><A class="jive-link-blog-small" href="https://blogs.sap.com/?p=94915" target="_blank" rel="noopener noreferrer">rewrote the mobile dev course sample app from W3U3</A><SPAN style="color: #333333;font-size: 12px;background-color: #ffffff">. <STRONG>This </STRONG></SPAN><SPAN style="color: #333333;font-size: 12px;background-color: #ffffff"><STRONG>post explains what I changed in the ProductList, ProductDetail and SupplierDetail views / controllers. </STRONG>See the links at the bottom of the </SPAN><A class="jive-link-blog-small" href="https://blogs.sap.com/?p=94915" target="_blank" rel="noopener noreferrer">opening post</A><SPAN style="color: #333333;font-size: 12px;background-color: #ffffff"> to get to explanations for the other areas.</SPAN></P><P></P><H3 id="toc-hId-946196931">ProductList</H3><H3 id="toc-hId-749683426"></H3><P></P><P><SPAN style="color: #333333;font-size: 12px;background-color: #ffffff">If you remember back to the Login controller (<A class="jive-link-blog-small" href="https://blogs.sap.com/?p=95019" target="_blank" rel="noopener noreferrer">described in the previous post in this series</A>) we arrive at the ProductList view after successfully logging in, creating the OData model for the business available at the OData service, and performing a move from the Login page to this ProductList page with <SPAN style="color: #333333;font-size: 12px;background-color: #ffffff">oApp.to("ProductList"), <A class="jive-link-external-small" href="https://sapui5.hana.ondemand.com/sdk/#docs/api/symbols/sap.m.NavContainer.html#to" target="_blank" rel="nofollow noopener noreferrer">the navigation mechanism that is available in the App control, inherited from NavContainer</A>.</SPAN></SPAN></P><P></P><H4 id="toc-hId-682252640">ProductList.view.js</H4><P></P><H4 id="toc-hId-485739135"></H4><P><SPAN style="color: #333333;font-size: 12px;background-color: #ffffff">Here's what the ProductList view looks like.</SPAN></P><P></P><PRE class="language-javascript"><CODE>sap.ui.jsview("com.opensap.ProductList", {<BR />
<BR />
&nbsp;&nbsp;&nbsp; getControllerName: function() {<BR />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; return "com.opensap.ProductList";<BR />
&nbsp;&nbsp;&nbsp; },<BR />
<BR />
&nbsp;&nbsp;&nbsp; createContent: function(oController) {<BR />
<BR />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; return new sap.m.Page("ProductPage", {<BR />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; title: "Products",<BR />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; content: [<BR />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; new sap.m.List({<BR />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; headerText: "Product Overview",<BR />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; items: {<BR />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; path: "/ProductCollection",<BR />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; template: new sap.m.StandardListItem({<BR />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; title: "{Name}",<BR />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; description: "{Description}",<BR />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; type: sap.m.ListType.Navigation,<BR />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; press: [oController.handleProductListItemPress, oController]<BR />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; })<BR />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }<BR />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; })<BR />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ]<BR />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; });<BR />
&nbsp;&nbsp;&nbsp; }<BR />
<BR />
});</CODE></PRE><P></P><P><SPAN style="color: #333333;font-size: 12px;background-color: #ffffff">Like the previous views, this isn't actually much different from the original version. I've left out stuff that wasn't needed, and in particular the icon property of each StandardListItem was pointing at the wrong model property name, resulting in no icon being shown in the list. I've removed the icon* properties as well as a couple of list properties (inset and type).</SPAN></P><P></P><P><SPAN style="color: #333333;font-size: 12px;background-color: #ffffff">What I have done, though, mostly for fun, is to write the createContent function as a single statement. This in contrast to the multiple statements in the original, but perhaps more interestingly, the whole thing looks more declarative than imperative. This will come into play when we eventually look at declarative views in XML, which are actually my prefererence, and arguably the neatest and least amount of typing ... which might surprise you. Anyway, more on that another time.</SPAN></P><P></P><H4 id="toc-hId-289225630"><SPAN style="color: #333333;font-size: 12px;background-color: #ffffff">ProductList.controller.js</SPAN></H4><H4 id="toc-hId-92712125"></H4><P><SPAN style="color: #333333;font-size: 12px;background-color: #ffffff">The ProductList controller is very simple; all it has to do is handle the press of the StandardListItem (see the press event specification in the view above).</SPAN></P><P></P><PRE class="language-javascript"><CODE>sap.ui.controller("com.opensap.ProductList", {<BR />
&nbsp;&nbsp;&nbsp; handleProductListItemPress: function(oEvent) {<BR />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; this.getView().getParent().to("ProductDetail", {<BR />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; context: oEvent.getSource().getBindingContext()<BR />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; });<BR />
&nbsp;&nbsp;&nbsp; }<BR />
});</CODE></PRE><P></P><P><SPAN style="color: #333333;font-size: 12px;background-color: #ffffff">Again, I've left out the empty boilerplate code from the original, and am just doing what's required, nothing more: getting the binding context of the source of the event (the particular StandardListItem that was pressed), and passing that in the navigation to the ProductDetail page. </SPAN></P><P></P><P><SPAN style="color: #333333;font-size: 12px;background-color: #ffffff"><EM>Note that I've been sort of interchanging the word page and view here and earlier. This is in relation to the App control, which has a 'pages' aggregation from the NavContainer control. As the <A class="jive-link-external-small" href="https://sapui5.hana.ondemand.com/sdk/#docs/api/symbols/sap.m.NavContainer.html#getPages" target="_blank" rel="nofollow noopener noreferrer">documentation states</A>, you don't have to put Page controls into this pages aggregation, you can put other controls that have a fullscreen semantic, and one of those possible controls is a View.</EM><BR /></SPAN></P><P></P><P></P><H3 id="toc-hId--232884099">ProductDetail</H3><H3 id="toc-hId--429397604"></H3><P></P><P><SPAN style="color: #333333;font-size: 12px;background-color: #ffffff">So we've navigated from the ProductList to the ProductDetail by selecting an item in the List control, and having that item's binding context (related to the OData model) passed to us. Here's what the view looks like.</SPAN></P><P></P><PRE class="language-javascript"><CODE>sap.ui.jsview("com.opensap.ProductDetail", {<BR />
&nbsp;&nbsp;&nbsp; getControllerName: function() {<BR />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; return "com.opensap.ProductDetail";<BR />
&nbsp;&nbsp;&nbsp; },<BR />
&nbsp;&nbsp;&nbsp; onBeforeShow: function(oEvent) {<BR />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; if (oEvent.data.context) {<BR />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; this.setBindingContext(oEvent.data.context);<BR />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }<BR />
&nbsp;&nbsp;&nbsp; },</CODE></PRE><P></P><P><SPAN style="color: #333333;font-size: 11.818181991577148px;background-color: #ffffff">So in the ProductDetail view, where we want to simply show more detail about that particular Product entity, we first make sure that the passed context is bound (to the view).</SPAN></P><P><SPAN style="color: #333333;font-size: 11.818181991577148px;background-color: #ffffff"><BR /></SPAN></P><P></P><PRE class="language-javascript"><CODE>&nbsp; createContent: function(oController) {<BR />
<BR />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; return new sap.m.Page({<BR />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; title: "{Name}",<BR />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; showNavButton: true,<BR />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; navButtonPress: [oController.handleNavButtonPress, oController],<BR />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; content: [<BR />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; new sap.m.List({<BR />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; items: [<BR />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; new sap.m.DisplayListItem({<BR />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; label: "Name",<BR />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; value: "{Name}"<BR />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }),<BR />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; new sap.m.DisplayListItem({<BR />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; label: "Description",<BR />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; value: "{Description}"<BR />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }),<BR />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; new sap.m.DisplayListItem({<BR />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; label: "Price",<BR />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; value: "{Price} {CurrencyCode}"<BR />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }),<BR />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; new sap.m.StandardListItem({<BR />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; title: "Supplier",<BR />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; description: "{SupplierName}",<BR />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; type: sap.m.ListType.Navigation,<BR />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; press: [oController.handleSupplierPress, oController]<BR />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; })<BR />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ]<BR />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }),<BR />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; new sap.m.VBox({<BR />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; alignItems: sap.m.FlexAlignItems.Center,<BR />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; items: [<BR />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; new sap.m.Image({<BR />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; src: "{app&gt;/ES1Root}{ProductPicUrl}",<BR />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; decorative: true,<BR />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; densityAware: false<BR />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; })<BR />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ]<BR />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; })<BR />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ]<BR />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; });<BR />
&nbsp;&nbsp;&nbsp; }<BR />
});</CODE></PRE><P></P><P><SPAN style="color: #333333;font-size: 11.818181991577148px;background-color: #ffffff">Once that's done, all we have to do is fill out the createContent function, which again is very similar to the original. Note that here I'm using two model properties together for the value of the "Price" item to show a currency value and code. </SPAN></P><P></P><P><SPAN style="color: #333333;font-size: 11.818181991577148px;background-color: #ffffff">In the original version, there was some custom data attached to the Supplier item - specifically the SupplierId property from the Product. This was used, in the controller, to manually (and somewhat "bluntly") construct an OData Entity URL for subsequent (manual) retrieval. Of couse, you might have guessed by now what I'm going to say. Not necessary at all. More on this shortly. But it's worth pointing out that the attaching of the custom data is quite a useful and widely available facility in general. It's widely available because it's part of the Element class, from which, ultimately, all controls inherit. So you can attach custom data in name/value pairs to any control you wish, more or less.</SPAN></P><P></P><P><SPAN style="color: #333333;font-size: 11.818181991577148px;background-color: #ffffff">Finally, let's have a quick look at that VBox control containing the product image. I took a lead from the original app and decided to prefix the relative URL (which is what is contained in the ProductPicUrl property) with the generic (non-SMP-proxied) 'sapes1' URL base. And to achieve this prefixing I just concatenated a couple of model properties - one from the named "app" model (the ES1Root) and the other being the actual image relative URL. </SPAN></P><P><SPAN style="color: #333333;font-size: 11.818181991577148px;background-color: #ffffff"><BR /></SPAN></P><P><SPAN style="color: #333333;font-size: 11.818181991577148px;background-color: #ffffff">Ok, let's have a look at the rewritten controller.&nbsp; </SPAN></P><P></P><H4 id="toc-hId--496828390"><SPAN style="color: #333333;font-size: 11.818181991577148px;background-color: #ffffff">ProductDetail.controller.js<BR /></SPAN></H4><P></P><PRE class="language-javascript"><CODE>sap.ui.controller("com.opensap.ProductDetail", {<BR />
&nbsp;&nbsp;&nbsp; handleNavButtonPress: function(oEvent) {<BR />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; this.getView().getParent().back();<BR />
&nbsp;&nbsp;&nbsp; },<BR />
<BR />
&nbsp;&nbsp;&nbsp; handleSupplierPress: function(oEvent) {<BR />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; this.getView().getParent().to("SupplierDetail", {<BR />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; context: oEvent.getSource().getBindingContext()<BR />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; });<BR />
&nbsp;&nbsp;&nbsp; }<BR />
<BR />
});</CODE></PRE><P></P><P><SPAN style="color: #333333;font-size: 11.818181991577148px;background-color: #ffffff">As well as the back navigation, we have the handling of the press of the Supplier item in the ProductDetail view. This should take us to the SupplierDetail view to show us more information about the supplier. </SPAN></P><P></P><P><SPAN style="color: #333333;font-size: 11.818181991577148px;background-color: #ffffff">So before we think about how we make this work, let's pause for a second and consider the business data that we're consuming through the OData service.</SPAN></P><P></P><H3 id="toc-hId--822424614">OData Model and Service</H3><H3 id="toc-hId--1094169488"></H3><P></P><P><SPAN style="color: #333333;font-size: 11.818181991577148px;background-color: #ffffff">We have, in the OData service originating at <A class="jive-link-external-small" href="https://sapes1.sapdevcenter.com/sap/opu/odata/sap/ZGWSAMPLE_SRV/" target="_blank" rel="nofollow noopener noreferrer">https://sapes1.sapdevcenter.com/sap/opu/odata/sap/ZGWSAMPLE_SRV/</A>, a number of EntitySets, or 'collections', including the <A class="jive-link-external-small" href="https://sapes1.sapdevcenter.com/sap/opu/odata/sap/ZGWSAMPLE_SRV/BusinessPartnerCollection?sap-ds-debug=true" target="_blank" rel="nofollow noopener noreferrer">BusinessPartnerCollection</A> and the <A class="jive-link-external-small" href="https://sapes1.sapdevcenter.com/sap/opu/odata/sap/ZGWSAMPLE_SRV/ProductCollection?sap-ds-debug=true" target="_blank" rel="nofollow noopener noreferrer">ProductCollection</A> - both of which have entities that we're interested in for our app. We start out with the ProductCollection, display a list, pick a specific product for more detail, and then go to the supplier for that product. If you look at the OData metadata for this service, you'll see that in the definition of the Product entity, there's a<EM> navigation property </EM>that will take us directly from the product entity to the related business partner entity. <EM>How useful is that? Yes, very! So let's use it.</EM></SPAN></P><P></P><P><SPAN style="color: #333333;font-size: 11.818181991577148px;background-color: #ffffff"><EM><IMG class="migrated-image" src="https://community.sap.com/legacyfs/online/storage/blog_attachments/2013/10/navprop_300982.jpg" width="620" /></EM></SPAN></P><P><SPAN style="color: #333333;font-size: 11.818181991577148px;background-color: #ffffff">Before we look at how we use it, let's review how the original app was doing things here to go from the selected product detail to the supplier. In the supplierTap function of the original ProductDetail controller, the OData.read function was called explicitly (ouch), on a manually constructed OData URL (ouch), which abruptly jumped straight to the BusinessPartnerCollection, ignoring this navigation feature (double-ouch). The supplier's ID (which had been squirrelled away in the custom data as mentioned earlier) was specified directly, as a key predicate, and a JSON representation was requested: <BR /><BR /><SPAN>OData.read("</SPAN><A class="jive-link-external-small" href="https://sapes1.devcenter.com/sap/opu/odata/sap/ZGWSAMPLE_SRV/BusinessPartnerCollection" target="_blank" rel="nofollow noopener noreferrer">https://sapes1.devcenter.com/sap/opu/odata/sap/ZGWSAMPLE_SRV/BusinessPartnerCollection</A><SPAN>('" + supplierId + "')?$format=json", ...)</SPAN></SPAN></P><P></P><P><SPAN style="color: #333333;font-size: 11.818181991577148px;background-color: #ffffff">Yes, you can guess the next bit <span class="lia-unicode-emoji" title=":slightly_smiling_face:">ðŸ™‚</span> The JSON data was passed directly to the next view, bypassing any semblance of OData model usage. Ouch. I guess this also bypasses the SMP URL rewriting security and should have really been the SMP-based URL. And ouch.<BR /></SPAN></P><P></P><P><SPAN style="color: #333333;font-size: 11.818181991577148px;background-color: #ffffff">So how did we do it here? Well, just by passing the context of the selected product, as usual. Just like we did when we went from the ProductList view to the ProductDetail view. And then following on from that in the SupplierDetail view with a reference to the relative 'Supplier' entity.</SPAN></P><P><SPAN style="color: #333333;font-size: 11.818181991577148px;background-color: #ffffff"><BR /></SPAN></P><P></P><H3 id="toc-hId--1290682993">SupplierDetail</H3><H3 id="toc-hId--1487196498"></H3><P></P><H4 id="toc-hId--1977113010"><SPAN style="color: #333333;font-size: 11.818181991577148px;background-color: #ffffff">SupplierDetail.view.js</SPAN></H4><P></P><P><SPAN style="color: #333333;font-size: 11.818181991577148px;background-color: #ffffff">Ok, so here's the view.<BR /></SPAN></P><P></P><H4 id="toc-hId-2121340781"></H4><PRE class="language-javascript"><CODE>sap.ui.jsview("com.opensap.SupplierDetail", {<BR />
&nbsp;&nbsp;&nbsp; getControllerName: function() {<BR />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; return "com.opensap.SupplierDetail";<BR />
&nbsp;&nbsp;&nbsp; },<BR />
&nbsp;&nbsp;&nbsp; onBeforeShow: function(oEvent) {<BR />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; if (oEvent.data.context) {<BR />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; this.setBindingContext(oEvent.data.context);<BR />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }<BR />
&nbsp;&nbsp;&nbsp; },<BR />
 &nbsp;&nbsp; createContent: function(oController) {<BR />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; var oPage = new sap.m.Page({<BR />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; title: "{CompanyName}",<BR />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; showNavButton: true,<BR />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; navButtonPress: [oController.handleNavButtonPress, oController],<BR />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; content: [<BR />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; new sap.m.List({<BR />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; items: [<BR />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; new sap.m.DisplayListItem({<BR />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; label: "Company Name",<BR />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; value: "{CompanyName}"<BR />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }),<BR />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; new sap.m.DisplayListItem({<BR />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; label: "Web Address",<BR />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; value: "{WebAddress}"<BR />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }),<BR />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; new sap.m.DisplayListItem({<BR />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; label: "Phone Number",<BR />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; value: "{PhoneNumber}"<BR />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; })<BR />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ]<BR />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; })<BR />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ]<BR />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; });<BR />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; oPage.bindElement("Supplier");<BR />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; return oPage;<BR />
&nbsp;&nbsp;&nbsp; }<BR />
});</CODE></PRE><P></P><P><SPAN style="color: #333333;font-size: 12.222222328186035px;background-color: #ffffff">This view looks pretty normal and doesn't differ much from the original. We have the onBeforeShow and the createContent. But the key line is this:</SPAN></P><P></P><P><SPAN style="color: #333333;font-size: 12.222222328186035px;background-color: #ffffff">oPage.bindElement("Supplier")</SPAN></P><P></P><P><SPAN style="color: #333333;font-size: 12.222222328186035px;background-color: #ffffff">At the point that this is invoked, there's already the binding context that refers to the specific product previously chosen, say, like this:</SPAN></P><P></P><P><SPAN style="color: #333333;font-size: 12.222222328186035px;background-color: #ffffff"><A class="jive-link-external-small" href="https://sapes1.sapdevcenter.com/sap/opu/odata/sap/ZGWSAMPLE_SRV/ProductCollection('HT-1007')" target="_blank" rel="nofollow noopener noreferrer">https://sapes1.sapdevcenter.com/sap/opu/odata/sap/ZGWSAMPLE_SRV/ProductCollection('HT-1007')</A></SPAN></P><P></P><P><SPAN style="color: #333333;font-size: 12.222222328186035px;background-color: #ffffff">(I'm using the 'sapes1' link rather than the SMP-rewritten one here so you can navigate them from here and have a look manually if you want.)</SPAN></P><P></P><P><SPAN style="color: #333333;font-size: 12.222222328186035px;background-color: #ffffff">Following the navigation property mentioned earlier, to the supplier (the entity in the BusinessPartnerCollection) is simply a matter, OData-wise, of extending the path to navigate to the supplier, like this:</SPAN></P><P></P><P><SPAN style="color: #333333;font-size: 12.222222328186035px;background-color: #ffffff"><A class="jive-link-external-small" href="https://sapes1.sapdevcenter.com/sap/opu/odata/sap/ZGWSAMPLE_SRV/ProductCollection(" target="_blank" rel="nofollow noopener noreferrer">https://sapes1.sapdevcenter.com/sap/opu/odata/sap/ZGWSAMPLE_SRV/ProductCollection('HT-1007')/Supplier</A></SPAN></P><P></P><P><SPAN style="color: #333333;font-size: 12.222222328186035px;background-color: #ffffff">So in OData terms, we're navigating. And in path terms, we're going to a relative "Supplier", which is exactly what we're doing with the oPage.bindElement("Supplier"). The <A class="jive-link-external-small" href="https://sapui5.hana.ondemand.com/sdk/#docs/api/symbols/sap.ui.base.ManagedObject.html#bindElement" target="_blank" rel="nofollow noopener noreferrer">bindElement</A> mechanism, when called on an entity in an OData model, triggers an automatic OData "read" operation, i.e. an HTTP GET request, and updates the model.&nbsp; Bingo!</SPAN></P><P></P><P><SPAN style="color: #333333;font-size: 12.222222328186035px;background-color: #ffffff">Looking at the Network tab of Chrome Developer Tools, this is what we see happens:</SPAN></P><P><IMG class="migrated-image" src="https://community.sap.com/legacyfs/online/storage/blog_attachments/2013/10/calls_300997.jpg" width="620" /></P><P></P><P><SPAN style="color: #333333;font-size: 12.222222328186035px;background-color: #ffffff">The first call (ProductCollection?$skip...) was for the initial binding to "/ProductCollection" in the ProductList view. Then a product HT-1007 was selected, the App navigated to the ProductDetail view, and then the supplier item was pressed. And when the bindElement in the SupplierDetail view was called, this triggered the last call in the screenshot - to "Supplier", relative to ProductCollection('HT-1007').</SPAN></P><P></P><P><SPAN style="color: #333333;font-size: 12.222222328186035px;background-color: #ffffff">All automatic and comfortable! </SPAN></P><P></P><P></P><P><SPAN style="font-weight: bold">SupplierDetail.controller.js</SPAN></P><P></P><PRE class="language-javascript"><CODE>sap.ui.controller("com.opensap.SupplierDetail", {<BR />
&nbsp;&nbsp;&nbsp; handleNavButtonPress: function(oEvent) {<BR />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; this.getView().getParent().back();<BR />
&nbsp;&nbsp;&nbsp; }<BR />
})</CODE></PRE><P></P><P><SPAN style="color: #333333;font-size: 12.222222328186035px;background-color: #ffffff">Let's finish off with a quick look at the corresponding controller for this view. It doesn't have much work to do - just navigate back when the nav button is pressed. And it's very similar to the original.</SPAN></P><P></P><P><SPAN style="color: #333333;font-size: 12.222222328186035px;background-color: #ffffff">So there we have it. Embrace SAPUI5 and its myriad features (automatic module loading, well thought out controls, OData models, and more) and have fun building apps.</SPAN></P><P></P><P><SPAN style="color: #333333;font-size: 12.222222328186035px;background-color: #ffffff">That's draws this series to an end. Thanks for reading. The link to the Github repo where the rewritten app can be found is in the <A class="jive-link-blog-small" href="https://blogs.sap.com/?p=94915" target="_blank" rel="noopener noreferrer">original post in this series</A>, and also here: <A class="jive-link-external-small" href="https://github.com/qmacro/w3u3_redonebasic" target="_blank" rel="nofollow noopener noreferrer">https://github.com/qmacro/w3u3_redonebasic</A></SPAN></P><P></P><P><SPAN style="color: #333333;font-size: 12.222222328186035px;background-color: #ffffff">Share &amp; enjoy!</SPAN></P><P><SPAN style="color: #333333;font-size: 12.222222328186035px;background-color: #ffffff"> <BR /></SPAN></P></DIV>
