2019-11-26-annotated-links-episode-44-of-hands-on-sap-dev-with-qmacro
Annotated links: Episode 44 of Hands-on SAP dev with qmacro
technology-blog-sap
2019-11-26
https://community.sap.com/t5/technology-blogs-by-sap/annotated-links-episode-44-of-hands-on-sap-dev-with-qmacro/ba-p/13456763
<EM>This is a searchable description of the content of a live stream recording, specifically <STRONG>"Ep.44 – Business Rules in Cloud Foundry – setting things up"</STRONG> in the "<A href="https://bit.ly/handsonsapdev" target="_blank" rel="nofollow noopener noreferrer">Hands-on SAP dev with qmacro</A>" series. There are links directly to specific highlights in the video recording. For links to annotations of other episodes, please see the "<A href="https://bit.ly/handsonsapdev#replays" target="_blank" rel="nofollow noopener noreferrer">Catch the replays</A>" section of the series blog post.</EM><BR />
<BR />
This episode was streamed live on Fri 22 Nov 2019 and is approximately 60 minutes in length. The stream recording is <A href="https://www.youtube.com/watch?v=Mn9xU4BCVcM&amp;list=PL6RpkC85SLQAIntm7MkNk78ysDm3Ua8t0&amp;index=45" target="_blank" rel="nofollow noopener noreferrer">available on YouTube</A>.<BR />
<BR />
<IMG class="migrated-image" src="https://community.sap.com/legacyfs/online/storage/blog_attachments/2019/11/Screenshot-2019-11-26-at-08.42.00.png" /><BR />
<BR />
Brief synopsis: In previous recent episodes we've taken a look at the Business Rules service on Neo, and kicked the tyres with a simple rules service. Now it's time to move to Cloud Foundry and set things up there. Let's go!<BR />
<BR />
<A href="https://www.youtube.com/watch?v=Mn9xU4BCVcM&amp;list=PL6RpkC85SLQAIntm7MkNk78ysDm3Ua8t0&amp;t=00h02m00s" target="_blank" rel="nofollow noopener noreferrer">00:02:00</A> It's #TShirtDay today and I'm wearing my favourite Rush tshirt - you should definitely check out their music: <A class="uri" href="https://open.spotify.com/artist/2Hkut4rAAyrQxRdof7FVJq" target="_blank" rel="nofollow noopener noreferrer">https://open.spotify.com/artist/2Hkut4rAAyrQxRdof7FVJq</A>.<BR />
<BR />
<A href="https://www.youtube.com/watch?v=Mn9xU4BCVcM&amp;list=PL6RpkC85SLQAIntm7MkNk78ysDm3Ua8t0&amp;t=00h06m10s" target="_blank" rel="nofollow noopener noreferrer">00:06:10</A> If you want to request an SAP CodeJam, check out the main <A href="https://community.sap.com/events/codejam" target="_blank">CodeJam page</A> where you can find the topics and a link to request one.<BR />
<BR />
<A href="https://www.youtube.com/watch?v=Mn9xU4BCVcM&amp;list=PL6RpkC85SLQAIntm7MkNk78ysDm3Ua8t0&amp;t=00h07m10s" target="_blank" rel="nofollow noopener noreferrer">00:07:10</A> As I <A href="https://twitter.com/qmacro/status/1197752299461992448" target="_blank" rel="nofollow noopener noreferrer">mentioned earlier today</A>, on the SAP Cloud Platform Cockpit there's a new Starter Scenario available, "<A href="https://developers.sap.com/mission.cp-starter-extensions-cap.html" target="_blank" rel="noopener noreferrer">Build a Business Application using Node.js</A>" - nice work <SPAN class="mention-scrubbed">iwona.jirschitzka</SPAN> &amp; team!<BR />
<BR />
<A href="https://www.youtube.com/watch?v=Mn9xU4BCVcM&amp;list=PL6RpkC85SLQAIntm7MkNk78ysDm3Ua8t0&amp;t=00h09m10s" target="_blank" rel="nofollow noopener noreferrer">00:09:10</A> I'm trying to work more openly, and am now editing my draft annotations for the <A href="https://bit.ly/handsonsapdev#replays" target="_blank" rel="nofollow noopener noreferrer">live stream replays</A> in a <A href="https://github.com/qmacro/handsonsapdev" target="_blank" rel="nofollow noopener noreferrer">public GitHub repo</A>. So you'll see the draft annotations as they're written, and most likely even before they're made live. In fact, I'll go and <A href="https://github.com/qmacro/handsonsapdev/commit/c02a6f71fb418e733b75f1d679e704175dc1ed21" target="_blank" rel="nofollow noopener noreferrer">push this new file right now</A>!<BR />
<BR />
<A href="https://www.youtube.com/watch?v=Mn9xU4BCVcM&amp;list=PL6RpkC85SLQAIntm7MkNk78ysDm3Ua8t0&amp;t=00h10m45s" target="_blank" rel="nofollow noopener noreferrer">00:10:45</A> Now, in the <A href="https://bit.ly/handsonsapdev#upcoming" target="_blank" rel="nofollow noopener noreferrer">upcoming section</A> of the main <A href="https://bit.ly/handsonsapdev" target="_blank" rel="nofollow noopener noreferrer">Hands-on SAP dev</A> post, I'm maintaining not only the upcoming episode but, where appropriate, I've added future planned episodes - there are already two episodes planned next week, with <SPAN class="mention-scrubbed">thomas.jung</SPAN> on Wednesday and <SPAN class="mention-scrubbed">mariusobert</SPAN> on Friday.<BR />
<BR />
<A href="https://www.youtube.com/watch?v=Mn9xU4BCVcM&amp;list=PL6RpkC85SLQAIntm7MkNk78ysDm3Ua8t0&amp;t=00h11m40s" target="_blank" rel="nofollow noopener noreferrer">00:11:40</A> Starting where we left off on this topic last time, looking at what we have with respect to the Business Rules service in the Neo environment, so that we know what we're aiming for in Cloud Foundry (CF). This includes the service itself and also the administration UI.<BR />
<BR />
<A href="https://www.youtube.com/watch?v=Mn9xU4BCVcM&amp;list=PL6RpkC85SLQAIntm7MkNk78ysDm3Ua8t0&amp;t=00h14m45s" target="_blank" rel="nofollow noopener noreferrer">00:14:45</A> Mentioning one of the great folks from the Intelligent Enterprise Process Orchestration team <SPAN class="mention-scrubbed">archana.shukla</SPAN> - you should definitely take a look at her blog posts on the subjects of the Business Rules and Workflow services!<BR />
<BR />
<A href="https://www.youtube.com/watch?v=Mn9xU4BCVcM&amp;list=PL6RpkC85SLQAIntm7MkNk78ysDm3Ua8t0&amp;t=00h16m00s" target="_blank" rel="nofollow noopener noreferrer">00:16:00</A> Exploring my SAP Cloud Platform CF trial account, and the relationships between the subaccount, the organisation and the space(s), as well as basic CF concepts such as applications, services, service instances and bindings.<BR />
<BR />
<A href="https://www.youtube.com/watch?v=Mn9xU4BCVcM&amp;list=PL6RpkC85SLQAIntm7MkNk78ysDm3Ua8t0&amp;t=00h19m50s" target="_blank" rel="nofollow noopener noreferrer">00:19:50</A> <SPAN class="mention-scrubbed">gregorw</SPAN> points out that while you can renew your Cloud Foundry trial three times up to a total of 90 days, you can actually keep renewing, it's just that your artifacts are removed after 90 days (but you can redeploy and set things up again). He points to a <A href="https://twitter.com/Chuergo16/status/1197580905314996226" target="_blank" rel="nofollow noopener noreferrer">tweet</A> by <SPAN class="mention-scrubbed">chuergo16</SPAN> that relates to this.<BR />
<BR />
<A href="https://www.youtube.com/watch?v=Mn9xU4BCVcM&amp;list=PL6RpkC85SLQAIntm7MkNk78ysDm3Ua8t0&amp;t=00h23m50s" target="_blank" rel="nofollow noopener noreferrer">00:23:50</A> Mentioning the <A href="https://surveys.sap.com/jfe/form/SV_0uozKWOYSgTrBFX" target="_blank" rel="noopener noreferrer">SAP Developer Insights Survey</A>, in a conversation about feedback. If you have already completed it - thank you! If you haven't, please do, it should take you no more than 10 mins.<BR />
<BR />
<A href="https://www.youtube.com/watch?v=Mn9xU4BCVcM&amp;list=PL6RpkC85SLQAIntm7MkNk78ysDm3Ua8t0&amp;t=00h24m15s" target="_blank" rel="nofollow noopener noreferrer">00:24:15</A> Creating a new instance of the Business Rules service, with the 'lite' plan, and talking about a strategy for naming things, to help with my problem of (a) never knowing what to pick and (b) regardless of what I pick ('business-rules' in this case) I forget what it was 5 mins later. This is particularly and painfully prescient as indeed at the end of this episode, the build / deploy process fails ... because I forgot what name I'd chosen!<BR />
<BR />
<A href="https://www.youtube.com/watch?v=Mn9xU4BCVcM&amp;list=PL6RpkC85SLQAIntm7MkNk78ysDm3Ua8t0&amp;t=00h25m30s" target="_blank" rel="nofollow noopener noreferrer">00:25:30</A> A quick mention of the SAP <A href="https://anchor.fm/sap-community-podcast" target="_blank" rel="nofollow noopener noreferrer">Coffee Corner Radio Podcast</A>, to which you should definitely subscribe. Recommended!<BR />
<BR />
<A href="https://www.youtube.com/watch?v=Mn9xU4BCVcM&amp;list=PL6RpkC85SLQAIntm7MkNk78ysDm3Ua8t0&amp;t=00h26m10s" target="_blank" rel="nofollow noopener noreferrer">00:26:10</A> About to create a Service Key for the new instance of this service, so we can make calls to it from other endpoints such as the <A href="https://api.sap.com" target="_blank" rel="noopener noreferrer">SAP API Business Hub</A>. Note that the authentication will be based on OAuth 2.0.<BR />
<BR />
<A href="https://www.youtube.com/watch?v=Mn9xU4BCVcM&amp;list=PL6RpkC85SLQAIntm7MkNk78ysDm3Ua8t0&amp;t=00h29m05s" target="_blank" rel="nofollow noopener noreferrer">00:29:05</A> There are three pieces of information in the Service Key that we'll need eventually to make our API calls: the client ID, the client secret, and the endpoint URL.<BR />
<BR />
<A href="https://www.youtube.com/watch?v=Mn9xU4BCVcM&amp;list=PL6RpkC85SLQAIntm7MkNk78ysDm3Ua8t0&amp;t=00h30m15s" target="_blank" rel="nofollow noopener noreferrer">00:30:15</A> <SPAN class="mention-scrubbed">mark.teichmann</SPAN> shares a link to a useful resource regarding OAuth 2.0 and SAP service resources: <A href="https://wiki.scn.sap.com/wiki/display/Security/OAuth+2.0+-+Integrating+access+protected+web+services+using+the+OAuth+2.0+Client" target="_blank" rel="noopener noreferrer">OAuth 2.0 - Integrating access protected web services using the OAuth 2.0 Client Skip to end of metadata</A>. Thanks Mark!<BR />
<BR />
<A href="https://www.youtube.com/watch?v=Mn9xU4BCVcM&amp;list=PL6RpkC85SLQAIntm7MkNk78ysDm3Ua8t0&amp;t=00h31m00s" target="_blank" rel="nofollow noopener noreferrer">00:31:00</A> At this stage we move back to the organisation level in CF to create a collection of Business Service related roles and assign that collection to myself. The roles cover superuser access to both of the areas - design-time and runtime, in other words, Repository and Runtime contexts.<BR />
<BR />
<A href="https://www.youtube.com/watch?v=Mn9xU4BCVcM&amp;list=PL6RpkC85SLQAIntm7MkNk78ysDm3Ua8t0&amp;t=00h38m10s" target="_blank" rel="nofollow noopener noreferrer">00:38:10</A> With the role collection created, we add it to my user, via Trust Configuration, in the context of the identity provider used (the SAP ID Service).<BR />
<BR />
<A href="https://www.youtube.com/watch?v=Mn9xU4BCVcM&amp;list=PL6RpkC85SLQAIntm7MkNk78ysDm3Ua8t0&amp;t=00h40m10s" target="_blank" rel="nofollow noopener noreferrer">00:40:10</A> Almost everything is set up now, but one thing that we still have to do is manually and explicitly bring to life the equivalent of the "Manage Business Rules" app that we know and love from the Neo environment. In Neo it was automatically available to us, but in this CF context we need to build and deploy the app ourselves. It's a one-time activity, yes, it's extra work, but I think in this case it's worth it as it teaches us more stuff about how CF and multi-target apps work.<BR />
<BR />
<A href="https://www.youtube.com/watch?v=Mn9xU4BCVcM&amp;list=PL6RpkC85SLQAIntm7MkNk78ysDm3Ua8t0&amp;t=00h42m40s" target="_blank" rel="nofollow noopener noreferrer">00:42:40</A> Downloading the <A href="https://github.com/SAP/cloud-businessrules-samples/blob/master/cf-apps/cf-businessruleseditor.zip" target="_blank" rel="nofollow noopener noreferrer">cf-businessruleseditor.zip</A> file from the <A href="https://github.com/SAP/cloud-businessrules-samples" target="_blank" rel="nofollow noopener noreferrer">SAP/cloud-businessrules-samples</A> repo, which we'll import into the SAP Web IDE to build and deploy.<BR />
<BR />
<A href="https://www.youtube.com/watch?v=Mn9xU4BCVcM&amp;list=PL6RpkC85SLQAIntm7MkNk78ysDm3Ua8t0&amp;t=00h43m40s" target="_blank" rel="nofollow noopener noreferrer">00:43:40</A> I mentioned that this process is described in a relatively new tutorial, <A href="https://developers.sap.com/tutorials/cp-cf-businessrules03-setup-mrp.html" target="_blank" rel="noopener noreferrer">Set Up the Manage Rules Project Application</A>, which is part of a new mission <A href="https://developers.sap.com/mission.cp-rules-get-started.html" target="_blank" rel="noopener noreferrer">Get Started with SAP Cloud Platform Business Rules</A>. Check it out!<BR />
<BR />
<A href="https://www.youtube.com/watch?v=Mn9xU4BCVcM&amp;list=PL6RpkC85SLQAIntm7MkNk78ysDm3Ua8t0&amp;t=00h45m50s" target="_blank" rel="nofollow noopener noreferrer">00:45:50</A> Loading the SAP Web IDE, straight into a nice workspace "HandsOnSAPDev" that I've created for this live stream series purpose, importing the ZIP file, and exploring the contents, and marvelling that there is very little there - most importantly there's the <CODE>mta.yaml</CODE> file which we look at in detail.<BR />
<BR />
For those (like me) who like to stare at configuration, here's the content of the <CODE>mta.yaml</CODE> file (including the change from "businessrules" to "business-rules" I had to <A href="https://twitter.com/qmacro/status/1197806803217723393" target="_blank" rel="nofollow noopener noreferrer">make at the end</A> to get the build to work and the deploy to be successful (yes, this is the name change that I'd forgotten about!):<BR />
<DIV><BR />
<PRE class="sourceCode yaml"><CODE class="sourceCode yaml"><SPAN class="fu">ID:</SPAN> businessruleseditor<BR />
<SPAN class="fu">_schema-version:</SPAN> <SPAN class="st">'2.1'</SPAN><BR />
<SPAN class="fu">parameters:</SPAN><BR />
   <SPAN class="fu">deploy_mode:</SPAN> html5-repo<BR />
<SPAN class="fu">version:</SPAN> 0.0.1<BR />
<BR />
<SPAN class="fu">modules:</SPAN><BR />
 <SPAN class="kw">-</SPAN> <SPAN class="fu">name:</SPAN> businessruleseditor_appRouter<BR />
   <SPAN class="fu">type:</SPAN> approuter.nodejs<BR />
   <SPAN class="fu">path:</SPAN> businessruleseditor_appRouter<BR />
   <SPAN class="fu">parameters:</SPAN><BR />
      <SPAN class="fu">disk-quota:</SPAN> 256M<BR />
      <SPAN class="fu">memory:</SPAN> 256M<BR />
   <SPAN class="fu">requires:</SPAN><BR />
    <SPAN class="kw">-</SPAN> <SPAN class="fu">name:</SPAN> businessruleseditor_html5_repo_runtime<BR />
    <SPAN class="kw">-</SPAN> <SPAN class="fu">name:</SPAN> businessrules_uaa<BR />
    <SPAN class="kw">-</SPAN> <SPAN class="fu">name:</SPAN> business-rules<BR />
<SPAN class="fu">resources:</SPAN><BR />
 <SPAN class="kw">-</SPAN> <SPAN class="fu">name:</SPAN> businessruleseditor_html5_repo_runtime<BR />
   <SPAN class="fu">parameters:</SPAN><BR />
      <SPAN class="fu">service-plan:</SPAN> app-runtime<BR />
      <SPAN class="fu">service:</SPAN> html5-apps-repo<BR />
   <SPAN class="fu">type:</SPAN> org.cloudfoundry.managed-service<BR />
 <SPAN class="kw">-</SPAN> <SPAN class="fu">name:</SPAN> business-rules<BR />
   <SPAN class="fu">type:</SPAN> org.cloudfoundry.existing-service<BR />
 <SPAN class="kw">-</SPAN> <SPAN class="fu">name:</SPAN> businessrules_uaa<BR />
   <SPAN class="fu">type:</SPAN> com.sap.xs.uaa<BR />
   <SPAN class="fu">parameters:</SPAN><BR />
      <SPAN class="fu">config:</SPAN><BR />
         <SPAN class="fu">xsappname:</SPAN> businessrules_uaa-appname<BR />
         <SPAN class="fu">tenant-mode:</SPAN> dedicated<BR />
         <SPAN class="fu">role-templates:</SPAN><BR />
            <SPAN class="kw">-</SPAN> <SPAN class="fu">name :</SPAN> UaaUser<BR />
              <SPAN class="fu">description:</SPAN> Role template for accessing SAP Business Rule APIs.Editor via user token flow<BR />
              <SPAN class="fu">scope-references:</SPAN><BR />
                <SPAN class="kw">-</SPAN> uaa.user</CODE></PRE><BR />
</DIV><BR />
<A href="https://www.youtube.com/watch?v=Mn9xU4BCVcM&amp;list=PL6RpkC85SLQAIntm7MkNk78ysDm3Ua8t0&amp;t=00h53m30s" target="_blank" rel="nofollow noopener noreferrer">00:53:30</A> We build the project, deliberately choosing the deprecated tool, to remember what it does and how the logs look as we can look at the new build tool <CODE>mbt</CODE> in a future episode (the deprecated, Java-based build tool will be supported to 31 May 2020). The build process completes and a new multi-target application archive <CODE>businessruleseditor_0.0.1.mtar</CODE> is created.<BR />
<BR />
<A href="https://www.youtube.com/watch?v=Mn9xU4BCVcM&amp;list=PL6RpkC85SLQAIntm7MkNk78ysDm3Ua8t0&amp;t=00h56m00s" target="_blank" rel="nofollow noopener noreferrer">00:56:00</A> We deploy this to CF, specifying the API endpoint, organisation and space ... and it fails! It's because I'd forgotten I'd named the Business Rules service instance 'business-rules' (with a dash) - I needed to adjust the <CODE>mta.yaml</CODE> references to deal with this. Oops! The nice thing was that the failure was fairly clean and obvious - the error message told us exactly what was wrong.<BR />
<BR />
One more issue (again, my fault) - in rushing to make the change, I only changed the reference in a single place, not in both places (referer and referee) so the build failed again. Doh! Shortly after the stream finished, I fixed it. An exciting end to the stream, don't you think?<BR />
<BR />
And ... as Former Member pointed out in the chat right at the end: "<EM>Problems are where we learn</EM>". Well said!
