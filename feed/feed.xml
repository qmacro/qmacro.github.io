<?xml version="1.0" encoding="utf-8"?>
<?xml-stylesheet href="pretty-atom-feed.xsl" type="text/xsl"?>
<feed xmlns="http://www.w3.org/2005/Atom" xml:lang="en">
  <title>DJ Adams</title>
  <subtitle>Reserving the right to be wrong</subtitle>
  <link href="https://qmacro.org/feed/feed.xml" rel="self" />
  <link href="https://qmacro.org/blog/" />
  <updated>2025-11-11T00:00:00Z</updated>
  <id>https://qmacro.org/blog/</id>
  <author>
    <name>DJ Adams</name>
  </author>
  <entry>
    <title>Hands-on domain modelling with CAP&#39;s CDS at UKISUG Connect</title>
    <link href="https://qmacro.org/blog/posts/2025/11/11/hands-on-domain-modelling-with-caps-cds-at-ukisug-connect/" />
    <updated>2025-11-11T00:00:00Z</updated>
    <id>https://qmacro.org/blog/posts/2025/11/11/hands-on-domain-modelling-with-caps-cds-at-ukisug-connect/</id>
    <content type="html">&lt;p&gt;As I mentioned in my &lt;a href=&quot;https://qmacro.org/blog/posts/2025/09/10/upcoming-talks-in-autumn-2025/&quot;&gt;Upcoming talks in autumn 2025&lt;/a&gt; post recently, I&#39;ll be attending and speaking at &lt;a href=&quot;https://www.ukisugconnect.co.uk/&quot;&gt;UKISUG Connect&lt;/a&gt;. I have a couple of sessions, a hands-on workshop on the &lt;a href=&quot;https://virtual.oxfordabstracts.com/event/75555/program?date=%222025-11-30%22&quot;&gt;Sunday&lt;/a&gt; and a technical track talk on the &lt;a href=&quot;https://virtual.oxfordabstracts.com/event/75555/program?date=%222025-12-1%22&quot;&gt;Monday&lt;/a&gt;.&lt;/p&gt;
&lt;p&gt;In this post I want to describe the hands-on workshop, what to expect, and (if you intend to participate in the actual hands-on part) what you need.&lt;/p&gt;
&lt;p&gt;First, from the &lt;a href=&quot;https://virtual.oxfordabstracts.com/event/75555/submission/101&quot;&gt;session page&lt;/a&gt;, here&#39;s the synopsis:&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;Become acquainted with CAP&#39;s CDS, the common language that binds domain experts, with their key business &amp;amp; process knowledge, to developers. A hands-on-optional session where we&#39;ll explore the language &amp;amp; concepts together and get comfortable with it.&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;There are also the full session details:&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;What happened to systems analysts, module specialists?&lt;/p&gt;
&lt;p&gt;Nothing - they&#39;re still here, and called &amp;quot;domain experts&amp;quot;. What&#39;s more, there&#39;s a common language that binds them, with their key business &amp;amp; process knowledge, to developers, with their knowledge of best practices &amp;amp; developer tools.&lt;/p&gt;
&lt;p&gt;That common language is CDS - a succinct, powerful and flexible way to describe the domain model and associated functionality for a given solution.&lt;/p&gt;
&lt;p&gt;We&#39;ll learn by doing, collaboratively exploring how to model entities, relationships, functions and more to build the domain model definition to be at the heart of the solution.&lt;/p&gt;
&lt;p&gt;Bring and work on your own laptop (setup instructions provided) or just take part in the Q&amp;amp;A style conversation led by the instructor.&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;That last sentence is important, and worth explaining. I would like to make the session as welcoming and open as possible, even to those with no prior experience of CAP or CDS, and to non-developers.&lt;/p&gt;
&lt;p&gt;Additionally, I know that some folks simply may not have their laptops with them, or not want to set things up to participate in the exercises. That is absolutely fine.&lt;/p&gt;
&lt;p&gt;You can participate:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;either on your laptop, working through the exercises with me and the rest of your fellow hands-on enthusiasts&lt;/li&gt;
&lt;li&gt;or listen &amp;amp; watch, and take part in the conversation we&#39;ll have throughout the 2 hours, as I work through the exercises myself too, on the big screen, for all to see&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;The first option will require you to set up (or already have) a trial account on the SAP Business Technology Platform (BTP) - more on that in the &lt;a href=&quot;https://qmacro.org/blog/posts/2025/11/11/hands-on-domain-modelling-with-caps-cds-at-ukisug-connect/#preparation-for-doing-the-exercises&quot;&gt;Preparation for doing the exercises&lt;/a&gt; section below.&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;https://qmacro.org/images/2025/11/hands-on-session-2024.jpg&quot; alt=&quot;A photo of a hands-on workshop I ran last year at the event&quot;&gt;&lt;/p&gt;
&lt;p&gt;The second option is just as valid and the more questions and back and forth we generate between us the better for all! And there&#39;s no preparation required, except perhaps to pack your curiosity and bring it with you.&lt;/p&gt;
&lt;h2 id=&quot;preparation-for-doing-the-exercises&quot;&gt;Preparation for doing the exercises&lt;/h2&gt;
&lt;p&gt;If you do want to take the first option, and work through the exercises on your laptop as I lead the session working through them myself, then arguably the easiest option for you is to use the SAP Business Application Studio, the online IDE available for free in an BTP trial account.&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;To get a trial account, follow the tutorial &lt;a href=&quot;https://developers.sap.com/tutorials/hcp-create-trial-account.html&quot;&gt;Get an Account on SAP BTP Trial&lt;/a&gt;.&lt;/li&gt;
&lt;li&gt;Once you&#39;ve done that, follow the tutorial &lt;a href=&quot;https://developers.sap.com/tutorials/appstudio-onboarding.html&quot;&gt;Set Up SAP Business Application Studio for Development&lt;/a&gt;.&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;Then you&#39;re all set.&lt;/p&gt;
&lt;p&gt;Either way, I encourage you to pop down to the hands-on workshop rooms on Sunday afternoon and join me!&lt;/p&gt;
</content>
  </entry>
  <entry>
    <title>Quiet cds test output - two ways</title>
    <link href="https://qmacro.org/blog/posts/2025/10/20/quiet-cds-test-output-two-ways/" />
    <updated>2025-10-20T00:00:00Z</updated>
    <id>https://qmacro.org/blog/posts/2025/10/20/quiet-cds-test-output-two-ways/</id>
    <content type="html">&lt;h2 id=&quot;background&quot;&gt;Background&lt;/h2&gt;
&lt;p&gt;I watched Mauricio Lauffer&#39;s Devtoberfest session &lt;a href=&quot;https://www.youtube.com/watch?v=6kfixPTQH4U&quot;&gt;Testing SAP CAP Node.js apps with cds.test&lt;/a&gt; yesterday, it was great. Thanks Mauricio! It&#39;s a nice accompaniment to the &lt;a href=&quot;https://cap.cloud.sap/docs/node.js/cds-test&quot;&gt;Testing with cds.test&lt;/a&gt; topic in Capire.&lt;/p&gt;
&lt;h2 id=&quot;setting-up-a-test-project&quot;&gt;Setting up a test project&lt;/h2&gt;
&lt;p&gt;I set up a small project to try things out myself (using CAP Node.js, with my &lt;code&gt;@sap/cds-dk&lt;/code&gt; at 9.4.1):&lt;/p&gt;
&lt;pre class=&quot;language-bash&quot; tabindex=&quot;0&quot;&gt;&lt;code class=&quot;language-bash&quot;&gt;cds init &lt;span class=&quot;token parameter variable&quot;&gt;--add&lt;/span&gt; tiny-sample,test proj &lt;span class=&quot;token operator&quot;&gt;&amp;amp;&amp;amp;&lt;/span&gt; &lt;span class=&quot;token builtin class-name&quot;&gt;cd&lt;/span&gt; &lt;span class=&quot;token variable&quot;&gt;$_&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;&amp;amp;&amp;amp;&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;npm&lt;/span&gt; i&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;This produced:&lt;/p&gt;
&lt;pre class=&quot;language-log&quot; tabindex=&quot;0&quot;&gt;&lt;code class=&quot;language-log&quot;&gt;creating new CAP project in &lt;span class=&quot;token file-path string&quot;&gt;./proj&lt;/span&gt;

adding nodejs
adding tiny&lt;span class=&quot;token operator&quot;&gt;-&lt;/span&gt;sample
adding test
&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt; writing test&lt;span class=&quot;token operator&quot;&gt;/&lt;/span&gt;CatalogService&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;test&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;js

successfully created project – continue with cd proj

find samples on &lt;span class=&quot;token url&quot;&gt;https://github.com/capire/samples&lt;/span&gt;
learn about next steps at &lt;span class=&quot;token url&quot;&gt;https://cap.cloud.sap&lt;/span&gt;

added &lt;span class=&quot;token number&quot;&gt;134&lt;/span&gt; packages&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; and audited &lt;span class=&quot;token number&quot;&gt;135&lt;/span&gt; packages in &lt;span class=&quot;token number&quot;&gt;5s&lt;/span&gt;

&lt;span class=&quot;token number&quot;&gt;25&lt;/span&gt; packages are looking for funding
  run `npm fund` for details

found &lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt; vulnerabilities&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;I was now in the position to experiment.&lt;/p&gt;
&lt;h2 id=&quot;the-basic-testing-artifacts&quot;&gt;The basic testing artifacts&lt;/h2&gt;
&lt;p&gt;By default, adding the &lt;code&gt;test&lt;/code&gt; facet created &lt;code&gt;test/CatalogService.test.js&lt;/code&gt;:&lt;/p&gt;
&lt;pre class=&quot;language-log&quot; tabindex=&quot;0&quot;&gt;&lt;code class=&quot;language-log&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;
├── README&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;md
├── app
├── db
│   ├── data
│   │   └── my&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;bookshop&lt;span class=&quot;token operator&quot;&gt;-&lt;/span&gt;Books&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;csv
│   └── &lt;span class=&quot;token domain constant&quot;&gt;schema.cds&lt;/span&gt;
├── &lt;span class=&quot;token domain constant&quot;&gt;eslint.config.mjs&lt;/span&gt;
├── &lt;span class=&quot;token domain constant&quot;&gt;package-lock.json&lt;/span&gt;
├── &lt;span class=&quot;token domain constant&quot;&gt;package.json&lt;/span&gt;
├── srv
│   └── &lt;span class=&quot;token domain constant&quot;&gt;cat-service.cds&lt;/span&gt;
└── test
    └── CatalogService&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;test&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;js&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;Additionally, in &lt;code&gt;package.json&lt;/code&gt;:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;code&gt;@cap-js/cds-test&lt;/code&gt; was added as a dev dependency&lt;/li&gt;
&lt;li&gt;a new script &lt;code&gt;test&lt;/code&gt; was added which invokes &lt;code&gt;node --test&lt;/code&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;The &lt;code&gt;test/CatalogService.test.js&lt;/code&gt; file contains a fixture to test the &lt;code&gt;CatalogService&lt;/code&gt; endpoint, specifically the &lt;code&gt;Books&lt;/code&gt; entityset, where I modified the expected book subset to be one of the items in the initial data, i.e. &lt;code&gt;{&amp;quot;ID&amp;quot;: 2, &amp;quot;title&amp;quot;: &amp;quot;Jane Eyre&amp;quot;}&lt;/code&gt;.&lt;/p&gt;
&lt;p&gt;So far so good.&lt;/p&gt;
&lt;h2 id=&quot;the-first-test-run&quot;&gt;The first test run&lt;/h2&gt;
&lt;p&gt;When I invoke the test cycle, with &lt;code&gt;npm test&lt;/code&gt; (causing &lt;code&gt;node --test&lt;/code&gt; to run), I see this:&lt;/p&gt;
&lt;pre class=&quot;language-log&quot; tabindex=&quot;0&quot;&gt;&lt;code class=&quot;language-log&quot;&gt;&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt; proj&lt;span class=&quot;token operator&quot;&gt;@&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;1.0.0&lt;/span&gt; test
&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt; node &lt;span class=&quot;token operator&quot;&gt;-&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;-&lt;/span&gt;test

&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;cds&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;-&lt;/span&gt; loaded model from &lt;span class=&quot;token number&quot;&gt;3&lt;/span&gt; file&lt;span class=&quot;token operator&quot;&gt;(&lt;/span&gt;s&lt;span class=&quot;token operator&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt;

  srv&lt;span class=&quot;token operator&quot;&gt;/&lt;/span&gt;cat&lt;span class=&quot;token operator&quot;&gt;-&lt;/span&gt;service&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;cds
  node_modules&lt;span class=&quot;token operator&quot;&gt;/&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;@&lt;/span&gt;sap&lt;span class=&quot;token operator&quot;&gt;/&lt;/span&gt;cds&lt;span class=&quot;token operator&quot;&gt;/&lt;/span&gt;srv&lt;span class=&quot;token operator&quot;&gt;/&lt;/span&gt;outbox&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;cds
  db&lt;span class=&quot;token operator&quot;&gt;/&lt;/span&gt;schema&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;cds

&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;cds&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;-&lt;/span&gt; connect to db &lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt; sqlite &lt;span class=&quot;token operator&quot;&gt;{&lt;/span&gt; url&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&#39;:memory:&#39;&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;}&lt;/span&gt;
  &lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt; init from db&lt;span class=&quot;token operator&quot;&gt;/&lt;/span&gt;data&lt;span class=&quot;token operator&quot;&gt;/&lt;/span&gt;my&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;bookshop&lt;span class=&quot;token operator&quot;&gt;-&lt;/span&gt;Books&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;csv
&lt;span class=&quot;token operator&quot;&gt;/&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt; successfully deployed to in&lt;span class=&quot;token operator&quot;&gt;-&lt;/span&gt;memory database&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;

&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;cds&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;-&lt;/span&gt; using auth strategy &lt;span class=&quot;token operator&quot;&gt;{&lt;/span&gt;
  &lt;span class=&quot;token property&quot;&gt;kind:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&#39;mocked&#39;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
  &lt;span class=&quot;token property&quot;&gt;impl:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&#39;node_modules/@sap/cds/lib/srv/middlewares/auth/basic-auth.js&#39;&lt;/span&gt;
&lt;span class=&quot;token operator&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;cds&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;-&lt;/span&gt; serving CatalogService &lt;span class=&quot;token operator&quot;&gt;{&lt;/span&gt;
  &lt;span class=&quot;token property&quot;&gt;at:&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&#39;/odata/v4/catalog&#39;&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
  &lt;span class=&quot;token property&quot;&gt;decl:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&#39;srv/cat-service.cds:3&#39;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
  &lt;span class=&quot;token property&quot;&gt;impl:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&#39;node_modules/@sap/cds/srv/app-service.js&#39;&lt;/span&gt;
&lt;span class=&quot;token operator&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;cds&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;-&lt;/span&gt; server listening on &lt;span class=&quot;token operator&quot;&gt;{&lt;/span&gt; url&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&#39;http://localhost:34593&#39;&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;cds&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;-&lt;/span&gt; server &lt;span class=&quot;token number&quot;&gt;v9.4.3&lt;/span&gt; launched in &lt;span class=&quot;token number&quot;&gt;185&lt;/span&gt; ms
✔ &lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt;next&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;105.447291ms&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;odata&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;-&lt;/span&gt; GET &lt;span class=&quot;token file-path string&quot;&gt;/odata/v4/catalog/CatalogService.Books&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;{&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&#39;$select&#39;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&#39;ID,title&#39;&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;}&lt;/span&gt;
▶ OData APIs
  ✔ serves CatalogService&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;Books &lt;span class=&quot;token operator&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;18.874042ms&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;)&lt;/span&gt;
✔ OData APIs &lt;span class=&quot;token operator&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;19.020667ms&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;)&lt;/span&gt;
ℹ tests &lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt;
ℹ suites &lt;span class=&quot;token number&quot;&gt;2&lt;/span&gt;
ℹ pass &lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt;
ℹ fail &lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt;
ℹ cancelled &lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt;
ℹ skipped &lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt;
ℹ todo &lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt;
ℹ duration_ms &lt;span class=&quot;token number&quot;&gt;220.950041&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;That&#39;s quite a lot of output, and it&#39;s not as easy as it could be to discern what happened.&lt;/p&gt;
&lt;h2 id=&quot;using-cds-log-levels&quot;&gt;Using cds.log.levels&lt;/h2&gt;
&lt;p&gt;One way to address this, &lt;a href=&quot;https://github.com/mauriciolauffer/devtoberfest2025/blob/main/package.json&quot;&gt;as Mauricio did&lt;/a&gt;, is to reduce the output of certain modules to nothing, using &lt;code&gt;silent&lt;/code&gt; for various &lt;code&gt;cds.log.levels&lt;/code&gt; components, in &lt;code&gt;package.json&lt;/code&gt;:&lt;/p&gt;
&lt;pre class=&quot;language-json&quot; tabindex=&quot;0&quot;&gt;&lt;code class=&quot;language-json&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
  &lt;span class=&quot;token property&quot;&gt;&quot;cds&quot;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;token property&quot;&gt;&quot;log&quot;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
      &lt;span class=&quot;token property&quot;&gt;&quot;levels&quot;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;token property&quot;&gt;&quot;cds&quot;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;silent&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
        &lt;span class=&quot;token property&quot;&gt;&quot;cds.serve&quot;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;silent&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
        &lt;span class=&quot;token property&quot;&gt;&quot;odata&quot;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;silent&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
        &lt;span class=&quot;token property&quot;&gt;&quot;deploy&quot;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;silent&quot;&lt;/span&gt;
      &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
  &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;This makes the test output less noisy, for sure:&lt;/p&gt;
&lt;pre class=&quot;language-log&quot; tabindex=&quot;0&quot;&gt;&lt;code class=&quot;language-log&quot;&gt;&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt; proj&lt;span class=&quot;token operator&quot;&gt;@&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;1.0.0&lt;/span&gt; test
&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt; node &lt;span class=&quot;token operator&quot;&gt;-&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;-&lt;/span&gt;test

✔ &lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt;next&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;100.910208ms&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;)&lt;/span&gt;
▶ OData APIs
  ✔ serves CatalogService&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;Books &lt;span class=&quot;token operator&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;19.222666ms&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;)&lt;/span&gt;
✔ OData APIs &lt;span class=&quot;token operator&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;19.378125ms&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;)&lt;/span&gt;
ℹ tests &lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt;
ℹ suites &lt;span class=&quot;token number&quot;&gt;2&lt;/span&gt;
ℹ pass &lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt;
ℹ fail &lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt;
ℹ cancelled &lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt;
ℹ skipped &lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt;
ℹ todo &lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt;
ℹ duration_ms &lt;span class=&quot;token number&quot;&gt;212.527334&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;But it also makes regular CAP server log output a little mute - when running &lt;code&gt;cds watch&lt;/code&gt;, this is all that is emitted:&lt;/p&gt;
&lt;pre class=&quot;language-log&quot; tabindex=&quot;0&quot;&gt;&lt;code class=&quot;language-log&quot;&gt;cds serve all &lt;span class=&quot;token operator&quot;&gt;-&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;-&lt;/span&gt;with&lt;span class=&quot;token operator&quot;&gt;-&lt;/span&gt;mocks &lt;span class=&quot;token operator&quot;&gt;-&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;-&lt;/span&gt;in&lt;span class=&quot;token operator&quot;&gt;-&lt;/span&gt;memory&lt;span class=&quot;token operator&quot;&gt;?&lt;/span&gt;
&lt;span class=&quot;token operator&quot;&gt;(&lt;/span&gt; live reload enabled for browsers &lt;span class=&quot;token operator&quot;&gt;)&lt;/span&gt;

        ___________________________

&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;cds&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;-&lt;/span&gt; connect using bindings from&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;{&lt;/span&gt; registry&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&#39;~/.cds-services.json&#39;&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;A little too quiet.&lt;/p&gt;
&lt;h2 id=&quot;wrapping-log-level-settings-in-a-profile&quot;&gt;Wrapping log level settings in a profile&lt;/h2&gt;
&lt;p&gt;As the Capire documentation explains, &lt;a href=&quot;https://cap.cloud.sap/docs/node.js/cds-env#profiles&quot;&gt;configuration profiles&lt;/a&gt; are easy to use and can be employed in various ways.&lt;/p&gt;
&lt;p&gt;I can contextualise these reductions in log output to a configuration profile, I&#39;ll call it &amp;quot;quiet&amp;quot;:&lt;/p&gt;
&lt;pre class=&quot;language-json&quot; tabindex=&quot;0&quot;&gt;&lt;code class=&quot;language-json&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
  &lt;span class=&quot;token property&quot;&gt;&quot;cds&quot;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;token property&quot;&gt;&quot;[quiet]&quot;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
      &lt;span class=&quot;token property&quot;&gt;&quot;log&quot;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;token property&quot;&gt;&quot;levels&quot;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
          &lt;span class=&quot;token property&quot;&gt;&quot;cds&quot;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;silent&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
          &lt;span class=&quot;token property&quot;&gt;&quot;cds.serve&quot;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;silent&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
          &lt;span class=&quot;token property&quot;&gt;&quot;odata&quot;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;silent&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
          &lt;span class=&quot;token property&quot;&gt;&quot;deploy&quot;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;silent&quot;&lt;/span&gt;
        &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
      &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
  &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;Then I can run &lt;code&gt;cds watch&lt;/code&gt; as normal and get the output I expect:&lt;/p&gt;
&lt;pre class=&quot;language-log&quot; tabindex=&quot;0&quot;&gt;&lt;code class=&quot;language-log&quot;&gt;cds serve all &lt;span class=&quot;token operator&quot;&gt;-&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;-&lt;/span&gt;with&lt;span class=&quot;token operator&quot;&gt;-&lt;/span&gt;mocks &lt;span class=&quot;token operator&quot;&gt;-&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;-&lt;/span&gt;in&lt;span class=&quot;token operator&quot;&gt;-&lt;/span&gt;memory&lt;span class=&quot;token operator&quot;&gt;?&lt;/span&gt;
&lt;span class=&quot;token operator&quot;&gt;(&lt;/span&gt; live reload enabled for browsers &lt;span class=&quot;token operator&quot;&gt;)&lt;/span&gt;

        ___________________________

&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;cds&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;-&lt;/span&gt; loaded model from &lt;span class=&quot;token number&quot;&gt;3&lt;/span&gt; file&lt;span class=&quot;token operator&quot;&gt;(&lt;/span&gt;s&lt;span class=&quot;token operator&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt;

  srv&lt;span class=&quot;token operator&quot;&gt;/&lt;/span&gt;cat&lt;span class=&quot;token operator&quot;&gt;-&lt;/span&gt;service&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;cds
  node_modules&lt;span class=&quot;token operator&quot;&gt;/&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;@&lt;/span&gt;sap&lt;span class=&quot;token operator&quot;&gt;/&lt;/span&gt;cds&lt;span class=&quot;token operator&quot;&gt;/&lt;/span&gt;srv&lt;span class=&quot;token operator&quot;&gt;/&lt;/span&gt;outbox&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;cds
  db&lt;span class=&quot;token operator&quot;&gt;/&lt;/span&gt;schema&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;cds

&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;cds&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;-&lt;/span&gt; connect using bindings from&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;{&lt;/span&gt; registry&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&#39;~/.cds-services.json&#39;&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;cds&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;-&lt;/span&gt; connect to db &lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt; sqlite &lt;span class=&quot;token operator&quot;&gt;{&lt;/span&gt; url&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&#39;:memory:&#39;&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;}&lt;/span&gt;
  &lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt; init from db&lt;span class=&quot;token operator&quot;&gt;/&lt;/span&gt;data&lt;span class=&quot;token operator&quot;&gt;/&lt;/span&gt;my&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;bookshop&lt;span class=&quot;token operator&quot;&gt;-&lt;/span&gt;Books&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;csv
&lt;span class=&quot;token operator&quot;&gt;/&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt; successfully deployed to in&lt;span class=&quot;token operator&quot;&gt;-&lt;/span&gt;memory database&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;

&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;cds&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;-&lt;/span&gt; using auth strategy &lt;span class=&quot;token operator&quot;&gt;{&lt;/span&gt;
  &lt;span class=&quot;token property&quot;&gt;kind:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&#39;mocked&#39;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
  &lt;span class=&quot;token property&quot;&gt;impl:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&#39;node_modules/@sap/cds/lib/srv/middlewares/auth/basic-auth.js&#39;&lt;/span&gt;
&lt;span class=&quot;token operator&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;cds&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;-&lt;/span&gt; serving CatalogService &lt;span class=&quot;token operator&quot;&gt;{&lt;/span&gt;
  &lt;span class=&quot;token property&quot;&gt;at:&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&#39;/odata/v4/catalog&#39;&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
  &lt;span class=&quot;token property&quot;&gt;decl:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&#39;srv/cat-service.cds:3&#39;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
  &lt;span class=&quot;token property&quot;&gt;impl:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&#39;node_modules/@sap/cds/srv/app-service.js&#39;&lt;/span&gt;
&lt;span class=&quot;token operator&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;cds&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;-&lt;/span&gt; server listening on &lt;span class=&quot;token operator&quot;&gt;{&lt;/span&gt; url&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&#39;http://localhost:4004&#39;&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;cds&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;-&lt;/span&gt; server &lt;span class=&quot;token number&quot;&gt;v9.4.3&lt;/span&gt; launched in &lt;span class=&quot;token number&quot;&gt;245&lt;/span&gt; ms
&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;cds&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt; terminate with &lt;span class=&quot;token operator&quot;&gt;^&lt;/span&gt;C &lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;But I can add the profile specification to the &lt;code&gt;test&lt;/code&gt; NPM script via &lt;code&gt;CDS_ENV&lt;/code&gt; or &lt;code&gt;NODE_ENV&lt;/code&gt; like this:&lt;/p&gt;
&lt;pre class=&quot;language-json&quot; tabindex=&quot;0&quot;&gt;&lt;code class=&quot;language-json&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
  &lt;span class=&quot;token property&quot;&gt;&quot;scripts&quot;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;token property&quot;&gt;&quot;start&quot;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;cds-serve&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
    &lt;span class=&quot;token property&quot;&gt;&quot;test&quot;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;CDS_ENV=quiet node --test&quot;&lt;/span&gt;
  &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;This keeps the test run output quiet and manageable:&lt;/p&gt;
&lt;pre class=&quot;language-log&quot; tabindex=&quot;0&quot;&gt;&lt;code class=&quot;language-log&quot;&gt;&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt; proj&lt;span class=&quot;token operator&quot;&gt;@&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;1.0.0&lt;/span&gt; test
&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt; CDS_ENV&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;quiet node &lt;span class=&quot;token operator&quot;&gt;-&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;-&lt;/span&gt;test

✔ &lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt;next&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;115.602208ms&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;)&lt;/span&gt;
▶ OData APIs
  ✔ serves CatalogService&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;Books &lt;span class=&quot;token operator&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;21.739417ms&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;)&lt;/span&gt;
✔ OData APIs &lt;span class=&quot;token operator&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;21.917125ms&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;)&lt;/span&gt;
ℹ tests &lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt;
ℹ suites &lt;span class=&quot;token number&quot;&gt;2&lt;/span&gt;
ℹ pass &lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt;
ℹ fail &lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt;
ℹ cancelled &lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt;
ℹ skipped &lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt;
ℹ todo &lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt;
ℹ duration_ms &lt;span class=&quot;token number&quot;&gt;231.362166&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;
&lt;h2 id=&quot;using-cds-test&quot;&gt;Using cds test&lt;/h2&gt;
&lt;p&gt;In another great Devtoberfest session, &lt;a href=&quot;https://www.youtube.com/watch?v=HLlX_e-kXJw&quot;&gt;CAP Tools - What&#39;s New and Hot&lt;/a&gt;, Christian Georgi took us through some really cool new tools for development and testing.&lt;/p&gt;
&lt;p&gt;One of these was the new &lt;code&gt;cds test&lt;/code&gt; command.&lt;/p&gt;
&lt;p&gt;But very briefly, instead of using &lt;code&gt;node --test&lt;/code&gt;, with (or without) the &lt;code&gt;CDS_ENV=quiet&lt;/code&gt; setting, I can use the &lt;code&gt;cds test&lt;/code&gt; command, which runs the tests and has a lovely succinct output:&lt;/p&gt;
&lt;pre class=&quot;language-log&quot; tabindex=&quot;0&quot;&gt;&lt;code class=&quot;language-log&quot;&gt;  OData APIs
    ✔ serves CatalogService&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;Books

 &lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt; passed
 &lt;span class=&quot;token number&quot;&gt;0.259s&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;How neat is that?!&lt;/p&gt;
&lt;h2 id=&quot;wrapping-up&quot;&gt;Wrapping up&lt;/h2&gt;
&lt;p&gt;To find out more, you should watch the replay of Christian&#39;s session, after watching the replay of Mauricio&#39;s session too, of course.&lt;/p&gt;
&lt;p&gt;Happy testing!&lt;/p&gt;
</content>
  </entry>
  <entry>
    <title>Modelling contained-in relationships with compositions in CDS</title>
    <link href="https://qmacro.org/blog/posts/2025/10/14/modelling-contained-in-relationships-with-compositions-in-cds/" />
    <updated>2025-10-14T00:00:00Z</updated>
    <id>https://qmacro.org/blog/posts/2025/10/14/modelling-contained-in-relationships-with-compositions-in-cds/</id>
    <content type="html">&lt;h2 id=&quot;background&quot;&gt;Background&lt;/h2&gt;
&lt;p&gt;There&#39;s a classic structure often found representing business data in enterprise software, and that&#39;s the &amp;quot;document&amp;quot;. Purchase requisition, sales order, goods receipt, and so on. Header and items. Most of the time the items don&#39;t make sense existing on their own, independent of their header parent. Such documents are typically modelled using contained-in relationships.&lt;/p&gt;
&lt;p&gt;There&#39;s a great section of the &lt;a href=&quot;https://cap.cloud.sap/docs/&quot;&gt;Capire&lt;/a&gt; documentation, specifically on &lt;a href=&quot;https://cap.cloud.sap/docs/guides/domain-modeling#compositions&quot;&gt;compositions&lt;/a&gt;, on which I want to expand here.&lt;/p&gt;
&lt;h2 id=&quot;explicit-modelling&quot;&gt;Explicit modelling&lt;/h2&gt;
&lt;p&gt;Given a hammer, all problems look like nails. Given the &amp;quot;entity&amp;quot; concept, all business data structures look like they should be modelled using entities.&lt;/p&gt;
&lt;p&gt;Which does work. To wit:&lt;/p&gt;
&lt;pre class=&quot;language-cds&quot; tabindex=&quot;0&quot;&gt;&lt;code class=&quot;language-cds&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;service&lt;/span&gt; S {
  &lt;span class=&quot;token keyword&quot;&gt;entity&lt;/span&gt; Orders {
    &lt;span class=&quot;token cqlkeywords keyword&quot;&gt;key&lt;/span&gt; ID    : &lt;span class=&quot;token type builtin&quot;&gt;Integer&lt;/span&gt;;
        Items : &lt;span class=&quot;token association-composition keyword&quot;&gt;Composition of many OrderItems&lt;/span&gt;
                  &lt;span class=&quot;token cqlkeywords keyword&quot;&gt;on&lt;/span&gt; Items.parent = $self;
  }

  &lt;span class=&quot;token keyword&quot;&gt;entity&lt;/span&gt; OrderItems {
    &lt;span class=&quot;token cqlkeywords keyword&quot;&gt;key&lt;/span&gt; parent : &lt;span class=&quot;token association-composition keyword&quot;&gt;Association to Orders&lt;/span&gt;;
    &lt;span class=&quot;token cqlkeywords keyword&quot;&gt;key&lt;/span&gt; pos    : &lt;span class=&quot;token type builtin&quot;&gt;Integer&lt;/span&gt;;
        qty    : &lt;span class=&quot;token type builtin&quot;&gt;Integer&lt;/span&gt;;
  }
}&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;When compiled (with &lt;code&gt;cds compile --to yaml service.cds&lt;/code&gt;&lt;a href=&quot;https://qmacro.org/blog/posts/2025/10/14/modelling-contained-in-relationships-with-compositions-in-cds/#footnotes&quot;&gt;&lt;sup&gt;1&lt;/sup&gt;&lt;/a&gt;), this results in the following schema notation (in a YAML representation as I find it cleaner and easier to read)&lt;a href=&quot;https://qmacro.org/blog/posts/2025/10/14/modelling-contained-in-relationships-with-compositions-in-cds/#footnotes&quot;&gt;&lt;sup&gt;2&lt;/sup&gt;&lt;/a&gt;:&lt;/p&gt;
&lt;pre class=&quot;language-yaml&quot; tabindex=&quot;0&quot;&gt;&lt;code class=&quot;language-yaml&quot;&gt;&lt;span class=&quot;token key atrule&quot;&gt;definitions&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
  &lt;span class=&quot;token key atrule&quot;&gt;S&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
    &lt;span class=&quot;token key atrule&quot;&gt;kind&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; service
  &lt;span class=&quot;token key atrule&quot;&gt;S.Orders&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
    &lt;span class=&quot;token key atrule&quot;&gt;kind&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; entity
    &lt;span class=&quot;token key atrule&quot;&gt;elements&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
      &lt;span class=&quot;token key atrule&quot;&gt;ID&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
        &lt;span class=&quot;token key atrule&quot;&gt;key&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token boolean important&quot;&gt;true&lt;/span&gt;
        &lt;span class=&quot;token key atrule&quot;&gt;type&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; cds.Integer
      &lt;span class=&quot;token key atrule&quot;&gt;Items&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
        &lt;span class=&quot;token key atrule&quot;&gt;type&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; cds.Composition
        &lt;span class=&quot;token key atrule&quot;&gt;cardinality&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
          &lt;span class=&quot;token key atrule&quot;&gt;max&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&#39;*&#39;&lt;/span&gt;
        &lt;span class=&quot;token key atrule&quot;&gt;target&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; S.OrderItems
        &lt;span class=&quot;token key atrule&quot;&gt;&#39;on&#39;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
          &lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;token key atrule&quot;&gt;ref&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
              &lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt; Items
              &lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt; parent
          &lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&#39;=&#39;&lt;/span&gt;
          &lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;token key atrule&quot;&gt;ref&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
              &lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt; $self
  &lt;span class=&quot;token key atrule&quot;&gt;S.OrderItems&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
    &lt;span class=&quot;token key atrule&quot;&gt;kind&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; entity
    &lt;span class=&quot;token key atrule&quot;&gt;elements&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
      &lt;span class=&quot;token key atrule&quot;&gt;parent&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
        &lt;span class=&quot;token key atrule&quot;&gt;key&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token boolean important&quot;&gt;true&lt;/span&gt;
        &lt;span class=&quot;token key atrule&quot;&gt;type&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; cds.Association
        &lt;span class=&quot;token key atrule&quot;&gt;target&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; S.Orders
        &lt;span class=&quot;token key atrule&quot;&gt;keys&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
          &lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;token key atrule&quot;&gt;ref&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
              &lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt; ID
      &lt;span class=&quot;token key atrule&quot;&gt;pos&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
        &lt;span class=&quot;token key atrule&quot;&gt;key&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token boolean important&quot;&gt;true&lt;/span&gt;
        &lt;span class=&quot;token key atrule&quot;&gt;type&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; cds.Integer
      &lt;span class=&quot;token key atrule&quot;&gt;qty&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
        &lt;span class=&quot;token key atrule&quot;&gt;type&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; cds.Integer&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;The resulting CSN encompasses the modelling intent - zero or more item children, and a relationship constraint that links back to the parent.&lt;/p&gt;
&lt;p&gt;But the definitions at the CDS model level are quite explicit and arguably a little &amp;quot;noisy&amp;quot;:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;at the parent level, the constraint detail (i.e. &lt;code&gt;on Items.parent = $self&lt;/code&gt;) needs to be expressed explicitly&lt;/li&gt;
&lt;li&gt;the child requires an explicit (key) element to point back to the parent&lt;/li&gt;
&lt;li&gt;that child-to-parent relationship needs to be expressed explicitly as a to-one association which is arguably also just a bit too much &amp;quot;machinery&amp;quot; on show&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;Remember, domain modelling is the common language for business domain experts and developers, and the CDS model is where they meet. So machinery is to be avoided where possible.&lt;/p&gt;
&lt;h2 id=&quot;implicit-modelling&quot;&gt;Implicit modelling&lt;/h2&gt;
&lt;p&gt;Such a classic parent-child structure can be expressed in the CDS model a lot more succinctly, using &lt;a href=&quot;https://cap.cloud.sap/docs/guides/domain-modeling#aspects&quot;&gt;aspects&lt;/a&gt;, specifically &lt;a href=&quot;https://cap.cloud.sap/docs/guides/domain-modeling#composition-of-aspects&quot;&gt;anonymous aspects&lt;/a&gt;.&lt;/p&gt;
&lt;p&gt;The exact same model can be expressed thus:&lt;/p&gt;
&lt;pre class=&quot;language-cds&quot; tabindex=&quot;0&quot;&gt;&lt;code class=&quot;language-cds&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;service&lt;/span&gt; S {
  &lt;span class=&quot;token keyword&quot;&gt;entity&lt;/span&gt; Orders {
    &lt;span class=&quot;token cqlkeywords keyword&quot;&gt;key&lt;/span&gt; ID    : &lt;span class=&quot;token type builtin&quot;&gt;Integer&lt;/span&gt;;
        Items : &lt;span class=&quot;token association-composition keyword&quot;&gt;Composition of many &lt;/span&gt;{
                  &lt;span class=&quot;token cqlkeywords keyword&quot;&gt;key&lt;/span&gt; pos : &lt;span class=&quot;token type builtin&quot;&gt;Integer&lt;/span&gt;;
                      qty : &lt;span class=&quot;token type builtin&quot;&gt;Integer&lt;/span&gt;;
                }
  }

}&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;That&#39;s it - that&#39;s the entire equivalent declaration. In using an anonymous aspect (that&#39;s the part expressed as the &lt;code&gt;{ ... }&lt;/code&gt; block) to describe the composition target, we get to NOT have to come up with and define:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;a second entity definition&lt;/li&gt;
&lt;li&gt;a name for that second entity&lt;/li&gt;
&lt;li&gt;a composition constraint&lt;/li&gt;
&lt;li&gt;a pointer from the child back to the parent&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;I would go so far as to say that &lt;a href=&quot;https://qmacro.org/blog/posts/2017/02/19/the-beauty-of-recursion-and-list-machinery/#initial-recognition&quot;&gt;staring at&lt;/a&gt; this structure expression conjures up far more readily what a document (such as those examples mentioned above) &amp;quot;looks like&amp;quot; mentally.&lt;/p&gt;
&lt;p&gt;And guess what? The equivalent schema notation is logically the same. Here&#39;s what compiling this &amp;quot;quieter&amp;quot; and more compact version to the YAML flavour of CSN gives us&lt;a href=&quot;https://qmacro.org/blog/posts/2025/10/14/modelling-contained-in-relationships-with-compositions-in-cds/#footnotes&quot;&gt;&lt;sup&gt;2&lt;/sup&gt;&lt;/a&gt;:&lt;/p&gt;
&lt;pre class=&quot;language-yaml&quot; tabindex=&quot;0&quot;&gt;&lt;code class=&quot;language-yaml&quot;&gt;&lt;span class=&quot;token key atrule&quot;&gt;definitions&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
  &lt;span class=&quot;token key atrule&quot;&gt;S&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
    &lt;span class=&quot;token key atrule&quot;&gt;kind&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; service
  &lt;span class=&quot;token key atrule&quot;&gt;S.Orders&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
    &lt;span class=&quot;token key atrule&quot;&gt;kind&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; entity
    &lt;span class=&quot;token key atrule&quot;&gt;elements&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
      &lt;span class=&quot;token key atrule&quot;&gt;ID&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
        &lt;span class=&quot;token key atrule&quot;&gt;key&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token boolean important&quot;&gt;true&lt;/span&gt;
        &lt;span class=&quot;token key atrule&quot;&gt;type&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; cds.Integer
      &lt;span class=&quot;token key atrule&quot;&gt;Items&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
        &lt;span class=&quot;token key atrule&quot;&gt;type&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; cds.Composition
        &lt;span class=&quot;token key atrule&quot;&gt;cardinality&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
          &lt;span class=&quot;token key atrule&quot;&gt;max&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&#39;*&#39;&lt;/span&gt;
        &lt;span class=&quot;token key atrule&quot;&gt;targetAspect&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
          &lt;span class=&quot;token key atrule&quot;&gt;elements&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
            &lt;span class=&quot;token key atrule&quot;&gt;pos&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
              &lt;span class=&quot;token key atrule&quot;&gt;key&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token boolean important&quot;&gt;true&lt;/span&gt;
              &lt;span class=&quot;token key atrule&quot;&gt;type&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; cds.Integer
            &lt;span class=&quot;token key atrule&quot;&gt;qty&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
              &lt;span class=&quot;token key atrule&quot;&gt;type&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; cds.Integer
        &lt;span class=&quot;token key atrule&quot;&gt;target&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; S.Orders.Items
        &lt;span class=&quot;token key atrule&quot;&gt;&#39;on&#39;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
          &lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;token key atrule&quot;&gt;ref&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
              &lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt; Items
              &lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt; up_
          &lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&#39;=&#39;&lt;/span&gt;
          &lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;token key atrule&quot;&gt;ref&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
              &lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt; $self
  &lt;span class=&quot;token key atrule&quot;&gt;S.Orders.Items&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
    &lt;span class=&quot;token key atrule&quot;&gt;kind&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; entity
    &lt;span class=&quot;token key atrule&quot;&gt;elements&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
      &lt;span class=&quot;token key atrule&quot;&gt;up_&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
        &lt;span class=&quot;token key atrule&quot;&gt;key&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token boolean important&quot;&gt;true&lt;/span&gt;
        &lt;span class=&quot;token key atrule&quot;&gt;type&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; cds.Association
        &lt;span class=&quot;token key atrule&quot;&gt;cardinality&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
          &lt;span class=&quot;token key atrule&quot;&gt;min&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt;
          &lt;span class=&quot;token key atrule&quot;&gt;max&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt;
        &lt;span class=&quot;token key atrule&quot;&gt;target&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; S.Orders
        &lt;span class=&quot;token key atrule&quot;&gt;keys&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
          &lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;token key atrule&quot;&gt;ref&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
              &lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt; ID
        &lt;span class=&quot;token key atrule&quot;&gt;notNull&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token boolean important&quot;&gt;true&lt;/span&gt;
      &lt;span class=&quot;token key atrule&quot;&gt;pos&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
        &lt;span class=&quot;token key atrule&quot;&gt;key&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token boolean important&quot;&gt;true&lt;/span&gt;
        &lt;span class=&quot;token key atrule&quot;&gt;type&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; cds.Integer
      &lt;span class=&quot;token key atrule&quot;&gt;qty&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
        &lt;span class=&quot;token key atrule&quot;&gt;type&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; cds.Integer&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;There are some technical differences, which are worth pointing out (there&#39;s always an opportunity to learn):&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;there&#39;s still a composition &lt;code&gt;target&lt;/code&gt; pointing to an entity definition, but here that is &lt;code&gt;S.Orders.Items&lt;/code&gt;, a definition that&#39;s been created on the fly to help satisfy the composition requirements&lt;/li&gt;
&lt;li&gt;this &lt;code&gt;S.Orders.Items&lt;/code&gt; entity has a key element &lt;code&gt;up_&lt;/code&gt; that points back to the parent&lt;/li&gt;
&lt;li&gt;there&#39;s additional info at the &lt;code&gt;Items&lt;/code&gt; element in the parent that captures the original anonymous aspect definition (in &lt;code&gt;targetAspect&lt;/code&gt;)&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;From a naming convention perspective, the name of the generated target entity is created using the parent entity as a prefix (&lt;code&gt;S.Orders&lt;/code&gt;) to the composition element&#39;s name (&lt;code&gt;Items&lt;/code&gt;), forming a &lt;a href=&quot;https://cap.cloud.sap/docs/cds/cdl#scoped-names&quot;&gt;scoped&lt;/a&gt; name &lt;code&gt;S.Orders.Items&lt;/code&gt;. And I would wager that it&#39;s unlikely that we as humans would use an underscore-suffixed name for an element, so &lt;code&gt;up_&lt;/code&gt; is a good choice for the automatically generated pointer-to-parent element name.&lt;/p&gt;
&lt;h2 id=&quot;hybrid&quot;&gt;Hybrid&lt;/h2&gt;
&lt;p&gt;There is a middle ground, where named, rather than anonymous aspects can be used. You can read more about this in the &lt;a href=&quot;https://cap.cloud.sap/docs/cds/cdl#with-named-targets&quot;&gt;named targets&lt;/a&gt; section of the Domain Modelling topic of Capire.&lt;/p&gt;
&lt;h2 id=&quot;wrapping-up&quot;&gt;Wrapping up&lt;/h2&gt;
&lt;p&gt;The CDS modelling language (and CDL specifically) is for humans. CSN is for machines. The distinction is not always top of mind, but if we try to keep it there, we&#39;ll end up with cleaner, simpler model definitions that are easier to reason about, easier to extend and reuse, and easier to maintain.&lt;/p&gt;
&lt;h2 id=&quot;footnotes&quot;&gt;Footnotes&lt;/h2&gt;
&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;I piped the resulting YAML through &lt;code&gt;yq -y .&lt;/code&gt; to pretty-print it, as I find the long(er) lines of the raw YAML output a little tough to digest.&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;I removed the metadata from the compiled YAML output:&lt;/p&gt;
&lt;pre class=&quot;language-yaml&quot; tabindex=&quot;0&quot;&gt;&lt;code class=&quot;language-yaml&quot;&gt;&lt;span class=&quot;token key atrule&quot;&gt;meta&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
  &lt;span class=&quot;token key atrule&quot;&gt;creator&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; CDS Compiler v6.4.2
  &lt;span class=&quot;token key atrule&quot;&gt;flavor&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; inferred
&lt;span class=&quot;token key atrule&quot;&gt;$version&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;2&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;just to keep things a little more compact.&lt;/p&gt;
&lt;/li&gt;
&lt;/ol&gt;
</content>
  </entry>
  <entry>
    <title>Using @capire modules from GitHub Packages</title>
    <link href="https://qmacro.org/blog/posts/2025/10/12/using-capire-modules-from-github-packages/" />
    <updated>2025-10-12T00:00:00Z</updated>
    <id>https://qmacro.org/blog/posts/2025/10/12/using-capire-modules-from-github-packages/</id>
    <content type="html">&lt;h2 id=&quot;background&quot;&gt;Background&lt;/h2&gt;
&lt;p&gt;&lt;a href=&quot;https://cap.cloud.sap/docs/releases/aug25&quot;&gt;Recently&lt;/a&gt; the home for Capire documentation and sample repositories moved into the &lt;a href=&quot;https://github.com/capire&quot;&gt;capire&lt;/a&gt; organisation on GitHub. This content includes classic modules such as &lt;a href=&quot;https://github.com/capire/bookshop&quot;&gt;bookshop&lt;/a&gt; which are now maintained as individual repositories, are subject to release schedules and deployments, and are made available as &lt;a href=&quot;https://github.com/orgs/capire/packages&quot;&gt;packages&lt;/a&gt; that are available in the NPM registry which is part of &lt;a href=&quot;https://docs.github.com/en/packages/learn-github-packages/introduction-to-github-packages&quot;&gt;GitHub Packages&lt;/a&gt;.&lt;/p&gt;
&lt;p&gt;Retrieving (e.g. via &lt;code&gt;npm install&lt;/code&gt; or &lt;code&gt;npm add&lt;/code&gt;) a package such as &lt;code&gt;@sap/cds-dk&lt;/code&gt; is straightforward as such packages &lt;a href=&quot;https://www.npmjs.com/package/@sap/cds-dk&quot;&gt;are available&lt;/a&gt; in the default NPM registry at &lt;a href=&quot;https://registry.npmjs.org&quot;&gt;https://registry.npmjs.org&lt;/a&gt; (with a human centric UI at &lt;a href=&quot;https://npmjs.com&quot;&gt;https://npmjs.com&lt;/a&gt;).&lt;/p&gt;
&lt;h2 id=&quot;namespace-registry-mapping-required&quot;&gt;Namespace registry mapping required&lt;/h2&gt;
&lt;p&gt;Retrieving packages from any other registry (such as package &lt;code&gt;@capire/bookshop&lt;/code&gt; in the NPM registry that is part of GitHub Packages) requires a mapping, typically by package namespace.&lt;/p&gt;
&lt;p&gt;This is done by configuration in an &lt;code&gt;.npmrc&lt;/code&gt; file in your home directory. The mapping here (for the &lt;code&gt;@capire&lt;/code&gt; namespaced packages) needs to look like this in that file:&lt;/p&gt;
&lt;pre class=&quot;language-text&quot; tabindex=&quot;0&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;@capire:registry=https://npm.pkg.github.com&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;Without this mapping, here&#39;s what happens:&lt;/p&gt;
&lt;pre class=&quot;language-log&quot; tabindex=&quot;0&quot;&gt;&lt;code class=&quot;language-log&quot;&gt;&lt;span class=&quot;token operator&quot;&gt;;&lt;/span&gt; npm add &lt;span class=&quot;token operator&quot;&gt;@&lt;/span&gt;capire&lt;span class=&quot;token operator&quot;&gt;/&lt;/span&gt;bookshop&lt;span class=&quot;token operator&quot;&gt;@&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;2.0.4&lt;/span&gt;
npm error code E404
npm error &lt;span class=&quot;token number&quot;&gt;404&lt;/span&gt; Not Found &lt;span class=&quot;token operator&quot;&gt;-&lt;/span&gt; GET &lt;span class=&quot;token url&quot;&gt;https://registry.npmjs.org/@capire%2fbookshop&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;-&lt;/span&gt; Not found
npm error &lt;span class=&quot;token number&quot;&gt;404&lt;/span&gt;
npm error &lt;span class=&quot;token number&quot;&gt;404&lt;/span&gt;  &lt;span class=&quot;token string&quot;&gt;&#39;@capire/bookshop@2.0.4&#39;&lt;/span&gt; is not in this registry&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;
npm error &lt;span class=&quot;token number&quot;&gt;404&lt;/span&gt;
npm error &lt;span class=&quot;token number&quot;&gt;404&lt;/span&gt; Note that you can also install from a
npm error &lt;span class=&quot;token number&quot;&gt;404&lt;/span&gt; tarball&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; folder&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; http url&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; or git url&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;With the mapping above in the &lt;code&gt;.npmrc&lt;/code&gt; file, here&#39;s what happens:&lt;/p&gt;
&lt;pre class=&quot;language-log&quot; tabindex=&quot;0&quot;&gt;&lt;code class=&quot;language-log&quot;&gt;&lt;span class=&quot;token operator&quot;&gt;;&lt;/span&gt; npm add &lt;span class=&quot;token operator&quot;&gt;@&lt;/span&gt;capire&lt;span class=&quot;token operator&quot;&gt;/&lt;/span&gt;bookshop&lt;span class=&quot;token operator&quot;&gt;@&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;2.0.4&lt;/span&gt;
npm error code E401
npm error &lt;span class=&quot;token number&quot;&gt;401&lt;/span&gt; Unauthorized
  &lt;span class=&quot;token operator&quot;&gt;-&lt;/span&gt; GET &lt;span class=&quot;token url&quot;&gt;https://npm.pkg.github.com/@capire%2fbookshop&lt;/span&gt;
  &lt;span class=&quot;token operator&quot;&gt;-&lt;/span&gt; authentication token not provided&lt;/code&gt;&lt;/pre&gt;
&lt;h2 id=&quot;authentication-information-required&quot;&gt;Authentication information required&lt;/h2&gt;
&lt;p&gt;In order to &lt;a href=&quot;https://docs.github.com/en/packages/working-with-a-github-packages-registry/working-with-the-npm-registry&quot;&gt;work with GitHub Packages&#39; NPM registry&lt;/a&gt; ...&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;&amp;quot;... you need an access token to publish, install, and delete private, internal, and public packages.&amp;quot;&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;Yes, even for read operations such as &lt;code&gt;install&lt;/code&gt; and &lt;code&gt;add&lt;/code&gt;.&lt;/p&gt;
&lt;p&gt;The &lt;a href=&quot;https://docs.github.com/en/packages/working-with-a-github-packages-registry/working-with-the-npm-registry#authenticating-with-a-personal-access-token&quot;&gt;Authenticating with a personal access token&lt;/a&gt; describes the procedure, which basically has two steps.&lt;/p&gt;
&lt;h3 id=&quot;generate-a-token&quot;&gt;Generate a token&lt;/h3&gt;
&lt;p&gt;In the &lt;a href=&quot;https://github.com/settings/tokens&quot;&gt;Tokens (classic) section of your GitHub developer settings&lt;/a&gt;, generate a new &amp;quot;Personal Access Token (classic)&amp;quot; like this, selecting the &lt;code&gt;read:packages&lt;/code&gt; scope:&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;https://qmacro.org/images/2025/10/personal-access-token-classic-read-packages.png&quot; alt=&quot;generating a personal access token (classic) with read:packages scope&quot;&gt;&lt;/p&gt;
&lt;h3 id=&quot;associate-the-token-with-the-registry&quot;&gt;Associate the token with the registry&lt;/h3&gt;
&lt;p&gt;This token now needs to be associated with the registry, by adding another line to the &lt;code&gt;.npmrc&lt;/code&gt; file that looks like this:&lt;/p&gt;
&lt;pre class=&quot;language-text&quot; tabindex=&quot;0&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;//npm.pkg.github.com/:_authToken=THE-TOKEN-JUST-GENERATED&lt;/code&gt;&lt;/pre&gt;
&lt;h2 id=&quot;installing-a-package&quot;&gt;Installing a package&lt;/h2&gt;
&lt;p&gt;Once this is done, &lt;code&gt;npm install&lt;/code&gt; or &lt;code&gt;npm add&lt;/code&gt; will complete successfully:&lt;/p&gt;
&lt;pre class=&quot;language-shell&quot; tabindex=&quot;0&quot;&gt;&lt;code class=&quot;language-shell&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;npm&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;add&lt;/span&gt; @capire/bookshop@2.0.4

added &lt;span class=&quot;token number&quot;&gt;115&lt;/span&gt; packages, and audited &lt;span class=&quot;token number&quot;&gt;116&lt;/span&gt; packages &lt;span class=&quot;token keyword&quot;&gt;in&lt;/span&gt; 6s

&lt;span class=&quot;token number&quot;&gt;23&lt;/span&gt; packages are looking &lt;span class=&quot;token keyword&quot;&gt;for&lt;/span&gt; funding
  run &lt;span class=&quot;token variable&quot;&gt;&lt;span class=&quot;token variable&quot;&gt;`&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;npm&lt;/span&gt; fund&lt;span class=&quot;token variable&quot;&gt;`&lt;/span&gt;&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;for&lt;/span&gt; details

found &lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt; vulnerabilities&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;The package appears in the appropriate dependencies section of &lt;code&gt;package.json&lt;/code&gt; as usual:&lt;/p&gt;
&lt;pre class=&quot;language-json&quot; tabindex=&quot;0&quot;&gt;&lt;code class=&quot;language-json&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
  &lt;span class=&quot;token property&quot;&gt;&quot;name&quot;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;test&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
  &lt;span class=&quot;token property&quot;&gt;&quot;dependencies&quot;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;token property&quot;&gt;&quot;@capire/bookshop&quot;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;^2.0.4&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
    &lt;span class=&quot;token property&quot;&gt;&quot;@sap/cds&quot;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;^9&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
    &lt;span class=&quot;token property&quot;&gt;&quot;express&quot;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;^4&quot;&lt;/span&gt;
  &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
  &lt;span class=&quot;token property&quot;&gt;&quot;devDependencies&quot;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;token property&quot;&gt;&quot;@cap-js/sqlite&quot;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;^2&quot;&lt;/span&gt;
  &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
  &lt;span class=&quot;token property&quot;&gt;&quot;scripts&quot;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;token property&quot;&gt;&quot;start&quot;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;cds-serve&quot;&lt;/span&gt;
  &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;Success!&lt;/p&gt;
</content>
  </entry>
  <entry>
    <title>CDS source formatting and readability</title>
    <link href="https://qmacro.org/blog/posts/2025/09/16/cds-source-formatting-and-readability/" />
    <updated>2025-09-16T00:00:00Z</updated>
    <id>https://qmacro.org/blog/posts/2025/09/16/cds-source-formatting-and-readability/</id>
    <content type="html">&lt;h2 id=&quot;background&quot;&gt;Background&lt;/h2&gt;
&lt;p&gt;I still remember my son Joseph showing me, years ago now, the power of &lt;a href=&quot;https://pkg.go.dev/cmd/gofmt&quot;&gt;gofmt&lt;/a&gt;, a tool that automatically formats Go source code. The blog post &lt;a href=&quot;https://go.dev/blog/gofmt&quot;&gt;go fmt your code&lt;/a&gt; introduces the tool, and more importantly the philosophy of embracing such a tool, with these points that I will reproduce here. Code automatically formatted is:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;em&gt;easier to read&lt;/em&gt;: when all code looks the same you need not mentally convert others&#39; formatting style into something you can understand&lt;/li&gt;
&lt;li&gt;&lt;em&gt;easier to write&lt;/em&gt;: never worry about minor formatting concerns while hacking away&lt;/li&gt;
&lt;li&gt;&lt;em&gt;easier to maintain&lt;/em&gt;: mechanical changes to the source don&#39;t cause unrelated changes to the file&#39;s formatting; diffs show only the real changes&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;It&#39;s also makes for a less controversial experience generally as you&#39;re not going to be arguing over how to use whitespace or other syntactic symbols.&lt;/p&gt;
&lt;h2 id=&quot;the-importance-of-domain-modelling-and-the-language-used&quot;&gt;The importance of domain modelling and the language used&lt;/h2&gt;
&lt;p&gt;In &lt;a href=&quot;https://qmacro.org/blog/posts/2024/11/07/five-reasons-to-use-cap/&quot;&gt;Five reasons to use CAP&lt;/a&gt; I talk about &lt;a href=&quot;https://qmacro.org/blog/posts/2024/11/07/five-reasons-to-use-cap/#2-domain-modelling-is-a-first-class-citizen&quot;&gt;domain modelling being a first class citizen&lt;/a&gt;; it&#39;s a critical part of the design and of the process, and the CDS model, described in the declarative and high level &lt;a href=&quot;https://cap.cloud.sap/docs/cds/cdl&quot;&gt;Conceptual Definition Language&lt;/a&gt; (CDL)&lt;a href=&quot;https://qmacro.org/blog/posts/2025/09/16/cds-source-formatting-and-readability/#footnotes&quot;&gt;&lt;sup&gt;1&lt;/sup&gt;&lt;/a&gt; is central to that, being a language that both domain expert and programmer alike use to meet and describe models and behaviours.&lt;/p&gt;
&lt;p&gt;Reading and writing CDS models is therefore an important skill for us all to cultivate. Having a consistent format, a sort of &amp;quot;forma franca&amp;quot;, can only help with that.&lt;/p&gt;
&lt;h2 id=&quot;cap-tools-for-formatting-cds-model-sources&quot;&gt;CAP tools for formatting CDS model sources&lt;/h2&gt;
&lt;p&gt;The &lt;a href=&quot;https://cap.cloud.sap/docs/tools/cds-editors&quot;&gt;CDS Editors and IDEs&lt;/a&gt; topic in Capire gives us a nice overview of the key tools available for CAP developers.&lt;/p&gt;
&lt;p&gt;These tools include facilities for formatting CDS sources, which you may have already come across when using the &lt;a href=&quot;https://marketplace.visualstudio.com/items?itemName=SAPSE.vscode-cds&quot;&gt;CDS Language Support&lt;/a&gt; extension for VS Code:&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;https://qmacro.org/images/2025/09/vs-code-cds-format.gif&quot; alt=&quot;animated demonstration of formatting CDS sources in VS Code&quot;&gt;&lt;/p&gt;
&lt;p&gt;The CAP team did a superb job of making such facilities available, in the form of language server, so I can also &lt;a href=&quot;https://github.com/qmacro/dotfiles/blob/2620e2d0995c8b3529d2dc4768e4d4cac0db94b2/config/nvim/lsp/cds.lua&quot;&gt;use it&lt;/a&gt; in my editor of choice, Neovim (automatically &lt;a href=&quot;https://github.com/qmacro/dotfiles/blob/2620e2d0995c8b3529d2dc4768e4d4cac0db94b2/config/nvim/init.lua#L14-L23&quot;&gt;formatting on save&lt;/a&gt;):&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;https://qmacro.org/images/2025/09/neovim-cds-format.gif&quot; alt=&quot;animated demonstration of formatting CDS sources in Neovim&quot;&gt;&lt;/p&gt;
&lt;p&gt;There&#39;s also a standalone CLI tool &lt;code&gt;format-cds&lt;/code&gt; which is described in the &lt;a href=&quot;https://cap.cloud.sap/docs/tools/cds-editors#cds-formatter&quot;&gt;CDS Source Formatter&lt;/a&gt; section of Capire&#39;s CDS Editors and IDEs topic, where you can find out what the different formatting options are and how to set them. Here&#39;s a demonstration of &lt;code&gt;format-cds&lt;/code&gt; in action, on the same &lt;code&gt;srv/cat-service.cds&lt;/code&gt; sample source file:&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;https://qmacro.org/images/2025/09/format-cds-example.gif&quot; alt=&quot;animated demonstration of formatting CDS sources with the format-cds command&quot;&gt;&lt;/p&gt;
&lt;p&gt;While there are plenty of options to express your formatting preferences, I like the idea of the &amp;quot;standard format&amp;quot;, as championed by the official CDS formatter&#39;s defaults.&lt;/p&gt;
&lt;h2 id=&quot;formatting-of-sample-cds-sources&quot;&gt;Formatting of sample CDS sources&lt;/h2&gt;
&lt;p&gt;With the advent of CAP&#39;s &lt;a href=&quot;https://cap.cloud.sap/docs/releases/aug25&quot;&gt;August 2025 release&lt;/a&gt; (at 9.3.0+ for the Node.js runtime) I&#39;m very happy to see the alignment of the CDS model sources in both the &lt;code&gt;sample&lt;/code&gt; and &lt;code&gt;tiny-sample&lt;/code&gt; facets with this standard format.&lt;/p&gt;
&lt;p&gt;The examples above used one of these source files, specifically &lt;code&gt;srv/cat-service.cds&lt;/code&gt; from the &lt;code&gt;sample&lt;/code&gt; facet, and each of the animations shows the before (pre August 2025 release) and after (August 2025 release and onwards) format - and as you we can see, the formatting of those sources today are aligned with the standard format.&lt;/p&gt;
&lt;p&gt;This means that when starting from the samples, we are:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;being exposed to the &amp;quot;standard format&amp;quot;&lt;/li&gt;
&lt;li&gt;starting in a good place from where we can continue&lt;/li&gt;
&lt;li&gt;seeing more clearly the structure of CDS and the language&#39;s artifacts&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;I for one welcome the change&lt;a href=&quot;https://qmacro.org/blog/posts/2025/09/16/cds-source-formatting-and-readability/#footnotes&quot;&gt;&lt;sup&gt;2&lt;/sup&gt;&lt;/a&gt; and hope that this can trigger a deeper interest in and love for the CDS language in general, and a focus on how best to express it in particular. If nothing else, it will get us talking!&lt;/p&gt;
&lt;h2 id=&quot;footnotes&quot;&gt;Footnotes&lt;/h2&gt;
&lt;ol&gt;
&lt;li&gt;While technically &amp;quot;CDL&amp;quot; is more accurate when referring to the language of domain modelling, I will use &amp;quot;CDS&amp;quot; here, as a form of (reverse) &lt;a href=&quot;https://en.wikipedia.org/wiki/Synecdoche&quot;&gt;synechdoche&lt;/a&gt;.&lt;/li&gt;
&lt;li&gt;OK, I admit, it was me that requested this, and the team very kindly agreed, thanks folks!&lt;/li&gt;
&lt;/ol&gt;
</content>
  </entry>
  <entry>
    <title>Upcoming talks in autumn 2025</title>
    <link href="https://qmacro.org/blog/posts/2025/09/10/upcoming-talks-in-autumn-2025/" />
    <updated>2025-09-10T00:00:00Z</updated>
    <id>https://qmacro.org/blog/posts/2025/09/10/upcoming-talks-in-autumn-2025/</id>
    <content type="html">&lt;p&gt;I&#39;m delivering and / or involved in various in-person talks and workshops over the next few months, here&#39;s a quick breakdown.&lt;/p&gt;
&lt;h3 id=&quot;26-sep-foundations-of-ai-applications-with-the-sap-hana-cloud&quot;&gt;26 Sep: Foundations of AI applications with the SAP HANA Cloud&lt;/h3&gt;
&lt;p&gt;This is an SAP CodeJam &lt;a href=&quot;https://community.sap.com/t5/sap-codejam/foundations-of-ai-applications-with-the-sap-hana-cloud-porto-pt/ev-p/14153367&quot;&gt;on Fri 26 Sep in Porto, PT&lt;/a&gt;, led by my lovely colleague Witalij Rudnicki and assisted by me.&lt;/p&gt;
&lt;h3 id=&quot;27-sep-level-up-your-cap-skills-by-learning-how-to-use-the-cds-repl&quot;&gt;27 Sep: Level up your CAP skills by learning how to use the cds REPL&lt;/h3&gt;
&lt;p&gt;This is a talk I&#39;m giving on Sat 27 Sep at &lt;a href=&quot;https://sitporto.com&quot;&gt;SAP Inside Track Porto&lt;/a&gt;, PT, following the AI and SAP HANA Cloud CodeJam the day before.&lt;/p&gt;
&lt;p&gt;Abstract: The cds repl (REPL stands for Read Evaluate Print Loop) is an extremely powerful and versatile tool for every CAP Node.js developer. In this session, you&#39;ll become acquainted with it, get a feel for what it&#39;s like, how to wield its powers, and more. No experience required, this will be a live session with no slides.&lt;/p&gt;
&lt;h3 id=&quot;08-oct-sap-fiori-elements-flexible-programming-model&quot;&gt;08 Oct: SAP Fiori elements flexible programming model&lt;/h3&gt;
&lt;p&gt;This is an SAP CodeJam &lt;a href=&quot;https://community.sap.com/t5/sap-codejam/sap-fiori-elements-flexible-programming-model-birmingham-uk/ev-p/14210332&quot;&gt;on Wed 08 Oct in Birmingham, UK&lt;/a&gt;, led by my lovely colleague Nico Schoenteich and assisted by me.&lt;/p&gt;
&lt;h3 id=&quot;10-oct-service-integration-with-sap-cloud-application-programming-model&quot;&gt;10 Oct: Service integration with SAP Cloud Application Programming Model&lt;/h3&gt;
&lt;p&gt;This is an SAP CodeJam &lt;a href=&quot;https://community.sap.com/t5/sap-codejam/service-integration-with-the-sap-cloud-application-programming-model-munich/ec-p/14212922&quot;&gt;on Fri 10 Oct in Munich, DE&lt;/a&gt;, led by me.&lt;/p&gt;
&lt;h3 id=&quot;11-oct-cap-node-js-features-for-local-development&quot;&gt;11 Oct: CAP Node.js features for local development&lt;/h3&gt;
&lt;p&gt;This is a talk on Sat 11 Oct at &lt;a href=&quot;https://community.sap.com/t5/m%C3%BCnchen-blog-posts/sap-inside-track-munich-2025-call-for-speakers-sitmuc25/ba-p/14161947&quot;&gt;SAP Inside Track Munich&lt;/a&gt; DE, following the CAP CodeJam the day before.&lt;/p&gt;
&lt;p&gt;Abstract: There are some great facilities in CAP Node.js for local development, which means rapid iterations and the ability to think local-first without losing sight of the productive context in the cloud. In this session I&#39;ll demonstrate some of these facilities which will make you a valuable asset to any project. No slides, just working live in the terminal and editor.&lt;/p&gt;
&lt;h3 id=&quot;05-nov-draft-day-for-developers-turning-new-technology-into-real-world-wins&quot;&gt;05 Nov: Draft day for developers: Turning new technology into real-world wins&lt;/h3&gt;
&lt;p&gt;I&#39;ll &lt;a href=&quot;https://www.sap.com/events/teched/berlin/flow/sap/te25/speaker-catalog-inperson/page/dj-adams&quot;&gt;be at SAP TechEd&lt;/a&gt;, and I&#39;m honoured to play a part in session &lt;a href=&quot;https://www.sap.com/events/teched/berlin/flow/sap/te25/catalog-inperson/page/catalog/session/1755789361320001c3gG&quot;&gt;KEY101 | Draft day for developers: Turning new technology into real-world wins&lt;/a&gt;, the Developer Keynote on Wed 05 Nov at SAP TechEd in Berlin this year.&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;https://qmacro.org/images/2025/09/teched-speaker.png&quot; alt=&quot;TechEd speaker profile&quot;&gt;&lt;/p&gt;
&lt;p&gt;Abstract: The picks are in, and developers, their tools, and frameworks are first-round talent. Get a front-row seat to SAP&#39;s latest innovations built to accelerate how you code, automate, and scale. Explore how you can use SAP&#39;s newest AI capabilities, generative agents, and enhanced tooling to build faster and smarter with less friction and more impact.&lt;/p&gt;
&lt;h3 id=&quot;05-nov-trivia-competition&quot;&gt;05 Nov: Trivia competition&lt;/h3&gt;
&lt;p&gt;I&#39;ll be running a live trivia competition (&lt;a href=&quot;https://www.sap.com/events/teched/berlin/flow/sap/te25/catalog-inperson/page/catalog/session/1756936085495001SaY9&quot;&gt;CT1288&lt;/a&gt;) on Wed 05 Nov in the Community Theatre.&lt;/p&gt;
&lt;h3 id=&quot;05-nov-learning-by-doing-in-the-cds-repl&quot;&gt;05 Nov: Learning by doing in the cds REPL&lt;/h3&gt;
&lt;p&gt;This is a talk (&lt;a href=&quot;https://www.sap.com/events/teched/berlin/flow/sap/te25/catalog-inperson/page/catalog/session/1756936609129001McHZ&quot;&gt;CT1291&lt;/a&gt;) that I&#39;m giving in the Community Theatre on Wed 05 Nov.&lt;/p&gt;
&lt;p&gt;Abstract: Work through a simple SAP Cloud Application Programming Model (CAP) project, live with your peers, in the cds REPL. Explore as you go and collectively ask each other questions, such as &amp;quot;What will happen if?&amp;quot; &amp;quot;What do you think this will evaluate to?&amp;quot; and &amp;quot;Why does this happen?&amp;quot;&lt;/p&gt;
&lt;h3 id=&quot;30-nov-hands-on-with-the-domain-modelling-language-that-powers-ecc-s-4hana-and-beyond-caps-cds&quot;&gt;30 Nov: Hands-on with the domain modelling language that powers ECC, S/4HANA and beyond - CAP&#39;s CDS&lt;/h3&gt;
&lt;p&gt;This is a hands-on workshop I&#39;m running on the first day of &lt;a href=&quot;https://www.sap.com/uk/events/2025-11-30-uk-pe-ukisug-connect.html&quot;&gt;UKISUG Connect 2025&lt;/a&gt;.&lt;/p&gt;
&lt;p&gt;Abstract: Become acquainted with CAP&#39;s CDS, the common language that binds domain experts, with their key business &amp;amp; process knowledge, to developers. A hands-on-optional session where we&#39;ll explore the language &amp;amp; concepts together and get comfortable with it. (More info is available on the &lt;a href=&quot;https://virtual.oxfordabstracts.com/event/75555/submission/101&quot;&gt;session detail page&lt;/a&gt;).&lt;/p&gt;
&lt;h3 id=&quot;01-dec-local-first-a-more-efficient-development-strategy-for-extending-with-the-sap-cloud-application-programming-model&quot;&gt;01 Dec: Local-first: A more efficient development strategy for extending with the SAP Cloud Application Programming Model&lt;/h3&gt;
&lt;p&gt;This is a talk in the Technical stream at &lt;a href=&quot;https://www.sap.com/uk/events/2025-11-30-uk-pe-ukisug-connect.html&quot;&gt;UKISUG Connect 2025&lt;/a&gt;.&lt;/p&gt;
&lt;p&gt;Abstract: Today, more than ever, developer efficiency is critical. Join this session to learn of the local-first development affordances that CAP has to offer. No slides, just live coding and (hopefully) some fun! (More info is available on the &lt;a href=&quot;https://virtual.oxfordabstracts.com/event/75555/submission/127&quot;&gt;session detail page&lt;/a&gt;).&lt;/p&gt;
</content>
  </entry>
  <entry>
    <title>Auto formatting extensionless Bash scripts in Neovim</title>
    <link href="https://qmacro.org/blog/posts/2025/09/01/auto-formatting-extensionless-bash-scripts-in-neovim/" />
    <updated>2025-09-01T00:00:00Z</updated>
    <id>https://qmacro.org/blog/posts/2025/09/01/auto-formatting-extensionless-bash-scripts-in-neovim/</id>
    <content type="html">&lt;h2 id=&quot;tl-dr&quot;&gt;TL;DR&lt;/h2&gt;
&lt;p&gt;The Bash language server is easy to install and has support for &lt;code&gt;shfmt&lt;/code&gt; which in turn has support for Editorconfig settings.&lt;/p&gt;
&lt;p&gt;For shell scripts without extensions, Editorconfig is no good, except if you use &lt;code&gt;shfmt&lt;/code&gt;&#39;s special support in the form of &lt;code&gt;[[shell]]&lt;/code&gt; or &lt;code&gt;[[bash]]&lt;/code&gt; section globs.&lt;/p&gt;
&lt;p&gt;But that&#39;s non-standard, and when invoked via the Bash language server, doesn&#39;t work. However, you can get it to work by using a wrapper script that strips off options in the call to &lt;code&gt;shfmt&lt;/code&gt; with the result that these special Editorconfig sections are recognised.&lt;/p&gt;
&lt;h2 id=&quot;background&quot;&gt;Background&lt;/h2&gt;
&lt;p&gt;In my continuing quest to &lt;a href=&quot;https://qmacro.org/blog/posts/2025/06/10/a-modern-and-clean-neovim-setup-for-cap-node-js-configuration-and-diagnostics/&quot;&gt;build out a cleaner and leaner Neovim configuration&lt;/a&gt; I turned my attention recently to improving my Bash script editing experience. For Bash there are plenty of facilities that fit into my Personal Development Environment, including &lt;code&gt;shellcheck&lt;/code&gt; and &lt;code&gt;shfmt&lt;/code&gt;, both of which I have been using for quite a while (see &lt;a href=&quot;https://qmacro.org/blog/posts/2020/10/05/improving-my-shell-scripting/&quot;&gt;Improving my shell scripting&lt;/a&gt;).&lt;/p&gt;
&lt;p&gt;I decided to give the &lt;a href=&quot;https://github.com/bash-lsp/bash-language-server&quot;&gt;Bash language server&lt;/a&gt; a try. It&#39;s a super easy setup &lt;a href=&quot;https://github.com/bash-lsp/bash-language-server?tab=readme-ov-file#neovim&quot;&gt;for Neovim 0.11+&lt;/a&gt; and the &lt;a href=&quot;https://github.com/bash-lsp/bash-language-server?tab=readme-ov-file#shfmt-integration&quot;&gt;integration with shfmt&lt;/a&gt; was a feature that caught my eye in particular. See &lt;a href=&quot;https://qmacro.org/blog/posts/2025/09/01/auto-formatting-extensionless-bash-scripts-in-neovim/#appendix-c-neovim-lsp-configuration-for-the-bash-language-server&quot;&gt;Appendix C&lt;/a&gt; for the setup configuration details.&lt;/p&gt;
&lt;p&gt;Add to this a desire to also more consciously embrace &lt;a href=&quot;https://editorconfig.org/&quot;&gt;Editorconfig&lt;/a&gt;, especially given &lt;a href=&quot;https://github.com/mvdan/sh/blob/master/cmd/shfmt/shfmt.1.scd#description&quot;&gt;shfmt&#39;s support for that&lt;/a&gt;, and I was set for a great experience.&lt;/p&gt;
&lt;h2 id=&quot;the-perfect-storm&quot;&gt;The perfect storm&lt;/h2&gt;
&lt;p&gt;I am of the opinion that the names of shell scripts that are written to be executed on the command line should not have extensions. This follows a &lt;a href=&quot;https://google.github.io/styleguide/shellguide.html#s2.1-file-extensions&quot;&gt;specific guideline&lt;/a&gt; in the &lt;a href=&quot;https://google.github.io/styleguide/shellguide.html&quot;&gt;Google Shell Style Guide&lt;/a&gt;. Interpretation of shell script file[type]s is based on the &lt;a href=&quot;https://en.wikipedia.org/wiki/Shebang_(Unix)&quot;&gt;shebang&lt;/a&gt;.&lt;/p&gt;
&lt;p&gt;This approach, combined with the Bash language server, its support for &lt;code&gt;shfmt&lt;/code&gt;, and a custom part of &lt;code&gt;shfmt&lt;/code&gt;&#39;s support for Editorconfig, turned out to be a small but perfect storm:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Editorconfig&#39;s approach and configuration (&lt;a href=&quot;https://spec.editorconfig.org/&quot;&gt;specification&lt;/a&gt;) is based on file extensions only and there is no generic provision for specifying editor settings for files without extensions&lt;/li&gt;
&lt;li&gt;As the extensionless shell script is such a common phenomenon, support for Editorconfig within &lt;code&gt;shfmt&lt;/code&gt; has been extended to allow for special &lt;a href=&quot;https://spec.editorconfig.org/#glob-expressions&quot;&gt;section names&lt;/a&gt; in Editorconfig configuration files so that such shell scripts can be matched more generically; this support is described in the &lt;a href=&quot;https://github.com/mvdan/sh/blob/master/cmd/shfmt/shfmt.1.scd#examples&quot;&gt;Examples&lt;/a&gt; section in &lt;code&gt;shfmt&lt;/code&gt;&#39;s documentation thus:
&lt;blockquote&gt;
&lt;p&gt;&amp;quot;EditorConfig sections may also use &lt;code&gt;[[shell]]&lt;/code&gt; or &lt;code&gt;[[bash]]&lt;/code&gt; to match any shell or bash scripts, which is particularly useful when scripts use a shebang but no extension. Note that this feature is outside of the EditorConfig spec and may be changed in the future.&amp;quot;&lt;/p&gt;
&lt;/blockquote&gt;
&lt;/li&gt;
&lt;li&gt;While it&#39;s great to have &lt;a href=&quot;https://github.com/bash-lsp/bash-language-server?tab=readme-ov-file#shfmt-integration&quot;&gt;support for shfmt&lt;/a&gt; in the Bash language server, this support does not include this non-standard (but insanely useful) &lt;code&gt;[[bash]]&lt;/code&gt; style facility for Editorconfig configuration.&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;Consequently, when editing shell scripts with extensionless filenames using Neovim with the Bash language server configured and &lt;code&gt;shfmt&lt;/code&gt; installed&lt;a href=&quot;https://qmacro.org/blog/posts/2025/09/01/auto-formatting-extensionless-bash-scripts-in-neovim/#footnotes&quot;&gt;&lt;sup&gt;1&lt;/sup&gt;&lt;/a&gt;
I got a very odd and confusing experience.&lt;/p&gt;
&lt;p&gt;&lt;a name=&quot;example-of-the-issue&quot;&gt;&lt;/a&gt;&lt;/p&gt;
&lt;h2 id=&quot;example-of-the-issue&quot;&gt;Example of the issue&lt;/h2&gt;
&lt;p&gt;Here&#39;s an example, based on three test files called &lt;code&gt;a&lt;/code&gt;, &lt;code&gt;b&lt;/code&gt; and &lt;code&gt;fixup&lt;/code&gt;, and these (reduced) Editorconfig settings in my &lt;code&gt;.editorconfig&lt;/code&gt; file:&lt;/p&gt;
&lt;pre class=&quot;language-toml&quot; tabindex=&quot;0&quot;&gt;&lt;code class=&quot;language-toml&quot;&gt;&lt;span class=&quot;token key property&quot;&gt;root&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token boolean&quot;&gt;true&lt;/span&gt;

&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;*&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;
&lt;span class=&quot;token key property&quot;&gt;indent_style&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;=&lt;/span&gt; tab

&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;token table class-name&quot;&gt;bash&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;
&lt;span class=&quot;token key property&quot;&gt;indent_size&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;2&lt;/span&gt;
&lt;span class=&quot;token key property&quot;&gt;indent_style&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;=&lt;/span&gt; space
&lt;span class=&quot;token key property&quot;&gt;switch_case_indent&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token boolean&quot;&gt;true&lt;/span&gt;
&lt;span class=&quot;token key property&quot;&gt;binary_next_line&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token boolean&quot;&gt;true&lt;/span&gt;
&lt;span class=&quot;token key property&quot;&gt;space_redirects&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token boolean&quot;&gt;true&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;&lt;em&gt;On the command line&lt;/em&gt;, running &lt;code&gt;shfmt&lt;/code&gt;&lt;a href=&quot;https://qmacro.org/blog/posts/2025/09/01/auto-formatting-extensionless-bash-scripts-in-neovim/#footnotes&quot;&gt;&lt;sup&gt;2&lt;/sup&gt;&lt;/a&gt; on each of these three files produced the expected results, in that all were formatted according to the &lt;code&gt;shfmt&lt;/code&gt;-specific settings in that &lt;code&gt;[[bash]]&lt;/code&gt; section plus of course indented with 2 spaces.&lt;/p&gt;
&lt;p&gt;&lt;em&gt;Within Neovim&lt;/em&gt;, via the Bash language server&lt;a href=&quot;https://qmacro.org/blog/posts/2025/09/01/auto-formatting-extensionless-bash-scripts-in-neovim/#footnotes&quot;&gt;&lt;sup&gt;3&lt;/sup&gt;&lt;/a&gt;, with shell script files &lt;code&gt;a&lt;/code&gt; and &lt;code&gt;b&lt;/code&gt; everything seemed to work fine and my Bash scripts were indented appropriately with 2 spaces. When I then started to work on real shell scripts such as the one called &lt;code&gt;fixup&lt;/code&gt;, things didn&#39;t work the same, and the indentation was done with tabs, not spaces (the horror!).&lt;/p&gt;
&lt;p&gt;Yes, you guessed it, this was because in standard Editorconfig procedure, the &lt;code&gt;[bash]&lt;/code&gt; part of the &lt;code&gt;[[bash]]&lt;/code&gt; section heading is considered a sequence of characters &lt;code&gt;b&lt;/code&gt;, &lt;code&gt;a&lt;/code&gt;, &lt;code&gt;s&lt;/code&gt; and &lt;code&gt;h&lt;/code&gt;, matching files of those single-character names; and as &lt;code&gt;fixup&lt;/code&gt; was not matched with that sequence, that section (containing &lt;code&gt;indent_style = space&lt;/code&gt;) didn&#39;t apply, and so &lt;code&gt;indent_style = tab&lt;/code&gt; prevailed.&lt;/p&gt;
&lt;p&gt;This is unfortunate, but is not really anyone&#39;s fault.&lt;/p&gt;
&lt;h2 id=&quot;bash-language-server-shfmt-and-editorconfig&quot;&gt;Bash language server, shfmt and Editorconfig&lt;/h2&gt;
&lt;p&gt;I dug in to see what was happening in the Bash language server.&lt;/p&gt;
&lt;p&gt;In preparing to call &lt;code&gt;shfmt&lt;/code&gt;, properties appropriate for the file in question are determined from the Editorconfig configuration. The &lt;a href=&quot;https://www.npmjs.com/package/editorconfig&quot;&gt;editorconfig&lt;/a&gt; NPM package is used for this determination, and the custom &lt;code&gt;shfmt&lt;/code&gt; extension to allow for &lt;code&gt;[[bash]]&lt;/code&gt; and &lt;code&gt;[[shell]]&lt;/code&gt; does not exist in that package.&lt;/p&gt;
&lt;p&gt;There are generic configuration properties such as &lt;code&gt;indent_style&lt;/code&gt;, and &lt;code&gt;shfmt&lt;/code&gt;-specific ones such as &lt;code&gt;switch_case_indent&lt;/code&gt;. If there are any &lt;code&gt;shfmt&lt;/code&gt;-specific ones then the Editorconfig configuration is used. Otherwise, the language server configuration is used. This reflects the approach taken by &lt;code&gt;shfmt&lt;/code&gt; itself in using either Editorconfig or its own command line flags, but not both (as we&#39;ll see in the next section).&lt;/p&gt;
&lt;p&gt;The configuration is then turned into a series of explicit &lt;code&gt;shfmt&lt;/code&gt; command line options, in particular (but not exclusively) from the &lt;a href=&quot;https://github.com/mvdan/sh/blob/master/cmd/shfmt/shfmt.1.scd#printer-flags&quot;&gt;Printer flags&lt;/a&gt; group. For example, on surfacing a &lt;code&gt;binary_next_line = true&lt;/code&gt; setting in &lt;code&gt;.editorconfig&lt;/code&gt; it will generate an equivalent &lt;code&gt;-bn&lt;/code&gt; flag to pass in the call to &lt;code&gt;shfmt&lt;/code&gt;.&lt;/p&gt;
&lt;p&gt;Then the Bash language server invokes &lt;code&gt;shfmt&lt;/code&gt; passing these generated options, plus the &lt;code&gt;--filename&lt;/code&gt; option to specify the full pathname of the file being formatted.&lt;/p&gt;
&lt;h3 id=&quot;example-for-script-called-fixup&quot;&gt;Example for script called &#39;fixup&#39;&lt;/h3&gt;
&lt;p&gt;Here&#39;s an example of that for the script called &lt;code&gt;fixup&lt;/code&gt; for which the &lt;code&gt;editorconfig&lt;/code&gt; package does &lt;em&gt;not&lt;/em&gt; match the &lt;code&gt;[[bash]]&lt;/code&gt; section. This is what&#39;s invoked:&lt;/p&gt;
&lt;pre class=&quot;language-shell&quot; tabindex=&quot;0&quot;&gt;&lt;code class=&quot;language-shell&quot;&gt;shfmt &lt;span class=&quot;token parameter variable&quot;&gt;--filename&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;/home/dj/test/fixup &lt;span class=&quot;token parameter variable&quot;&gt;-i0&lt;/span&gt; &lt;span class=&quot;token parameter variable&quot;&gt;-ln&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;auto -&lt;/code&gt;&lt;/pre&gt;
&lt;ul&gt;
&lt;li&gt;the &lt;code&gt;-i0&lt;/code&gt; comes from a default driven by the basic details sent in the request from Neovim&#39;s LSP client, which includes &lt;code&gt;insertSpaces = false&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;the &lt;code&gt;-ln=auto&lt;/code&gt; comes from &lt;a href=&quot;https://github.com/bash-lsp/bash-language-server/blob/main/server/src/config.ts&quot;&gt;a default in the Bash language server itself&lt;/a&gt; for &lt;code&gt;languageDialect&lt;/code&gt; (see also &lt;a href=&quot;https://qmacro.org/blog/posts/2025/09/01/auto-formatting-extensionless-bash-scripts-in-neovim/#appendix-a-mason-info-for-bash-language-server&quot;&gt;Appendix A&lt;/a&gt;)&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id=&quot;example-for-script-called-a&quot;&gt;Example for script called &#39;a&#39;&lt;/h3&gt;
&lt;p&gt;Here&#39;s another example of what the Bash language server ultimately invokes for the script called &lt;code&gt;a&lt;/code&gt; which (by chance) &lt;em&gt;was&lt;/em&gt; matched by the &lt;code&gt;[[bash]]&lt;/code&gt; section:&lt;/p&gt;
&lt;pre class=&quot;language-shell&quot; tabindex=&quot;0&quot;&gt;&lt;code class=&quot;language-shell&quot;&gt;shfmt &lt;span class=&quot;token parameter variable&quot;&gt;--filename&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;/home/dj/test/a &lt;span class=&quot;token parameter variable&quot;&gt;-i&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;2&lt;/span&gt; &lt;span class=&quot;token parameter variable&quot;&gt;-bn&lt;/span&gt; &lt;span class=&quot;token parameter variable&quot;&gt;-ci&lt;/span&gt; &lt;span class=&quot;token parameter variable&quot;&gt;-sr&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;
&lt;ul&gt;
&lt;li&gt;these options come from the &lt;code&gt;indent_size&lt;/code&gt;, &lt;code&gt;binary_next_line&lt;/code&gt;, &lt;code&gt;switch_case_indent&lt;/code&gt; and &lt;code&gt;space_redirects&lt;/code&gt; Editorconfig properties in the &lt;code&gt;[[bash]]&lt;/code&gt; section&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id=&quot;between-a-rock-and-a-hard-place&quot;&gt;Between a rock and a hard place&lt;/h2&gt;
&lt;p&gt;As mentioned in the previous section, the Bash language server&#39;s approach takes its cue from the &lt;a href=&quot;https://github.com/mvdan/sh/blob/master/cmd/shfmt/shfmt.1.scd#description&quot;&gt;equivalent approach&lt;/a&gt; of &lt;code&gt;shfmt&lt;/code&gt; itself:&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;&amp;quot;If any EditorConfig files are found, they will be used to apply formatting options. If any parser or printer flags are given to the tool, no EditorConfig formatting options will be used. A default like -i=0 can be used for this purpose.&amp;quot;&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;In other words, &lt;em&gt;either&lt;/em&gt; Editorconfig (only), or no Editorconfig.&lt;/p&gt;
&lt;p&gt;But to effect this, Bash language server invokes &lt;code&gt;shfmt&lt;/code&gt; with explicit options for &lt;em&gt;both&lt;/em&gt; cases (where there&#39;s a match, and where there isn&#39;t). This can be seen directly in the two example invocations above.&lt;/p&gt;
&lt;p&gt;I want to manage my formatting in my &lt;code&gt;.editorconfig&lt;/code&gt; file(s), but if I want the Editorconfig settings to be honoured when formatting my shell scripts, I need to give them names that I can match with the Editorconfig section name globs, for example by giving them extensions. I don&#39;t want to do that.&lt;/p&gt;
&lt;p&gt;I want the Bash language server to invoke &lt;code&gt;shfmt&lt;/code&gt; without any &lt;a href=&quot;https://github.com/mvdan/sh/blob/master/cmd/shfmt/shfmt.1.scd#parser-flags&quot;&gt;parser&lt;/a&gt; or &lt;a href=&quot;https://github.com/mvdan/sh/blob/master/cmd/shfmt/shfmt.1.scd#printer-flags&quot;&gt;printer&lt;/a&gt; options so that &lt;code&gt;shfmt&lt;/code&gt; itself, with its special &lt;code&gt;[[bash]]&lt;/code&gt; processing ability (rather than the Bash language server with the standard &lt;code&gt;editorconfig&lt;/code&gt; package) parses the Editorconfig settings. This would effectively bypass any Bash language server logic for &lt;code&gt;shfmt&lt;/code&gt; and just let &lt;code&gt;shfmt&lt;/code&gt; do its thing, with (or without) an &lt;code&gt;.editorconfig&lt;/code&gt; file present.&lt;/p&gt;
&lt;h2 id=&quot;forcing-the-effect&quot;&gt;Forcing the effect&lt;/h2&gt;
&lt;p&gt;To begin with, I debugged what was going on (see the &lt;a href=&quot;https://qmacro.org/blog/posts/2025/09/01/auto-formatting-extensionless-bash-scripts-in-neovim/#useful-debugging-approaches&quot;&gt;Useful debugging approaches&lt;/a&gt; section) and found that the options for &lt;code&gt;shfmt&lt;/code&gt; were being determined and marshalled in &lt;a href=&quot;https://github.com/bash-lsp/bash-language-server/blob/6e419dad6fb07bcf269101c8ffe0d47fd11b14db/server/src/shfmt/index.ts&quot;&gt;server/src/shfmt/index.ts&lt;/a&gt; (yay for open source!):&lt;/p&gt;
&lt;pre class=&quot;language-typescript&quot; tabindex=&quot;0&quot;&gt;&lt;code class=&quot;language-typescript&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;private&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;async&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;runShfmt&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;
  document&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; TextDocument&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
  formatOptions&lt;span class=&quot;token operator&quot;&gt;?&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token constant&quot;&gt;LSP&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;FormattingOptions &lt;span class=&quot;token operator&quot;&gt;|&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;null&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
  shfmtConfig&lt;span class=&quot;token operator&quot;&gt;?&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; Record&lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;token builtin&quot;&gt;string&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token builtin&quot;&gt;string&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;|&lt;/span&gt; &lt;span class=&quot;token builtin&quot;&gt;boolean&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;|&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;null&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token builtin&quot;&gt;Promise&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;token builtin&quot;&gt;string&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
  &lt;span class=&quot;token keyword&quot;&gt;const&lt;/span&gt; args &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;await&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;this&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;getShfmtArguments&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;document&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;uri&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; formatOptions&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; shfmtConfig&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
  &lt;span class=&quot;token operator&quot;&gt;...&lt;/span&gt;
  &lt;span class=&quot;token keyword&quot;&gt;const&lt;/span&gt; proc &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;&lt;span class=&quot;token builtin&quot;&gt;Promise&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;resolve&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; reject&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&gt;&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;const&lt;/span&gt; proc &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;spawn&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;this&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;executablePath&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;...&lt;/span&gt;args&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&#39;-&#39;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt; cwd&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;this&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;cwd &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
    &lt;span class=&quot;token operator&quot;&gt;...&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;Using brute force&lt;a href=&quot;https://qmacro.org/blog/posts/2025/09/01/auto-formatting-extensionless-bash-scripts-in-neovim/#footnotes&quot;&gt;&lt;sup&gt;4&lt;/sup&gt;&lt;/a&gt; I simply truncated &lt;code&gt;args&lt;/code&gt; to &lt;code&gt;[]&lt;/code&gt;, removing the call to &lt;code&gt;this.getShfmtArguments&lt;/code&gt;, and everything worked as planned - &lt;code&gt;shfmt&lt;/code&gt; was called without any options at all, with the result that &lt;code&gt;shfmt&lt;/code&gt; did the right thing, finding and using the appropriate Editorconfig settings, for all Bash files.&lt;/p&gt;
&lt;p&gt;I didn&#39;t want to have to make this modification each time I installed the Bash language server, nor do I think it appropriate to suggest as a modification upstream. So I decided to wrap the call to &lt;code&gt;shfmt&lt;/code&gt;.&lt;/p&gt;
&lt;h3 id=&quot;wrapping-shfmt-to-strip-off-the-options&quot;&gt;Wrapping shfmt to strip off the options&lt;/h3&gt;
&lt;p&gt;The Bash language server &lt;a href=&quot;https://github.com/bash-lsp/bash-language-server/blob/main/server/src/config.ts&quot;&gt;configuration&lt;/a&gt; includes a section specifically for &lt;code&gt;shfmt&lt;/code&gt; (see &lt;a href=&quot;https://qmacro.org/blog/posts/2025/09/01/auto-formatting-extensionless-bash-scripts-in-neovim/#appendix-b-configuration-for-bash-language-server&quot;&gt;Appendix B&lt;/a&gt;). I can use the &lt;code&gt;shfmt.path&lt;/code&gt; configuration option to specify an alternate path for the executable, pointing to a simple shell script that removes all the options passed, except for a couple of generic ones.&lt;/p&gt;
&lt;p&gt;Here&#39;s the script, called &lt;code&gt;shfmt-wrapper&lt;/code&gt;, placed in &lt;code&gt;~/.local/bin/&lt;/code&gt; which is listed first in my &lt;code&gt;PATH&lt;/code&gt; environment variable:&lt;/p&gt;
&lt;pre class=&quot;language-bash&quot; tabindex=&quot;0&quot;&gt;&lt;code class=&quot;language-bash&quot;&gt;&lt;span class=&quot;token shebang important&quot;&gt;#!/usr/bin/env bash&lt;/span&gt;

&lt;span class=&quot;token builtin class-name&quot;&gt;declare&lt;/span&gt; &lt;span class=&quot;token parameter variable&quot;&gt;-a&lt;/span&gt; shfmtargs
&lt;span class=&quot;token keyword&quot;&gt;for&lt;/span&gt; &lt;span class=&quot;token for-or-select variable&quot;&gt;i&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;in&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;&lt;span class=&quot;token variable&quot;&gt;$@&lt;/span&gt;&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;do&lt;/span&gt;
  &lt;span class=&quot;token keyword&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt; &lt;span class=&quot;token variable&quot;&gt;$i&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;==&lt;/span&gt; &lt;span class=&quot;token parameter variable&quot;&gt;--filename&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;* &lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;||&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt; &lt;span class=&quot;token variable&quot;&gt;$i&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;==&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;-&quot;&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;then&lt;/span&gt;
    &lt;span class=&quot;token assign-left variable&quot;&gt;shfmtargs&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;&lt;span class=&quot;token variable&quot;&gt;${shfmtargs&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;@&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;}&lt;/span&gt;&quot;&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;&lt;span class=&quot;token variable&quot;&gt;$i&lt;/span&gt;&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
  &lt;span class=&quot;token keyword&quot;&gt;fi&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;done&lt;/span&gt;
shfmt &lt;span class=&quot;token string&quot;&gt;&quot;&lt;span class=&quot;token variable&quot;&gt;${shfmtargs&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;@&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;}&lt;/span&gt;&quot;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;All it does is take the options passed to it, removes all but the &lt;code&gt;--filename=...&lt;/code&gt; and &lt;code&gt;-&lt;/code&gt; ones, and then calls the actual &lt;code&gt;shfmt&lt;/code&gt; with what&#39;s left.&lt;/p&gt;
&lt;p&gt;And with the &lt;code&gt;shfmt.path&lt;/code&gt; option (see &lt;a href=&quot;https://qmacro.org/blog/posts/2025/09/01/auto-formatting-extensionless-bash-scripts-in-neovim/#appendix-c-neovim-lsp-configuration-for-the-bash-language-server&quot;&gt;Appendix C&lt;/a&gt;) I then told the Bash language server to use this wrapper when invoking &lt;code&gt;shfmt&lt;/code&gt;.&lt;/p&gt;
&lt;p&gt;Therefore, because no parser or printer flags are ever present in the &lt;code&gt;shfmt&lt;/code&gt; option list, &lt;code&gt;shfmt&lt;/code&gt; will use the Editorconfig configuration, interpreting it using the custom support for &lt;code&gt;[[bash]]&lt;/code&gt; or &lt;code&gt;[[shell]]&lt;/code&gt; sections.&lt;/p&gt;
&lt;p&gt;The result is that this section of my &lt;code&gt;.editorconfig&lt;/code&gt; file is interpreted as I intend:&lt;/p&gt;
&lt;pre class=&quot;language-toml&quot; tabindex=&quot;0&quot;&gt;&lt;code class=&quot;language-toml&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;token table class-name&quot;&gt;bash&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;
&lt;span class=&quot;token key property&quot;&gt;indent_size&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;2&lt;/span&gt;
&lt;span class=&quot;token key property&quot;&gt;indent_style&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;=&lt;/span&gt; space
&lt;span class=&quot;token key property&quot;&gt;switch_case_indent&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token boolean&quot;&gt;true&lt;/span&gt;
&lt;span class=&quot;token key property&quot;&gt;binary_next_line&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token boolean&quot;&gt;true&lt;/span&gt;
&lt;span class=&quot;token key property&quot;&gt;space_redirects&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token boolean&quot;&gt;true&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;and my extensionless Bash script files are formatted appropriately. Not with tabs, and no &lt;code&gt;shfmt&lt;/code&gt;-specific configuration, but as I have described in configuration.&lt;/p&gt;
&lt;p&gt;Great!&lt;/p&gt;
&lt;p&gt;This is of course a bit hacky, but I think it is within the boundaries of &amp;quot;small pieces, loosely joined&amp;quot; and doesn&#39;t require any modification to any non-user-serviceable parts.&lt;/p&gt;
&lt;p&gt;&lt;a name=&quot;useful-debugging-approaches&quot;&gt;&lt;/a&gt;&lt;/p&gt;
&lt;h2 id=&quot;useful-debugging-approaches&quot;&gt;Useful debugging approaches&lt;/h2&gt;
&lt;p&gt;In working out what was going on, I used various tools and settings to help me. Here&#39;s a quick list of those, mostly to remind my future self.&lt;/p&gt;
&lt;h3 id=&quot;the-editorconfig-cli&quot;&gt;The editorconfig CLI&lt;/h3&gt;
&lt;p&gt;The &lt;a href=&quot;https://www.npmjs.com/package/editorconfig&quot;&gt;editorconfig&lt;/a&gt; package, which I installed globally for these investigations with &lt;code&gt;npm i -g editorconfig&lt;/code&gt;, also sports a CLI which can be used to show the &amp;quot;effective configuration&amp;quot;, given a filename. Taking the &lt;code&gt;.editorconfig&lt;/code&gt; file contents in the &lt;a href=&quot;https://qmacro.org/blog/posts/2025/09/01/auto-formatting-extensionless-bash-scripts-in-neovim/#example-of-the-issue&quot;&gt;example of the issue&lt;/a&gt; shown earlier, here&#39;s what is output ...&lt;/p&gt;
&lt;p&gt;for the shell script file named &lt;code&gt;a&lt;/code&gt;:&lt;/p&gt;
&lt;pre class=&quot;language-shell&quot; tabindex=&quot;0&quot;&gt;&lt;code class=&quot;language-shell&quot;&gt;$ editorconfig a
&lt;span class=&quot;token assign-left variable&quot;&gt;indent_style&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;space
&lt;span class=&quot;token assign-left variable&quot;&gt;indent_size&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;2&lt;/span&gt;
&lt;span class=&quot;token assign-left variable&quot;&gt;switch_case_indent&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;true
&lt;span class=&quot;token assign-left variable&quot;&gt;binary_next_line&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;true
&lt;span class=&quot;token assign-left variable&quot;&gt;space_redirects&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;true
&lt;span class=&quot;token assign-left variable&quot;&gt;tab_width&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;2&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;and for the shell script file named &lt;code&gt;fixup&lt;/code&gt;:&lt;/p&gt;
&lt;pre class=&quot;language-shell&quot; tabindex=&quot;0&quot;&gt;&lt;code class=&quot;language-shell&quot;&gt;$ editorconfig fixup
&lt;span class=&quot;token assign-left variable&quot;&gt;indent_style&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;tab
&lt;span class=&quot;token assign-left variable&quot;&gt;indent_size&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;tab&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;Thus I can see first hand what the Bash language server would receive from the &lt;code&gt;editorconfig&lt;/code&gt; module, given a filename and some Editorconfig configuration.&lt;/p&gt;
&lt;h3 id=&quot;language-server-logging&quot;&gt;Language server logging&lt;/h3&gt;
&lt;p&gt;Logs are emitted at various points in the Bash language server&#39;s operation, as I could see from browsing the &lt;a href=&quot;https://github.com/bash-lsp/bash-language-server/tree/main/server/src&quot;&gt;server source code&lt;/a&gt;.&lt;/p&gt;
&lt;p&gt;For example, the &lt;a href=&quot;https://github.com/bash-lsp/bash-language-server/blob/main/server/src/shfmt/index.ts&quot;&gt;shfmt support&lt;/a&gt; has many logging lines, including this one:&lt;/p&gt;
&lt;pre class=&quot;language-typescript&quot; tabindex=&quot;0&quot;&gt;&lt;code class=&quot;language-typescript&quot;&gt;logger&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;debug&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;
  &lt;span class=&quot;token template-string&quot;&gt;&lt;span class=&quot;token template-punctuation string&quot;&gt;`&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;Shfmt: found .editorconfig properties: &lt;/span&gt;&lt;span class=&quot;token interpolation&quot;&gt;&lt;span class=&quot;token interpolation-punctuation punctuation&quot;&gt;${&lt;/span&gt;&lt;span class=&quot;token constant&quot;&gt;JSON&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;stringify&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;
    editorconfigProperties&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
  &lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token interpolation-punctuation punctuation&quot;&gt;}&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token template-punctuation string&quot;&gt;`&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;In the &lt;a href=&quot;https://github.com/bash-lsp/bash-language-server/blob/main/server/src/config.ts&quot;&gt;configuration section&lt;/a&gt; I could see that it was probably possible to set my desired logging level with the environment variable &lt;code&gt;BASH_IDE_LOG_LEVEL&lt;/code&gt;.&lt;/p&gt;
&lt;p&gt;But it turns out that the idea is that settings can be specified in the LSP configuration, and the setting property &amp;quot;path&amp;quot; is what&#39;s actually shown in the &lt;a href=&quot;https://qmacro.org/blog/posts/2025/09/01/auto-formatting-extensionless-bash-scripts-in-neovim/#appendix-a-mason-info-for-bash-language-server&quot;&gt;Mason info&lt;/a&gt;, starting with &lt;code&gt;bashIde&lt;/code&gt; as the first path section. I didn&#39;t find that in the Bash language server README or configuration section, perhaps I should have known that implicitly, or known to look elsewhere for it.&lt;/p&gt;
&lt;p&gt;Anyway, once I figured that out, I could set my desired level like this (also shown in &lt;a href=&quot;https://qmacro.org/blog/posts/2025/09/01/auto-formatting-extensionless-bash-scripts-in-neovim/appendix-c-neovim-lsp-configuration-for-the-bash-language-server&quot;&gt;Appendix C&lt;/a&gt;):&lt;/p&gt;
&lt;pre class=&quot;language-lua&quot; tabindex=&quot;0&quot;&gt;&lt;code class=&quot;language-lua&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
  cmd &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&#39;bash-language-server&#39;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&#39;start&#39;&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
  filetypes &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&#39;bash&#39;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&#39;sh&#39;&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
  settings &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    bashIde &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
      logLevel &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&#39;debug&#39;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
      shfmt &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
        path &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; vim&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;fn&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;expand&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&#39;$HOME&#39;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;..&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&#39;/dotfiles/scripts/shfmt-wrapper&#39;&lt;/span&gt;
      &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
  &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;Where does this log output from the Bash language server show up? Well, now I figured it out, it&#39;s obvious - it&#39;s all collected in Neovim&#39;s general LSP log file at &lt;code&gt;~/.local/state/nvim/lsp.log&lt;/code&gt;.&lt;/p&gt;
&lt;p&gt;However, any debug level log output from the Bash language server will only show up there if the general Neovim language server logging level is high enough. Even after adding the &lt;code&gt;logLevel = &#39;debug&#39;&lt;/code&gt; configuration above, nothing showed up ... until I realised I had this in my &lt;code&gt;~/.config/nvim/init.lua&lt;/code&gt;:&lt;/p&gt;
&lt;pre class=&quot;language-lua&quot; tabindex=&quot;0&quot;&gt;&lt;code class=&quot;language-lua&quot;&gt;&lt;span class=&quot;token comment&quot;&gt;-- LSP logging&lt;/span&gt;
vim&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;lsp&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;set_log_level&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;WARN&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;Setting this to &lt;code&gt;DEBUG&lt;/code&gt;, either by changing the value in the &lt;code&gt;init.lua&lt;/code&gt; file itself, or simply on the fly with:&lt;/p&gt;
&lt;pre class=&quot;language-shell&quot; tabindex=&quot;0&quot;&gt;&lt;code class=&quot;language-shell&quot;&gt;:lua vim.lsp.set_log_level&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;DEBUG&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;does the trick, and output like this appears in the &lt;code&gt;lsp.log&lt;/code&gt; file:&lt;/p&gt;
&lt;pre class=&quot;language-log&quot; tabindex=&quot;0&quot;&gt;&lt;code class=&quot;language-log&quot;&gt;&lt;span class=&quot;token level debug keyword&quot;&gt;DEBUG&lt;/span&gt; &lt;span class=&quot;token property&quot;&gt;Shfmt:&lt;/span&gt; found &lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;editorconfig properties&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;indent_style&quot;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;tab&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;indent_size&quot;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;tab&quot;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;}&lt;/span&gt;&#39;
&lt;span class=&quot;token level debug keyword&quot;&gt;DEBUG&lt;/span&gt; &lt;span class=&quot;token property&quot;&gt;Shfmt:&lt;/span&gt; no shfmt properties found in &lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;editorconfig &lt;span class=&quot;token operator&quot;&gt;-&lt;/span&gt; using language server shfmt config&quot;
&lt;span class=&quot;token level debug keyword&quot;&gt;DEBUG&lt;/span&gt; &lt;span class=&quot;token property&quot;&gt;Shfmt:&lt;/span&gt; running &lt;span class=&quot;token string&quot;&gt;&quot;/home/dj/.local/bin/shfmt-wrapper --filename=/tmp/formatting/fixup -i=0 -ln=auto&quot;&lt;/span&gt;&#39;&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;&lt;a name=&quot;appendix-a-mason-info-for-the-bash-language-server&quot;&gt;&lt;/a&gt;&lt;/p&gt;
&lt;h2 id=&quot;appendix-a-mason-info-for-the-bash-language-server&quot;&gt;Appendix A - Mason info for the Bash language server&lt;/h2&gt;
&lt;pre class=&quot;language-text&quot; tabindex=&quot;0&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;Language Filter: press &lt;C-f&gt; to apply filter

Installed (1)
  ◍ bash-language-server
    A language server for Bash.

    installed version 5.6.0
    installed purl    pkg:npm/bash-language-server@5.6.0
    homepage          https://github.com/bash-lsp/bash-language-server
    languages         Bash, Csh, Ksh, Sh, Zsh
    categories        LSP
    executables       bash-language-server

    ↓ LSP server configuration schema (press enter to collapse)
      This is a read-only overview of the settings this server accepts.
      Note that some settings might not apply to neovim.

      → bashIde.backgroundAnalysisMaxFiles    default: 500
      → bashIde.enableSourceErrorDiagnostics  default: false
      → bashIde.explainshellEndpoint          default: &quot;&quot;
      → bashIde.globPattern                   default: &quot;**/*@(.sh|.inc|.bash|.command)&quot;
      → bashIde.includeAllWorkspaceSymbols    default: false
      → bashIde.logLevel                      default: &quot;info&quot;
      → bashIde.shellcheckArguments           default: &quot;&quot;
      → bashIde.shellcheckPath                default: &quot;shellcheck&quot;
      → bashIde.shfmt.binaryNextLine          default: false
      → bashIde.shfmt.caseIndent              default: false
      → bashIde.shfmt.funcNextLine            default: false
      → bashIde.shfmt.ignoreEditorconfig      default: false
      → bashIde.shfmt.keepPadding             default: false
      → bashIde.shfmt.languageDialect         default: &quot;auto&quot;
      → bashIde.shfmt.path                    default: &quot;shfmt&quot;
      → bashIde.shfmt.simplifyCode            default: false
      → bashIde.shfmt.spaceRedirects          default: false&lt;/C-f&gt;&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;&lt;a name=&quot;appendix-b-configuation-for-bash-language-server&quot;&gt;&lt;/a&gt;&lt;/p&gt;
&lt;h2 id=&quot;appendix-b-configuration-for-bash-language-server&quot;&gt;Appendix B - Configuration for Bash language server&lt;/h2&gt;
&lt;pre class=&quot;language-javascript&quot; tabindex=&quot;0&quot;&gt;&lt;code class=&quot;language-javascript&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;const&lt;/span&gt; rawConfig &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
  &lt;span class=&quot;token literal-property property&quot;&gt;backgroundAnalysisMaxFiles&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;toNumber&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;process&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;env&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token constant&quot;&gt;BACKGROUND_ANALYSIS_MAX_FILES&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
  &lt;span class=&quot;token literal-property property&quot;&gt;enableSourceErrorDiagnostics&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;toBoolean&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;process&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;env&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token constant&quot;&gt;ENABLE_SOURCE_ERROR_DIAGNOSTICS&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
  &lt;span class=&quot;token literal-property property&quot;&gt;explainshellEndpoint&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; process&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;env&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token constant&quot;&gt;EXPLAINSHELL_ENDPOINT&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
  &lt;span class=&quot;token literal-property property&quot;&gt;globPattern&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; process&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;env&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token constant&quot;&gt;GLOB_PATTERN&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
  &lt;span class=&quot;token literal-property property&quot;&gt;includeAllWorkspaceSymbols&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;toBoolean&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;process&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;env&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token constant&quot;&gt;INCLUDE_ALL_WORKSPACE_SYMBOLS&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
  &lt;span class=&quot;token literal-property property&quot;&gt;logLevel&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; process&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;env&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;token constant&quot;&gt;LOG_LEVEL_ENV_VAR&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
  &lt;span class=&quot;token literal-property property&quot;&gt;shellcheckArguments&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; process&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;env&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token constant&quot;&gt;SHELLCHECK_ARGUMENTS&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
  &lt;span class=&quot;token literal-property property&quot;&gt;shellcheckPath&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; process&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;env&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token constant&quot;&gt;SHELLCHECK_PATH&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
  &lt;span class=&quot;token literal-property property&quot;&gt;shfmt&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;token literal-property property&quot;&gt;path&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; process&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;env&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token constant&quot;&gt;SHFMT_PATH&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
    &lt;span class=&quot;token literal-property property&quot;&gt;ignoreEditorconfig&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;toBoolean&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;process&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;env&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token constant&quot;&gt;SHFMT_IGNORE_EDITORCONFIG&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
    &lt;span class=&quot;token literal-property property&quot;&gt;languageDialect&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; process&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;env&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token constant&quot;&gt;SHFMT_LANGUAGE_DIALECT&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
    &lt;span class=&quot;token literal-property property&quot;&gt;binaryNextLine&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;toBoolean&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;process&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;env&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token constant&quot;&gt;SHFMT_BINARY_NEXT_LINE&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
    &lt;span class=&quot;token literal-property property&quot;&gt;caseIndent&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;toBoolean&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;process&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;env&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token constant&quot;&gt;SHFMT_CASE_INDENT&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
    &lt;span class=&quot;token literal-property property&quot;&gt;funcNextLine&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;toBoolean&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;process&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;env&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token constant&quot;&gt;SHFMT_FUNC_NEXT_LINE&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
    &lt;span class=&quot;token literal-property property&quot;&gt;keepPadding&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;toBoolean&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;process&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;env&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token constant&quot;&gt;SHFMT_KEEP_PADDING&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
    &lt;span class=&quot;token literal-property property&quot;&gt;simplifyCode&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;toBoolean&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;process&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;env&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token constant&quot;&gt;SHFMT_SIMPLIFY_CODE&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
    &lt;span class=&quot;token literal-property property&quot;&gt;spaceRedirects&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;toBoolean&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;process&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;env&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token constant&quot;&gt;SHFMT_SPACE_REDIRECTS&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
  &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;&lt;a name=&quot;appendix-c-neovim-lsp-configuration-for-the-bash-language-server&quot;&gt;&lt;/a&gt;&lt;/p&gt;
&lt;h2 id=&quot;appendix-c-neovim-lsp-configuration-for-the-bash-language-server&quot;&gt;Appendix C - Neovim LSP configuration for the Bash language server&lt;/h2&gt;
&lt;p&gt;To add the Bash language server to &lt;a href=&quot;https://qmacro.org/blog/posts/2025/06/10/a-modern-and-clean-neovim-setup-for-cap-node-js-configuration-and-diagnostics/&quot;&gt;my Neovim 0.11+ setup&lt;/a&gt; and configure it, all I needed was to create a new configuration file &lt;code&gt;~/.config/nvim/lsp/bash.lua&lt;/code&gt;:&lt;/p&gt;
&lt;pre class=&quot;language-lua&quot; tabindex=&quot;0&quot;&gt;&lt;code class=&quot;language-lua&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
  cmd &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&#39;bash-language-server&#39;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&#39;start&#39;&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
  filetypes &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&#39;bash&#39;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&#39;sh&#39;&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
  settings &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    bashIde &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
      logLevel &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&#39;debug&#39;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
      shfmt &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
        path &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; vim&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;fn&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;expand&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&#39;$HOME&#39;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;..&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&#39;/dotfiles/scripts/shfmt-wrapper&#39;&lt;/span&gt;
      &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
  &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;(The settings will be explained in the course of this post.)&lt;/p&gt;
&lt;p&gt;Then it was just a matter of enabling the server in the list in my main &lt;code&gt;~/config/nvim/init.lua&lt;/code&gt; file:&lt;/p&gt;
&lt;pre class=&quot;language-lua&quot; tabindex=&quot;0&quot;&gt;&lt;code class=&quot;language-lua&quot;&gt;vim&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;lsp&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;enable&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
  &lt;span class=&quot;token string&quot;&gt;&#39;javascript&#39;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
  &lt;span class=&quot;token string&quot;&gt;&#39;cds&#39;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
  &lt;span class=&quot;token string&quot;&gt;&#39;markdown&#39;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
  &lt;span class=&quot;token string&quot;&gt;&#39;dockerfile&#39;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
  &lt;span class=&quot;token string&quot;&gt;&#39;lua&#39;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
  &lt;span class=&quot;token string&quot;&gt;&#39;bash&#39;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token comment&quot;&gt;-- here&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;&lt;a name=&quot;footnotes&quot;&gt;&lt;/a&gt;&lt;/p&gt;
&lt;h2 id=&quot;footnotes&quot;&gt;Footnotes&lt;/h2&gt;
&lt;ol&gt;
&lt;li&gt;as well as &lt;code&gt;shellcheck&lt;/code&gt; which &lt;a href=&quot;https://github.com/bash-lsp/bash-language-server?tab=readme-ov-file#dependencies&quot;&gt;is also supported&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;version &lt;a href=&quot;https://github.com/mvdan/sh/releases/tag/v3.8.0&quot;&gt;3.8.0&lt;/a&gt; or higher, as that is when support for Editorconfig sections such as &lt;code&gt;[[shell]]&lt;/code&gt; &lt;a href=&quot;https://github.com/mvdan/sh/issues/664&quot;&gt;was introduced&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;https://github.com/qmacro/dotfiles/blob/57c7f38e64ef1f59b9c41f6155b0fa350eb030b7/config/nvim/init.lua#L14-L23&quot;&gt;configured&lt;/a&gt; through a &lt;code&gt;BufWritePre&lt;/code&gt; event based call to &lt;code&gt;vim.lsp.buf.format&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;it was actually in the &lt;a href=&quot;https://github.com/mason-org/mason.nvim&quot;&gt;Mason&lt;/a&gt; installed and managed location at &lt;code&gt;~/.local/share/nvim/mason/packages/bash-language-server/node_modules/bash-language-server/out/shfmt/index.js&lt;/code&gt;, i.e. the transpiled JavaScript equivalent file&lt;/li&gt;
&lt;/ol&gt;
</content>
  </entry>
  <entry>
    <title>Neovim configuration for file and module navigation in CDS models</title>
    <link href="https://qmacro.org/blog/posts/2025/08/06/neovim-configuration-for-file-and-module-navigation-in-cds-models/" />
    <updated>2025-08-06T00:00:00Z</updated>
    <id>https://qmacro.org/blog/posts/2025/08/06/neovim-configuration-for-file-and-module-navigation-in-cds-models/</id>
    <content type="html">&lt;h2 id=&quot;cds-modelling-across-files-and-modules&quot;&gt;CDS modelling across files and modules&lt;/h2&gt;
&lt;p&gt;In the context of CDS models, one of the best practices is to embrace &lt;a href=&quot;https://cap.cloud.sap/docs/about/best-practices#aspects&quot;&gt;aspects&lt;/a&gt; and &amp;quot;factor out separate concerns into separate files&amp;quot;. In addition to files the CDS compiler supports Node.js packages (modules).&lt;/p&gt;
&lt;p&gt;An example of both can be found in the &lt;a href=&quot;https://cap.cloud.sap/docs/tools/cds-cli#sample&quot;&gt;sample&lt;/a&gt; facet. Let&#39;s create a project based on this sample facet and explore.&lt;/p&gt;
&lt;pre class=&quot;language-bash&quot; tabindex=&quot;0&quot;&gt;&lt;code class=&quot;language-bash&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;token builtin class-name&quot;&gt;cd&lt;/span&gt; /tmp &lt;span class=&quot;token operator&quot;&gt;&amp;amp;&amp;amp;&lt;/span&gt; cds init &lt;span class=&quot;token parameter variable&quot;&gt;--add&lt;/span&gt; sample sample &lt;span class=&quot;token operator&quot;&gt;&amp;amp;&amp;amp;&lt;/span&gt; &lt;span class=&quot;token builtin class-name&quot;&gt;cd&lt;/span&gt; sample &lt;span class=&quot;token operator&quot;&gt;&amp;amp;&amp;amp;&lt;/span&gt; tree &lt;span class=&quot;token parameter variable&quot;&gt;-L&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;3&lt;/span&gt;
creating new CAP project &lt;span class=&quot;token keyword&quot;&gt;in&lt;/span&gt; ./sample

adding nodejs
adding sample

successfully created project – &lt;span class=&quot;token builtin class-name&quot;&gt;continue&lt;/span&gt; with &lt;span class=&quot;token builtin class-name&quot;&gt;cd&lt;/span&gt; sample

&lt;span class=&quot;token function&quot;&gt;find&lt;/span&gt; samples on https://github.com/SAP-samples/cloud-cap-samples
learn about next steps at https://cap.cloud.sap
&lt;span class=&quot;token builtin class-name&quot;&gt;.&lt;/span&gt;
├── README.md
├── app
│   ├── _i18n
│   │   ├── i18n.properties
│   │   └── i18n_de.properties
│   ├── admin-books
│   │   ├── fiori-service.cds
│   │   └── webapp
│   ├── appconfig
│   │   └── fioriSandboxConfig.json
│   ├── browse
│   │   ├── fiori-service.cds
│   │   └── webapp
│   ├── common.cds
│   ├── index.html
│   └── services.cds
├── db
│   ├── data
│   │   ├── sap.capire.bookshop-Authors.csv
│   │   ├── sap.capire.bookshop-Books.csv
│   │   ├── sap.capire.bookshop-Books_texts.csv
│   │   └── sap.capire.bookshop-Genres.csv
│   └── schema.cds
├── eslint.config.mjs
├── package.json
└── srv
    ├── admin-service.cds
    ├── admin-service.js
    ├── cat-service.cds
    └── cat-service.js

&lt;span class=&quot;token number&quot;&gt;11&lt;/span&gt; directories, &lt;span class=&quot;token number&quot;&gt;20&lt;/span&gt; files&lt;/code&gt;&lt;/pre&gt;
&lt;h3 id=&quot;examining-the-using-references&quot;&gt;Examining the &#39;using&#39; references&lt;/h3&gt;
&lt;p&gt;In &lt;code&gt;app/admin-books/fiori-service.cds&lt;/code&gt; there&#39;s this:&lt;/p&gt;
&lt;pre class=&quot;language-cds&quot; tabindex=&quot;0&quot;&gt;&lt;code class=&quot;language-cds&quot;&gt;&lt;span class=&quot;token using keyword&quot;&gt;using&lt;/span&gt; { AdminService } &lt;span class=&quot;token from keyword&quot;&gt;from&lt;/span&gt; &#39;../../srv/admin-&lt;span class=&quot;token keyword&quot;&gt;service&lt;/span&gt;.cds&#39;;
&lt;span class=&quot;token using keyword&quot;&gt;using&lt;/span&gt; { sap.capire.bookshop } &lt;span class=&quot;token from keyword&quot;&gt;from&lt;/span&gt; &#39;../../db/schema&#39;;
...&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;So &lt;code&gt;AdminService&lt;/code&gt; is being imported from &lt;code&gt;../../srv/admin-service.cds&lt;/code&gt;, which looks like this:&lt;/p&gt;
&lt;pre class=&quot;language-cds&quot; tabindex=&quot;0&quot;&gt;&lt;code class=&quot;language-cds&quot;&gt;&lt;span class=&quot;token using keyword&quot;&gt;using&lt;/span&gt; { sap.capire.bookshop &lt;span class=&quot;token cqlkeywords keyword&quot;&gt;as&lt;/span&gt; my } &lt;span class=&quot;token from keyword&quot;&gt;from&lt;/span&gt; &#39;../db/schema&#39;;
&lt;span class=&quot;token keyword&quot;&gt;service&lt;/span&gt; AdminService &lt;span class=&quot;token annotation important&quot;&gt;@(requires:&#39;admin&#39;)&lt;/span&gt; {
  &lt;span class=&quot;token keyword&quot;&gt;entity&lt;/span&gt; Books &lt;span class=&quot;token cqlkeywords keyword&quot;&gt;as&lt;/span&gt; &lt;span class=&quot;token cdl-keyword keyword&quot;&gt;projection&lt;/span&gt; &lt;span class=&quot;token cqlkeywords keyword&quot;&gt;on&lt;/span&gt; my.Books;
  &lt;span class=&quot;token keyword&quot;&gt;entity&lt;/span&gt; Authors &lt;span class=&quot;token cqlkeywords keyword&quot;&gt;as&lt;/span&gt; &lt;span class=&quot;token cdl-keyword keyword&quot;&gt;projection&lt;/span&gt; &lt;span class=&quot;token cqlkeywords keyword&quot;&gt;on&lt;/span&gt; my.Authors;
}&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;In turn, the entities here are from the &lt;code&gt;sap.capire.bookshop&lt;/code&gt; namespace which is imported from &lt;code&gt;../db/schema&lt;/code&gt;, which looks like this:&lt;/p&gt;
&lt;pre class=&quot;language-cds&quot; tabindex=&quot;0&quot;&gt;&lt;code class=&quot;language-cds&quot;&gt;&lt;span class=&quot;token using keyword&quot;&gt;using&lt;/span&gt; { Currency, managed, sap } &lt;span class=&quot;token from keyword&quot;&gt;from&lt;/span&gt; &#39;@sap/cds/common&#39;;
&lt;span class=&quot;token keyword&quot;&gt;namespace&lt;/span&gt; sap.capire.bookshop;

&lt;span class=&quot;token keyword&quot;&gt;entity&lt;/span&gt; Books : managed {
   ...
}&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;And &lt;code&gt;Currency&lt;/code&gt;, &lt;code&gt;managed&lt;/code&gt; and &lt;code&gt;sap&lt;/code&gt; are imported from the module &lt;code&gt;@sap/cds/common&lt;/code&gt;, a file (&lt;code&gt;common.cds&lt;/code&gt;) within the &lt;code&gt;@sap/cds&lt;/code&gt; module, which (at this point) is available in the globally installed &lt;code&gt;@sap/cds-dk&lt;/code&gt; module location (as we haven&#39;t performed a project-local &lt;code&gt;npm install&lt;/code&gt; yet), and looks like this (heavily redacted):&lt;/p&gt;
&lt;pre class=&quot;language-cds&quot; tabindex=&quot;0&quot;&gt;&lt;code class=&quot;language-cds&quot;&gt;&lt;span class=&quot;token cqlkeywords keyword&quot;&gt;type&lt;/span&gt; Currency : &lt;span class=&quot;token association-composition keyword&quot;&gt;Association to sap&lt;/span&gt;.common.Currencies;
...
&lt;span class=&quot;token keyword&quot;&gt;aspect&lt;/span&gt; managed {
  createdAt  : &lt;span class=&quot;token type builtin&quot;&gt;Timestamp &lt;/span&gt;&lt;span class=&quot;token annotation important&quot;&gt;@cds.on.insert&lt;/span&gt; : $now;
  createdBy  : User      &lt;span class=&quot;token annotation important&quot;&gt;@cds.on.insert&lt;/span&gt; : $user;
  modifiedAt : &lt;span class=&quot;token type builtin&quot;&gt;Timestamp &lt;/span&gt;&lt;span class=&quot;token annotation important&quot;&gt;@cds.on.insert&lt;/span&gt; : $now  &lt;span class=&quot;token annotation important&quot;&gt;@cds.on.update&lt;/span&gt; : $now;
  modifiedBy : User      &lt;span class=&quot;token annotation important&quot;&gt;@cds.on.insert&lt;/span&gt; : $user &lt;span class=&quot;token annotation important&quot;&gt;@cds.on.update&lt;/span&gt; : $user;
}
...&lt;/code&gt;&lt;/pre&gt;
&lt;h3 id=&quot;visualising-the-navigation-path&quot;&gt;Visualising the navigation path&lt;/h3&gt;
&lt;p&gt;Here&#39;s what these relations (and navigations) look like in &amp;quot;diagram&amp;quot; form (thanks to &lt;a href=&quot;https://asciiflow.com/#/&quot;&gt;ASCIIFlow&lt;/a&gt;):&lt;/p&gt;
&lt;pre class=&quot;language-text&quot; tabindex=&quot;0&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;+-----------------------------+
|app/admin/fiori-service.cds  |
+-----------------------------+
|using ... from               |
|&#39;../../srv/admin-service.cds&#39;|
|             |              1|
+-------------|---------------+   +-----------------------------+
              +-------------------|srv/admin-service.cds        |
                                  +-----------------------------+
                                  |using ... from               |
                                  |&#39;../db/schema.cds&#39;           |
                                  |            |               2|
+-----------------------------+   +------------|----------------+
|db/schema.cds                |----------------+
+-----------------------------+
|using ... from               |
|&#39;@sap/cds/common&#39;            |
|             |              3|
+-------------|---------------+   +-----------------------------+
              +-------------------|@sap/cds/common              |
                                  +-----------------------------+
                                  |type Currency ...            |
                                  |aspect managed { ... }       |
                                  |                            4|
                                  +-----------------------------+&lt;/code&gt;&lt;/pre&gt;
&lt;blockquote&gt;
&lt;p&gt;As mentioned earlier, the &lt;code&gt;@sap/cds/common&lt;/code&gt; resource is a file called &lt;code&gt;common.cds&lt;/code&gt; within the &lt;code&gt;@sap/cds&lt;/code&gt; module.&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;What&#39;s notable is that these relations are expressed differently each time:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;the first points to &lt;code&gt;../../srv/admin-service.cds&lt;/code&gt; which has an explicit &lt;code&gt;.cds&lt;/code&gt; extension&lt;/li&gt;
&lt;li&gt;the second points to &lt;code&gt;../db/schema&lt;/code&gt; which has no extension&lt;/li&gt;
&lt;li&gt;the third points to a Node.js module based resource &lt;code&gt;@sap/cds/common&lt;/code&gt;, again with no extension specified&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;Here&#39;s a quick demo of how that navigation path can be followed in VS Code, with the &lt;a href=&quot;https://marketplace.visualstudio.com/items?itemName=SAPSE.vscode-cds&quot;&gt;SAP CDS Language Support&lt;/a&gt; extension:&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;https://qmacro.org/images/2025/08/vscode-nav.gif&quot; alt=&quot;navigation in VS Code&quot;&gt;&lt;/p&gt;
&lt;h2 id=&quot;making-cds-model-navigation-work-in-neovim&quot;&gt;Making CDS model navigation work in Neovim&lt;/h2&gt;
&lt;p&gt;With the &lt;code&gt;@sap/cds-lsp&lt;/code&gt; language server in play, plus the Tree-sitter queries for CDS, I have a good experience in Neovim already (see &lt;a href=&quot;https://qmacro.org/blog/posts/2025/06/10/a-modern-and-clean-neovim-setup-for-cap-node-js-configuration-and-diagnostics/&quot;&gt;A modern and clean Neovim setup for CAP Node.js - configuration and diagnostics&lt;/a&gt;).&lt;/p&gt;
&lt;p&gt;However, using the standard &lt;a href=&quot;https://neovim.io/doc/user/editing.html#gf&quot;&gt;gf&lt;/a&gt; mechanism left me wanting, due to the types of navigation target and the vagaries of how they are expressed. With a little configuration though, (which is still experimental at this stage, as I&#39;m still learning) I&#39;ve improved the situation.&lt;/p&gt;
&lt;p&gt;I added some &lt;a href=&quot;https://neovim.io/doc/user/usr_41.html#_writing-a-filetype-plugin&quot;&gt;ftplugin&lt;/a&gt; configuration specific to CDS files, in an &lt;code&gt;after/ftplugin/cds.lua&lt;/code&gt; file within my Neovim config, and it looks like this:&lt;/p&gt;
&lt;pre class=&quot;language-lua&quot; tabindex=&quot;0&quot;&gt;&lt;code class=&quot;language-lua&quot;&gt;&lt;span class=&quot;token comment&quot;&gt;-- Settings to be able to navigate to cds resources in Node.js modules&lt;/span&gt;

&lt;span class=&quot;token comment&quot;&gt;-- Given a path p, add it to the &#39;path&#39; if it exists&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;local&lt;/span&gt; addpath &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;function&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;p&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
  &lt;span class=&quot;token keyword&quot;&gt;if&lt;/span&gt; vim&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;uv&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;fs_stat&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;p&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;then&lt;/span&gt; vim&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;opt&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;path&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;append&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;p&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;end&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;end&lt;/span&gt;

&lt;span class=&quot;token comment&quot;&gt;-- Auto add .cds extension to files if necessary when nav with gf&lt;/span&gt;
vim&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;opt&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;suffixesadd &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&#39;.cds&#39;&lt;/span&gt;

&lt;span class=&quot;token comment&quot;&gt;-- Ensure that the literal @ symbol is treated as part of a filename&lt;/span&gt;
&lt;span class=&quot;token comment&quot;&gt;-- (required as the CAP module names are in the @sap namespace)&lt;/span&gt;
vim&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;opt&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;isfname&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;append &lt;span class=&quot;token string&quot;&gt;&#39;@-@&#39;&lt;/span&gt;

&lt;span class=&quot;token comment&quot;&gt;-- The standard module location&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;local&lt;/span&gt; moduledir &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&#39;/node_modules&#39;&lt;/span&gt;

&lt;span class=&quot;token comment&quot;&gt;-- If a project-local npm install has been executed then projpath&lt;/span&gt;
&lt;span class=&quot;token comment&quot;&gt;-- will reflect the project-local node_modules dir&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;local&lt;/span&gt; projpath &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; vim&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;fs&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;root&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&#39;package.json&#39;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;..&lt;/span&gt; moduledir

&lt;span class=&quot;token comment&quot;&gt;-- We can also add the CAP global based node_modules dir,&lt;/span&gt;
&lt;span class=&quot;token comment&quot;&gt;-- based on the location of the &#39;cds&#39; executable&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;local&lt;/span&gt; cdsdkpath &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; vim&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;fs&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;dirname&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;vim&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;fn&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;exepath&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&#39;cds&#39;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
    &lt;span class=&quot;token operator&quot;&gt;..&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&#39;/../lib/node_modules/@sap/cds-dk&#39;&lt;/span&gt;
    &lt;span class=&quot;token operator&quot;&gt;..&lt;/span&gt; moduledir

&lt;span class=&quot;token comment&quot;&gt;-- Add them if they exist&lt;/span&gt;
&lt;span class=&quot;token function&quot;&gt;addpath&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;projpath&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;token function&quot;&gt;addpath&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;cdsdkpath&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;Here&#39;s a quick summary:&lt;/p&gt;
&lt;p&gt;I have a simple function &lt;code&gt;addpath&lt;/code&gt; which will add a (path) value to &lt;code&gt;path&lt;/code&gt; option, which the help describes as &amp;quot;a list of directories which will be searched when using &lt;code&gt;gf&lt;/code&gt; ... and other commands&amp;quot;. The function uses &lt;a href=&quot;https://neovim.io/doc/user/lua.html#vim.fs.exists()&quot;&gt;uv.fs_stat&lt;/a&gt; to ensure the directory actually exists before adding it.&lt;/p&gt;
&lt;p&gt;The &lt;code&gt;suffixesadd&lt;/code&gt; option (via &lt;a href=&quot;https://neovim.io/doc/user/options.html#&#39;suffixesadd&#39;&quot;&gt;vim.opt.suffixesadd&lt;/a&gt;) is also related to the use of &lt;code&gt;gf&lt;/code&gt; and is a &amp;quot;comma-separated list of suffixes, which are used when searching for a file for the &lt;code&gt;gf&lt;/code&gt;, &lt;code&gt;[I&lt;/code&gt;, etc. commands&amp;quot;. So here I add &lt;code&gt;.cds&lt;/code&gt; to this option for the case where an extension isn&#39;t given - like in this case:&lt;/p&gt;
&lt;pre class=&quot;language-cds&quot; tabindex=&quot;0&quot;&gt;&lt;code class=&quot;language-cds&quot;&gt;&lt;span class=&quot;token using keyword&quot;&gt;using&lt;/span&gt; { sap.capire.bookshop &lt;span class=&quot;token cqlkeywords keyword&quot;&gt;as&lt;/span&gt; my } &lt;span class=&quot;token from keyword&quot;&gt;from&lt;/span&gt; &#39;../db/schema&#39;;&lt;/code&gt;&lt;/pre&gt;
&lt;blockquote&gt;
&lt;p&gt;The extension is omitted here as a sort of CAP best practice, and could in fact be &lt;code&gt;.csn&lt;/code&gt;, the compiled machine-readable equivalent of CDL (the human-readable language used in CDS model files). But I&#39;ll cross that bridge when I come to it.&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;That&#39;s it with regards to handling navigation to other CDS model files. But navigation to Node.js modules requires a bit more fettling.&lt;/p&gt;
&lt;p&gt;The CAP modules are all in the &lt;code&gt;sap&lt;/code&gt; namespace. Namespaces, or &lt;a href=&quot;https://docs.npmjs.com/about-scopes&quot;&gt;scopes&lt;/a&gt;, are prefixed with the &lt;code&gt;@&lt;/code&gt; symbol (as in &lt;code&gt;@sap/cds&lt;/code&gt;, for example). When modules are installed, in the &lt;code&gt;node_modules/&lt;/code&gt; directory, the &lt;code&gt;@&lt;/code&gt;-prefixed namespace forms part of the directory structure. So in this &lt;code&gt;sample&lt;/code&gt; project, after running &lt;code&gt;npm install&lt;/code&gt;, here&#39;s where &lt;code&gt;@sap/cds/common&lt;/code&gt; is to be found:&lt;/p&gt;
&lt;pre class=&quot;language-text&quot; tabindex=&quot;0&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;node_modules/
├── @cap-js
│   ├── cds-types
│   │   ├── ...
│   │   └── scripts
│   ├── db-service
│   │   ├── ...
│   │   └── package.json
│   └── sqlite
│       ├── ...
│       └── package.json
└── @sap
    └── cds
        ├── CHANGELOG.md
        ├── LICENSE
        ├── README.md
        ├── _i18n
        ├── app
        ├── bin
  ---&gt;  ├── common.cds
        ├── eslint.config.mjs
        ├── lib
        ├── libx
        ├── package.json
        ├── server.js
        ├── srv
        └── tasks&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;That means I need to add the literal &lt;code&gt;@&lt;/code&gt; symbol to the &lt;a href=&quot;https://neovim.io/doc/user/options.html#&#39;isfname&#39;&quot;&gt;isfname&lt;/a&gt; option, which denotes the characters included in filenames. If we look at the default value for &lt;code&gt;isfname&lt;/code&gt; (with &lt;code&gt;:set isfname?&lt;/code&gt;) we see this:&lt;/p&gt;
&lt;pre class=&quot;language-text&quot; tabindex=&quot;0&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;@,48-57,/,.,-,_,+,,,#,$,%,~,=&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;But &lt;code&gt;@&lt;/code&gt; here represents &amp;quot;alpha characters&amp;quot;, and to have the actual &lt;code&gt;@&lt;/code&gt; symbol included, one needs to add &lt;code&gt;@-@&lt;/code&gt;.&lt;/p&gt;
&lt;p&gt;Once that is done, it&#39;s just a question of determining:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;the CAP Node.js project&#39;s root directory (with &lt;code&gt;vim.fs.root(0, &#39;package.json&#39;)&lt;/code&gt;)&lt;/li&gt;
&lt;li&gt;the location of the globally installed &lt;code&gt;@sap/cds-dk&lt;/code&gt; module, based on where the &lt;code&gt;cds&lt;/code&gt; executable can be found&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;Then, &lt;code&gt;/node_modules&lt;/code&gt; is appended to each, and they&#39;re both passed to the &lt;code&gt;addpath&lt;/code&gt; function defined earlier.&lt;/p&gt;
&lt;p&gt;Once either or both these paths are in the &lt;code&gt;path&lt;/code&gt; option (depending on whether they exist or not), &lt;code&gt;gf&lt;/code&gt; based navigation can proceed successfully!&lt;/p&gt;
&lt;h2 id=&quot;wrapping-up&quot;&gt;Wrapping up&lt;/h2&gt;
&lt;p&gt;This was a quick configuration hack in an area of Neovim (well, Vim, I guess) that I hadn&#39;t previously much experience in. So it may need some more tweaking. But for now, it works well, as shown here:&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;https://qmacro.org/images/2025/08/neovim-nav.gif&quot; alt=&quot;navigation in Neovim&quot;&gt;&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;In VS Code each newly navigated-to resource was opened in a separate tab by default. In Neovim they&#39;re opened in the same buffer, so to return to the previous resource in the &amp;quot;jump list&amp;quot; one can use &lt;code&gt;ctrl-o&lt;/code&gt;.&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h2 id=&quot;see-also&quot;&gt;See also&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;https://qmacro.org/blog/posts/2025/06/10/a-modern-and-clean-neovim-setup-for-cap-node-js-configuration-and-diagnostics/&quot;&gt;A modern and clean Neovim setup for CAP Node.js - configuration and diagnostics&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;https://qmacro.org/blog/posts/2025/08/04/excluding-specific-diagnostics-in-neovim/&quot;&gt;Excluding specific diagnostics in Neovim&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
</content>
  </entry>
  <entry>
    <title>Excluding specific diagnostics in Neovim</title>
    <link href="https://qmacro.org/blog/posts/2025/08/04/excluding-specific-diagnostics-in-neovim/" />
    <updated>2025-08-04T00:00:00Z</updated>
    <id>https://qmacro.org/blog/posts/2025/08/04/excluding-specific-diagnostics-in-neovim/</id>
    <content type="html">&lt;p&gt;Note: I&#39;m still learning (a) Lua, (b) the API surface of Neovim and (c) how the different core components interact and work together, so this may not be the best solution, but it works for me and I&#39;ve learned a lot digging in and putting it together.&lt;/p&gt;
&lt;p&gt;I recently revisited my Neovim config, with a view to updating and simplifying it with the advent of release 0.11. I covered some of this in my last Neovim related post &lt;a href=&quot;https://qmacro.org/blog/posts/2025/06/10/a-modern-and-clean-neovim-setup-for-cap-node-js-configuration-and-diagnostics/&quot;&gt;A modern and clean Neovim setup for CAP Node.js - configuration and diagnostics&lt;/a&gt;. In that context, when editing Node.js (JavaScript) files, everything worked nicely with regards to the Language Server and how the diagnostics were surfaced.&lt;/p&gt;
&lt;h2 id=&quot;a-desire-to-filter-out-a-specific-diagnostic&quot;&gt;A desire to filter out a specific diagnostic&lt;/h2&gt;
&lt;p&gt;That is, everything worked nicely ... with one annoyance - the hint level diagnostic &amp;quot;File is a CommonJS module&amp;quot; shown here on line 1:&lt;/p&gt;
&lt;pre class=&quot;language-text&quot; tabindex=&quot;0&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;H   1 const cds = require(&#39;@sap/cds&#39;)     ■ File is a CommonJS module; it may be converted to an ES module.
    2 module.exports = cds.service.impl(function() {
    3   this.after(&#39;each&#39;, &#39;Books&#39;, book =&gt; {
    4     console.log(book
E   5   })     ■ &#39;,&#39; expected.
    6 })&lt;/code&gt;&lt;/pre&gt;
&lt;blockquote&gt;
&lt;p&gt;For this sample display I&#39;d temporarily changed my preferred config so that all diagnostics are shown, as virtual text, rather than virtual lines, like this:&lt;/p&gt;
&lt;pre class=&quot;language-text&quot; tabindex=&quot;0&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;:lua vim.diagnostic.config({virtual_lines = false, virtual_text = true})&lt;/code&gt;&lt;/pre&gt;
&lt;/blockquote&gt;
&lt;p&gt;So I wanted the language server to still publish diagnostics, but for me to be able to filter them.&lt;/p&gt;
&lt;h2 id=&quot;digging-into-the-neovim-docu&quot;&gt;Digging into the Neovim docu&lt;/h2&gt;
&lt;p&gt;In order to achieve this, I spent a pleasant morning today looking through the documentation and getting a better understanding of the API with respect to these features of Neovim (the links are to the documentation sections that are important here):&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;https://neovim.io/doc/user/diagnostic.html&quot;&gt;Diagnostic framework&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;https://neovim.io/doc/user/lsp.html&quot;&gt;LSP client / framework&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;https://neovim.io/doc/user/lua.html&quot;&gt;Lua engine&lt;/a&gt; (including the &lt;code&gt;vim&lt;/code&gt; table-related functions)&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id=&quot;the-general-idea&quot;&gt;The general idea&lt;/h2&gt;
&lt;p&gt;Neovim has mechanisms for firing up language servers, connecting to them and making their features and functionality available in buffers. It also has facilities for managing diagnostics and surfacing them in different ways.&lt;/p&gt;
&lt;p&gt;With regards to diagnostics, a simplified flow between Neovim and a language server looks generally like this:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Neovim attaches to a language server, sending the contents of the buffer to it for analysis&lt;/li&gt;
&lt;li&gt;The language server publishes hint, information, warning and error level diagnostics (via &lt;a href=&quot;https://code.visualstudio.com/api/language-extensions/programmatic-language-features#provide-diagnostics&quot;&gt;textDocument/publishDiagnostics&lt;/a&gt;)&lt;/li&gt;
&lt;li&gt;These diagnostics are stored in Neovim via a call to &lt;code&gt;vim.diagnostic.set&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;Depending on the configuration, the diagnostics are displayed appropriately in the buffer&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;While I first went down the path of trying to add a filter in the last part (diagnostic display), I found that this was ultimately the wrong way to go about it, not least because I would have found myself having to override all the various diagnostic display affordances such as signs, virtual text, and so on.&lt;/p&gt;
&lt;p&gt;The key was to interrupt the &lt;em&gt;setting&lt;/em&gt; of the diagnostics so that I could filter some out before they were actually stored, which meant overriding &lt;code&gt;vim.diagnostic.set&lt;/code&gt;.&lt;/p&gt;
&lt;h2 id=&quot;examining-the-anatomy-of-a-diagnostic&quot;&gt;Examining the anatomy of a diagnostic&lt;/h2&gt;
&lt;p&gt;Understanding what a diagnostic looked like helped me enormously. In the JavaScript sample above, these two diagnostics are displayed:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;(H)INT 80001: File is a CommonJS module; it may be converted to an ES module.&lt;/li&gt;
&lt;li&gt;(E)RROR 1005: &#39;,&#39; expected&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;We can look at what these are via &lt;code&gt;vim.diagnostic.get&lt;/code&gt;. Invoking this:&lt;/p&gt;
&lt;pre class=&quot;language-text&quot; tabindex=&quot;0&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;:lua print(vim.diagnostic.get())&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;will just emit a table reference, something like this:&lt;/p&gt;
&lt;pre class=&quot;language-text&quot; tabindex=&quot;0&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;table: 0x68251cb7dca8&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;But we can use the &lt;code&gt;vim.print&lt;/code&gt; function instead:&lt;/p&gt;
&lt;pre class=&quot;language-text&quot; tabindex=&quot;0&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;:lua vim.print(vim.diagnostic.get())&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;or even simply the &lt;code&gt;=&lt;/code&gt; mechanism:&lt;/p&gt;
&lt;pre class=&quot;language-text&quot; tabindex=&quot;0&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;:lua =vim.diagnostic.get()&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;and this will cause a formatted display of the table contents:&lt;/p&gt;
&lt;pre class=&quot;language-lua&quot; tabindex=&quot;0&quot;&gt;&lt;code class=&quot;language-lua&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    bufnr &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
    code &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;1005&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
    col &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;2&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
    end_col &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;3&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
    end_lnum &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;4&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
    lnum &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;4&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
    message &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;&#39;,&#39; expected.&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
    namespace &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;7&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
    severity &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
    source &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;typescript&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
    user_data &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
      lsp &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
        code &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;1005&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
        message &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;&#39;,&#39; expected.&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
        range &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
          &lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;end&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
            character &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;3&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
            line &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;4&lt;/span&gt;
          &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
          start &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
            character &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;2&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
            line &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;4&lt;/span&gt;
          &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
        &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
        severity &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
        source &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;typescript&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
        tags &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
      &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
  &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    bufnr &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
    code &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;80001&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
    col &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;12&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
    end_col &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;31&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
    end_lnum &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
    lnum &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
    message &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;File is a CommonJS module; it may be converted to an ES module.&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
    namespace &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;7&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
    severity &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;4&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
    source &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;typescript&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
    user_data &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
      lsp &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
        code &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;80001&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
        message &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;File is a CommonJS module; it may be converted to an ES module.&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
        range &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
          &lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;end&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
            character &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;31&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
            line &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt;
          &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
          start &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
            character &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;12&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
            line &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt;
          &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
        &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
        severity &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;4&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
        source &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;typescript&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
        tags &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
      &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
  &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;I decided that I would want to filter on &lt;code&gt;code&lt;/code&gt; and &lt;code&gt;source&lt;/code&gt;; the &lt;code&gt;source&lt;/code&gt; for both diagnostics here is &lt;code&gt;typescript&lt;/code&gt;, and the &lt;code&gt;code&lt;/code&gt; values are actually shown in the virtual text display already (&lt;code&gt;80001&lt;/code&gt; and &lt;code&gt;1005&lt;/code&gt;).&lt;/p&gt;
&lt;h2 id=&quot;how-diagnostics-are-set&quot;&gt;How diagnostics are set&lt;/h2&gt;
&lt;p&gt;Diagnostics find their way from the language server back into Neovim via &lt;code&gt;vim.diagnostic.set&lt;/code&gt; which &lt;a href=&quot;https://neovim.io/doc/user/diagnostic.html#vim.diagnostic.set()&quot;&gt;has this signature&lt;/a&gt;:&lt;/p&gt;
&lt;pre class=&quot;language-text&quot; tabindex=&quot;0&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;set({namespace}, {bufnr}, {diagnostics}, {opts})&lt;/code&gt;&lt;/pre&gt;
&lt;blockquote&gt;
&lt;p&gt;I was curious as to what the namespace was; the value is shown as &lt;code&gt;7&lt;/code&gt; for both diagnostic records above; looking at the namespaces with &lt;code&gt;:lua =vim.api.nvim_get_namespaces()&lt;/code&gt; shows this:&lt;/p&gt;
&lt;pre class=&quot;language-lua&quot; tabindex=&quot;0&quot;&gt;&lt;code class=&quot;language-lua&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
  lazy &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;2&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
  &lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;nvim.hlyank&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;5&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
  &lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;nvim.lsp.references&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;3&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
  &lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;nvim.lsp.semantic_tokens&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;8&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
  &lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;nvim.lsp.semantic_tokens:1&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;9&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
  &lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;nvim.lsp.signature_help&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;6&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
  &lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;nvim.terminal.prompt&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
  &lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;nvim.treesitter.highlighter&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;4&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
  &lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;nvim.vim.lsp.javascript.1.diagnostic.signs&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;11&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
  &lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;nvim.vim.lsp.javascript.1.diagnostic.underline&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;12&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
  &lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;nvim.vim.lsp.javascript.1.diagnostic.virtual_lines&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;10&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
  &lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;vim.lsp.javascript.1&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;7&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;which confirms that they&#39;re coming from the language server for TypeScript/JavaScript.&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h3 id=&quot;injecting-a-filter-into-vim-diagnostic-set&quot;&gt;Injecting a filter into vim.diagnostic.set&lt;/h3&gt;
&lt;p&gt;Once I understood this, I was able to create a simple module (it&#39;s my first real foray into custom modules, so I may be doing this suboptimally), in &lt;code&gt;~/.config/nvim/lua/qmacro/diagnostic.lua&lt;/code&gt;:&lt;/p&gt;
&lt;pre class=&quot;language-lua&quot; tabindex=&quot;0&quot;&gt;&lt;code class=&quot;language-lua&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;local&lt;/span&gt; M &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;

&lt;span class=&quot;token keyword&quot;&gt;local&lt;/span&gt; original_vim_diagnostic_set &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; vim&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;diagnostic&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;set

&lt;span class=&quot;token keyword&quot;&gt;local&lt;/span&gt; filterbuilder &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;function&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;filters&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
  &lt;span class=&quot;token keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;function&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;diagnostic&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;for&lt;/span&gt; _&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; e &lt;span class=&quot;token keyword&quot;&gt;in&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;pairs&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;filters&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;do&lt;/span&gt;
      &lt;span class=&quot;token keyword&quot;&gt;if&lt;/span&gt; e&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;code &lt;span class=&quot;token operator&quot;&gt;==&lt;/span&gt; diagnostic&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;code &lt;span class=&quot;token keyword&quot;&gt;and&lt;/span&gt; e&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;source &lt;span class=&quot;token operator&quot;&gt;==&lt;/span&gt; diagnostic&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;source &lt;span class=&quot;token keyword&quot;&gt;then&lt;/span&gt;
        &lt;span class=&quot;token comment&quot;&gt;-- if e.reason then&lt;/span&gt;
        &lt;span class=&quot;token comment&quot;&gt;--   print(&#39;Filtering out&#39;, diagnostic.source, &#39;/&#39;, diagnostic.code, &#39;diagnostic -&#39;, e.reason)&lt;/span&gt;
        &lt;span class=&quot;token comment&quot;&gt;-- end&lt;/span&gt;
        &lt;span class=&quot;token keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;false&lt;/span&gt;
      &lt;span class=&quot;token keyword&quot;&gt;end&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;end&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;true&lt;/span&gt;
  &lt;span class=&quot;token keyword&quot;&gt;end&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;end&lt;/span&gt;

M&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;exclude &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;function&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;filters&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
  vim&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;diagnostic&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;set &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;function&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;ns&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; bufnr&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; diagnostics&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; opts&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;local&lt;/span&gt; filtered_diagnostics &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; vim&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;tbl_filter&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;filterbuilder&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;filters&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; diagnostics&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
    &lt;span class=&quot;token function&quot;&gt;original_vim_diagnostic_set&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;ns&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; bufnr&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; filtered_diagnostics&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; opts&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
  &lt;span class=&quot;token keyword&quot;&gt;end&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;end&lt;/span&gt;

&lt;span class=&quot;token keyword&quot;&gt;return&lt;/span&gt; M&lt;/code&gt;&lt;/pre&gt;
&lt;h3 id=&quot;using-the-module&quot;&gt;Using the module&lt;/h3&gt;
&lt;p&gt;Before walking through this, I thought it would help to show how I want to call this, from within my &lt;code&gt;~/.config/nvim/init.lua&lt;/code&gt;:&lt;/p&gt;
&lt;pre class=&quot;language-lua&quot; tabindex=&quot;0&quot;&gt;&lt;code class=&quot;language-lua&quot;&gt;&lt;span class=&quot;token function&quot;&gt;require&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&#39;qmacro.diagnostic&#39;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;exclude&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
  &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt; code &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;80001&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; source &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&#39;typescript&#39;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; reason &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&#39;yes I know already!&#39;&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;In calling the &lt;code&gt;exclude&lt;/code&gt; function in this module, I can pass a table of exclude filters, each of which has a &lt;code&gt;code&lt;/code&gt; and &lt;code&gt;source&lt;/code&gt; field, and an optional &lt;code&gt;reason&lt;/code&gt; field.&lt;/p&gt;
&lt;h3 id=&quot;a-walkthrough-of-the-module&quot;&gt;A walkthrough of the module&lt;/h3&gt;
&lt;p&gt;Now here&#39;s a brief breakdown of the module:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;I save the original &lt;code&gt;vim.diagnostic.set&lt;/code&gt; function in &lt;code&gt;original_vim_diagnostic_set&lt;/code&gt; so I can call it later&lt;/li&gt;
&lt;li&gt;The &lt;code&gt;filterbuilder&lt;/code&gt; function takes a table of filters and produces a function (yes, I like higher order functions), specifically a predicate function, that can be then used with &lt;a href=&quot;https://neovim.io/doc/user/lua.html#vim.tbl_filter()&quot;&gt;vim.tbl_filter&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;The predicate function produced also has some commented-out logging (that uses the optional &lt;code&gt;reason&lt;/code&gt; field from the filter entry) that I&#39;ll make good once I figure out the best way to log stuff cleanly and in accordance with standard levels&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;With all that preparation, all that I then have to do is:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Override the standard &lt;code&gt;vim.diagnostic.set&lt;/code&gt; function with one that injects a call to &lt;code&gt;vim.tbl_filter&lt;/code&gt; to remove any diagnostics that are caught by the exclude filters, before passing through the modified table and the rest of the original arguments to the original &lt;code&gt;vim.diagnostic.set&lt;/code&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;And that&#39;s pretty much it.&lt;/p&gt;
&lt;h2 id=&quot;wrapping-up&quot;&gt;Wrapping up&lt;/h2&gt;
&lt;p&gt;This works for me so far, and getting to this stage has also taught me some more about Neovim&#39;s Lua API and various components.&lt;/p&gt;
&lt;p&gt;I added this setup to my Neovim configuration with &lt;a href=&quot;https://github.com/qmacro/dotfiles/commit/fb3272c121a5acd7610dc21aceb3a7bb53190257&quot;&gt;this commit to my dotfiles&lt;/a&gt;.&lt;/p&gt;
&lt;p&gt;Along with the Neovim documentation itself, the following resources helped clarify things in my mind:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;https://influentcoder.com/posts/nvim-diagnostics/&quot;&gt;Understanding Diagnostics in Neovim&lt;/a&gt; by Guillaume Humbert&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;https://blob42.xyz/blog/neovim-diagnostic-filtering/&quot;&gt;Filtering Neovim Diagnostics&lt;/a&gt; by Chakib Benziane&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;https://www.youtube.com/playlist?list=PLep05UYkc6wTyBe7kPjQFWVXTlhKeQejM&quot;&gt;Advent of Neovim&lt;/a&gt; by TJ DeVries&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;Thanks!&lt;/p&gt;
&lt;h2 id=&quot;see-also&quot;&gt;See also&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;https://qmacro.org/blog/posts/2025/06/10/a-modern-and-clean-neovim-setup-for-cap-node-js-configuration-and-diagnostics/&quot;&gt;A modern and clean Neovim setup for CAP Node.js - configuration and diagnostics&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;https://qmacro.org/blog/posts/2025/08/06/neovim-configuration-for-file-and-module-navigation-in-cds-models/&quot;&gt;Neovim configuration for file and module navigation in CDS models&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
</content>
  </entry>
  <entry>
    <title>A reCAP intro to the cds REPL</title>
    <link href="https://qmacro.org/blog/posts/2025/07/21/a-recap-intro-to-the-cds-repl/" />
    <updated>2025-07-21T00:00:00Z</updated>
    <id>https://qmacro.org/blog/posts/2025/07/21/a-recap-intro-to-the-cds-repl/</id>
    <content type="html">&lt;p&gt;At &lt;a href=&quot;https://recap-conf.dev/&quot;&gt;reCAP&lt;/a&gt;, part of &lt;a href=&quot;https://code-connect.dev/&quot;&gt;Code Connect 2025&lt;/a&gt;, I gave a talk on the cds REPL: &amp;quot;Gain a superpower by learning how to harness the cds REPL&amp;quot;. You can watch the recording on the &lt;a href=&quot;https://broadcast.sap.com/replay/250709_recap#&quot;&gt;replay site&lt;/a&gt;; this post is a sort of summary and accompaniment, and an extension to &lt;a href=&quot;https://qmacro.org/blog/posts/2025/03/21/level-up-your-cap-skills-by-learning-how-to-use-the-cds-repl/&quot;&gt;my previous post on the topic&lt;/a&gt;. Read this post while watching the replay.&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;https://qmacro.org/images/2025/07/audimax-shot.png&quot; alt=&quot;A selfie with the audience&quot;&gt;&lt;/p&gt;
&lt;h2 id=&quot;setting-up&quot;&gt;Setting up&lt;/h2&gt;
&lt;p&gt;Using my &lt;a href=&quot;https://github.com/qmacro/cap-con-img/&quot;&gt;cap-con-img&lt;/a&gt; repo I built an image with the (at the time) latest CAP Node.js release which was 9.1.0 and launched a throwaway (&lt;code&gt;--rm&lt;/code&gt;) container from it (I actually used &lt;code&gt;./buildver latest&lt;/code&gt; which will also work but today will give you a newer version of course):&lt;/p&gt;
&lt;pre class=&quot;language-bash&quot; tabindex=&quot;0&quot;&gt;&lt;code class=&quot;language-bash&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt; gh repo clone https://github.com/qmacro/cap-con-img &lt;span class=&quot;token punctuation&quot;&gt;&#92;&lt;/span&gt;
  &lt;span class=&quot;token operator&quot;&gt;&amp;amp;&amp;amp;&lt;/span&gt; &lt;span class=&quot;token builtin class-name&quot;&gt;cd&lt;/span&gt; cap-con-img &lt;span class=&quot;token punctuation&quot;&gt;&#92;&lt;/span&gt;
  &lt;span class=&quot;token operator&quot;&gt;&amp;amp;&amp;amp;&lt;/span&gt; ./buildbase &lt;span class=&quot;token punctuation&quot;&gt;&#92;&lt;/span&gt;
  &lt;span class=&quot;token operator&quot;&gt;&amp;amp;&amp;amp;&lt;/span&gt; ./buildver &lt;span class=&quot;token number&quot;&gt;9.1&lt;/span&gt;.0 &lt;span class=&quot;token punctuation&quot;&gt;&#92;&lt;/span&gt;
  &lt;span class=&quot;token operator&quot;&gt;&amp;amp;&amp;amp;&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;docker&lt;/span&gt; run &lt;span class=&quot;token parameter variable&quot;&gt;--rm&lt;/span&gt; &lt;span class=&quot;token parameter variable&quot;&gt;-it&lt;/span&gt; cap-9.1.0 &lt;span class=&quot;token function&quot;&gt;bash&lt;/span&gt;
&lt;span class=&quot;token function&quot;&gt;node&lt;/span&gt; ➜ ~
$&lt;/code&gt;&lt;/pre&gt;
&lt;blockquote&gt;
&lt;p&gt;For orientation, my local shell prompt is &lt;code&gt;;&lt;/code&gt;, the shell prompt inside the container is &lt;code&gt;$&lt;/code&gt; and the cds REPL prompt will be &lt;code&gt;&amp;gt;&lt;/code&gt;.&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;Once at the container shell prompt I initialised a new CAP project based on the &lt;code&gt;tiny-sample&lt;/code&gt; facet, installing &lt;code&gt;@sap-cloud-sdk/http-client&lt;/code&gt; too, as I&#39;ll need that towards the end of the talk:&lt;/p&gt;
&lt;pre class=&quot;language-bash&quot; tabindex=&quot;0&quot;&gt;&lt;code class=&quot;language-bash&quot;&gt;$ cds init &lt;span class=&quot;token parameter variable&quot;&gt;--add&lt;/span&gt; tiny-sample tiny-sample &lt;span class=&quot;token punctuation&quot;&gt;&#92;&lt;/span&gt;
  &lt;span class=&quot;token operator&quot;&gt;&amp;amp;&amp;amp;&lt;/span&gt; &lt;span class=&quot;token builtin class-name&quot;&gt;cd&lt;/span&gt; tiny-sample &lt;span class=&quot;token punctuation&quot;&gt;&#92;&lt;/span&gt;
  &lt;span class=&quot;token operator&quot;&gt;&amp;amp;&amp;amp;&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;npm&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;add&lt;/span&gt; @sap-cloud-sdk/http-client&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;Here&#39;s what the entire project structure (minus the &lt;code&gt;node_modules/&lt;/code&gt; content) looks like:&lt;/p&gt;
&lt;pre class=&quot;language-bash&quot; tabindex=&quot;0&quot;&gt;&lt;code class=&quot;language-bash&quot;&gt;$ tree &lt;span class=&quot;token parameter variable&quot;&gt;-AI&lt;/span&gt; node*
&lt;span class=&quot;token builtin class-name&quot;&gt;.&lt;/span&gt;
├── README.md
├── app
├── db
│   ├── data
│   │   └── my.bookshop-Books.csv
│   └── schema.cds
├── eslint.config.mjs
├── package-lock.json
├── package.json
└── srv
    └── cat-service.cds&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;Then I started the cds REPL:&lt;/p&gt;
&lt;pre class=&quot;language-shell&quot; tabindex=&quot;0&quot;&gt;&lt;code class=&quot;language-shell&quot;&gt;$ cds repl
Welcome to cds repl &lt;span class=&quot;token function&quot;&gt;v&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;9.1&lt;/span&gt;.0
&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;It&#39;s also worth looking at the entire CDS model in source form, as it will provide the background for what I explore.&lt;/p&gt;
&lt;p&gt;At the &amp;quot;db&amp;quot; layer there is &lt;code&gt;db/schema.cds&lt;/code&gt;:&lt;/p&gt;
&lt;pre class=&quot;language-cds&quot; tabindex=&quot;0&quot;&gt;&lt;code class=&quot;language-cds&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;namespace&lt;/span&gt; my.bookshop;

&lt;span class=&quot;token keyword&quot;&gt;entity&lt;/span&gt; Books {
  &lt;span class=&quot;token cqlkeywords keyword&quot;&gt;key&lt;/span&gt; ID : &lt;span class=&quot;token type builtin&quot;&gt;Integer&lt;/span&gt;;
  title  : &lt;span class=&quot;token type builtin&quot;&gt;String&lt;/span&gt;;
  stock  : &lt;span class=&quot;token type builtin&quot;&gt;Integer&lt;/span&gt;;
}&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;At the &amp;quot;service&amp;quot; layer there is &lt;code&gt;srv/cat-service.cds&lt;/code&gt;:&lt;/p&gt;
&lt;pre class=&quot;language-cds&quot; tabindex=&quot;0&quot;&gt;&lt;code class=&quot;language-cds&quot;&gt;&lt;span class=&quot;token using keyword&quot;&gt;using&lt;/span&gt; my.bookshop &lt;span class=&quot;token cqlkeywords keyword&quot;&gt;as&lt;/span&gt; my &lt;span class=&quot;token from keyword&quot;&gt;from&lt;/span&gt; &#39;../db/schema&#39;;

&lt;span class=&quot;token keyword&quot;&gt;service&lt;/span&gt; CatalogService {
    &lt;span class=&quot;token annotation important&quot;&gt;@readonly&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;entity&lt;/span&gt; Books &lt;span class=&quot;token cqlkeywords keyword&quot;&gt;as&lt;/span&gt; &lt;span class=&quot;token cdl-keyword keyword&quot;&gt;projection&lt;/span&gt; &lt;span class=&quot;token cqlkeywords keyword&quot;&gt;on&lt;/span&gt; my.Books;
}&lt;/code&gt;&lt;/pre&gt;
&lt;h2 id=&quot;getting-help&quot;&gt;Getting help&lt;/h2&gt;
&lt;p&gt;The cds REPL is based on the Node.js REPL and asking for help shows the regular Node.js REPL commands plus &lt;code&gt;.run&lt;/code&gt; and &lt;code&gt;.inspect&lt;/code&gt; which are specific to the cds REPL:&lt;/p&gt;
&lt;pre class=&quot;language-shell&quot; tabindex=&quot;0&quot;&gt;&lt;code class=&quot;language-shell&quot;&gt;&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt; .help
.break     Sometimes you get stuck, this gets you out
.clear     Alias &lt;span class=&quot;token keyword&quot;&gt;for&lt;/span&gt; .break
.editor    Enter editor mode
.exit      Exit the REPL
.help      Print this &lt;span class=&quot;token builtin class-name&quot;&gt;help&lt;/span&gt; message
.inspect   Sets options &lt;span class=&quot;token keyword&quot;&gt;for&lt;/span&gt; util.inspect, e.g. &lt;span class=&quot;token variable&quot;&gt;&lt;span class=&quot;token variable&quot;&gt;`&lt;/span&gt;.inspect .depth&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;token variable&quot;&gt;`&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token builtin class-name&quot;&gt;.&lt;/span&gt;
.load      Load JS from a &lt;span class=&quot;token function&quot;&gt;file&lt;/span&gt; into the REPL session
.run       Runs a cds server from a given CAP project folder, or module name like @capire/bookshop.
.save      Save all evaluated commands &lt;span class=&quot;token keyword&quot;&gt;in&lt;/span&gt; this REPL session to a &lt;span class=&quot;token function&quot;&gt;file&lt;/span&gt;

Press Ctrl+C to abort current expression, Ctrl+D to &lt;span class=&quot;token builtin class-name&quot;&gt;exit&lt;/span&gt; the REPL&lt;/code&gt;&lt;/pre&gt;
&lt;h2 id=&quot;exploring-the-cds-facade-with-inspect&quot;&gt;Exploring the cds facade with .inspect&lt;/h2&gt;
&lt;p&gt;The &lt;a href=&quot;https://cap.cloud.sap/docs/node.js/cds-facade&quot;&gt;cds facade&lt;/a&gt; is a good place to start exploring. It contains a lot of detail, so I used the &lt;code&gt;.inspect&lt;/code&gt; feature to keep things to a minimum:&lt;/p&gt;
&lt;pre class=&quot;language-bash&quot; tabindex=&quot;0&quot;&gt;&lt;code class=&quot;language-bash&quot;&gt;&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt; .inspect .depth&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt; cds

cds: cds_facade &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
  _events: &lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;Object: null prototype&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;,
  _eventsCount: &lt;span class=&quot;token number&quot;&gt;2&lt;/span&gt;,
  _maxListeners: undefined,
  model: undefined,
  db: undefined,
  cli: &lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;Object&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;,
  root: &lt;span class=&quot;token string&quot;&gt;&#39;/home/node/tiny-sample&#39;&lt;/span&gt;,
  services: &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;,
  extend: &lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;Function &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;anonymous&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;,
  version: &lt;span class=&quot;token string&quot;&gt;&#39;9.1.0&#39;&lt;/span&gt;,
  builtin: &lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;Object&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;,
  service: &lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;Function&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;,
  log: &lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;Function&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;,
  parse: &lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;Function&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;,
  home: &lt;span class=&quot;token string&quot;&gt;&#39;/home/node/tiny-sample/node_modules/@sap/cds&#39;&lt;/span&gt;,
  env: &lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;Config&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;,
  requires: &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;,
  &lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;Symbol&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;shapeMode&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;: false,
  &lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;Symbol&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;kCapture&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;: &lt;span class=&quot;token boolean&quot;&gt;false&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;Running &lt;code&gt;.inspect .depth=N&lt;/code&gt; on its own will fix the detail level for subsequent inspections to N.&lt;/p&gt;
&lt;pre class=&quot;language-bash&quot; tabindex=&quot;0&quot;&gt;&lt;code class=&quot;language-bash&quot;&gt;&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt; .inspect .depth&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt;

updated node:util.inspect.defaultOptions with: &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt; depth: &lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;At this point there are no values for &lt;code&gt;db&lt;/code&gt;, &lt;code&gt;services&lt;/code&gt; or &lt;code&gt;model&lt;/code&gt; in the facade, because I&#39;ve not yet started any CAP server.&lt;/p&gt;
&lt;h2 id=&quot;starting-a-server-with-run&quot;&gt;Starting a server with .run&lt;/h2&gt;
&lt;p&gt;With &lt;code&gt;.run&lt;/code&gt; I started a CAP server based on the project in the current (&lt;code&gt;.&lt;/code&gt;) directory:&lt;/p&gt;
&lt;pre class=&quot;language-shell&quot; tabindex=&quot;0&quot;&gt;&lt;code class=&quot;language-shell&quot;&gt;&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt; .run &lt;span class=&quot;token builtin class-name&quot;&gt;.&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;..&lt;/span&gt;. &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;usual CAP server output&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
Following variables are made available &lt;span class=&quot;token keyword&quot;&gt;in&lt;/span&gt; your repl&#39;s global context:

from cds.entities: &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
  Books,
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;

from cds.services: &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
  db,
  CatalogService,
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;

Simply &lt;span class=&quot;token builtin class-name&quot;&gt;type&lt;/span&gt; e.g. CatalogService &lt;span class=&quot;token keyword&quot;&gt;in&lt;/span&gt; the prompt to use the respective objects.&lt;/code&gt;&lt;/pre&gt;
&lt;blockquote&gt;
&lt;p&gt;This can be done on launching the REPL too like this: &lt;code&gt;cds repl --run .&lt;/code&gt;, or &lt;code&gt;cds r -r .&lt;/code&gt; if you like short invocations.&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;Everything is a service, including the database facility (&lt;code&gt;db&lt;/code&gt;) as well as the &lt;code&gt;CatalogService&lt;/code&gt; defined in &lt;code&gt;srv/cat-service.cds&lt;/code&gt;.&lt;/p&gt;
&lt;p&gt;And there&#39;s also the &lt;code&gt;Books&lt;/code&gt; entity from &lt;code&gt;db/schema.cds&lt;/code&gt; (at this point I&#39;ve increased the &lt;code&gt;.inspect&lt;/code&gt; depth from 0 to 4):&lt;/p&gt;
&lt;pre class=&quot;language-javascript&quot; tabindex=&quot;0&quot;&gt;&lt;code class=&quot;language-javascript&quot;&gt;&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt; Books
entity &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
  &lt;span class=&quot;token literal-property property&quot;&gt;kind&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&#39;entity&#39;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
  &lt;span class=&quot;token literal-property property&quot;&gt;elements&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; LinkedDefinitions &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;token constant&quot;&gt;ID&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; Integer &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt; &lt;span class=&quot;token literal-property property&quot;&gt;key&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token boolean&quot;&gt;true&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token literal-property property&quot;&gt;type&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&#39;cds.Integer&#39;&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
    &lt;span class=&quot;token literal-property property&quot;&gt;title&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; String &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt; &lt;span class=&quot;token literal-property property&quot;&gt;type&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&#39;cds.String&#39;&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
    &lt;span class=&quot;token literal-property property&quot;&gt;stock&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; Integer &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt; &lt;span class=&quot;token literal-property property&quot;&gt;type&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&#39;cds.Integer&#39;&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
  &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;I then took a peek at some of the detail in the &lt;code&gt;CatalogService&lt;/code&gt;, specifically the &lt;code&gt;handlers&lt;/code&gt;, to show &lt;a href=&quot;https://qmacro.org/blog/posts/2024/11/07/five-reasons-to-use-cap/#1-the-code-is-in-the-framework-not-outside-of-it&quot;&gt;the built-in mechanisms&lt;/a&gt; - all those features one can read about in &lt;a href=&quot;https://cap.cloud.sap/docs/&quot;&gt;Capire&lt;/a&gt; such as auth checks, autoexposure, input validation, paging, sorting, and so on, plus the complete support for CRUD operations, is there:&lt;/p&gt;
&lt;pre class=&quot;language-javascript&quot; tabindex=&quot;0&quot;&gt;&lt;code class=&quot;language-javascript&quot;&gt;&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt; CatalogService&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;handlers
EventHandlers &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
  &lt;span class=&quot;token literal-property property&quot;&gt;_initial&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
      &lt;span class=&quot;token literal-property property&quot;&gt;before&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&#39;*&#39;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
      &lt;span class=&quot;token literal-property property&quot;&gt;handler&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;Function&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; check_service_level_restrictions&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt; &lt;span class=&quot;token literal-property property&quot;&gt;before&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&#39;*&#39;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token literal-property property&quot;&gt;handler&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;Function&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; check_auth_privileges&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt; &lt;span class=&quot;token literal-property property&quot;&gt;before&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&#39;*&#39;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token literal-property property&quot;&gt;handler&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;Function&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; check_readonly&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt; &lt;span class=&quot;token literal-property property&quot;&gt;before&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&#39;*&#39;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token literal-property property&quot;&gt;handler&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;Function&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; check_insertonly&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt; &lt;span class=&quot;token literal-property property&quot;&gt;before&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&#39;*&#39;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token literal-property property&quot;&gt;handler&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;Function&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; check_odata_constraints&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt; &lt;span class=&quot;token literal-property property&quot;&gt;before&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&#39;*&#39;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token literal-property property&quot;&gt;handler&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;Function&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; check_autoexposed&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt; &lt;span class=&quot;token literal-property property&quot;&gt;before&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&#39;*&#39;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token literal-property property&quot;&gt;handler&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;AsyncFunction&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; enforce_auth&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt; &lt;span class=&quot;token literal-property property&quot;&gt;before&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&#39;READ&#39;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token literal-property property&quot;&gt;handler&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;Function&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; restrict_expand&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt; &lt;span class=&quot;token literal-property property&quot;&gt;before&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&#39;CREATE&#39;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token literal-property property&quot;&gt;handler&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;AsyncFunction&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; validate_input&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt; &lt;span class=&quot;token literal-property property&quot;&gt;before&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&#39;UPDATE&#39;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token literal-property property&quot;&gt;handler&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;AsyncFunction&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; validate_input&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt; &lt;span class=&quot;token literal-property property&quot;&gt;before&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&#39;NEW&#39;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token literal-property property&quot;&gt;handler&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;AsyncFunction&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; validate_input&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt; &lt;span class=&quot;token literal-property property&quot;&gt;before&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&#39;READ&#39;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token literal-property property&quot;&gt;handler&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;Function&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; handle_paging&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt; &lt;span class=&quot;token literal-property property&quot;&gt;before&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&#39;READ&#39;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token literal-property property&quot;&gt;handler&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;Function&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; handle_sorting&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
  &lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
  &lt;span class=&quot;token literal-property property&quot;&gt;before&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
  &lt;span class=&quot;token literal-property property&quot;&gt;on&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt; &lt;span class=&quot;token literal-property property&quot;&gt;on&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&#39;CREATE&#39;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token literal-property property&quot;&gt;handler&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;AsyncFunction&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; handle_crud_requests&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt; &lt;span class=&quot;token literal-property property&quot;&gt;on&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&#39;READ&#39;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token literal-property property&quot;&gt;handler&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;AsyncFunction&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; handle_crud_requests&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt; &lt;span class=&quot;token literal-property property&quot;&gt;on&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&#39;UPDATE&#39;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token literal-property property&quot;&gt;handler&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;AsyncFunction&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; handle_crud_requests&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt; &lt;span class=&quot;token literal-property property&quot;&gt;on&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&#39;DELETE&#39;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token literal-property property&quot;&gt;handler&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;AsyncFunction&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; handle_crud_requests&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt; &lt;span class=&quot;token literal-property property&quot;&gt;on&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&#39;UPSERT&#39;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token literal-property property&quot;&gt;handler&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;AsyncFunction&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; handle_crud_requests&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
  &lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
  &lt;span class=&quot;token literal-property property&quot;&gt;after&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
  &lt;span class=&quot;token literal-property property&quot;&gt;_error&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;
&lt;h2 id=&quot;understanding-entities-at-different-levels&quot;&gt;Understanding entities at different levels&lt;/h2&gt;
&lt;p&gt;With the &lt;a href=&quot;https://qmacro.org/blog/posts/2025/07/21/a-recap-intro-to-the-cds-repl/#cds-model&quot;&gt;CDS model&lt;/a&gt; in mind, I stopped for a moment to look at the difference between what the injected variable &lt;code&gt;Books&lt;/code&gt; represents (shown just above), and what the expanded &amp;quot;service-equivalent&amp;quot; looks like, in &lt;code&gt;CatalogService.entities&lt;/code&gt;, which I first extracted using a destructuring assignment:&lt;/p&gt;
&lt;pre class=&quot;language-javascript&quot; tabindex=&quot;0&quot;&gt;&lt;code class=&quot;language-javascript&quot;&gt;&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt; &lt;span class=&quot;token literal-property property&quot;&gt;Books&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; mybooks &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; CatalogService&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;entities
&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;object Function&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;and then inspected:&lt;/p&gt;
&lt;pre class=&quot;language-javascript&quot; tabindex=&quot;0&quot;&gt;&lt;code class=&quot;language-javascript&quot;&gt;&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt; mybooks
entity &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
  &lt;span class=&quot;token literal-property property&quot;&gt;kind&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&#39;entity&#39;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
  &lt;span class=&quot;token string-property property&quot;&gt;&#39;@readonly&#39;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token boolean&quot;&gt;true&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
  &lt;span class=&quot;token literal-property property&quot;&gt;projection&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt; &lt;span class=&quot;token literal-property property&quot;&gt;from&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt; &lt;span class=&quot;token literal-property property&quot;&gt;ref&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&#39;my.bookshop.Books&#39;&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
  &lt;span class=&quot;token literal-property property&quot;&gt;elements&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; LinkedDefinitions &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;token constant&quot;&gt;ID&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; Integer &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt; &lt;span class=&quot;token literal-property property&quot;&gt;key&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token boolean&quot;&gt;true&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token literal-property property&quot;&gt;type&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&#39;cds.Integer&#39;&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
    &lt;span class=&quot;token literal-property property&quot;&gt;title&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; String &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt; &lt;span class=&quot;token literal-property property&quot;&gt;type&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&#39;cds.String&#39;&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
    &lt;span class=&quot;token literal-property property&quot;&gt;stock&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; Integer &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt; &lt;span class=&quot;token literal-property property&quot;&gt;type&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&#39;cds.Integer&#39;&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
  &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
  &lt;span class=&quot;token string-property property&quot;&gt;&#39;@Capabilities.DeleteRestrictions.Deletable&#39;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token boolean&quot;&gt;false&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
  &lt;span class=&quot;token string-property property&quot;&gt;&#39;@Capabilities.InsertRestrictions.Insertable&#39;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token boolean&quot;&gt;false&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
  &lt;span class=&quot;token string-property property&quot;&gt;&#39;@Capabilities.UpdateRestrictions.Updatable&#39;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token boolean&quot;&gt;false&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;What&#39;s different is that this &amp;quot;version&amp;quot; is a projection on the &lt;code&gt;Books&lt;/code&gt; entity (in the &lt;code&gt;my.bookshop&lt;/code&gt; namespace), defined by a query object construct, there&#39;s a &lt;code&gt;@readonly&lt;/code&gt; annotation defined upon it, which in turn &lt;a href=&quot;https://cap.cloud.sap/docs/guides/security/authorization#restricting-events&quot;&gt;expand into&lt;/a&gt; the &lt;code&gt;@Capabilities&lt;/code&gt; based restrictions seen here.&lt;/p&gt;
&lt;h2 id=&quot;building-and-executing-query-objects&quot;&gt;Building and executing query objects&lt;/h2&gt;
&lt;p&gt;In CAP query objects are first class citizens and essential to our understanding of the fundamentals. They&#39;re constructed at a core level with &lt;a href=&quot;https://cap.cloud.sap/docs/node.js/cds-ql&quot;&gt;cds.ql&lt;/a&gt; but there are also higher level APIs such as the &lt;a href=&quot;https://cap.cloud.sap/docs/node.js/core-services#crud-style-api&quot;&gt;CRUD-style API&lt;/a&gt; which I used here, assigning the object directly to a variable:&lt;/p&gt;
&lt;pre class=&quot;language-javascript&quot; tabindex=&quot;0&quot;&gt;&lt;code class=&quot;language-javascript&quot;&gt;&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt; thebooks &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; CatalogService&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;read&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;mybooks&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
cds&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;ql &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
  &lt;span class=&quot;token constant&quot;&gt;SELECT&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt; &lt;span class=&quot;token literal-property property&quot;&gt;from&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt; &lt;span class=&quot;token literal-property property&quot;&gt;ref&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&#39;CatalogService.Books&#39;&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;To &lt;a href=&quot;https://cap.cloud.sap/docs/node.js/cds-ql#executing-queries&quot;&gt;execute the query&lt;/a&gt; I used &lt;code&gt;await&lt;/code&gt;, which by default passes the query to &lt;code&gt;cds.db.run()&lt;/code&gt;:&lt;/p&gt;
&lt;pre class=&quot;language-javascript&quot; tabindex=&quot;0&quot;&gt;&lt;code class=&quot;language-javascript&quot;&gt;&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;await&lt;/span&gt; thebooks
&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;
  &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt; &lt;span class=&quot;token constant&quot;&gt;ID&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token literal-property property&quot;&gt;title&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&#39;Wuthering Heights&#39;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token literal-property property&quot;&gt;stock&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;100&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
  &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt; &lt;span class=&quot;token constant&quot;&gt;ID&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;2&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token literal-property property&quot;&gt;title&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&#39;Jane Eyre&#39;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token literal-property property&quot;&gt;stock&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;500&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;In other words, this is the same as:&lt;/p&gt;
&lt;pre class=&quot;language-javascript&quot; tabindex=&quot;0&quot;&gt;&lt;code class=&quot;language-javascript&quot;&gt;&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;await&lt;/span&gt; db&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;run&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;thebooks&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;because I still have the &lt;code&gt;db&lt;/code&gt; variable that was automatically made available in the REPL session&#39;s global context.&lt;/p&gt;
&lt;p&gt;Queries can be extended, which I did at this point:&lt;/p&gt;
&lt;pre class=&quot;language-javascript&quot; tabindex=&quot;0&quot;&gt;&lt;code class=&quot;language-javascript&quot;&gt;&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;await&lt;/span&gt; thebooks&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;where&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;token string-property property&quot;&gt;&#39;stock&#39;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;token string-property property&quot;&gt;&#39;&gt;&#39;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;100&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt; &lt;span class=&quot;token constant&quot;&gt;ID&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;2&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token literal-property property&quot;&gt;title&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&#39;Jane Eyre&#39;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token literal-property property&quot;&gt;stock&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;500&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;
&lt;blockquote&gt;
&lt;p&gt;Beware, this will modify the query object:&lt;/p&gt;
&lt;pre class=&quot;language-javascript&quot; tabindex=&quot;0&quot;&gt;&lt;code class=&quot;language-javascript&quot;&gt;&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt; thebooks
cds&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;ql &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
  &lt;span class=&quot;token constant&quot;&gt;SELECT&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;token literal-property property&quot;&gt;from&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt; &lt;span class=&quot;token literal-property property&quot;&gt;ref&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&#39;CatalogService.Books&#39;&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
    &lt;span class=&quot;token literal-property property&quot;&gt;where&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt; &lt;span class=&quot;token literal-property property&quot;&gt;ref&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&#39;stock&#39;&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&#39;&gt;&#39;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt; &lt;span class=&quot;token literal-property property&quot;&gt;val&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;100&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;
  &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;
&lt;/blockquote&gt;
&lt;h2 id=&quot;creating-a-service-from-scratch&quot;&gt;Creating a service from scratch&lt;/h2&gt;
&lt;p&gt;As well as defining a service (such as &lt;code&gt;CatalogService&lt;/code&gt;) in the CDS model, it&#39;s possible to create a service from the ground up, which I illustrated next:&lt;/p&gt;
&lt;pre class=&quot;language-javascript&quot; tabindex=&quot;0&quot;&gt;&lt;code class=&quot;language-javascript&quot;&gt;&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt; srv &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;cds&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;Service&lt;/span&gt;
Service &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
  &lt;span class=&quot;token literal-property property&quot;&gt;name&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&#39;Service&#39;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
  &lt;span class=&quot;token literal-property property&quot;&gt;options&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
  &lt;span class=&quot;token literal-property property&quot;&gt;handlers&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; EventHandlers &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;token literal-property property&quot;&gt;_initial&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
    &lt;span class=&quot;token literal-property property&quot;&gt;before&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
    &lt;span class=&quot;token literal-property property&quot;&gt;on&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
    &lt;span class=&quot;token literal-property property&quot;&gt;after&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
    &lt;span class=&quot;token literal-property property&quot;&gt;_error&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;
  &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
  &lt;span class=&quot;token literal-property property&quot;&gt;definition&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;undefined&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;This is like an &amp;quot;empty&amp;quot; version of the service I looked at before - for example, there are no handlers defined.&lt;/p&gt;
&lt;p&gt;That doesn&#39;t prevent the sending of messages; it&#39;s just that nothing will happen, as I then demonstrated:&lt;/p&gt;
&lt;pre class=&quot;language-javascript&quot; tabindex=&quot;0&quot;&gt;&lt;code class=&quot;language-javascript&quot;&gt;&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;await&lt;/span&gt; srv&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;send&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&#39;recap&#39;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt; &lt;span class=&quot;token literal-property property&quot;&gt;is&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;awesome&quot;&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;At this point I defined a super simple handler for the &lt;code&gt;recap&lt;/code&gt; event (remember, a handler definition is essentially a function, so &lt;code&gt;console.log&lt;/code&gt; will do just fine here):&lt;/p&gt;
&lt;pre class=&quot;language-javascript&quot; tabindex=&quot;0&quot;&gt;&lt;code class=&quot;language-javascript&quot;&gt;&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt; srv&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;on&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&#39;recap&#39;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; console&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;log&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;This time, because of the definition of the &lt;code&gt;on&lt;/code&gt; phase handler for this event named &lt;code&gt;recap&lt;/code&gt;, the data is passed to the handler function, which outputs it:&lt;/p&gt;
&lt;pre class=&quot;language-javascript&quot; tabindex=&quot;0&quot;&gt;&lt;code class=&quot;language-javascript&quot;&gt;&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;await&lt;/span&gt; srv&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;send&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&#39;recap&#39;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt; &lt;span class=&quot;token literal-property property&quot;&gt;is&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;awesome&quot;&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
Request &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt; &lt;span class=&quot;token literal-property property&quot;&gt;method&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&#39;recap&#39;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token literal-property property&quot;&gt;data&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt; &lt;span class=&quot;token literal-property property&quot;&gt;is&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&#39;awesome&#39;&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;AsyncFunction&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; next&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;This is what was shown in the output:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;what is being passed is an object of type &lt;code&gt;Request&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;the content of the &lt;code&gt;Request&lt;/code&gt;, an object containing the request &lt;code&gt;method&lt;/code&gt;, and the payload (in &lt;code&gt;data&lt;/code&gt;)&lt;/li&gt;
&lt;li&gt;a &lt;code&gt;next&lt;/code&gt; function that can be called by the handler&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;In other words, this is effectively a request/response concept, close to the synchronous ideas in HTTP, for example.&lt;/p&gt;
&lt;p&gt;Then, to contrast this with an event message concept, close to the asynchronous ideas with event emitters and receivers, I swapped out the &lt;code&gt;srv.send&lt;/code&gt; and used &lt;code&gt;srv.emit&lt;/code&gt; instead:&lt;/p&gt;
&lt;pre class=&quot;language-javascript&quot; tabindex=&quot;0&quot;&gt;&lt;code class=&quot;language-javascript&quot;&gt;&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;await&lt;/span&gt; srv&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;emit&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&#39;recap&#39;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt; &lt;span class=&quot;token literal-property property&quot;&gt;is&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;awesome&quot;&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
EventMessage &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt; &lt;span class=&quot;token literal-property property&quot;&gt;event&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&#39;recap&#39;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token literal-property property&quot;&gt;data&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt; &lt;span class=&quot;token literal-property property&quot;&gt;is&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&#39;awesome&#39;&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;Function&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; _dummy&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;This time the &lt;code&gt;console.log&lt;/code&gt; handler showed that:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;what is being passed is an object of type &lt;code&gt;EventMessage&lt;/code&gt; (as opposed to &lt;code&gt;Request&lt;/code&gt;)&lt;/li&gt;
&lt;li&gt;the &lt;code&gt;recap&lt;/code&gt; name is the same, but is now treated as an &lt;code&gt;event&lt;/code&gt; rather than a &lt;code&gt;method&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;there is no &lt;code&gt;next&lt;/code&gt; function (just a &lt;code&gt;_dummy&lt;/code&gt;)&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;This &lt;code&gt;next&lt;/code&gt; vs &lt;code&gt;_dummy&lt;/code&gt; function is at the heart of one of the key differences between events and requests in CAP. In both contexts one can define multiple handlers that are called in sequence for a given message.&lt;/p&gt;
&lt;p&gt;The handling of &lt;em&gt;requests&lt;/em&gt; is done in the context of a classic &lt;a href=&quot;https://cap.cloud.sap/docs/node.js/core-services#interceptor-stack-with-next&quot;&gt;interceptor stack&lt;/a&gt;, where any given handler can break the chain and effectively declare that the message has been handled (by not calling &lt;code&gt;next&lt;/code&gt; to pass the processing to the next handler in the stack). But there is no interceptor stack in the handling of &lt;em&gt;events&lt;/em&gt; - every registered handler is called, regardless (and therefore there&#39;s no need for the &lt;code&gt;next&lt;/code&gt; function).&lt;/p&gt;
&lt;h2 id=&quot;sending-queries-to-a-remote-service&quot;&gt;Sending queries to a remote service&lt;/h2&gt;
&lt;p&gt;Constructing and sending queries to services is fundamental in CAP. Earlier I constructed a query and sent it to the &lt;code&gt;db&lt;/code&gt; service. In this last part of the talk I showed how one can construct a query and send it to a remote service (my &lt;a href=&quot;https://developer-challenge.cfapps.eu10.hana.ondemand.com/odata/v4/northbreeze&quot;&gt;Northbreeze OData service&lt;/a&gt;), without having to think too much at all about the fact that it is even remote.&lt;/p&gt;
&lt;p&gt;In CAP services are either &amp;quot;required&amp;quot; or &amp;quot;provided&amp;quot;. A remote service is one that is &amp;quot;required&amp;quot;, commonly with the details in &lt;code&gt;package.json#cds.requires&lt;/code&gt;, and &lt;a href=&quot;https://cap.cloud.sap/docs/node.js/cds-connect&quot;&gt;cds.connect&lt;/a&gt; is used to make a connection to such a remote service.&lt;/p&gt;
&lt;p&gt;I don&#39;t have anything in &lt;code&gt;package.json#cds.requires&lt;/code&gt; so this is what I got when I tried something simple like this:&lt;/p&gt;
&lt;pre class=&quot;language-javascript&quot; tabindex=&quot;0&quot;&gt;&lt;code class=&quot;language-javascript&quot;&gt;&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt; cds&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;connect&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;to&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&#39;northbreeze&#39;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
Promise &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
  &lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt;rejected&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt; Error&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; Didn&lt;span class=&quot;token string&quot;&gt;&#39;t find a configuration for &#39;&lt;/span&gt;cds&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;requires&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;northbreeze&#39; &lt;span class=&quot;token keyword&quot;&gt;in&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;/&lt;/span&gt;home&lt;span class=&quot;token operator&quot;&gt;/&lt;/span&gt;node&lt;span class=&quot;token operator&quot;&gt;/&lt;/span&gt;tiny&lt;span class=&quot;token operator&quot;&gt;-&lt;/span&gt;sample&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;There&#39;s a second parameter to &lt;code&gt;cds.connect.to&lt;/code&gt; which expects an options object, wherein one can provide a service binding (essentially a destination object) in a &lt;code&gt;credentials&lt;/code&gt; property:&lt;/p&gt;
&lt;pre class=&quot;language-javascript&quot; tabindex=&quot;0&quot;&gt;&lt;code class=&quot;language-javascript&quot;&gt;&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt; nb &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;await&lt;/span&gt; cds&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;connect&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;to&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&#39;northbreeze&#39;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;token literal-property property&quot;&gt;kind&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&#39;odata&#39;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token literal-property property&quot;&gt;credentials&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt; &lt;span class=&quot;token literal-property property&quot;&gt;url&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&#39;https://developer-challenge.cfapps.eu10.hana.ondemand.com/odata/v4/northbreeze&#39;&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
RemoteService &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
  &lt;span class=&quot;token literal-property property&quot;&gt;name&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&#39;northbreeze&#39;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
  &lt;span class=&quot;token literal-property property&quot;&gt;options&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;token literal-property property&quot;&gt;kind&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&#39;odata&#39;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
    &lt;span class=&quot;token literal-property property&quot;&gt;impl&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&#39;@sap/cds/libx/_runtime/remote/Service.js&#39;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
    &lt;span class=&quot;token literal-property property&quot;&gt;external&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token boolean&quot;&gt;true&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
    &lt;span class=&quot;token literal-property property&quot;&gt;credentials&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
      &lt;span class=&quot;token literal-property property&quot;&gt;url&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&#39;https://developer-challenge.cfapps.eu10.hana.ondemand.com/odata/v4/northbreeze&#39;&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
  &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
  &lt;span class=&quot;token literal-property property&quot;&gt;kind&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&#39;odata&#39;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
  &lt;span class=&quot;token literal-property property&quot;&gt;handlers&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; EventHandlers &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;token literal-property property&quot;&gt;_initial&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt; &lt;span class=&quot;token literal-property property&quot;&gt;before&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&#39;UPDATE&#39;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token literal-property property&quot;&gt;handler&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;Function&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; clearKeysFromData&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
    &lt;span class=&quot;token literal-property property&quot;&gt;before&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
    &lt;span class=&quot;token literal-property property&quot;&gt;on&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt; &lt;span class=&quot;token literal-property property&quot;&gt;on&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&#39;*&#39;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token literal-property property&quot;&gt;handler&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;AsyncFunction&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; on_handler&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
    &lt;span class=&quot;token literal-property property&quot;&gt;after&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
    &lt;span class=&quot;token literal-property property&quot;&gt;_error&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;
  &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
  &lt;span class=&quot;token literal-property property&quot;&gt;definition&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;undefined&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
  &lt;span class=&quot;token literal-property property&quot;&gt;_source&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&#39;/home/node/tiny-sample/node_modules/@sap/cds/libx/_runtime/remote/Service.js&#39;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
  &lt;span class=&quot;token literal-property property&quot;&gt;datasource&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;undefined&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
  &lt;span class=&quot;token literal-property property&quot;&gt;destinationOptions&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;undefined&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
  &lt;span class=&quot;token literal-property property&quot;&gt;destination&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;token literal-property property&quot;&gt;name&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;undefined&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
    &lt;span class=&quot;token literal-property property&quot;&gt;url&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&#39;https://developer-challenge.cfapps.eu10.hana.ondemand.com/odata/v4/northbreeze&#39;&lt;/span&gt;
  &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
  &lt;span class=&quot;token literal-property property&quot;&gt;path&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;undefined&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
  &lt;span class=&quot;token literal-property property&quot;&gt;requestTimeout&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;60000&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
  &lt;span class=&quot;token literal-property property&quot;&gt;csrf&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;undefined&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
  &lt;span class=&quot;token literal-property property&quot;&gt;csrfInBatch&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;undefined&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
  &lt;span class=&quot;token literal-property property&quot;&gt;middlewares&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt; &lt;span class=&quot;token literal-property property&quot;&gt;timeout&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;Function&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;anonymous&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token literal-property property&quot;&gt;csrf&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;undefined&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
  &lt;span class=&quot;token literal-property property&quot;&gt;entities&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
  &lt;span class=&quot;token literal-property property&quot;&gt;actions&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;Doing this, and assigning the result to a variable, gives a &lt;code&gt;RemoteService&lt;/code&gt; object, which is on a similar level to the &lt;code&gt;db&lt;/code&gt; and &lt;code&gt;CatalogService&lt;/code&gt; objects I had after starting the CAP server:&lt;/p&gt;
&lt;pre class=&quot;language-javascript&quot; tabindex=&quot;0&quot;&gt;&lt;code class=&quot;language-javascript&quot;&gt;&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;db&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; CatalogService&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; nb&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;forEach&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token parameter&quot;&gt;x&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&gt;&lt;/span&gt; console&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;log&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token template-string&quot;&gt;&lt;span class=&quot;token template-punctuation string&quot;&gt;`&lt;/span&gt;&lt;span class=&quot;token interpolation&quot;&gt;&lt;span class=&quot;token interpolation-punctuation punctuation&quot;&gt;${&lt;/span&gt;x&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;name&lt;span class=&quot;token interpolation-punctuation punctuation&quot;&gt;}&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;: &lt;/span&gt;&lt;span class=&quot;token interpolation&quot;&gt;&lt;span class=&quot;token interpolation-punctuation punctuation&quot;&gt;${&lt;/span&gt;x&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;constructor&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;name&lt;span class=&quot;token interpolation-punctuation punctuation&quot;&gt;}&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt; (&lt;/span&gt;&lt;span class=&quot;token interpolation&quot;&gt;&lt;span class=&quot;token interpolation-punctuation punctuation&quot;&gt;${&lt;/span&gt;x&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;kind&lt;span class=&quot;token interpolation-punctuation punctuation&quot;&gt;}&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token template-punctuation string&quot;&gt;`&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;token literal-property property&quot;&gt;db&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;SQLiteService&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;sqlite&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;token literal-property property&quot;&gt;CatalogService&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;ApplicationService&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;app&lt;span class=&quot;token operator&quot;&gt;-&lt;/span&gt;service&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;token literal-property property&quot;&gt;northbreeze&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;RemoteService&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;odata&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;At this point I constructed a new query object, enjoying how the approach (which uses tagged templates) allows me to express my query in almost-English:&lt;/p&gt;
&lt;pre class=&quot;language-javascript&quot; tabindex=&quot;0&quot;&gt;&lt;code class=&quot;language-javascript&quot;&gt;&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt; cats &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token constant&quot;&gt;SELECT&lt;/span&gt; &lt;span class=&quot;token template-string&quot;&gt;&lt;span class=&quot;token template-punctuation string&quot;&gt;`&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;CategoryName&lt;/span&gt;&lt;span class=&quot;token template-punctuation string&quot;&gt;`&lt;/span&gt;&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;from &lt;span class=&quot;token template-string&quot;&gt;&lt;span class=&quot;token template-punctuation string&quot;&gt;`&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;Categories&lt;/span&gt;&lt;span class=&quot;token template-punctuation string&quot;&gt;`&lt;/span&gt;&lt;/span&gt;
cds&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;ql &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
  &lt;span class=&quot;token constant&quot;&gt;SELECT&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;token literal-property property&quot;&gt;from&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt; &lt;span class=&quot;token literal-property property&quot;&gt;ref&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&#39;Categories&#39;&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
    &lt;span class=&quot;token literal-property property&quot;&gt;columns&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt; &lt;span class=&quot;token literal-property property&quot;&gt;ref&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&#39;CategoryName&#39;&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;
  &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;The context here in the post has diverged slightly from the context of the talk, because (as I&#39;d exited the cds REPL back to the shell to show the output of &lt;code&gt;npm ls&lt;/code&gt;) the cds REPL session at this point was a fresh one in the talk, one where I hadn&#39;t re-invoked the CAP server (with &lt;code&gt;.run .&lt;/code&gt;), and therefore there was no &lt;code&gt;db&lt;/code&gt; variable injected into the global REPL context like before.&lt;/p&gt;
&lt;p&gt;So when I ran this during the talk, this happened:&lt;/p&gt;
&lt;pre class=&quot;language-javascript&quot; tabindex=&quot;0&quot;&gt;&lt;code class=&quot;language-javascript&quot;&gt;&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;await&lt;/span&gt; cats
Uncaught Error&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; Can&#39;t execute query &lt;span class=&quot;token keyword&quot;&gt;as&lt;/span&gt; no primary database is connected&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;But here, while we &lt;em&gt;do&lt;/em&gt; have a primary database in the form of &lt;code&gt;db&lt;/code&gt;, we get a different and equally illustrative error, which nicely illustrated the default use of &lt;code&gt;db.run&lt;/code&gt; when &lt;code&gt;await&lt;/code&gt;-ing a query - it sent the query to be executed in the context of that local database:&lt;/p&gt;
&lt;pre class=&quot;language-javascript&quot; tabindex=&quot;0&quot;&gt;&lt;code class=&quot;language-javascript&quot;&gt;&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;await&lt;/span&gt; cats
Uncaught SqliteError&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; no such table&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; Categories &lt;span class=&quot;token keyword&quot;&gt;in&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt;
&lt;span class=&quot;token constant&quot;&gt;SELECT&lt;/span&gt; CategoryName &lt;span class=&quot;token constant&quot;&gt;FROM&lt;/span&gt; Categories&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;Of course, I wanted to have this query sent to the remote service, which I achieved with the same method but called on the &lt;code&gt;RemoteService&lt;/code&gt; object (in &lt;code&gt;nb&lt;/code&gt;), rather than the &lt;code&gt;SQLiteService&lt;/code&gt; object (in &lt;code&gt;db&lt;/code&gt;):&lt;/p&gt;
&lt;pre class=&quot;language-javascript&quot; tabindex=&quot;0&quot;&gt;&lt;code class=&quot;language-javascript&quot;&gt;&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;await&lt;/span&gt; nb&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;run&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;cats&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;
  &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt; &lt;span class=&quot;token literal-property property&quot;&gt;CategoryName&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&#39;Beverages&#39;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token literal-property property&quot;&gt;CategoryID&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
  &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt; &lt;span class=&quot;token literal-property property&quot;&gt;CategoryName&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&#39;Condiments&#39;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token literal-property property&quot;&gt;CategoryID&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;2&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
  &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt; &lt;span class=&quot;token literal-property property&quot;&gt;CategoryName&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&#39;Confections&#39;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token literal-property property&quot;&gt;CategoryID&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;3&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
  &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt; &lt;span class=&quot;token literal-property property&quot;&gt;CategoryName&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&#39;Dairy Products&#39;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token literal-property property&quot;&gt;CategoryID&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;4&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
  &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt; &lt;span class=&quot;token literal-property property&quot;&gt;CategoryName&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&#39;Grains/Cereals&#39;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token literal-property property&quot;&gt;CategoryID&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;5&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
  &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt; &lt;span class=&quot;token literal-property property&quot;&gt;CategoryName&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&#39;Meat/Poultry&#39;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token literal-property property&quot;&gt;CategoryID&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;6&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
  &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt; &lt;span class=&quot;token literal-property property&quot;&gt;CategoryName&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&#39;Produce&#39;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token literal-property property&quot;&gt;CategoryID&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;7&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
  &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt; &lt;span class=&quot;token literal-property property&quot;&gt;CategoryName&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&#39;Seafood&#39;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token literal-property property&quot;&gt;CategoryID&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;8&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;The query object is serialised and sent to the remote service, and the results returned, without me having to do anything! If you&#39;re curious, information on the built-in implementation that facilitates this is also available:&lt;/p&gt;
&lt;pre class=&quot;language-javascript&quot; tabindex=&quot;0&quot;&gt;&lt;code class=&quot;language-javascript&quot;&gt;&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt; nb&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;options
&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
  &lt;span class=&quot;token literal-property property&quot;&gt;kind&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&#39;odata&#39;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
  &lt;span class=&quot;token literal-property property&quot;&gt;impl&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&#39;@sap/cds/libx/_runtime/remote/Service.js&#39;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
  &lt;span class=&quot;token literal-property property&quot;&gt;external&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token boolean&quot;&gt;true&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
  &lt;span class=&quot;token literal-property property&quot;&gt;credentials&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;token literal-property property&quot;&gt;url&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&#39;https://developer-challenge.cfapps.eu10.hana.ondemand.com/odata/v4/northbreeze&#39;&lt;/span&gt;
  &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;Excellent!&lt;/p&gt;
&lt;h2 id=&quot;wrapping-up&quot;&gt;Wrapping up&lt;/h2&gt;
&lt;p&gt;With that, I wrapped up the talk (it was only a 20 minute slot) and so I&#39;ll wrap up this post too.&lt;/p&gt;
&lt;p&gt;Let me know in the comments how you get on with the cds REPL, and share what you discover!&lt;/p&gt;
</content>
  </entry>
</feed>