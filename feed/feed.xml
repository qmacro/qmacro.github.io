<?xml version="1.0" encoding="utf-8"?>
<?xml-stylesheet href="pretty-atom-feed.xsl" type="text/xsl"?>
<feed xmlns="http://www.w3.org/2005/Atom" xml:lang="en">
  <title>DJ Adams</title>
  <subtitle>Reserving the right to be wrong</subtitle>
  <link href="https://qmacro.org/feed/feed.xml" rel="self" />
  <link href="https://qmacro.org/blog/" />
  <updated>2025-12-09T00:00:00Z</updated>
  <id>https://qmacro.org/blog/</id>
  <author>
    <name>DJ Adams</name>
  </author>
  <entry>
    <title>A new Hands-on SAP Dev mini-series on the core expression language in CDS</title>
    <link href="https://qmacro.org/blog/posts/2025/12/09/a-new-hands-on-sap-dev-mini-series-on-the-core-expression-language-in-cds/" />
    <updated>2025-12-09T00:00:00Z</updated>
    <id>https://qmacro.org/blog/posts/2025/12/09/a-new-hands-on-sap-dev-mini-series-on-the-core-expression-language-in-cds/</id>
    <content type="html">&lt;p&gt;After Devtoberfest comes TechEd and the long tail of conferences that lead into
the holiday season. Then comes the new year, and a restart of our &lt;a href=&quot;https://community.sap.com/t5/technology-blog-posts-by-sap/hands-on-sap-dev-with-qmacro-new-live-stream-series/ba-p/13393464&quot;&gt;long
running&lt;/a&gt;
live stream show &amp;quot;Hands-on SAP Dev&amp;quot; on the &lt;a href=&quot;https://www.youtube.com/@sapdevs&quot;&gt;SAP Developers YouTube
channel&lt;/a&gt;.&lt;/p&gt;
&lt;p&gt;We&#39;re starting 2026 off with an under-the-hood style mini-series exploring
expressions in CDS.&lt;/p&gt;
&lt;p&gt;It&#39;s all about CXL - the Core Expression Language. What&#39;s that? One of the mini
languages&lt;a href=&quot;https://qmacro.org/blog/posts/2025/12/09/a-new-hands-on-sap-dev-mini-series-on-the-core-expression-language-in-cds/#footnotes&quot;&gt;&lt;sup&gt;1&lt;/sup&gt;&lt;/a&gt; in the CDS language family that is all
about expressions. Expressions are everywhere - they&#39;re used in queries, in
calculated elements and in annotations. They are fundamental to many of the
underlying design philosophies in CAP and convey power wrapped in simplicity
that is the hallmark of CDS.&lt;/p&gt;
&lt;p&gt;&lt;a href=&quot;https://www.youtube.com/watch?v=aiE20i5BP70&amp;amp;list=PL6RpkC85SLQABOpzhd7WI-hMpy99PxUo0&amp;amp;index=1&quot;&gt;&lt;img src=&quot;https://qmacro.org/images/2025/12/cxl-thumbnail.png&quot; alt=&quot;the new series thumbnail with me and
Patrice&quot;&gt;&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;ðŸ‘‰ Join CAP core team member &lt;a href=&quot;https://patrice.codes/&quot;&gt;Patrice Bender&lt;/a&gt; and me in
&lt;a href=&quot;https://www.youtube.com/watch?v=aiE20i5BP70&amp;amp;list=PL6RpkC85SLQABOpzhd7WI-hMpy99PxUo0&amp;amp;index=1&quot;&gt;Part 1 of this new mini-series &amp;quot;CDS expressions in CAP - Under the hood&amp;quot;&lt;/a&gt; on Fri 16 Jan 2026 at the usual time.&lt;/p&gt;
&lt;h2 id=&quot;footnotes&quot;&gt;Footnotes&lt;/h2&gt;
&lt;ol&gt;
&lt;li&gt;Also known as a &lt;a href=&quot;https://en.wikipedia.org/wiki/Domain-specific_language&quot;&gt;Domain Specific
Language&lt;/a&gt; (DSL).&lt;/li&gt;
&lt;/ol&gt;
</content>
  </entry>
  <entry>
    <title>A simple exploration of status transition flows in CAP</title>
    <link href="https://qmacro.org/blog/posts/2025/12/08/a-simple-exploration-of-status-transition-flows-in-cap/" />
    <updated>2025-12-08T00:00:00Z</updated>
    <id>https://qmacro.org/blog/posts/2025/12/08/a-simple-exploration-of-status-transition-flows-in-cap/</id>
    <content type="html">&lt;p&gt;The &lt;a href=&quot;https://cap.cloud.sap/docs/releases/nov25&quot;&gt;November 2025 release&lt;/a&gt; of CAP heralded &lt;a href=&quot;https://cap.cloud.sap/docs/releases/nov25#status-transition-flows&quot;&gt;a beta version of Status-Transition Flows&lt;/a&gt;, moving us up yet another gear in the journey towards declarative nirvana.&lt;/p&gt;
&lt;h2 id=&quot;background&quot;&gt;Background&lt;/h2&gt;
&lt;p&gt;I wanted to try out this new significant feature, one which embodies and celebrates one of the key reasons to use CAP - &lt;a href=&quot;https://qmacro.org/blog/posts/2024/11/07/five-reasons-to-use-cap/#1-the-code-is-in-the-framework-not-outside-of-it&quot;&gt;the code is in the framework, not outside of it&lt;/a&gt;. In the November release notes there&#39;s a brief glimpse of what this declarative approach looks like:&lt;/p&gt;
&lt;pre class=&quot;language-cds&quot; tabindex=&quot;0&quot;&gt;&lt;code class=&quot;language-cds&quot;&gt;annotate Travels with &lt;span class=&quot;token annotation important&quot;&gt;@flow.status:&lt;/span&gt; Status &lt;span class=&quot;token keyword&quot;&gt;actions&lt;/span&gt; {
  rejectTravel    @&lt;span class=&quot;token from keyword&quot;&gt;from&lt;/span&gt;: #Open  &lt;span class=&quot;token annotation important&quot;&gt;@to:&lt;/span&gt; #Canceled;
  acceptTravel    @&lt;span class=&quot;token from keyword&quot;&gt;from&lt;/span&gt;: #Open  &lt;span class=&quot;token annotation important&quot;&gt;@to:&lt;/span&gt; #Accepted;
  deductDiscount  @&lt;span class=&quot;token from keyword&quot;&gt;from&lt;/span&gt;: #Open;
};&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;Of course, this is only part of how things are set up; following the link at the end of this section of the release notes leads us to &lt;a href=&quot;https://cap.cloud.sap/docs/guides/providing-services#status-transition-flows&quot;&gt;the relevant Capire section within the Providing Services topic&lt;/a&gt;, where we can see some of the rest of the CDS model (domain model and service definition specifically) that goes to make up the sample.&lt;/p&gt;
&lt;p&gt;I wanted to write my own example, complete but also as simple as possible, so I could then &lt;a href=&quot;https://qmacro.org/blog/posts/2017/02/19/the-beauty-of-recursion-and-list-machinery/#initial-recognition&quot;&gt;stare at it&lt;/a&gt; for a while to let things sink in. Here&#39;s what I came up with.&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;https://qmacro.org/images/2025/12/double-toggle-switch.jpg&quot; alt=&quot;double toggle switch&quot;&gt;
(&lt;a href=&quot;https://commons.wikimedia.org/wiki/File:A_double_toggle_light_switch.jpg&quot;&gt;Image courtesy of Wikimedia Commons&lt;/a&gt;)&lt;/p&gt;
&lt;h2 id=&quot;modelling-an-on-off-switch&quot;&gt;Modelling an on/off switch&lt;/h2&gt;
&lt;p&gt;After initialising a new CAP project (with &lt;code&gt;cds init&lt;/code&gt;), I just created a &lt;code&gt;services.cds&lt;/code&gt; file&lt;a href=&quot;https://qmacro.org/blog/posts/2025/12/08/a-simple-exploration-of-status-transition-flows-in-cap/#footnotes&quot;&gt;&lt;sup&gt;1&lt;/sup&gt;&lt;/a&gt; with the following content:&lt;/p&gt;
&lt;pre class=&quot;language-cds&quot; tabindex=&quot;0&quot;&gt;&lt;code class=&quot;language-cds&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;context&lt;/span&gt; qmacro {

  &lt;span class=&quot;token cqlkeywords keyword&quot;&gt;type&lt;/span&gt; Status : &lt;span class=&quot;token type builtin&quot;&gt;String &lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;enum&lt;/span&gt; {
    Up;
    Down;
  }

  &lt;span class=&quot;token keyword&quot;&gt;entity&lt;/span&gt; Switches {
    &lt;span class=&quot;token cqlkeywords keyword&quot;&gt;key&lt;/span&gt; ID     : &lt;span class=&quot;token type builtin&quot;&gt;Integer&lt;/span&gt;;
        status : Status &lt;span class=&quot;token cdl-keyword keyword&quot;&gt;default&lt;/span&gt; #Down;
  }
}

&lt;span class=&quot;token keyword&quot;&gt;service&lt;/span&gt; SwitchService {

  &lt;span class=&quot;token keyword&quot;&gt;entity&lt;/span&gt; Switches &lt;span class=&quot;token cqlkeywords keyword&quot;&gt;as&lt;/span&gt; &lt;span class=&quot;token cdl-keyword keyword&quot;&gt;projection&lt;/span&gt; &lt;span class=&quot;token cqlkeywords keyword&quot;&gt;on&lt;/span&gt; qmacro.Switches

    &lt;span class=&quot;token keyword&quot;&gt;actions&lt;/span&gt; {
      &lt;span class=&quot;token keyword&quot;&gt;action&lt;/span&gt; flipUp();
      &lt;span class=&quot;token keyword&quot;&gt;action&lt;/span&gt; flipDown();
    };


  annotate Switches with &lt;span class=&quot;token annotation important&quot;&gt;@flow.status:&lt;/span&gt; status &lt;span class=&quot;token keyword&quot;&gt;actions&lt;/span&gt; {
    flipUp               @&lt;span class=&quot;token from keyword&quot;&gt;from&lt;/span&gt;       : #Down  &lt;span class=&quot;token annotation important&quot;&gt;@to:&lt;/span&gt; #Up;
    flipDown             @&lt;span class=&quot;token from keyword&quot;&gt;from&lt;/span&gt;       : #Up    &lt;span class=&quot;token annotation important&quot;&gt;@to:&lt;/span&gt; #Down;
  };
}&lt;/code&gt;&lt;/pre&gt;
&lt;h2 id=&quot;understanding-the-definitions&quot;&gt;Understanding the definitions&lt;/h2&gt;
&lt;p&gt;Recently I&#39;ve been looking more closely at CDS modelling in general and CDL in particular, partly in the context of creating the exercise content for the &lt;a href=&quot;https://github.com/SAP-samples/cap-cds-hands-on/&quot;&gt;Hands-on with CAP CDS&lt;/a&gt; workshop which I gave &lt;a href=&quot;https://qmacro.org/blog/posts/2025/09/10/upcoming-talks-in-autumn-2025/#ukisug-connect&quot;&gt;at UKISUG Connect&lt;/a&gt; at the start of this month. And I have come to value taking my time to understand the nuances of how models are expressed. Here are a few points of interest relating to the declarations here:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;I want to have everything in a single file to keep things as simple as possible&lt;/li&gt;
&lt;li&gt;This includes my data model, my service definition and my annotations&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;With regards to the data model:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;I&#39;m using the &lt;code&gt;context&lt;/code&gt; keyword to enclose my data model, which consists of a custom named type &lt;code&gt;Status&lt;/code&gt; and the entity &lt;code&gt;Switches&lt;/code&gt;, with a scope name prefix (&lt;code&gt;qmacro&lt;/code&gt;)&lt;/li&gt;
&lt;li&gt;The &lt;code&gt;status&lt;/code&gt; element of &lt;code&gt;Switches&lt;/code&gt; is defined with the custom &lt;code&gt;Status&lt;/code&gt; type which has its possible values as a list of &lt;a href=&quot;https://cap.cloud.sap/docs/cds/cdl#enums&quot;&gt;enumeration values&lt;/a&gt; (&lt;code&gt;Up&lt;/code&gt; and &lt;code&gt;Down&lt;/code&gt;); as this is the element that&#39;s going to be used as the status element, I&#39;ve given it a default value (&lt;code&gt;Down&lt;/code&gt;) as it requires one (no initial state can be provided on creation as the element should be readonly from the client perspective)&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;With regards to the service definition:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;There&#39;s a pass-through projection (i.e. it defaults to an &lt;a href=&quot;https://cap.cloud.sap/docs/cds/cdl#views-with-inferred-signatures&quot;&gt;inferred signature&lt;/a&gt;)&lt;/li&gt;
&lt;li&gt;The projection is for the &lt;code&gt;Switches&lt;/code&gt; entity, and there&#39;s also a couple of &lt;a href=&quot;https://cap.cloud.sap/docs/cds/cdl#bound-actions&quot;&gt;bound actions&lt;/a&gt; declared as part of the entity definition that starts with &lt;code&gt;entity Switches ...&lt;/code&gt; and finishes with the semicolon &lt;code&gt;;&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;As actions semantically signal that side-effects are likely, they&#39;ll need to be invoked with HTTP POST&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;Finally there&#39;s the annotation:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;It&#39;s separate to the annotation target, and arguably easier to read that way; moreover, it would likely (or at least possibly) be in a separate file if it weren&#39;t so deliberately simple (see &lt;a href=&quot;https://qmacro.org/blog/posts/2024/11/04/separating-concerns-and-focusing-on-the-important-stuff/&quot;&gt;Separating concerns and focusing on the important stuff&lt;/a&gt;)&lt;/li&gt;
&lt;li&gt;It has been written in accordance with the description in the &lt;a href=&quot;https://cap.cloud.sap/docs/guides/providing-services#modeling-flows&quot;&gt;Modelling Flows&lt;/a&gt; section of the &lt;a href=&quot;https://cap.cloud.sap/docs/guides/providing-services&quot;&gt;Providing Services&lt;/a&gt; topic in Capire&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id=&quot;digging-in-to-the-annotation&quot;&gt;Digging in to the annotation&lt;/h3&gt;
&lt;p&gt;The annotation is quite involved:&lt;/p&gt;
&lt;pre class=&quot;language-shell&quot; tabindex=&quot;0&quot;&gt;&lt;code class=&quot;language-shell&quot;&gt;annotate &lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt;target&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt; with &lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt;annotation&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt; &lt;span class=&quot;token builtin class-name&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt;info&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt; actions &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;..&lt;/span&gt;. &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;and indeed the construction used is rather unusual:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;code&gt;annotate &amp;lt;target&amp;gt; actions { ... }&lt;/code&gt; is &lt;a href=&quot;https://github.com/search?q=org%3Acapire+OR+org%3ASAP-samples+%2Fannotate+.%2B+actions%2F+path%3A*.cds&amp;amp;type=code&quot;&gt;reasonably common&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;but &lt;em&gt;two&lt;/em&gt; effective targets in a single annotation declaration context is &lt;a href=&quot;https://github.com/search?q=org%3Acapire+OR+org%3ASAP-samples+%2Fannotate+.%2B+with+%40.%2B+actions%2F+path%3A*.cds&amp;amp;type=code&quot;&gt;extremely rare&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;What we have here is a sequence of two annotations in one. The single annotation expression above could just as readily be expressed like this&lt;a href=&quot;https://qmacro.org/blog/posts/2025/12/08/a-simple-exploration-of-status-transition-flows-in-cap/#footnotes&quot;&gt;&lt;sup&gt;2&lt;/sup&gt;&lt;/a&gt;:&lt;/p&gt;
&lt;pre class=&quot;language-cds&quot; tabindex=&quot;0&quot;&gt;&lt;code class=&quot;language-cds&quot;&gt;annotate Switches with &lt;span class=&quot;token annotation important&quot;&gt;@flow.status:&lt;/span&gt; status;

annotate Switches &lt;span class=&quot;token keyword&quot;&gt;actions&lt;/span&gt; {
  flipUp    @&lt;span class=&quot;token from keyword&quot;&gt;from&lt;/span&gt;: #Down  &lt;span class=&quot;token annotation important&quot;&gt;@to:&lt;/span&gt; #Up;
  flipDown  @&lt;span class=&quot;token from keyword&quot;&gt;from&lt;/span&gt;: #Up    &lt;span class=&quot;token annotation important&quot;&gt;@to:&lt;/span&gt; #Down;
};&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;Separating these out like this makes it a bit easier for me to grok what&#39;s going on.&lt;/p&gt;
&lt;p&gt;First, we&#39;re blessing the &lt;code&gt;Switches&lt;/code&gt; entity with the Status-Transition Flows ability; at this level, we must specify the element to be used for the status. It&#39;s the &lt;code&gt;status&lt;/code&gt; element that&#39;s important, and we do that here by targeting the entire entity with the annotation and then specifying the element as a secondary piece of information. We could have annotated the element directly, like this:&lt;/p&gt;
&lt;pre class=&quot;language-cds&quot; tabindex=&quot;0&quot;&gt;&lt;code class=&quot;language-cds&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;context&lt;/span&gt; qmacro {

  &lt;span class=&quot;token single-line-comment comment&quot;&gt;// ...&lt;/span&gt;

  &lt;span class=&quot;token keyword&quot;&gt;entity&lt;/span&gt; Switches {
    &lt;span class=&quot;token cqlkeywords keyword&quot;&gt;key&lt;/span&gt; ID     : &lt;span class=&quot;token type builtin&quot;&gt;Integer&lt;/span&gt;;

        &lt;span class=&quot;token annotation important&quot;&gt;@flow.status&lt;/span&gt;
        status : Status &lt;span class=&quot;token cdl-keyword keyword&quot;&gt;default&lt;/span&gt; #Down;
  }
}

&lt;span class=&quot;token keyword&quot;&gt;service&lt;/span&gt; SwitchService {

  &lt;span class=&quot;token single-line-comment comment&quot;&gt;// ...&lt;/span&gt;

  annotate Switches &lt;span class=&quot;token keyword&quot;&gt;actions&lt;/span&gt; {
    flipUp    @&lt;span class=&quot;token from keyword&quot;&gt;from&lt;/span&gt;: #Down  &lt;span class=&quot;token annotation important&quot;&gt;@to:&lt;/span&gt; #Up;
    flipDown  @&lt;span class=&quot;token from keyword&quot;&gt;from&lt;/span&gt;: #Up    &lt;span class=&quot;token annotation important&quot;&gt;@to:&lt;/span&gt; #Down;
  };

}&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;but, we&#39;d have needed to additionally, explicitly and manually specify the &lt;code&gt;@readonly&lt;/code&gt; annotation &lt;a href=&quot;https://cap.cloud.sap/docs/guides/providing-services#declare-flow-using-flow-status&quot;&gt;as directed&lt;/a&gt;:&lt;/p&gt;
&lt;pre class=&quot;language-cds&quot; tabindex=&quot;0&quot;&gt;&lt;code class=&quot;language-cds&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;entity&lt;/span&gt; Switches {
  &lt;span class=&quot;token cqlkeywords keyword&quot;&gt;key&lt;/span&gt; ID     : &lt;span class=&quot;token type builtin&quot;&gt;Integer&lt;/span&gt;;

      &lt;span class=&quot;token annotation important&quot;&gt;@readonly&lt;/span&gt;
      &lt;span class=&quot;token annotation important&quot;&gt;@flow.status&lt;/span&gt;
      status : Status &lt;span class=&quot;token cdl-keyword keyword&quot;&gt;default&lt;/span&gt; #Down;
}&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;In the current state of how we make these declarations, specifying the flow status annotation at the entity level, and in the service layer, nearer to the related actions, makes more sense to me.&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;In case you&#39;re wondering, the original entity level &lt;code&gt;@flow.status&lt;/code&gt; annotation does indeed also cause a &lt;code&gt;@readonly&lt;/code&gt; annotation to be added; here&#39;s the relevant section of the CSN that&#39;s generated:&lt;/p&gt;
&lt;pre class=&quot;language-yaml&quot; tabindex=&quot;0&quot;&gt;&lt;code class=&quot;language-yaml&quot;&gt;&lt;span class=&quot;token key atrule&quot;&gt;definitions&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
  &lt;span class=&quot;token key atrule&quot;&gt;SwitchService.Switches&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
    &lt;span class=&quot;token key atrule&quot;&gt;kind&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; entity
    &lt;span class=&quot;token key atrule&quot;&gt;&quot;@flow.status&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt; &lt;span class=&quot;token key atrule&quot;&gt;&quot;=&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; status &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
    &lt;span class=&quot;token key atrule&quot;&gt;projection&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt; &lt;span class=&quot;token key atrule&quot;&gt;from&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt; &lt;span class=&quot;token key atrule&quot;&gt;ref&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;qmacro.Switches&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
    &lt;span class=&quot;token key atrule&quot;&gt;elements&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
      &lt;span class=&quot;token key atrule&quot;&gt;ID&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt; &lt;span class=&quot;token key atrule&quot;&gt;key&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token boolean important&quot;&gt;true&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token key atrule&quot;&gt;type&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; cds.Integer &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
      &lt;span class=&quot;token key atrule&quot;&gt;status&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
        &lt;span class=&quot;token key atrule&quot;&gt;type&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; qmacro.Status
        &lt;span class=&quot;token key atrule&quot;&gt;default&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt; &lt;span class=&quot;token key atrule&quot;&gt;&quot;#&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; Down&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token key atrule&quot;&gt;val&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; Down &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
        &lt;span class=&quot;token key atrule&quot;&gt;&quot;@flow.status&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token boolean important&quot;&gt;true&lt;/span&gt;
        &lt;span class=&quot;token key atrule&quot;&gt;&quot;@readonly&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token boolean important&quot;&gt;true&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;
&lt;/blockquote&gt;
&lt;p&gt;And, what of the actions themselves?&lt;/p&gt;
&lt;h3 id=&quot;looking-at-the-implementation-for-the-actions&quot;&gt;Looking at the implementation for the actions&lt;/h3&gt;
&lt;p&gt;We are used to having the CAP server provide a complete out-of-the-box CRUD handler experience for our services, on an entity by entity basis. We are also used to having to write our own handlers for custom &amp;quot;orthogonal&amp;quot; offerings such as actions and functions, as, almost by definition, they could be anything and are unguessable.&lt;/p&gt;
&lt;p&gt;And so here we are now with a couple of actions we&#39;ve declared:&lt;/p&gt;
&lt;pre class=&quot;language-cds&quot; tabindex=&quot;0&quot;&gt;&lt;code class=&quot;language-cds&quot;&gt;&lt;span class=&quot;token single-line-comment comment&quot;&gt;// ...&lt;/span&gt;

&lt;span class=&quot;token keyword&quot;&gt;service&lt;/span&gt; SwitchService {

  &lt;span class=&quot;token keyword&quot;&gt;entity&lt;/span&gt; Switches &lt;span class=&quot;token cqlkeywords keyword&quot;&gt;as&lt;/span&gt; &lt;span class=&quot;token cdl-keyword keyword&quot;&gt;projection&lt;/span&gt; &lt;span class=&quot;token cqlkeywords keyword&quot;&gt;on&lt;/span&gt; qmacro.Switches

    &lt;span class=&quot;token keyword&quot;&gt;actions&lt;/span&gt; {
      &lt;span class=&quot;token keyword&quot;&gt;action&lt;/span&gt; flipUp();
      &lt;span class=&quot;token keyword&quot;&gt;action&lt;/span&gt; flipDown();
    };

    &lt;span class=&quot;token single-line-comment comment&quot;&gt;// ...&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;and annotated:&lt;/p&gt;
&lt;pre class=&quot;language-cds&quot; tabindex=&quot;0&quot;&gt;&lt;code class=&quot;language-cds&quot;&gt;  &lt;span class=&quot;token single-line-comment comment&quot;&gt;// ...&lt;/span&gt;

  annotate Switches &lt;span class=&quot;token keyword&quot;&gt;actions&lt;/span&gt; {
    flipUp    @&lt;span class=&quot;token from keyword&quot;&gt;from&lt;/span&gt;: #Down  &lt;span class=&quot;token annotation important&quot;&gt;@to:&lt;/span&gt; #Up;
    flipDown  @&lt;span class=&quot;token from keyword&quot;&gt;from&lt;/span&gt;: #Up    &lt;span class=&quot;token annotation important&quot;&gt;@to:&lt;/span&gt; #Down;
  };
}&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;Here&#39;s what the implementation looks like, say in a corresponding &lt;code&gt;services.js&lt;/code&gt; file:&lt;/p&gt;
&lt;pre class=&quot;language-javascript&quot; tabindex=&quot;0&quot;&gt;&lt;code class=&quot;language-javascript&quot;&gt;&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;Yep, that&#39;s right. There is no implementation required, and no corresponding implementation file needed - that&#39;s sort of the whole point!&lt;/p&gt;
&lt;p&gt;With the declarative Status-Transition Flows approach, we&#39;ve declared everything we need with the annotations, describing what each action should do with respect to the status; what starting status requirements there are and what target statuses there can be. Here:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;code&gt;flipUp&lt;/code&gt;, which will transition the status to &lt;code&gt;Up&lt;/code&gt;, can only be invoked if the status is currently &lt;code&gt;Down&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;&lt;code&gt;flipDown&lt;/code&gt;, which will transition the status to &lt;code&gt;Down&lt;/code&gt;, can only be invoked if the status is currently &lt;code&gt;Up&lt;/code&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;Of course, there are far more flexible and involved possibilities here, which are nicely described &lt;a href=&quot;https://cap.cloud.sap/docs/guides/providing-services#status-transition-flows&quot;&gt;in the appropriate section&lt;/a&gt;.&lt;/p&gt;
&lt;h2 id=&quot;kicking-the-tyres&quot;&gt;Kicking the tyres&lt;/h2&gt;
&lt;p&gt;Now I have my model and service definition, and the appropriate annotations, what does it feel like, how does one interact with and experience it?&lt;/p&gt;
&lt;p&gt;Simply from an HTTP level, I&#39;ll give it a go. One can imagine how this then translates to calls being made from a frontend somewhere too, with buttons and other widgets in the UI enabled or disabled (or even hidden) according to the current status.&lt;/p&gt;
&lt;p&gt;I&#39;ll start the server with &lt;code&gt;cds watch&lt;/code&gt;.&lt;/p&gt;
&lt;h3 id=&quot;creating-my-first-switch&quot;&gt;Creating my first switch&lt;/h3&gt;
&lt;p&gt;OK, are there any existing switch entities?&lt;/p&gt;
&lt;pre class=&quot;language-bash&quot; tabindex=&quot;0&quot;&gt;&lt;code class=&quot;language-bash&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;curl&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;&#92;&lt;/span&gt;
  &lt;span class=&quot;token parameter variable&quot;&gt;--silent&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;&#92;&lt;/span&gt;
  &lt;span class=&quot;token parameter variable&quot;&gt;--url&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&#39;localhost:4004/odata/v4/switch/Switches&#39;&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;&#92;&lt;/span&gt;
  &lt;span class=&quot;token operator&quot;&gt;|&lt;/span&gt; jq
&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
  &lt;span class=&quot;token string&quot;&gt;&quot;@odata.context&quot;&lt;/span&gt;&lt;span class=&quot;token builtin class-name&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;&lt;span class=&quot;token variable&quot;&gt;$metadata&lt;/span&gt;#Switches&quot;&lt;/span&gt;,
  &lt;span class=&quot;token string&quot;&gt;&quot;value&quot;&lt;/span&gt;&lt;span class=&quot;token builtin class-name&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;No. So I&#39;ll create one:&lt;/p&gt;
&lt;pre class=&quot;language-bash&quot; tabindex=&quot;0&quot;&gt;&lt;code class=&quot;language-bash&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;curl&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;&#92;&lt;/span&gt;
  &lt;span class=&quot;token parameter variable&quot;&gt;--header&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&#39;Content-Type: application/json&#39;&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;&#92;&lt;/span&gt;
  &lt;span class=&quot;token parameter variable&quot;&gt;--data&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&#39;{&quot;ID&quot;:1}&#39;&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;&#92;&lt;/span&gt;
  &lt;span class=&quot;token parameter variable&quot;&gt;--silent&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;&#92;&lt;/span&gt;
  &lt;span class=&quot;token parameter variable&quot;&gt;--url&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&#39;localhost:4004/odata/v4/switch/Switches&#39;&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;&#92;&lt;/span&gt;
  &lt;span class=&quot;token operator&quot;&gt;|&lt;/span&gt; jq
&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
  &lt;span class=&quot;token string&quot;&gt;&quot;@odata.context&quot;&lt;/span&gt;&lt;span class=&quot;token builtin class-name&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;&lt;span class=&quot;token variable&quot;&gt;$metadata&lt;/span&gt;#Switches/&lt;span class=&quot;token variable&quot;&gt;$entity&lt;/span&gt;&quot;&lt;/span&gt;,
  &lt;span class=&quot;token string&quot;&gt;&quot;ID&quot;&lt;/span&gt;&lt;span class=&quot;token builtin class-name&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt;,
  &lt;span class=&quot;token string&quot;&gt;&quot;status&quot;&lt;/span&gt;&lt;span class=&quot;token builtin class-name&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;Down&quot;&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;It has the default status of &lt;code&gt;Down&lt;/code&gt;, as expected.&lt;/p&gt;
&lt;h3 id=&quot;trying-to-flip-the-switch-the-wrong-way&quot;&gt;Trying to flip the switch the wrong way&lt;/h3&gt;
&lt;p&gt;The switch is down, so I want to see if I can invoke the &lt;code&gt;flipDown&lt;/code&gt; action&lt;a href=&quot;https://qmacro.org/blog/posts/2025/12/08/a-simple-exploration-of-status-transition-flows-in-cap/#footnotes&quot;&gt;&lt;sup&gt;3&lt;/sup&gt;&lt;/a&gt;:&lt;/p&gt;
&lt;pre class=&quot;language-bash&quot; tabindex=&quot;0&quot;&gt;&lt;code class=&quot;language-bash&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;curl&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;&#92;&lt;/span&gt;
  &lt;span class=&quot;token parameter variable&quot;&gt;--request&lt;/span&gt; POST &lt;span class=&quot;token punctuation&quot;&gt;&#92;&lt;/span&gt;
  &lt;span class=&quot;token parameter variable&quot;&gt;--include&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;&#92;&lt;/span&gt;
  &lt;span class=&quot;token parameter variable&quot;&gt;--url&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&#39;localhost:4004/odata/v4/switch/Switches/1/flipDown&#39;&lt;/span&gt;
HTTP/1.1 &lt;span class=&quot;token number&quot;&gt;409&lt;/span&gt; Conflict
X-Powered-By: Express
OData-Version: &lt;span class=&quot;token number&quot;&gt;4.0&lt;/span&gt;
Content-Type: application/json&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;token assign-left variable&quot;&gt;charset&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;utf-8
Content-Length: &lt;span class=&quot;token number&quot;&gt;151&lt;/span&gt;

&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
  &lt;span class=&quot;token string&quot;&gt;&quot;error&quot;&lt;/span&gt;&lt;span class=&quot;token builtin class-name&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;token string&quot;&gt;&quot;message&quot;&lt;/span&gt;&lt;span class=&quot;token builtin class-name&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;Action &lt;span class=&quot;token entity&quot; title=&quot;&#92;&amp;quot;&quot;&gt;&#92;&quot;&lt;/span&gt;flipDown&lt;span class=&quot;token entity&quot; title=&quot;&#92;&amp;quot;&quot;&gt;&#92;&quot;&lt;/span&gt; requires &lt;span class=&quot;token entity&quot; title=&quot;&#92;&amp;quot;&quot;&gt;&#92;&quot;&lt;/span&gt;status&lt;span class=&quot;token entity&quot; title=&quot;&#92;&amp;quot;&quot;&gt;&#92;&quot;&lt;/span&gt; to be &lt;span class=&quot;token entity&quot; title=&quot;&#92;&amp;quot;&quot;&gt;&#92;&quot;&lt;/span&gt;[&lt;span class=&quot;token entity&quot; title=&quot;&#92;&amp;quot;&quot;&gt;&#92;&quot;&lt;/span&gt;Up&lt;span class=&quot;token entity&quot; title=&quot;&#92;&amp;quot;&quot;&gt;&#92;&quot;&lt;/span&gt;]&lt;span class=&quot;token entity&quot; title=&quot;&#92;&amp;quot;&quot;&gt;&#92;&quot;&lt;/span&gt;.&quot;&lt;/span&gt;,
    &lt;span class=&quot;token string&quot;&gt;&quot;code&quot;&lt;/span&gt;&lt;span class=&quot;token builtin class-name&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;INVALID_FLOW_TRANSITION_SINGLE&quot;&lt;/span&gt;,
    &lt;span class=&quot;token string&quot;&gt;&quot;@Common.numericSeverity&quot;&lt;/span&gt;&lt;span class=&quot;token builtin class-name&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;4&lt;/span&gt;
  &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;Nope! Plus, the HTTP status code 409 is &lt;a href=&quot;https://developer.mozilla.org/en-US/docs/Web/HTTP/Reference/Status/409&quot;&gt;nicely appropriate&lt;/a&gt;.&lt;/p&gt;
&lt;h3 id=&quot;flipping-the-switch-the-right-way&quot;&gt;Flipping the switch the right way&lt;/h3&gt;
&lt;p&gt;So how about flipping the switch from down to up?&lt;/p&gt;
&lt;pre class=&quot;language-bash&quot; tabindex=&quot;0&quot;&gt;&lt;code class=&quot;language-bash&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;curl&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;&#92;&lt;/span&gt;
  &lt;span class=&quot;token parameter variable&quot;&gt;--request&lt;/span&gt; POST &lt;span class=&quot;token punctuation&quot;&gt;&#92;&lt;/span&gt;
  &lt;span class=&quot;token parameter variable&quot;&gt;--include&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;&#92;&lt;/span&gt;
  &lt;span class=&quot;token parameter variable&quot;&gt;--url&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&#39;localhost:4004/odata/v4/switch/Switches/1/flipUp&#39;&lt;/span&gt;
HTTP/1.1 &lt;span class=&quot;token number&quot;&gt;204&lt;/span&gt; No Content
X-Powered-By: Express
OData-Version: &lt;span class=&quot;token number&quot;&gt;4.0&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;That seemed to work, but I&#39;ll check anyway:&lt;/p&gt;
&lt;pre class=&quot;language-bash&quot; tabindex=&quot;0&quot;&gt;&lt;code class=&quot;language-bash&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;curl&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;&#92;&lt;/span&gt;
  &lt;span class=&quot;token parameter variable&quot;&gt;--silent&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;&#92;&lt;/span&gt;
  &lt;span class=&quot;token parameter variable&quot;&gt;--url&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&#39;localhost:4004/odata/v4/switch/Switches/1&#39;&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;&#92;&lt;/span&gt;
  &lt;span class=&quot;token operator&quot;&gt;|&lt;/span&gt; jq
&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
  &lt;span class=&quot;token string&quot;&gt;&quot;@odata.context&quot;&lt;/span&gt;&lt;span class=&quot;token builtin class-name&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;&lt;span class=&quot;token variable&quot;&gt;$metadata&lt;/span&gt;#Switches/&lt;span class=&quot;token variable&quot;&gt;$entity&lt;/span&gt;&quot;&lt;/span&gt;,
  &lt;span class=&quot;token string&quot;&gt;&quot;ID&quot;&lt;/span&gt;&lt;span class=&quot;token builtin class-name&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt;,
  &lt;span class=&quot;token string&quot;&gt;&quot;status&quot;&lt;/span&gt;&lt;span class=&quot;token builtin class-name&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;Up&quot;&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;Excellent!&lt;/p&gt;
&lt;h2 id=&quot;wrapping-up&quot;&gt;Wrapping up&lt;/h2&gt;
&lt;p&gt;Of course, there&#39;s a lot more that this new Status-Transition Flows feature offers, but for now, I&#39;m glad I took a first look with this simple example.&lt;/p&gt;
&lt;p&gt;For further explorations and explanations, see Simon Engel&#39;s great session &lt;a href=&quot;https://www.youtube.com/watch?v=1XolXCjN5IQ&quot;&gt;Status Transition Flows in CAP&lt;/a&gt; from Devtoberfest earlier this year, as well as the &lt;a href=&quot;https://cap.cloud.sap/docs/guides/providing-services#status-transition-flows&quot;&gt;coverage in Capire&lt;/a&gt;.&lt;/p&gt;
&lt;p&gt;And remember, this is a beta feature right now, so a great time to try it out for yourself.&lt;/p&gt;
&lt;h2 id=&quot;footnotes&quot;&gt;Footnotes&lt;/h2&gt;
&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;The name of this file is significant, it&#39;s one of the two file items (the rest are directory items) in the &amp;quot;CDS roots&amp;quot;, as illustrated:&lt;/p&gt;
&lt;pre class=&quot;language-bash&quot; tabindex=&quot;0&quot;&gt;&lt;code class=&quot;language-bash&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt; cds &lt;span class=&quot;token function&quot;&gt;env&lt;/span&gt; roots
&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;
  &lt;span class=&quot;token string&quot;&gt;&quot;db/&quot;&lt;/span&gt;,
  &lt;span class=&quot;token string&quot;&gt;&quot;srv/&quot;&lt;/span&gt;,
  &lt;span class=&quot;token string&quot;&gt;&quot;app/&quot;&lt;/span&gt;,
  &lt;span class=&quot;token string&quot;&gt;&quot;schema&quot;&lt;/span&gt;,
  &lt;span class=&quot;token string&quot;&gt;&quot;services&quot;&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;This means that it&#39;s a default (&amp;quot;well-known&amp;quot;) location for CDS model definitions.&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;What&#39;s really going to blow your mind is that &lt;code&gt;annotate&lt;/code&gt; is really &lt;a href=&quot;https://cap.cloud.sap/docs/cds/cdl#the-annotate-directive&quot;&gt;just a shortcut variant&lt;/a&gt; of &lt;code&gt;extend&lt;/code&gt;.&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;I use &lt;code&gt;--include&lt;/code&gt; to have the response headers emitted, but have only included some of them in the output here, to keep things brief.&lt;/p&gt;
&lt;/li&gt;
&lt;/ol&gt;
</content>
  </entry>
  <entry>
    <title>Some ramblings on simple CDS modelling with CDL</title>
    <link href="https://qmacro.org/blog/posts/2025/11/12/some-ramblings-on-simple-cds-modelling-with-cdl/" />
    <updated>2025-11-12T00:00:00Z</updated>
    <id>https://qmacro.org/blog/posts/2025/11/12/some-ramblings-on-simple-cds-modelling-with-cdl/</id>
    <content type="html">&lt;p&gt;I&#39;m taking some time to peruse the &lt;a href=&quot;https://cap.cloud.sap/docs/cds/cdl&quot;&gt;Conceptual Definition Language (CDL)&lt;/a&gt; topic of the CAP documentation, and stopped at the first example in the &lt;a href=&quot;https://cap.cloud.sap/docs/cds/cdl#keywords-identifiers&quot;&gt;Keywords &amp;amp; Identifiers&lt;/a&gt; section, which piqued my interest. Let&#39;s put this in a file called &lt;code&gt;db/keywords-and-identifiers.cds&lt;/code&gt;:&lt;/p&gt;
&lt;pre class=&quot;language-cds&quot; tabindex=&quot;0&quot;&gt;&lt;code class=&quot;language-cds&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;namespace&lt;/span&gt; capire.bookshop;
&lt;span class=&quot;token using keyword&quot;&gt;using&lt;/span&gt; { managed, cuid } &lt;span class=&quot;token from keyword&quot;&gt;from&lt;/span&gt; &#39;@sap/cds/common&#39;;
&lt;span class=&quot;token keyword&quot;&gt;aspect&lt;/span&gt; primary : managed, cuid {}

&lt;span class=&quot;token keyword&quot;&gt;entity&lt;/span&gt; Books : primary {
  title  : &lt;span class=&quot;token type builtin&quot;&gt;String&lt;/span&gt;;
  author : &lt;span class=&quot;token association-composition keyword&quot;&gt;Association to Authors&lt;/span&gt;;
}

&lt;span class=&quot;token keyword&quot;&gt;entity&lt;/span&gt; Authors : primary {
  name   : &lt;span class=&quot;token type builtin&quot;&gt;String&lt;/span&gt;;
}&lt;/code&gt;&lt;/pre&gt;
&lt;blockquote&gt;
&lt;p&gt;I have &lt;a href=&quot;https://github.com/capire/docs/commit/2c42b724a9d6c1efadecfe400c478bbe739365d2&quot;&gt;been involved in tweaking&lt;/a&gt; this section, just so you know.&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h2 id=&quot;two-level-mixin&quot;&gt;Two-level mixin&lt;/h2&gt;
&lt;p&gt;The two-level mixin here made me pause for &lt;a href=&quot;https://qmacro.org/blog/posts/2017/02/19/the-beauty-of-recursion-and-list-machinery/#initial-recognition&quot;&gt;a stare&lt;/a&gt;, and also made me think what this definition looks like once compiled into &lt;a href=&quot;https://cap.cloud.sap/docs/cds/csn&quot;&gt;Core Schema Notation (CSN)&lt;/a&gt;. Let me simplify the above example as much as possible, to reduce any unnecessary noise:&lt;/p&gt;
&lt;pre class=&quot;language-cds&quot; tabindex=&quot;0&quot;&gt;&lt;code class=&quot;language-cds&quot;&gt;&lt;span class=&quot;token using keyword&quot;&gt;using&lt;/span&gt; cuid &lt;span class=&quot;token from keyword&quot;&gt;from&lt;/span&gt; &#39;@sap/cds/common&#39;;
&lt;span class=&quot;token keyword&quot;&gt;aspect&lt;/span&gt; primary : cuid {}

&lt;span class=&quot;token keyword&quot;&gt;entity&lt;/span&gt; Authors : primary {
  name   : &lt;span class=&quot;token type builtin&quot;&gt;String&lt;/span&gt;;
}&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;What do we have here?&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;the import of &lt;code&gt;cuid&lt;/code&gt; on its own (removing the need for the &lt;code&gt;{ ... }&lt;/code&gt; brace construct, by the way); &lt;code&gt;cuid&lt;/code&gt; is an aspect, defined (in &lt;code&gt;@sap/cds/common&lt;/code&gt;) like this: &lt;code&gt;aspect cuid { key ID : UUID; }&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;the definition of another (empty) aspect &lt;code&gt;primary&lt;/code&gt;, which, via the &lt;code&gt;:&lt;/code&gt; &lt;a href=&quot;https://cap.cloud.sap/docs/cds/cdl#includes&quot;&gt;shortcut syntax&lt;/a&gt;, is extended with the &lt;code&gt;cuid&lt;/code&gt; aspect&lt;/li&gt;
&lt;li&gt;the definition of an entity with a single non-key element (&lt;code&gt;name&lt;/code&gt;); this entity is extended with the &lt;code&gt;primary&lt;/code&gt; aspect&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id=&quot;surfacing-the-common-aspect&quot;&gt;Surfacing the common aspect&lt;/h2&gt;
&lt;p&gt;In order to reduce the noise further (especially when we start to look at what this CDS model compiles to), let&#39;s surface the &lt;code&gt;cuid&lt;/code&gt; aspect from &lt;code&gt;@sap/cds/common&lt;/code&gt; so we won&#39;t be inundated with the rest of &lt;code&gt;@sap/cds/common&lt;/code&gt; in what the compiler produces:&lt;/p&gt;
&lt;pre class=&quot;language-cds&quot; tabindex=&quot;0&quot;&gt;&lt;code class=&quot;language-cds&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;aspect&lt;/span&gt; cuid {
  &lt;span class=&quot;token cqlkeywords keyword&quot;&gt;key&lt;/span&gt; ID : &lt;span class=&quot;token type builtin&quot;&gt;UUID&lt;/span&gt;;
}

&lt;span class=&quot;token keyword&quot;&gt;aspect&lt;/span&gt; primary : cuid {}

&lt;span class=&quot;token keyword&quot;&gt;entity&lt;/span&gt; Authors : primary {
  name   : &lt;span class=&quot;token type builtin&quot;&gt;String&lt;/span&gt;;
}&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;Through the &amp;quot;two generation mixin ancestry&amp;quot;:&lt;/p&gt;
&lt;pre class=&quot;language-text&quot; tabindex=&quot;0&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;cuid
  |
  V
primary
  |
  V
Authors&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;the &lt;code&gt;Authors&lt;/code&gt; entity has a primary key &lt;code&gt;ID&lt;/code&gt; as well as the &lt;code&gt;name&lt;/code&gt; element.&lt;/p&gt;
&lt;h2 id=&quot;examining-the-csn&quot;&gt;Examining the CSN&lt;/h2&gt;
&lt;p&gt;What does this look like when compiled to CSN? We&#39;ll take the YAML representation as that is a little less verbose and (arguably) easier to read than the JSON equivalent. Using:&lt;/p&gt;
&lt;pre class=&quot;language-bash&quot; tabindex=&quot;0&quot;&gt;&lt;code class=&quot;language-bash&quot;&gt;cds compile &lt;span class=&quot;token parameter variable&quot;&gt;--to&lt;/span&gt; yaml db/keywords-and-identifiers.cds&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;we get:&lt;/p&gt;
&lt;pre class=&quot;language-yaml&quot; tabindex=&quot;0&quot;&gt;&lt;code class=&quot;language-yaml&quot;&gt;&lt;span class=&quot;token key atrule&quot;&gt;definitions&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
  &lt;span class=&quot;token key atrule&quot;&gt;cuid&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;token key atrule&quot;&gt;kind&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; aspect&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token key atrule&quot;&gt;elements&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;token key atrule&quot;&gt;ID&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;token key atrule&quot;&gt;key&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token boolean important&quot;&gt;true&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token key atrule&quot;&gt;type&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; cds.UUID&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
  &lt;span class=&quot;token key atrule&quot;&gt;primary&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;token key atrule&quot;&gt;kind&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; aspect&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token key atrule&quot;&gt;includes&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;cuid&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token key atrule&quot;&gt;elements&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;token key atrule&quot;&gt;ID&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;token key atrule&quot;&gt;key&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token boolean important&quot;&gt;true&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token key atrule&quot;&gt;type&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; cds.UUID&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
  &lt;span class=&quot;token key atrule&quot;&gt;Authors&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
    &lt;span class=&quot;token key atrule&quot;&gt;kind&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; entity
    &lt;span class=&quot;token key atrule&quot;&gt;includes&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;primary&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;
    &lt;span class=&quot;token key atrule&quot;&gt;elements&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;token key atrule&quot;&gt;ID&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;token key atrule&quot;&gt;key&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token boolean important&quot;&gt;true&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token key atrule&quot;&gt;type&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; cds.UUID&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token key atrule&quot;&gt;name&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;token key atrule&quot;&gt;type&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; cds.String&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;token key atrule&quot;&gt;meta&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;token key atrule&quot;&gt;creator&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; CDS Compiler v6.4.6&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token key atrule&quot;&gt;flavor&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; inferred&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;token key atrule&quot;&gt;$version&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;2.0&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;
&lt;h2 id=&quot;imperative-vs-declarative&quot;&gt;Imperative vs declarative&lt;/h2&gt;
&lt;p&gt;CDS modelling is predominantly achieved in a declarative fashion, with one of the Domain Specific Languages (DSLs) &lt;a href=&quot;https://cap.cloud.sap/docs/cds/&quot;&gt;available to us&lt;/a&gt;: CDL. But within CDL there are a small number of keywords that are, philosophically, more imperative than declarative - &lt;code&gt;extend&lt;/code&gt; being one of them (&lt;code&gt;annotate&lt;/code&gt;&lt;a href=&quot;https://qmacro.org/blog/posts/2025/11/12/some-ramblings-on-simple-cds-modelling-with-cdl/#footnotes&quot;&gt;&lt;sup&gt;1&lt;/sup&gt;&lt;/a&gt; and &lt;code&gt;define&lt;/code&gt; are imperative too).&lt;/p&gt;
&lt;p&gt;Adding the &lt;code&gt;ID&lt;/code&gt; key field to the &lt;code&gt;Authors&lt;/code&gt; entity via these aspects has been done declaratively, using the &lt;a href=&quot;https://cap.cloud.sap/docs/cds/cdl#includes&quot;&gt;shortcut syntax&lt;/a&gt; we examined earlier, i.e. with the &lt;code&gt;:&lt;/code&gt; symbol:&lt;/p&gt;
&lt;pre class=&quot;language-cds&quot; tabindex=&quot;0&quot;&gt;&lt;code class=&quot;language-cds&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;aspect&lt;/span&gt; primary : cuid {}
&lt;span class=&quot;token keyword&quot;&gt;entity&lt;/span&gt; Authors : primary { ... }&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;But in fact we can achieve the same outcome using this more imperative form of extension syntax, with the &lt;code&gt;extend&lt;/code&gt; keyword:&lt;/p&gt;
&lt;pre class=&quot;language-cds&quot; tabindex=&quot;0&quot;&gt;&lt;code class=&quot;language-cds&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;aspect&lt;/span&gt; primary {}

&lt;span class=&quot;token keyword&quot;&gt;entity&lt;/span&gt; Authors {
  name : &lt;span class=&quot;token type builtin&quot;&gt;String&lt;/span&gt;;
}

&lt;span class=&quot;token keyword&quot;&gt;extend&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;aspect&lt;/span&gt; primary with cuid;
&lt;span class=&quot;token keyword&quot;&gt;extend&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;entity&lt;/span&gt; Authors with primary;&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;This results in the same logical &lt;code&gt;Authors&lt;/code&gt; entity; I say &amp;quot;logical&amp;quot; as the compiler produces the definition with the elements in the order directly reflected in the top-to-bottom flow of the CDL, in other words, &lt;code&gt;name&lt;/code&gt; followed by &lt;code&gt;ID&lt;/code&gt;:&lt;/p&gt;
&lt;pre class=&quot;language-yaml&quot; tabindex=&quot;0&quot;&gt;&lt;code class=&quot;language-yaml&quot;&gt;&lt;span class=&quot;token key atrule&quot;&gt;Authors&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
  &lt;span class=&quot;token key atrule&quot;&gt;kind&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; entity
  &lt;span class=&quot;token key atrule&quot;&gt;includes&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;primary&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;
  &lt;span class=&quot;token key atrule&quot;&gt;elements&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;token key atrule&quot;&gt;name&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;token key atrule&quot;&gt;type&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; cds.String&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token key atrule&quot;&gt;ID&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;token key atrule&quot;&gt;key&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token boolean important&quot;&gt;true&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token key atrule&quot;&gt;type&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; cds.UUID&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;
&lt;h2 id=&quot;aspects-and-types&quot;&gt;Aspects and types&lt;/h2&gt;
&lt;p&gt;So far in this simple model there are aspects and an entity. The aspects we&#39;ve seen here are &lt;a href=&quot;https://cap.cloud.sap/docs/cds/cdl#named-aspects&quot;&gt;named&lt;/a&gt;, which allows us to think of them as first class citizens in our model, define them ahead of time, and use them to extend multiple targets. This section is in that context of &amp;quot;named aspects&amp;quot;, rather than anonymous ones, which is perhaps a topic for another time.&lt;/p&gt;
&lt;p&gt;Both aspects and entities represent structures (of elements), but entities differ from aspects in that they are normally manifested at the persistence layer, whereas aspects are not.&lt;/p&gt;
&lt;p&gt;There is another construct available to us in CDL, and that is the &lt;a href=&quot;https://cap.cloud.sap/docs/cds/cdl#type-definitions&quot;&gt;type definition&lt;/a&gt;. While aspects are possibly less familiar to developers who have not been enlightened by &lt;a href=&quot;https://en.wikipedia.org/wiki/Aspect-oriented_programming&quot;&gt;Aspect-oriented programming&lt;/a&gt;, types are what you expect them to be: custom, sometimes composite, definitions of element/type pairs.&lt;/p&gt;
&lt;p&gt;The example in Capire&#39;s &lt;a href=&quot;https://cap.cloud.sap/docs/cds/cdl#type-definitions&quot;&gt;Type Definitions&lt;/a&gt; section has some nice examples:&lt;/p&gt;
&lt;pre class=&quot;language-cds&quot; tabindex=&quot;0&quot;&gt;&lt;code class=&quot;language-cds&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;define&lt;/span&gt; &lt;span class=&quot;token cqlkeywords keyword&quot;&gt;type&lt;/span&gt; User : &lt;span class=&quot;token type builtin&quot;&gt;String(111)&lt;/span&gt;;
&lt;span class=&quot;token keyword&quot;&gt;define&lt;/span&gt; &lt;span class=&quot;token cqlkeywords keyword&quot;&gt;type&lt;/span&gt; Amount {
  value : &lt;span class=&quot;token type builtin&quot;&gt;Decimal(10,3)&lt;/span&gt;;
  currency : Currency;
}
&lt;span class=&quot;token keyword&quot;&gt;define&lt;/span&gt; &lt;span class=&quot;token cqlkeywords keyword&quot;&gt;type&lt;/span&gt; Currency : &lt;span class=&quot;token association-composition keyword&quot;&gt;Association to Currencies&lt;/span&gt;;&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;Given that types can be structures, just like aspects, can they be used to extend? The answer is a qualified &amp;quot;yes&amp;quot;.&lt;/p&gt;
&lt;p&gt;Let&#39;s say we wanted to add some origin info to our authors. How about the use of a new &lt;code&gt;origin&lt;/code&gt; aspect:&lt;/p&gt;
&lt;pre class=&quot;language-cds&quot; tabindex=&quot;0&quot;&gt;&lt;code class=&quot;language-cds&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;aspect&lt;/span&gt; cuid {
  &lt;span class=&quot;token cqlkeywords keyword&quot;&gt;key&lt;/span&gt; ID : &lt;span class=&quot;token type builtin&quot;&gt;UUID
&lt;/span&gt;};

&lt;span class=&quot;token keyword&quot;&gt;aspect&lt;/span&gt; origin {
  countryOfBirth : &lt;span class=&quot;token type builtin&quot;&gt;String&lt;/span&gt;;
}

&lt;span class=&quot;token keyword&quot;&gt;aspect&lt;/span&gt; primary : cuid, origin {}

&lt;span class=&quot;token keyword&quot;&gt;entity&lt;/span&gt; Authors : primary {
  name : &lt;span class=&quot;token type builtin&quot;&gt;String&lt;/span&gt;;
}&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;This conveys the new &lt;code&gt;countryOfBirth&lt;/code&gt; element to the &lt;code&gt;Authors&lt;/code&gt; entity, via the two-level mixin, as expected:&lt;/p&gt;
&lt;pre class=&quot;language-yaml&quot; tabindex=&quot;0&quot;&gt;&lt;code class=&quot;language-yaml&quot;&gt;&lt;span class=&quot;token key atrule&quot;&gt;definitions&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
  &lt;span class=&quot;token key atrule&quot;&gt;cuid&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;token key atrule&quot;&gt;kind&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; aspect&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token key atrule&quot;&gt;elements&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;token key atrule&quot;&gt;ID&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;token key atrule&quot;&gt;key&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token boolean important&quot;&gt;true&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token key atrule&quot;&gt;type&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; cds.UUID&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
  &lt;span class=&quot;token key atrule&quot;&gt;origin&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;token key atrule&quot;&gt;kind&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; aspect&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token key atrule&quot;&gt;elements&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;token key atrule&quot;&gt;countryOfBirth&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;token key atrule&quot;&gt;type&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; cds.String&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
  &lt;span class=&quot;token key atrule&quot;&gt;primary&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
    &lt;span class=&quot;token key atrule&quot;&gt;kind&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; aspect
    &lt;span class=&quot;token key atrule&quot;&gt;includes&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;cuid&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; origin&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;
    &lt;span class=&quot;token key atrule&quot;&gt;elements&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;token key atrule&quot;&gt;ID&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;token key atrule&quot;&gt;key&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token boolean important&quot;&gt;true&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token key atrule&quot;&gt;type&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; cds.UUID&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token key atrule&quot;&gt;countryOfBirth&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;token key atrule&quot;&gt;type&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; cds.String&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
  &lt;span class=&quot;token key atrule&quot;&gt;Authors&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
    &lt;span class=&quot;token key atrule&quot;&gt;kind&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; entity
    &lt;span class=&quot;token key atrule&quot;&gt;includes&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;primary&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;
    &lt;span class=&quot;token key atrule&quot;&gt;elements&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;token key atrule&quot;&gt;ID&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;token key atrule&quot;&gt;key&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token boolean important&quot;&gt;true&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token key atrule&quot;&gt;type&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; cds.UUID&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token key atrule&quot;&gt;countryOfBirth&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;token key atrule&quot;&gt;type&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; cds.String&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token key atrule&quot;&gt;name&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;token key atrule&quot;&gt;type&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; cds.String&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;token key atrule&quot;&gt;meta&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;token key atrule&quot;&gt;creator&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; CDS Compiler v6.4.6&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token key atrule&quot;&gt;flavor&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; inferred&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;token key atrule&quot;&gt;$version&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;2.0&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;What if we were to re-specify &lt;code&gt;origin&lt;/code&gt; as a type?&lt;/p&gt;
&lt;pre class=&quot;language-cds&quot; tabindex=&quot;0&quot;&gt;&lt;code class=&quot;language-cds&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;aspect&lt;/span&gt; cuid {
  &lt;span class=&quot;token cqlkeywords keyword&quot;&gt;key&lt;/span&gt; ID : &lt;span class=&quot;token type builtin&quot;&gt;UUID
&lt;/span&gt;};

&lt;span class=&quot;token cqlkeywords keyword&quot;&gt;type&lt;/span&gt; origin {
  countryOfBirth : &lt;span class=&quot;token type builtin&quot;&gt;String&lt;/span&gt;;
}

&lt;span class=&quot;token keyword&quot;&gt;aspect&lt;/span&gt; primary : cuid, origin {}

&lt;span class=&quot;token keyword&quot;&gt;entity&lt;/span&gt; Authors : primary {
  name : &lt;span class=&quot;token type builtin&quot;&gt;String&lt;/span&gt;;
}&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;While the intermediate definitions do reflect the &lt;code&gt;origin&lt;/code&gt;&#39;s &amp;quot;kind&amp;quot;, the end result in the entity is the same:&lt;/p&gt;
&lt;pre class=&quot;language-yaml&quot; tabindex=&quot;0&quot;&gt;&lt;code class=&quot;language-yaml&quot;&gt;&lt;span class=&quot;token key atrule&quot;&gt;definitions&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
  &lt;span class=&quot;token key atrule&quot;&gt;cuid&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;token key atrule&quot;&gt;kind&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; aspect&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token key atrule&quot;&gt;elements&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;token key atrule&quot;&gt;ID&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;token key atrule&quot;&gt;key&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token boolean important&quot;&gt;true&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token key atrule&quot;&gt;type&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; cds.UUID&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
  &lt;span class=&quot;token key atrule&quot;&gt;origin&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;token key atrule&quot;&gt;kind&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; type&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token key atrule&quot;&gt;elements&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;token key atrule&quot;&gt;countryOfBirth&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;token key atrule&quot;&gt;type&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; cds.String&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
  &lt;span class=&quot;token key atrule&quot;&gt;primary&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
    &lt;span class=&quot;token key atrule&quot;&gt;kind&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; aspect
    &lt;span class=&quot;token key atrule&quot;&gt;includes&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;cuid&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; origin&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;
    &lt;span class=&quot;token key atrule&quot;&gt;elements&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;token key atrule&quot;&gt;ID&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;token key atrule&quot;&gt;key&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token boolean important&quot;&gt;true&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token key atrule&quot;&gt;type&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; cds.UUID&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token key atrule&quot;&gt;countryOfBirth&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;token key atrule&quot;&gt;type&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; cds.String&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
  &lt;span class=&quot;token key atrule&quot;&gt;Authors&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
    &lt;span class=&quot;token key atrule&quot;&gt;kind&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; entity
    &lt;span class=&quot;token key atrule&quot;&gt;includes&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;primary&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;
    &lt;span class=&quot;token key atrule&quot;&gt;elements&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;token key atrule&quot;&gt;ID&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;token key atrule&quot;&gt;key&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token boolean important&quot;&gt;true&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token key atrule&quot;&gt;type&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; cds.UUID&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token key atrule&quot;&gt;countryOfBirth&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;token key atrule&quot;&gt;type&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; cds.String&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token key atrule&quot;&gt;name&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;token key atrule&quot;&gt;type&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; cds.String&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;token key atrule&quot;&gt;meta&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;token key atrule&quot;&gt;creator&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; CDS Compiler v6.4.6&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token key atrule&quot;&gt;flavor&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; inferred&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;token key atrule&quot;&gt;$version&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;2.0&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;This surprised me at first, but after all, CDL is an eminently flexible language with beauty in its simplicity and flexibility.&lt;/p&gt;
&lt;h2 id=&quot;no-keys-in-types&quot;&gt;No keys in types&lt;/h2&gt;
&lt;p&gt;One interesting difference between types and aspects in this regard is the conveyance of key elements. If we were to decide (for the sake of illustration) that &lt;code&gt;countryOfBirth&lt;/code&gt; were to be a key element, in the aspect variation:&lt;/p&gt;
&lt;pre class=&quot;language-cds&quot; tabindex=&quot;0&quot;&gt;&lt;code class=&quot;language-cds&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;aspect&lt;/span&gt; origin {
  &lt;span class=&quot;token cqlkeywords keyword&quot;&gt;key&lt;/span&gt; countryOfBirth : &lt;span class=&quot;token type builtin&quot;&gt;String&lt;/span&gt;;
}&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;that would be fine and all would be well.&lt;/p&gt;
&lt;p&gt;If we tried this in the type variation:&lt;/p&gt;
&lt;pre class=&quot;language-cds&quot; tabindex=&quot;0&quot;&gt;&lt;code class=&quot;language-cds&quot;&gt;&lt;span class=&quot;token cqlkeywords keyword&quot;&gt;type&lt;/span&gt; origin {
  &lt;span class=&quot;token cqlkeywords keyword&quot;&gt;key&lt;/span&gt; countryOfBirth : &lt;span class=&quot;token type builtin&quot;&gt;String&lt;/span&gt;;
}&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;then we&#39;d get a compiler warning&lt;a href=&quot;https://qmacro.org/blog/posts/2025/11/12/some-ramblings-on-simple-cds-modelling-with-cdl/#footnotes&quot;&gt;&lt;sup&gt;2&lt;/sup&gt;&lt;/a&gt;:&lt;/p&gt;
&lt;pre class=&quot;language-log&quot; tabindex=&quot;0&quot;&gt;&lt;code class=&quot;language-log&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;token level warning important&quot;&gt;WARNING&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt; db&lt;span class=&quot;token operator&quot;&gt;/&lt;/span&gt;keywords&lt;span class=&quot;token operator&quot;&gt;-&lt;/span&gt;and&lt;span class=&quot;token operator&quot;&gt;-&lt;/span&gt;identifiers&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;cds&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;10&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;3&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;-&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;6&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt;
  â€˜keyâ€™ is only supported for elements in an entity or an aspect
  &lt;span class=&quot;token operator&quot;&gt;(&lt;/span&gt;in type&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt;â€œhumanIDâ€&lt;span class=&quot;token operator&quot;&gt;/&lt;/span&gt;element&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt;â€œemployeeNrâ€&lt;span class=&quot;token operator&quot;&gt;)&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;This warning message ID is &lt;code&gt;def-unsupported-key&lt;/code&gt;; you may wish to peruse the &lt;a href=&quot;https://cap.cloud.sap/docs/cds/compiler/messages&quot;&gt;Compiler Messages&lt;/a&gt; topic of Capire for more fascinating insights (this particular warning is not yet listed).&lt;/p&gt;
&lt;p&gt;This is only a warning, and the compiler will still (currently) honour the key element in the entity, but it doesn&#39;t feel right to use a type like this, hence the &amp;quot;qualified yes&amp;quot;.&lt;/p&gt;
&lt;p&gt;Stopping to think about this a little, I am minded to reflect that the flexibility and simplicity of CDL is augmented by the intent conveyed by the semantics of the keywords themselves. I could imagine a version of CDL where both the &lt;code&gt;aspect&lt;/code&gt; and &lt;code&gt;type&lt;/code&gt; keywords were absent, replaced with a single &lt;code&gt;struct&lt;/code&gt; keyword&lt;a href=&quot;https://qmacro.org/blog/posts/2025/11/12/some-ramblings-on-simple-cds-modelling-with-cdl/#footnotes&quot;&gt;&lt;sup&gt;3&lt;/sup&gt;&lt;/a&gt;.
But that would, for me at least, make the language less approachable, less rich in expressiveness and the ability to show intent.&lt;/p&gt;
&lt;p&gt;And while one ultimate target of CDL is the machine readable equivalent (CSN), another ultimate target ... is us humans, in our endeavour to model business domains together.&lt;/p&gt;
&lt;h2 id=&quot;footnotes&quot;&gt;Footnotes&lt;/h2&gt;
&lt;ol&gt;
&lt;li&gt;It may interest you to know that &lt;code&gt;annotate&lt;/code&gt; &lt;a href=&quot;https://cap.cloud.sap/docs/cds/cdl#the-annotate-directive&quot;&gt;is a shortcut for&lt;/a&gt; &lt;code&gt;extend&lt;/code&gt;.&lt;/li&gt;
&lt;li&gt;I also get a warning in my editor thanks to CAP&#39;s language server for CDS.&lt;/li&gt;
&lt;li&gt;On that note, it may interest you to read the &lt;a href=&quot;https://cap.cloud.sap/docs/cds/csn#structured-types&quot;&gt;Structured Types&lt;/a&gt; section of Capire&#39;s CSN topic, where it says that &amp;quot;&lt;em&gt;structured types are signified by the presence of an &lt;code&gt;elements&lt;/code&gt; property&lt;/em&gt;&amp;quot;. Did you notice that each definition in the final YAML representation of the compiled model -- whether entity, aspect or type -- has an &lt;code&gt;elements&lt;/code&gt; property?&lt;/li&gt;
&lt;/ol&gt;
</content>
  </entry>
  <entry>
    <title>Hands-on domain modelling with CAP&#39;s CDS at UKISUG Connect</title>
    <link href="https://qmacro.org/blog/posts/2025/11/11/hands-on-domain-modelling-with-caps-cds-at-ukisug-connect/" />
    <updated>2025-11-11T00:00:00Z</updated>
    <id>https://qmacro.org/blog/posts/2025/11/11/hands-on-domain-modelling-with-caps-cds-at-ukisug-connect/</id>
    <content type="html">&lt;p&gt;As I mentioned in my &lt;a href=&quot;https://qmacro.org/blog/posts/2025/09/10/upcoming-talks-in-autumn-2025/&quot;&gt;Upcoming talks in autumn 2025&lt;/a&gt; post recently, I&#39;ll be attending and speaking at &lt;a href=&quot;https://www.ukisugconnect.co.uk/&quot;&gt;UKISUG Connect&lt;/a&gt;. I have a couple of sessions, a hands-on workshop on the &lt;a href=&quot;https://virtual.oxfordabstracts.com/event/75555/program?date=%222025-11-30%22&quot;&gt;Sunday&lt;/a&gt; and a technical track talk on the &lt;a href=&quot;https://virtual.oxfordabstracts.com/event/75555/program?date=%222025-12-1%22&quot;&gt;Monday&lt;/a&gt;.&lt;/p&gt;
&lt;p&gt;In this post I want to describe the hands-on workshop, what to expect, and (if you intend to participate in the actual hands-on part) what you need.&lt;/p&gt;
&lt;p&gt;First, from the &lt;a href=&quot;https://virtual.oxfordabstracts.com/event/75555/submission/101&quot;&gt;session page&lt;/a&gt;, here&#39;s the synopsis:&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;Become acquainted with CAP&#39;s CDS, the common language that binds domain experts, with their key business &amp;amp; process knowledge, to developers. A hands-on-optional session where we&#39;ll explore the language &amp;amp; concepts together and get comfortable with it.&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;There are also the full session details:&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;What happened to systems analysts, module specialists?&lt;/p&gt;
&lt;p&gt;Nothing - they&#39;re still here, and called &amp;quot;domain experts&amp;quot;. What&#39;s more, there&#39;s a common language that binds them, with their key business &amp;amp; process knowledge, to developers, with their knowledge of best practices &amp;amp; developer tools.&lt;/p&gt;
&lt;p&gt;That common language is CDS - a succinct, powerful and flexible way to describe the domain model and associated functionality for a given solution.&lt;/p&gt;
&lt;p&gt;We&#39;ll learn by doing, collaboratively exploring how to model entities, relationships, functions and more to build the domain model definition to be at the heart of the solution.&lt;/p&gt;
&lt;p&gt;Bring and work on your own laptop (setup instructions provided) or just take part in the Q&amp;amp;A style conversation led by the instructor.&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;That last sentence is important, and worth explaining. I would like to make the session as welcoming and open as possible, even to those with no prior experience of CAP or CDS, and to non-developers.&lt;/p&gt;
&lt;p&gt;Additionally, I know that some folks simply may not have their laptops with them, or not want to set things up to participate in the exercises. That is absolutely fine.&lt;/p&gt;
&lt;p&gt;You can participate:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;either on your laptop, working through the exercises with me and the rest of your fellow hands-on enthusiasts&lt;/li&gt;
&lt;li&gt;or listen &amp;amp; watch, and take part in the conversation we&#39;ll have throughout the 2 hours, as I work through the exercises myself too, on the big screen, for all to see&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;The first option will require you to set up (or already have) a trial account on the SAP Business Technology Platform (BTP) - more on that in the &lt;a href=&quot;https://qmacro.org/blog/posts/2025/11/11/hands-on-domain-modelling-with-caps-cds-at-ukisug-connect/#preparation-for-doing-the-exercises&quot;&gt;Preparation for doing the exercises&lt;/a&gt; section below.&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;https://qmacro.org/images/2025/11/hands-on-session-2024.jpg&quot; alt=&quot;A photo of a hands-on workshop I ran last year at the event&quot;&gt;&lt;/p&gt;
&lt;p&gt;The second option is just as valid and the more questions and back and forth we generate between us the better for all! And there&#39;s no preparation required, except perhaps to pack your curiosity and bring it with you.&lt;/p&gt;
&lt;h2 id=&quot;preparation-for-doing-the-exercises&quot;&gt;Preparation for doing the exercises&lt;/h2&gt;
&lt;p&gt;If you do want to take the first option, and work through the exercises on your laptop as I lead the session working through them myself, then arguably the easiest option for you is to use the SAP Business Application Studio, the online IDE available for free in an BTP trial account.&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;To get a trial account, follow the tutorial &lt;a href=&quot;https://developers.sap.com/tutorials/hcp-create-trial-account.html&quot;&gt;Get an Account on SAP BTP Trial&lt;/a&gt;.&lt;/li&gt;
&lt;li&gt;Once you&#39;ve done that, follow the tutorial &lt;a href=&quot;https://developers.sap.com/tutorials/appstudio-onboarding.html&quot;&gt;Set Up SAP Business Application Studio for Development&lt;/a&gt;.&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;Then you&#39;re all set.&lt;/p&gt;
&lt;p&gt;Either way, I encourage you to pop down to the hands-on workshop rooms on Sunday afternoon and join me!&lt;/p&gt;
</content>
  </entry>
  <entry>
    <title>Quiet cds test output - two ways</title>
    <link href="https://qmacro.org/blog/posts/2025/10/20/quiet-cds-test-output-two-ways/" />
    <updated>2025-10-20T00:00:00Z</updated>
    <id>https://qmacro.org/blog/posts/2025/10/20/quiet-cds-test-output-two-ways/</id>
    <content type="html">&lt;h2 id=&quot;background&quot;&gt;Background&lt;/h2&gt;
&lt;p&gt;I watched Mauricio Lauffer&#39;s Devtoberfest session &lt;a href=&quot;https://www.youtube.com/watch?v=6kfixPTQH4U&quot;&gt;Testing SAP CAP Node.js apps with cds.test&lt;/a&gt; yesterday, it was great. Thanks Mauricio! It&#39;s a nice accompaniment to the &lt;a href=&quot;https://cap.cloud.sap/docs/node.js/cds-test&quot;&gt;Testing with cds.test&lt;/a&gt; topic in Capire.&lt;/p&gt;
&lt;h2 id=&quot;setting-up-a-test-project&quot;&gt;Setting up a test project&lt;/h2&gt;
&lt;p&gt;I set up a small project to try things out myself (using CAP Node.js, with my &lt;code&gt;@sap/cds-dk&lt;/code&gt; at 9.4.1):&lt;/p&gt;
&lt;pre class=&quot;language-bash&quot; tabindex=&quot;0&quot;&gt;&lt;code class=&quot;language-bash&quot;&gt;cds init &lt;span class=&quot;token parameter variable&quot;&gt;--add&lt;/span&gt; tiny-sample,test proj &lt;span class=&quot;token operator&quot;&gt;&amp;amp;&amp;amp;&lt;/span&gt; &lt;span class=&quot;token builtin class-name&quot;&gt;cd&lt;/span&gt; &lt;span class=&quot;token variable&quot;&gt;$_&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;&amp;amp;&amp;amp;&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;npm&lt;/span&gt; i&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;This produced:&lt;/p&gt;
&lt;pre class=&quot;language-log&quot; tabindex=&quot;0&quot;&gt;&lt;code class=&quot;language-log&quot;&gt;creating new CAP project in &lt;span class=&quot;token file-path string&quot;&gt;./proj&lt;/span&gt;

adding nodejs
adding tiny&lt;span class=&quot;token operator&quot;&gt;-&lt;/span&gt;sample
adding test
&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt; writing test&lt;span class=&quot;token operator&quot;&gt;/&lt;/span&gt;CatalogService&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;test&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;js

successfully created project â€“ continue with cd proj

find samples on &lt;span class=&quot;token url&quot;&gt;https://github.com/capire/samples&lt;/span&gt;
learn about next steps at &lt;span class=&quot;token url&quot;&gt;https://cap.cloud.sap&lt;/span&gt;

added &lt;span class=&quot;token number&quot;&gt;134&lt;/span&gt; packages&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; and audited &lt;span class=&quot;token number&quot;&gt;135&lt;/span&gt; packages in &lt;span class=&quot;token number&quot;&gt;5s&lt;/span&gt;

&lt;span class=&quot;token number&quot;&gt;25&lt;/span&gt; packages are looking for funding
  run `npm fund` for details

found &lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt; vulnerabilities&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;I was now in the position to experiment.&lt;/p&gt;
&lt;h2 id=&quot;the-basic-testing-artifacts&quot;&gt;The basic testing artifacts&lt;/h2&gt;
&lt;p&gt;By default, adding the &lt;code&gt;test&lt;/code&gt; facet created &lt;code&gt;test/CatalogService.test.js&lt;/code&gt;:&lt;/p&gt;
&lt;pre class=&quot;language-log&quot; tabindex=&quot;0&quot;&gt;&lt;code class=&quot;language-log&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;
â”œâ”€â”€ README&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;md
â”œâ”€â”€ app
â”œâ”€â”€ db
â”‚   â”œâ”€â”€ data
â”‚   â”‚   â””â”€â”€ my&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;bookshop&lt;span class=&quot;token operator&quot;&gt;-&lt;/span&gt;Books&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;csv
â”‚   â””â”€â”€ &lt;span class=&quot;token domain constant&quot;&gt;schema.cds&lt;/span&gt;
â”œâ”€â”€ &lt;span class=&quot;token domain constant&quot;&gt;eslint.config.mjs&lt;/span&gt;
â”œâ”€â”€ &lt;span class=&quot;token domain constant&quot;&gt;package-lock.json&lt;/span&gt;
â”œâ”€â”€ &lt;span class=&quot;token domain constant&quot;&gt;package.json&lt;/span&gt;
â”œâ”€â”€ srv
â”‚   â””â”€â”€ &lt;span class=&quot;token domain constant&quot;&gt;cat-service.cds&lt;/span&gt;
â””â”€â”€ test
    â””â”€â”€ CatalogService&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;test&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;js&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;Additionally, in &lt;code&gt;package.json&lt;/code&gt;:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;code&gt;@cap-js/cds-test&lt;/code&gt; was added as a dev dependency&lt;/li&gt;
&lt;li&gt;a new script &lt;code&gt;test&lt;/code&gt; was added which invokes &lt;code&gt;node --test&lt;/code&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;The &lt;code&gt;test/CatalogService.test.js&lt;/code&gt; file contains a fixture to test the &lt;code&gt;CatalogService&lt;/code&gt; endpoint, specifically the &lt;code&gt;Books&lt;/code&gt; entityset, where I modified the expected book subset to be one of the items in the initial data, i.e. &lt;code&gt;{&amp;quot;ID&amp;quot;: 2, &amp;quot;title&amp;quot;: &amp;quot;Jane Eyre&amp;quot;}&lt;/code&gt;.&lt;/p&gt;
&lt;p&gt;So far so good.&lt;/p&gt;
&lt;h2 id=&quot;the-first-test-run&quot;&gt;The first test run&lt;/h2&gt;
&lt;p&gt;When I invoke the test cycle, with &lt;code&gt;npm test&lt;/code&gt; (causing &lt;code&gt;node --test&lt;/code&gt; to run), I see this:&lt;/p&gt;
&lt;pre class=&quot;language-log&quot; tabindex=&quot;0&quot;&gt;&lt;code class=&quot;language-log&quot;&gt;&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt; proj&lt;span class=&quot;token operator&quot;&gt;@&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;1.0.0&lt;/span&gt; test
&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt; node &lt;span class=&quot;token operator&quot;&gt;-&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;-&lt;/span&gt;test

&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;cds&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;-&lt;/span&gt; loaded model from &lt;span class=&quot;token number&quot;&gt;3&lt;/span&gt; file&lt;span class=&quot;token operator&quot;&gt;(&lt;/span&gt;s&lt;span class=&quot;token operator&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt;

  srv&lt;span class=&quot;token operator&quot;&gt;/&lt;/span&gt;cat&lt;span class=&quot;token operator&quot;&gt;-&lt;/span&gt;service&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;cds
  node_modules&lt;span class=&quot;token operator&quot;&gt;/&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;@&lt;/span&gt;sap&lt;span class=&quot;token operator&quot;&gt;/&lt;/span&gt;cds&lt;span class=&quot;token operator&quot;&gt;/&lt;/span&gt;srv&lt;span class=&quot;token operator&quot;&gt;/&lt;/span&gt;outbox&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;cds
  db&lt;span class=&quot;token operator&quot;&gt;/&lt;/span&gt;schema&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;cds

&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;cds&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;-&lt;/span&gt; connect to db &lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt; sqlite &lt;span class=&quot;token operator&quot;&gt;{&lt;/span&gt; url&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&#39;:memory:&#39;&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;}&lt;/span&gt;
  &lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt; init from db&lt;span class=&quot;token operator&quot;&gt;/&lt;/span&gt;data&lt;span class=&quot;token operator&quot;&gt;/&lt;/span&gt;my&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;bookshop&lt;span class=&quot;token operator&quot;&gt;-&lt;/span&gt;Books&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;csv
&lt;span class=&quot;token operator&quot;&gt;/&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt; successfully deployed to in&lt;span class=&quot;token operator&quot;&gt;-&lt;/span&gt;memory database&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;

&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;cds&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;-&lt;/span&gt; using auth strategy &lt;span class=&quot;token operator&quot;&gt;{&lt;/span&gt;
  &lt;span class=&quot;token property&quot;&gt;kind:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&#39;mocked&#39;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
  &lt;span class=&quot;token property&quot;&gt;impl:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&#39;node_modules/@sap/cds/lib/srv/middlewares/auth/basic-auth.js&#39;&lt;/span&gt;
&lt;span class=&quot;token operator&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;cds&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;-&lt;/span&gt; serving CatalogService &lt;span class=&quot;token operator&quot;&gt;{&lt;/span&gt;
  &lt;span class=&quot;token property&quot;&gt;at:&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&#39;/odata/v4/catalog&#39;&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
  &lt;span class=&quot;token property&quot;&gt;decl:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&#39;srv/cat-service.cds:3&#39;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
  &lt;span class=&quot;token property&quot;&gt;impl:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&#39;node_modules/@sap/cds/srv/app-service.js&#39;&lt;/span&gt;
&lt;span class=&quot;token operator&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;cds&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;-&lt;/span&gt; server listening on &lt;span class=&quot;token operator&quot;&gt;{&lt;/span&gt; url&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&#39;http://localhost:34593&#39;&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;cds&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;-&lt;/span&gt; server &lt;span class=&quot;token number&quot;&gt;v9.4.3&lt;/span&gt; launched in &lt;span class=&quot;token number&quot;&gt;185&lt;/span&gt; ms
âœ” &lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt;next&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;105.447291ms&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;odata&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;-&lt;/span&gt; GET &lt;span class=&quot;token file-path string&quot;&gt;/odata/v4/catalog/CatalogService.Books&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;{&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&#39;$select&#39;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&#39;ID,title&#39;&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;}&lt;/span&gt;
â–¶ OData APIs
  âœ” serves CatalogService&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;Books &lt;span class=&quot;token operator&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;18.874042ms&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;)&lt;/span&gt;
âœ” OData APIs &lt;span class=&quot;token operator&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;19.020667ms&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;)&lt;/span&gt;
â„¹ tests &lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt;
â„¹ suites &lt;span class=&quot;token number&quot;&gt;2&lt;/span&gt;
â„¹ pass &lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt;
â„¹ fail &lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt;
â„¹ cancelled &lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt;
â„¹ skipped &lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt;
â„¹ todo &lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt;
â„¹ duration_ms &lt;span class=&quot;token number&quot;&gt;220.950041&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;That&#39;s quite a lot of output, and it&#39;s not as easy as it could be to discern what happened.&lt;/p&gt;
&lt;h2 id=&quot;using-cds-log-levels&quot;&gt;Using cds.log.levels&lt;/h2&gt;
&lt;p&gt;One way to address this, &lt;a href=&quot;https://github.com/mauriciolauffer/devtoberfest2025/blob/main/package.json&quot;&gt;as Mauricio did&lt;/a&gt;, is to reduce the output of certain modules to nothing, using &lt;code&gt;silent&lt;/code&gt; for various &lt;code&gt;cds.log.levels&lt;/code&gt; components, in &lt;code&gt;package.json&lt;/code&gt;:&lt;/p&gt;
&lt;pre class=&quot;language-json&quot; tabindex=&quot;0&quot;&gt;&lt;code class=&quot;language-json&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
  &lt;span class=&quot;token property&quot;&gt;&quot;cds&quot;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;token property&quot;&gt;&quot;log&quot;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
      &lt;span class=&quot;token property&quot;&gt;&quot;levels&quot;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;token property&quot;&gt;&quot;cds&quot;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;silent&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
        &lt;span class=&quot;token property&quot;&gt;&quot;cds.serve&quot;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;silent&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
        &lt;span class=&quot;token property&quot;&gt;&quot;odata&quot;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;silent&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
        &lt;span class=&quot;token property&quot;&gt;&quot;deploy&quot;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;silent&quot;&lt;/span&gt;
      &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
  &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;This makes the test output less noisy, for sure:&lt;/p&gt;
&lt;pre class=&quot;language-log&quot; tabindex=&quot;0&quot;&gt;&lt;code class=&quot;language-log&quot;&gt;&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt; proj&lt;span class=&quot;token operator&quot;&gt;@&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;1.0.0&lt;/span&gt; test
&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt; node &lt;span class=&quot;token operator&quot;&gt;-&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;-&lt;/span&gt;test

âœ” &lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt;next&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;100.910208ms&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;)&lt;/span&gt;
â–¶ OData APIs
  âœ” serves CatalogService&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;Books &lt;span class=&quot;token operator&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;19.222666ms&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;)&lt;/span&gt;
âœ” OData APIs &lt;span class=&quot;token operator&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;19.378125ms&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;)&lt;/span&gt;
â„¹ tests &lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt;
â„¹ suites &lt;span class=&quot;token number&quot;&gt;2&lt;/span&gt;
â„¹ pass &lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt;
â„¹ fail &lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt;
â„¹ cancelled &lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt;
â„¹ skipped &lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt;
â„¹ todo &lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt;
â„¹ duration_ms &lt;span class=&quot;token number&quot;&gt;212.527334&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;But it also makes regular CAP server log output a little mute - when running &lt;code&gt;cds watch&lt;/code&gt;, this is all that is emitted:&lt;/p&gt;
&lt;pre class=&quot;language-log&quot; tabindex=&quot;0&quot;&gt;&lt;code class=&quot;language-log&quot;&gt;cds serve all &lt;span class=&quot;token operator&quot;&gt;-&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;-&lt;/span&gt;with&lt;span class=&quot;token operator&quot;&gt;-&lt;/span&gt;mocks &lt;span class=&quot;token operator&quot;&gt;-&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;-&lt;/span&gt;in&lt;span class=&quot;token operator&quot;&gt;-&lt;/span&gt;memory&lt;span class=&quot;token operator&quot;&gt;?&lt;/span&gt;
&lt;span class=&quot;token operator&quot;&gt;(&lt;/span&gt; live reload enabled for browsers &lt;span class=&quot;token operator&quot;&gt;)&lt;/span&gt;

        ___________________________

&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;cds&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;-&lt;/span&gt; connect using bindings from&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;{&lt;/span&gt; registry&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&#39;~/.cds-services.json&#39;&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;A little too quiet.&lt;/p&gt;
&lt;h2 id=&quot;wrapping-log-level-settings-in-a-profile&quot;&gt;Wrapping log level settings in a profile&lt;/h2&gt;
&lt;p&gt;As the Capire documentation explains, &lt;a href=&quot;https://cap.cloud.sap/docs/node.js/cds-env#profiles&quot;&gt;configuration profiles&lt;/a&gt; are easy to use and can be employed in various ways.&lt;/p&gt;
&lt;p&gt;I can contextualise these reductions in log output to a configuration profile, I&#39;ll call it &amp;quot;quiet&amp;quot;:&lt;/p&gt;
&lt;pre class=&quot;language-json&quot; tabindex=&quot;0&quot;&gt;&lt;code class=&quot;language-json&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
  &lt;span class=&quot;token property&quot;&gt;&quot;cds&quot;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;token property&quot;&gt;&quot;[quiet]&quot;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
      &lt;span class=&quot;token property&quot;&gt;&quot;log&quot;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;token property&quot;&gt;&quot;levels&quot;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
          &lt;span class=&quot;token property&quot;&gt;&quot;cds&quot;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;silent&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
          &lt;span class=&quot;token property&quot;&gt;&quot;cds.serve&quot;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;silent&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
          &lt;span class=&quot;token property&quot;&gt;&quot;odata&quot;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;silent&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
          &lt;span class=&quot;token property&quot;&gt;&quot;deploy&quot;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;silent&quot;&lt;/span&gt;
        &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
      &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
  &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;Then I can run &lt;code&gt;cds watch&lt;/code&gt; as normal and get the output I expect:&lt;/p&gt;
&lt;pre class=&quot;language-log&quot; tabindex=&quot;0&quot;&gt;&lt;code class=&quot;language-log&quot;&gt;cds serve all &lt;span class=&quot;token operator&quot;&gt;-&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;-&lt;/span&gt;with&lt;span class=&quot;token operator&quot;&gt;-&lt;/span&gt;mocks &lt;span class=&quot;token operator&quot;&gt;-&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;-&lt;/span&gt;in&lt;span class=&quot;token operator&quot;&gt;-&lt;/span&gt;memory&lt;span class=&quot;token operator&quot;&gt;?&lt;/span&gt;
&lt;span class=&quot;token operator&quot;&gt;(&lt;/span&gt; live reload enabled for browsers &lt;span class=&quot;token operator&quot;&gt;)&lt;/span&gt;

        ___________________________

&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;cds&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;-&lt;/span&gt; loaded model from &lt;span class=&quot;token number&quot;&gt;3&lt;/span&gt; file&lt;span class=&quot;token operator&quot;&gt;(&lt;/span&gt;s&lt;span class=&quot;token operator&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt;

  srv&lt;span class=&quot;token operator&quot;&gt;/&lt;/span&gt;cat&lt;span class=&quot;token operator&quot;&gt;-&lt;/span&gt;service&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;cds
  node_modules&lt;span class=&quot;token operator&quot;&gt;/&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;@&lt;/span&gt;sap&lt;span class=&quot;token operator&quot;&gt;/&lt;/span&gt;cds&lt;span class=&quot;token operator&quot;&gt;/&lt;/span&gt;srv&lt;span class=&quot;token operator&quot;&gt;/&lt;/span&gt;outbox&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;cds
  db&lt;span class=&quot;token operator&quot;&gt;/&lt;/span&gt;schema&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;cds

&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;cds&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;-&lt;/span&gt; connect using bindings from&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;{&lt;/span&gt; registry&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&#39;~/.cds-services.json&#39;&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;cds&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;-&lt;/span&gt; connect to db &lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt; sqlite &lt;span class=&quot;token operator&quot;&gt;{&lt;/span&gt; url&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&#39;:memory:&#39;&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;}&lt;/span&gt;
  &lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt; init from db&lt;span class=&quot;token operator&quot;&gt;/&lt;/span&gt;data&lt;span class=&quot;token operator&quot;&gt;/&lt;/span&gt;my&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;bookshop&lt;span class=&quot;token operator&quot;&gt;-&lt;/span&gt;Books&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;csv
&lt;span class=&quot;token operator&quot;&gt;/&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt; successfully deployed to in&lt;span class=&quot;token operator&quot;&gt;-&lt;/span&gt;memory database&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;

&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;cds&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;-&lt;/span&gt; using auth strategy &lt;span class=&quot;token operator&quot;&gt;{&lt;/span&gt;
  &lt;span class=&quot;token property&quot;&gt;kind:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&#39;mocked&#39;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
  &lt;span class=&quot;token property&quot;&gt;impl:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&#39;node_modules/@sap/cds/lib/srv/middlewares/auth/basic-auth.js&#39;&lt;/span&gt;
&lt;span class=&quot;token operator&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;cds&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;-&lt;/span&gt; serving CatalogService &lt;span class=&quot;token operator&quot;&gt;{&lt;/span&gt;
  &lt;span class=&quot;token property&quot;&gt;at:&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&#39;/odata/v4/catalog&#39;&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
  &lt;span class=&quot;token property&quot;&gt;decl:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&#39;srv/cat-service.cds:3&#39;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
  &lt;span class=&quot;token property&quot;&gt;impl:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&#39;node_modules/@sap/cds/srv/app-service.js&#39;&lt;/span&gt;
&lt;span class=&quot;token operator&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;cds&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;-&lt;/span&gt; server listening on &lt;span class=&quot;token operator&quot;&gt;{&lt;/span&gt; url&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&#39;http://localhost:4004&#39;&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;cds&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;-&lt;/span&gt; server &lt;span class=&quot;token number&quot;&gt;v9.4.3&lt;/span&gt; launched in &lt;span class=&quot;token number&quot;&gt;245&lt;/span&gt; ms
&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;cds&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt; terminate with &lt;span class=&quot;token operator&quot;&gt;^&lt;/span&gt;C &lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;But I can add the profile specification to the &lt;code&gt;test&lt;/code&gt; NPM script via &lt;code&gt;CDS_ENV&lt;/code&gt; or &lt;code&gt;NODE_ENV&lt;/code&gt; like this:&lt;/p&gt;
&lt;pre class=&quot;language-json&quot; tabindex=&quot;0&quot;&gt;&lt;code class=&quot;language-json&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
  &lt;span class=&quot;token property&quot;&gt;&quot;scripts&quot;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;token property&quot;&gt;&quot;start&quot;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;cds-serve&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
    &lt;span class=&quot;token property&quot;&gt;&quot;test&quot;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;CDS_ENV=quiet node --test&quot;&lt;/span&gt;
  &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;This keeps the test run output quiet and manageable:&lt;/p&gt;
&lt;pre class=&quot;language-log&quot; tabindex=&quot;0&quot;&gt;&lt;code class=&quot;language-log&quot;&gt;&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt; proj&lt;span class=&quot;token operator&quot;&gt;@&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;1.0.0&lt;/span&gt; test
&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt; CDS_ENV&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;quiet node &lt;span class=&quot;token operator&quot;&gt;-&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;-&lt;/span&gt;test

âœ” &lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt;next&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;115.602208ms&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;)&lt;/span&gt;
â–¶ OData APIs
  âœ” serves CatalogService&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;Books &lt;span class=&quot;token operator&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;21.739417ms&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;)&lt;/span&gt;
âœ” OData APIs &lt;span class=&quot;token operator&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;21.917125ms&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;)&lt;/span&gt;
â„¹ tests &lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt;
â„¹ suites &lt;span class=&quot;token number&quot;&gt;2&lt;/span&gt;
â„¹ pass &lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt;
â„¹ fail &lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt;
â„¹ cancelled &lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt;
â„¹ skipped &lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt;
â„¹ todo &lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt;
â„¹ duration_ms &lt;span class=&quot;token number&quot;&gt;231.362166&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;
&lt;h2 id=&quot;using-cds-test&quot;&gt;Using cds test&lt;/h2&gt;
&lt;p&gt;In another great Devtoberfest session, &lt;a href=&quot;https://www.youtube.com/watch?v=HLlX_e-kXJw&quot;&gt;CAP Tools - What&#39;s New and Hot&lt;/a&gt;, Christian Georgi took us through some really cool new tools for development and testing.&lt;/p&gt;
&lt;p&gt;One of these was the new &lt;code&gt;cds test&lt;/code&gt; command.&lt;/p&gt;
&lt;p&gt;But very briefly, instead of using &lt;code&gt;node --test&lt;/code&gt;, with (or without) the &lt;code&gt;CDS_ENV=quiet&lt;/code&gt; setting, I can use the &lt;code&gt;cds test&lt;/code&gt; command, which runs the tests and has a lovely succinct output:&lt;/p&gt;
&lt;pre class=&quot;language-log&quot; tabindex=&quot;0&quot;&gt;&lt;code class=&quot;language-log&quot;&gt;  OData APIs
    âœ” serves CatalogService&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;Books

 &lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt; passed
 &lt;span class=&quot;token number&quot;&gt;0.259s&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;How neat is that?!&lt;/p&gt;
&lt;h2 id=&quot;wrapping-up&quot;&gt;Wrapping up&lt;/h2&gt;
&lt;p&gt;To find out more, you should watch the replay of Christian&#39;s session, after watching the replay of Mauricio&#39;s session too, of course.&lt;/p&gt;
&lt;p&gt;Happy testing!&lt;/p&gt;
</content>
  </entry>
  <entry>
    <title>Modelling contained-in relationships with compositions in CDS</title>
    <link href="https://qmacro.org/blog/posts/2025/10/14/modelling-contained-in-relationships-with-compositions-in-cds/" />
    <updated>2025-10-14T00:00:00Z</updated>
    <id>https://qmacro.org/blog/posts/2025/10/14/modelling-contained-in-relationships-with-compositions-in-cds/</id>
    <content type="html">&lt;h2 id=&quot;background&quot;&gt;Background&lt;/h2&gt;
&lt;p&gt;There&#39;s a classic structure often found representing business data in enterprise software, and that&#39;s the &amp;quot;document&amp;quot;. Purchase requisition, sales order, goods receipt, and so on. Header and items. Most of the time the items don&#39;t make sense existing on their own, independent of their header parent. Such documents are typically modelled using contained-in relationships.&lt;/p&gt;
&lt;p&gt;There&#39;s a great section of the &lt;a href=&quot;https://cap.cloud.sap/docs/&quot;&gt;Capire&lt;/a&gt; documentation, specifically on &lt;a href=&quot;https://cap.cloud.sap/docs/guides/domain-modeling#compositions&quot;&gt;compositions&lt;/a&gt;, on which I want to expand here.&lt;/p&gt;
&lt;h2 id=&quot;explicit-modelling&quot;&gt;Explicit modelling&lt;/h2&gt;
&lt;p&gt;Given a hammer, all problems look like nails. Given the &amp;quot;entity&amp;quot; concept, all business data structures look like they should be modelled using entities.&lt;/p&gt;
&lt;p&gt;Which does work. To wit:&lt;/p&gt;
&lt;pre class=&quot;language-cds&quot; tabindex=&quot;0&quot;&gt;&lt;code class=&quot;language-cds&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;service&lt;/span&gt; S {
  &lt;span class=&quot;token keyword&quot;&gt;entity&lt;/span&gt; Orders {
    &lt;span class=&quot;token cqlkeywords keyword&quot;&gt;key&lt;/span&gt; ID    : &lt;span class=&quot;token type builtin&quot;&gt;Integer&lt;/span&gt;;
        Items : &lt;span class=&quot;token association-composition keyword&quot;&gt;Composition of many OrderItems&lt;/span&gt;
                  &lt;span class=&quot;token cqlkeywords keyword&quot;&gt;on&lt;/span&gt; Items.parent = $self;
  }

  &lt;span class=&quot;token keyword&quot;&gt;entity&lt;/span&gt; OrderItems {
    &lt;span class=&quot;token cqlkeywords keyword&quot;&gt;key&lt;/span&gt; parent : &lt;span class=&quot;token association-composition keyword&quot;&gt;Association to Orders&lt;/span&gt;;
    &lt;span class=&quot;token cqlkeywords keyword&quot;&gt;key&lt;/span&gt; pos    : &lt;span class=&quot;token type builtin&quot;&gt;Integer&lt;/span&gt;;
        qty    : &lt;span class=&quot;token type builtin&quot;&gt;Integer&lt;/span&gt;;
  }
}&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;When compiled (with &lt;code&gt;cds compile --to yaml service.cds&lt;/code&gt;&lt;a href=&quot;https://qmacro.org/blog/posts/2025/10/14/modelling-contained-in-relationships-with-compositions-in-cds/#footnotes&quot;&gt;&lt;sup&gt;1&lt;/sup&gt;&lt;/a&gt;), this results in the following schema notation (in a YAML representation as I find it cleaner and easier to read)&lt;a href=&quot;https://qmacro.org/blog/posts/2025/10/14/modelling-contained-in-relationships-with-compositions-in-cds/#footnotes&quot;&gt;&lt;sup&gt;2&lt;/sup&gt;&lt;/a&gt;:&lt;/p&gt;
&lt;pre class=&quot;language-yaml&quot; tabindex=&quot;0&quot;&gt;&lt;code class=&quot;language-yaml&quot;&gt;&lt;span class=&quot;token key atrule&quot;&gt;definitions&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
  &lt;span class=&quot;token key atrule&quot;&gt;S&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
    &lt;span class=&quot;token key atrule&quot;&gt;kind&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; service
  &lt;span class=&quot;token key atrule&quot;&gt;S.Orders&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
    &lt;span class=&quot;token key atrule&quot;&gt;kind&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; entity
    &lt;span class=&quot;token key atrule&quot;&gt;elements&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
      &lt;span class=&quot;token key atrule&quot;&gt;ID&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
        &lt;span class=&quot;token key atrule&quot;&gt;key&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token boolean important&quot;&gt;true&lt;/span&gt;
        &lt;span class=&quot;token key atrule&quot;&gt;type&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; cds.Integer
      &lt;span class=&quot;token key atrule&quot;&gt;Items&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
        &lt;span class=&quot;token key atrule&quot;&gt;type&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; cds.Composition
        &lt;span class=&quot;token key atrule&quot;&gt;cardinality&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
          &lt;span class=&quot;token key atrule&quot;&gt;max&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&#39;*&#39;&lt;/span&gt;
        &lt;span class=&quot;token key atrule&quot;&gt;target&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; S.OrderItems
        &lt;span class=&quot;token key atrule&quot;&gt;&#39;on&#39;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
          &lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;token key atrule&quot;&gt;ref&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
              &lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt; Items
              &lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt; parent
          &lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&#39;=&#39;&lt;/span&gt;
          &lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;token key atrule&quot;&gt;ref&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
              &lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt; $self
  &lt;span class=&quot;token key atrule&quot;&gt;S.OrderItems&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
    &lt;span class=&quot;token key atrule&quot;&gt;kind&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; entity
    &lt;span class=&quot;token key atrule&quot;&gt;elements&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
      &lt;span class=&quot;token key atrule&quot;&gt;parent&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
        &lt;span class=&quot;token key atrule&quot;&gt;key&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token boolean important&quot;&gt;true&lt;/span&gt;
        &lt;span class=&quot;token key atrule&quot;&gt;type&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; cds.Association
        &lt;span class=&quot;token key atrule&quot;&gt;target&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; S.Orders
        &lt;span class=&quot;token key atrule&quot;&gt;keys&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
          &lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;token key atrule&quot;&gt;ref&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
              &lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt; ID
      &lt;span class=&quot;token key atrule&quot;&gt;pos&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
        &lt;span class=&quot;token key atrule&quot;&gt;key&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token boolean important&quot;&gt;true&lt;/span&gt;
        &lt;span class=&quot;token key atrule&quot;&gt;type&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; cds.Integer
      &lt;span class=&quot;token key atrule&quot;&gt;qty&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
        &lt;span class=&quot;token key atrule&quot;&gt;type&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; cds.Integer&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;The resulting CSN encompasses the modelling intent - zero or more item children, and a relationship constraint that links back to the parent.&lt;/p&gt;
&lt;p&gt;But the definitions at the CDS model level are quite explicit and arguably a little &amp;quot;noisy&amp;quot;:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;at the parent level, the constraint detail (i.e. &lt;code&gt;on Items.parent = $self&lt;/code&gt;) needs to be expressed explicitly&lt;/li&gt;
&lt;li&gt;the child requires an explicit (key) element to point back to the parent&lt;/li&gt;
&lt;li&gt;that child-to-parent relationship needs to be expressed explicitly as a to-one association which is arguably also just a bit too much &amp;quot;machinery&amp;quot; on show&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;Remember, domain modelling is the common language for business domain experts and developers, and the CDS model is where they meet. So machinery is to be avoided where possible.&lt;/p&gt;
&lt;h2 id=&quot;implicit-modelling&quot;&gt;Implicit modelling&lt;/h2&gt;
&lt;p&gt;Such a classic parent-child structure can be expressed in the CDS model a lot more succinctly, using &lt;a href=&quot;https://cap.cloud.sap/docs/guides/domain-modeling#aspects&quot;&gt;aspects&lt;/a&gt;, specifically &lt;a href=&quot;https://cap.cloud.sap/docs/guides/domain-modeling#composition-of-aspects&quot;&gt;anonymous aspects&lt;/a&gt;.&lt;/p&gt;
&lt;p&gt;The exact same model can be expressed thus:&lt;/p&gt;
&lt;pre class=&quot;language-cds&quot; tabindex=&quot;0&quot;&gt;&lt;code class=&quot;language-cds&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;service&lt;/span&gt; S {
  &lt;span class=&quot;token keyword&quot;&gt;entity&lt;/span&gt; Orders {
    &lt;span class=&quot;token cqlkeywords keyword&quot;&gt;key&lt;/span&gt; ID    : &lt;span class=&quot;token type builtin&quot;&gt;Integer&lt;/span&gt;;
        Items : &lt;span class=&quot;token association-composition keyword&quot;&gt;Composition of many &lt;/span&gt;{
                  &lt;span class=&quot;token cqlkeywords keyword&quot;&gt;key&lt;/span&gt; pos : &lt;span class=&quot;token type builtin&quot;&gt;Integer&lt;/span&gt;;
                      qty : &lt;span class=&quot;token type builtin&quot;&gt;Integer&lt;/span&gt;;
                }
  }

}&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;That&#39;s it - that&#39;s the entire equivalent declaration. In using an anonymous aspect (that&#39;s the part expressed as the &lt;code&gt;{ ... }&lt;/code&gt; block) to describe the composition target, we get to NOT have to come up with and define:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;a second entity definition&lt;/li&gt;
&lt;li&gt;a name for that second entity&lt;/li&gt;
&lt;li&gt;a composition constraint&lt;/li&gt;
&lt;li&gt;a pointer from the child back to the parent&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;I would go so far as to say that &lt;a href=&quot;https://qmacro.org/blog/posts/2017/02/19/the-beauty-of-recursion-and-list-machinery/#initial-recognition&quot;&gt;staring at&lt;/a&gt; this structure expression conjures up far more readily what a document (such as those examples mentioned above) &amp;quot;looks like&amp;quot; mentally.&lt;/p&gt;
&lt;p&gt;And guess what? The equivalent schema notation is logically the same. Here&#39;s what compiling this &amp;quot;quieter&amp;quot; and more compact version to the YAML flavour of CSN gives us&lt;a href=&quot;https://qmacro.org/blog/posts/2025/10/14/modelling-contained-in-relationships-with-compositions-in-cds/#footnotes&quot;&gt;&lt;sup&gt;2&lt;/sup&gt;&lt;/a&gt;:&lt;/p&gt;
&lt;pre class=&quot;language-yaml&quot; tabindex=&quot;0&quot;&gt;&lt;code class=&quot;language-yaml&quot;&gt;&lt;span class=&quot;token key atrule&quot;&gt;definitions&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
  &lt;span class=&quot;token key atrule&quot;&gt;S&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
    &lt;span class=&quot;token key atrule&quot;&gt;kind&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; service
  &lt;span class=&quot;token key atrule&quot;&gt;S.Orders&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
    &lt;span class=&quot;token key atrule&quot;&gt;kind&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; entity
    &lt;span class=&quot;token key atrule&quot;&gt;elements&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
      &lt;span class=&quot;token key atrule&quot;&gt;ID&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
        &lt;span class=&quot;token key atrule&quot;&gt;key&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token boolean important&quot;&gt;true&lt;/span&gt;
        &lt;span class=&quot;token key atrule&quot;&gt;type&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; cds.Integer
      &lt;span class=&quot;token key atrule&quot;&gt;Items&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
        &lt;span class=&quot;token key atrule&quot;&gt;type&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; cds.Composition
        &lt;span class=&quot;token key atrule&quot;&gt;cardinality&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
          &lt;span class=&quot;token key atrule&quot;&gt;max&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&#39;*&#39;&lt;/span&gt;
        &lt;span class=&quot;token key atrule&quot;&gt;targetAspect&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
          &lt;span class=&quot;token key atrule&quot;&gt;elements&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
            &lt;span class=&quot;token key atrule&quot;&gt;pos&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
              &lt;span class=&quot;token key atrule&quot;&gt;key&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token boolean important&quot;&gt;true&lt;/span&gt;
              &lt;span class=&quot;token key atrule&quot;&gt;type&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; cds.Integer
            &lt;span class=&quot;token key atrule&quot;&gt;qty&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
              &lt;span class=&quot;token key atrule&quot;&gt;type&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; cds.Integer
        &lt;span class=&quot;token key atrule&quot;&gt;target&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; S.Orders.Items
        &lt;span class=&quot;token key atrule&quot;&gt;&#39;on&#39;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
          &lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;token key atrule&quot;&gt;ref&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
              &lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt; Items
              &lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt; up_
          &lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&#39;=&#39;&lt;/span&gt;
          &lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;token key atrule&quot;&gt;ref&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
              &lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt; $self
  &lt;span class=&quot;token key atrule&quot;&gt;S.Orders.Items&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
    &lt;span class=&quot;token key atrule&quot;&gt;kind&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; entity
    &lt;span class=&quot;token key atrule&quot;&gt;elements&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
      &lt;span class=&quot;token key atrule&quot;&gt;up_&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
        &lt;span class=&quot;token key atrule&quot;&gt;key&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token boolean important&quot;&gt;true&lt;/span&gt;
        &lt;span class=&quot;token key atrule&quot;&gt;type&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; cds.Association
        &lt;span class=&quot;token key atrule&quot;&gt;cardinality&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
          &lt;span class=&quot;token key atrule&quot;&gt;min&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt;
          &lt;span class=&quot;token key atrule&quot;&gt;max&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt;
        &lt;span class=&quot;token key atrule&quot;&gt;target&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; S.Orders
        &lt;span class=&quot;token key atrule&quot;&gt;keys&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
          &lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;token key atrule&quot;&gt;ref&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
              &lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt; ID
        &lt;span class=&quot;token key atrule&quot;&gt;notNull&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token boolean important&quot;&gt;true&lt;/span&gt;
      &lt;span class=&quot;token key atrule&quot;&gt;pos&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
        &lt;span class=&quot;token key atrule&quot;&gt;key&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token boolean important&quot;&gt;true&lt;/span&gt;
        &lt;span class=&quot;token key atrule&quot;&gt;type&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; cds.Integer
      &lt;span class=&quot;token key atrule&quot;&gt;qty&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
        &lt;span class=&quot;token key atrule&quot;&gt;type&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; cds.Integer&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;There are some technical differences, which are worth pointing out (there&#39;s always an opportunity to learn):&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;there&#39;s still a composition &lt;code&gt;target&lt;/code&gt; pointing to an entity definition, but here that is &lt;code&gt;S.Orders.Items&lt;/code&gt;, a definition that&#39;s been created on the fly to help satisfy the composition requirements&lt;/li&gt;
&lt;li&gt;this &lt;code&gt;S.Orders.Items&lt;/code&gt; entity has a key element &lt;code&gt;up_&lt;/code&gt; that points back to the parent&lt;/li&gt;
&lt;li&gt;there&#39;s additional info at the &lt;code&gt;Items&lt;/code&gt; element in the parent that captures the original anonymous aspect definition (in &lt;code&gt;targetAspect&lt;/code&gt;)&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;From a naming convention perspective, the name of the generated target entity is created using the parent entity as a prefix (&lt;code&gt;S.Orders&lt;/code&gt;) to the composition element&#39;s name (&lt;code&gt;Items&lt;/code&gt;), forming a &lt;a href=&quot;https://cap.cloud.sap/docs/cds/cdl#scoped-names&quot;&gt;scoped&lt;/a&gt; name &lt;code&gt;S.Orders.Items&lt;/code&gt;. And I would wager that it&#39;s unlikely that we as humans would use an underscore-suffixed name for an element, so &lt;code&gt;up_&lt;/code&gt; is a good choice for the automatically generated pointer-to-parent element name.&lt;/p&gt;
&lt;h2 id=&quot;hybrid&quot;&gt;Hybrid&lt;/h2&gt;
&lt;p&gt;There is a middle ground, where named, rather than anonymous aspects can be used. You can read more about this in the &lt;a href=&quot;https://cap.cloud.sap/docs/cds/cdl#with-named-targets&quot;&gt;named targets&lt;/a&gt; section of the Domain Modelling topic of Capire.&lt;/p&gt;
&lt;h2 id=&quot;wrapping-up&quot;&gt;Wrapping up&lt;/h2&gt;
&lt;p&gt;The CDS modelling language (and CDL specifically) is for humans. CSN is for machines. The distinction is not always top of mind, but if we try to keep it there, we&#39;ll end up with cleaner, simpler model definitions that are easier to reason about, easier to extend and reuse, and easier to maintain.&lt;/p&gt;
&lt;h2 id=&quot;footnotes&quot;&gt;Footnotes&lt;/h2&gt;
&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;I piped the resulting YAML through &lt;code&gt;yq -y .&lt;/code&gt; to pretty-print it, as I find the long(er) lines of the raw YAML output a little tough to digest.&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;I removed the metadata from the compiled YAML output:&lt;/p&gt;
&lt;pre class=&quot;language-yaml&quot; tabindex=&quot;0&quot;&gt;&lt;code class=&quot;language-yaml&quot;&gt;&lt;span class=&quot;token key atrule&quot;&gt;meta&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
  &lt;span class=&quot;token key atrule&quot;&gt;creator&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; CDS Compiler v6.4.2
  &lt;span class=&quot;token key atrule&quot;&gt;flavor&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; inferred
&lt;span class=&quot;token key atrule&quot;&gt;$version&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;2&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;just to keep things a little more compact.&lt;/p&gt;
&lt;/li&gt;
&lt;/ol&gt;
</content>
  </entry>
  <entry>
    <title>Using @capire modules from GitHub Packages</title>
    <link href="https://qmacro.org/blog/posts/2025/10/12/using-capire-modules-from-github-packages/" />
    <updated>2025-10-12T00:00:00Z</updated>
    <id>https://qmacro.org/blog/posts/2025/10/12/using-capire-modules-from-github-packages/</id>
    <content type="html">&lt;h2 id=&quot;background&quot;&gt;Background&lt;/h2&gt;
&lt;p&gt;&lt;a href=&quot;https://cap.cloud.sap/docs/releases/aug25&quot;&gt;Recently&lt;/a&gt; the home for Capire documentation and sample repositories moved into the &lt;a href=&quot;https://github.com/capire&quot;&gt;capire&lt;/a&gt; organisation on GitHub. This content includes classic modules such as &lt;a href=&quot;https://github.com/capire/bookshop&quot;&gt;bookshop&lt;/a&gt; which are now maintained as individual repositories, are subject to release schedules and deployments, and are made available as &lt;a href=&quot;https://github.com/orgs/capire/packages&quot;&gt;packages&lt;/a&gt; that are available in the NPM registry which is part of &lt;a href=&quot;https://docs.github.com/en/packages/learn-github-packages/introduction-to-github-packages&quot;&gt;GitHub Packages&lt;/a&gt;.&lt;/p&gt;
&lt;p&gt;Retrieving (e.g. via &lt;code&gt;npm install&lt;/code&gt; or &lt;code&gt;npm add&lt;/code&gt;) a package such as &lt;code&gt;@sap/cds-dk&lt;/code&gt; is straightforward as such packages &lt;a href=&quot;https://www.npmjs.com/package/@sap/cds-dk&quot;&gt;are available&lt;/a&gt; in the default NPM registry at &lt;a href=&quot;https://registry.npmjs.org&quot;&gt;https://registry.npmjs.org&lt;/a&gt; (with a human centric UI at &lt;a href=&quot;https://npmjs.com&quot;&gt;https://npmjs.com&lt;/a&gt;).&lt;/p&gt;
&lt;h2 id=&quot;namespace-registry-mapping-required&quot;&gt;Namespace registry mapping required&lt;/h2&gt;
&lt;p&gt;Retrieving packages from any other registry (such as package &lt;code&gt;@capire/bookshop&lt;/code&gt; in the NPM registry that is part of GitHub Packages) requires a mapping, typically by package namespace.&lt;/p&gt;
&lt;p&gt;This is done by configuration in an &lt;code&gt;.npmrc&lt;/code&gt; file in your home directory. The mapping here (for the &lt;code&gt;@capire&lt;/code&gt; namespaced packages) needs to look like this in that file:&lt;/p&gt;
&lt;pre class=&quot;language-text&quot; tabindex=&quot;0&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;@capire:registry=https://npm.pkg.github.com&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;Without this mapping, here&#39;s what happens:&lt;/p&gt;
&lt;pre class=&quot;language-log&quot; tabindex=&quot;0&quot;&gt;&lt;code class=&quot;language-log&quot;&gt;&lt;span class=&quot;token operator&quot;&gt;;&lt;/span&gt; npm add &lt;span class=&quot;token operator&quot;&gt;@&lt;/span&gt;capire&lt;span class=&quot;token operator&quot;&gt;/&lt;/span&gt;bookshop&lt;span class=&quot;token operator&quot;&gt;@&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;2.0.4&lt;/span&gt;
npm error code E404
npm error &lt;span class=&quot;token number&quot;&gt;404&lt;/span&gt; Not Found &lt;span class=&quot;token operator&quot;&gt;-&lt;/span&gt; GET &lt;span class=&quot;token url&quot;&gt;https://registry.npmjs.org/@capire%2fbookshop&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;-&lt;/span&gt; Not found
npm error &lt;span class=&quot;token number&quot;&gt;404&lt;/span&gt;
npm error &lt;span class=&quot;token number&quot;&gt;404&lt;/span&gt;  &lt;span class=&quot;token string&quot;&gt;&#39;@capire/bookshop@2.0.4&#39;&lt;/span&gt; is not in this registry&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;
npm error &lt;span class=&quot;token number&quot;&gt;404&lt;/span&gt;
npm error &lt;span class=&quot;token number&quot;&gt;404&lt;/span&gt; Note that you can also install from a
npm error &lt;span class=&quot;token number&quot;&gt;404&lt;/span&gt; tarball&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; folder&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; http url&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; or git url&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;With the mapping above in the &lt;code&gt;.npmrc&lt;/code&gt; file, here&#39;s what happens:&lt;/p&gt;
&lt;pre class=&quot;language-log&quot; tabindex=&quot;0&quot;&gt;&lt;code class=&quot;language-log&quot;&gt;&lt;span class=&quot;token operator&quot;&gt;;&lt;/span&gt; npm add &lt;span class=&quot;token operator&quot;&gt;@&lt;/span&gt;capire&lt;span class=&quot;token operator&quot;&gt;/&lt;/span&gt;bookshop&lt;span class=&quot;token operator&quot;&gt;@&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;2.0.4&lt;/span&gt;
npm error code E401
npm error &lt;span class=&quot;token number&quot;&gt;401&lt;/span&gt; Unauthorized
  &lt;span class=&quot;token operator&quot;&gt;-&lt;/span&gt; GET &lt;span class=&quot;token url&quot;&gt;https://npm.pkg.github.com/@capire%2fbookshop&lt;/span&gt;
  &lt;span class=&quot;token operator&quot;&gt;-&lt;/span&gt; authentication token not provided&lt;/code&gt;&lt;/pre&gt;
&lt;h2 id=&quot;authentication-information-required&quot;&gt;Authentication information required&lt;/h2&gt;
&lt;p&gt;In order to &lt;a href=&quot;https://docs.github.com/en/packages/working-with-a-github-packages-registry/working-with-the-npm-registry&quot;&gt;work with GitHub Packages&#39; NPM registry&lt;/a&gt; ...&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;&amp;quot;... you need an access token to publish, install, and delete private, internal, and public packages.&amp;quot;&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;Yes, even for read operations such as &lt;code&gt;install&lt;/code&gt; and &lt;code&gt;add&lt;/code&gt;.&lt;/p&gt;
&lt;p&gt;The &lt;a href=&quot;https://docs.github.com/en/packages/working-with-a-github-packages-registry/working-with-the-npm-registry#authenticating-with-a-personal-access-token&quot;&gt;Authenticating with a personal access token&lt;/a&gt; describes the procedure, which basically has two steps.&lt;/p&gt;
&lt;h3 id=&quot;generate-a-token&quot;&gt;Generate a token&lt;/h3&gt;
&lt;p&gt;In the &lt;a href=&quot;https://github.com/settings/tokens&quot;&gt;Tokens (classic) section of your GitHub developer settings&lt;/a&gt;, generate a new &amp;quot;Personal Access Token (classic)&amp;quot; like this, selecting the &lt;code&gt;read:packages&lt;/code&gt; scope:&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;https://qmacro.org/images/2025/10/personal-access-token-classic-read-packages.png&quot; alt=&quot;generating a personal access token (classic) with read:packages scope&quot;&gt;&lt;/p&gt;
&lt;h3 id=&quot;associate-the-token-with-the-registry&quot;&gt;Associate the token with the registry&lt;/h3&gt;
&lt;p&gt;This token now needs to be associated with the registry, by adding another line to the &lt;code&gt;.npmrc&lt;/code&gt; file that looks like this:&lt;/p&gt;
&lt;pre class=&quot;language-text&quot; tabindex=&quot;0&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;//npm.pkg.github.com/:_authToken=THE-TOKEN-JUST-GENERATED&lt;/code&gt;&lt;/pre&gt;
&lt;h2 id=&quot;installing-a-package&quot;&gt;Installing a package&lt;/h2&gt;
&lt;p&gt;Once this is done, &lt;code&gt;npm install&lt;/code&gt; or &lt;code&gt;npm add&lt;/code&gt; will complete successfully:&lt;/p&gt;
&lt;pre class=&quot;language-shell&quot; tabindex=&quot;0&quot;&gt;&lt;code class=&quot;language-shell&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;npm&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;add&lt;/span&gt; @capire/bookshop@2.0.4

added &lt;span class=&quot;token number&quot;&gt;115&lt;/span&gt; packages, and audited &lt;span class=&quot;token number&quot;&gt;116&lt;/span&gt; packages &lt;span class=&quot;token keyword&quot;&gt;in&lt;/span&gt; 6s

&lt;span class=&quot;token number&quot;&gt;23&lt;/span&gt; packages are looking &lt;span class=&quot;token keyword&quot;&gt;for&lt;/span&gt; funding
  run &lt;span class=&quot;token variable&quot;&gt;&lt;span class=&quot;token variable&quot;&gt;`&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;npm&lt;/span&gt; fund&lt;span class=&quot;token variable&quot;&gt;`&lt;/span&gt;&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;for&lt;/span&gt; details

found &lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt; vulnerabilities&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;The package appears in the appropriate dependencies section of &lt;code&gt;package.json&lt;/code&gt; as usual:&lt;/p&gt;
&lt;pre class=&quot;language-json&quot; tabindex=&quot;0&quot;&gt;&lt;code class=&quot;language-json&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
  &lt;span class=&quot;token property&quot;&gt;&quot;name&quot;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;test&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
  &lt;span class=&quot;token property&quot;&gt;&quot;dependencies&quot;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;token property&quot;&gt;&quot;@capire/bookshop&quot;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;^2.0.4&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
    &lt;span class=&quot;token property&quot;&gt;&quot;@sap/cds&quot;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;^9&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
    &lt;span class=&quot;token property&quot;&gt;&quot;express&quot;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;^4&quot;&lt;/span&gt;
  &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
  &lt;span class=&quot;token property&quot;&gt;&quot;devDependencies&quot;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;token property&quot;&gt;&quot;@cap-js/sqlite&quot;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;^2&quot;&lt;/span&gt;
  &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
  &lt;span class=&quot;token property&quot;&gt;&quot;scripts&quot;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;token property&quot;&gt;&quot;start&quot;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;cds-serve&quot;&lt;/span&gt;
  &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;Success!&lt;/p&gt;
</content>
  </entry>
  <entry>
    <title>CDS source formatting and readability</title>
    <link href="https://qmacro.org/blog/posts/2025/09/16/cds-source-formatting-and-readability/" />
    <updated>2025-09-16T00:00:00Z</updated>
    <id>https://qmacro.org/blog/posts/2025/09/16/cds-source-formatting-and-readability/</id>
    <content type="html">&lt;h2 id=&quot;background&quot;&gt;Background&lt;/h2&gt;
&lt;p&gt;I still remember my son Joseph showing me, years ago now, the power of &lt;a href=&quot;https://pkg.go.dev/cmd/gofmt&quot;&gt;gofmt&lt;/a&gt;, a tool that automatically formats Go source code. The blog post &lt;a href=&quot;https://go.dev/blog/gofmt&quot;&gt;go fmt your code&lt;/a&gt; introduces the tool, and more importantly the philosophy of embracing such a tool, with these points that I will reproduce here. Code automatically formatted is:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;em&gt;easier to read&lt;/em&gt;: when all code looks the same you need not mentally convert others&#39; formatting style into something you can understand&lt;/li&gt;
&lt;li&gt;&lt;em&gt;easier to write&lt;/em&gt;: never worry about minor formatting concerns while hacking away&lt;/li&gt;
&lt;li&gt;&lt;em&gt;easier to maintain&lt;/em&gt;: mechanical changes to the source don&#39;t cause unrelated changes to the file&#39;s formatting; diffs show only the real changes&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;It&#39;s also makes for a less controversial experience generally as you&#39;re not going to be arguing over how to use whitespace or other syntactic symbols.&lt;/p&gt;
&lt;h2 id=&quot;the-importance-of-domain-modelling-and-the-language-used&quot;&gt;The importance of domain modelling and the language used&lt;/h2&gt;
&lt;p&gt;In &lt;a href=&quot;https://qmacro.org/blog/posts/2024/11/07/five-reasons-to-use-cap/&quot;&gt;Five reasons to use CAP&lt;/a&gt; I talk about &lt;a href=&quot;https://qmacro.org/blog/posts/2024/11/07/five-reasons-to-use-cap/#2-domain-modelling-is-a-first-class-citizen&quot;&gt;domain modelling being a first class citizen&lt;/a&gt;; it&#39;s a critical part of the design and of the process, and the CDS model, described in the declarative and high level &lt;a href=&quot;https://cap.cloud.sap/docs/cds/cdl&quot;&gt;Conceptual Definition Language&lt;/a&gt; (CDL)&lt;a href=&quot;https://qmacro.org/blog/posts/2025/09/16/cds-source-formatting-and-readability/#footnotes&quot;&gt;&lt;sup&gt;1&lt;/sup&gt;&lt;/a&gt; is central to that, being a language that both domain expert and programmer alike use to meet and describe models and behaviours.&lt;/p&gt;
&lt;p&gt;Reading and writing CDS models is therefore an important skill for us all to cultivate. Having a consistent format, a sort of &amp;quot;forma franca&amp;quot;, can only help with that.&lt;/p&gt;
&lt;h2 id=&quot;cap-tools-for-formatting-cds-model-sources&quot;&gt;CAP tools for formatting CDS model sources&lt;/h2&gt;
&lt;p&gt;The &lt;a href=&quot;https://cap.cloud.sap/docs/tools/cds-editors&quot;&gt;CDS Editors and IDEs&lt;/a&gt; topic in Capire gives us a nice overview of the key tools available for CAP developers.&lt;/p&gt;
&lt;p&gt;These tools include facilities for formatting CDS sources, which you may have already come across when using the &lt;a href=&quot;https://marketplace.visualstudio.com/items?itemName=SAPSE.vscode-cds&quot;&gt;CDS Language Support&lt;/a&gt; extension for VS Code:&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;https://qmacro.org/images/2025/09/vs-code-cds-format.gif&quot; alt=&quot;animated demonstration of formatting CDS sources in VS Code&quot;&gt;&lt;/p&gt;
&lt;p&gt;The CAP team did a superb job of making such facilities available, in the form of language server, so I can also &lt;a href=&quot;https://github.com/qmacro/dotfiles/blob/2620e2d0995c8b3529d2dc4768e4d4cac0db94b2/config/nvim/lsp/cds.lua&quot;&gt;use it&lt;/a&gt; in my editor of choice, Neovim (automatically &lt;a href=&quot;https://github.com/qmacro/dotfiles/blob/2620e2d0995c8b3529d2dc4768e4d4cac0db94b2/config/nvim/init.lua#L14-L23&quot;&gt;formatting on save&lt;/a&gt;):&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;https://qmacro.org/images/2025/09/neovim-cds-format.gif&quot; alt=&quot;animated demonstration of formatting CDS sources in Neovim&quot;&gt;&lt;/p&gt;
&lt;p&gt;There&#39;s also a standalone CLI tool &lt;code&gt;format-cds&lt;/code&gt; which is described in the &lt;a href=&quot;https://cap.cloud.sap/docs/tools/cds-editors#cds-formatter&quot;&gt;CDS Source Formatter&lt;/a&gt; section of Capire&#39;s CDS Editors and IDEs topic, where you can find out what the different formatting options are and how to set them. Here&#39;s a demonstration of &lt;code&gt;format-cds&lt;/code&gt; in action, on the same &lt;code&gt;srv/cat-service.cds&lt;/code&gt; sample source file:&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;https://qmacro.org/images/2025/09/format-cds-example.gif&quot; alt=&quot;animated demonstration of formatting CDS sources with the format-cds command&quot;&gt;&lt;/p&gt;
&lt;p&gt;While there are plenty of options to express your formatting preferences, I like the idea of the &amp;quot;standard format&amp;quot;, as championed by the official CDS formatter&#39;s defaults.&lt;/p&gt;
&lt;h2 id=&quot;formatting-of-sample-cds-sources&quot;&gt;Formatting of sample CDS sources&lt;/h2&gt;
&lt;p&gt;With the advent of CAP&#39;s &lt;a href=&quot;https://cap.cloud.sap/docs/releases/aug25&quot;&gt;August 2025 release&lt;/a&gt; (at 9.3.0+ for the Node.js runtime) I&#39;m very happy to see the alignment of the CDS model sources in both the &lt;code&gt;sample&lt;/code&gt; and &lt;code&gt;tiny-sample&lt;/code&gt; facets with this standard format.&lt;/p&gt;
&lt;p&gt;The examples above used one of these source files, specifically &lt;code&gt;srv/cat-service.cds&lt;/code&gt; from the &lt;code&gt;sample&lt;/code&gt; facet, and each of the animations shows the before (pre August 2025 release) and after (August 2025 release and onwards) format - and as you we can see, the formatting of those sources today are aligned with the standard format.&lt;/p&gt;
&lt;p&gt;This means that when starting from the samples, we are:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;being exposed to the &amp;quot;standard format&amp;quot;&lt;/li&gt;
&lt;li&gt;starting in a good place from where we can continue&lt;/li&gt;
&lt;li&gt;seeing more clearly the structure of CDS and the language&#39;s artifacts&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;I for one welcome the change&lt;a href=&quot;https://qmacro.org/blog/posts/2025/09/16/cds-source-formatting-and-readability/#footnotes&quot;&gt;&lt;sup&gt;2&lt;/sup&gt;&lt;/a&gt; and hope that this can trigger a deeper interest in and love for the CDS language in general, and a focus on how best to express it in particular. If nothing else, it will get us talking!&lt;/p&gt;
&lt;h2 id=&quot;footnotes&quot;&gt;Footnotes&lt;/h2&gt;
&lt;ol&gt;
&lt;li&gt;While technically &amp;quot;CDL&amp;quot; is more accurate when referring to the language of domain modelling, I will use &amp;quot;CDS&amp;quot; here, as a form of (reverse) &lt;a href=&quot;https://en.wikipedia.org/wiki/Synecdoche&quot;&gt;synechdoche&lt;/a&gt;.&lt;/li&gt;
&lt;li&gt;OK, I admit, it was me that requested this, and the team very kindly agreed, thanks folks!&lt;/li&gt;
&lt;/ol&gt;
</content>
  </entry>
  <entry>
    <title>Upcoming talks in autumn 2025</title>
    <link href="https://qmacro.org/blog/posts/2025/09/10/upcoming-talks-in-autumn-2025/" />
    <updated>2025-09-10T00:00:00Z</updated>
    <id>https://qmacro.org/blog/posts/2025/09/10/upcoming-talks-in-autumn-2025/</id>
    <content type="html">&lt;p&gt;I&#39;m delivering and / or involved in various in-person talks and workshops over the next few months, here&#39;s a quick breakdown.&lt;/p&gt;
&lt;h3 id=&quot;26-sep-foundations-of-ai-applications-with-the-sap-hana-cloud&quot;&gt;26 Sep: Foundations of AI applications with the SAP HANA Cloud&lt;/h3&gt;
&lt;p&gt;This is an SAP CodeJam &lt;a href=&quot;https://community.sap.com/t5/sap-codejam/foundations-of-ai-applications-with-the-sap-hana-cloud-porto-pt/ev-p/14153367&quot;&gt;on Fri 26 Sep in Porto, PT&lt;/a&gt;, led by my lovely colleague Witalij Rudnicki and assisted by me.&lt;/p&gt;
&lt;h3 id=&quot;27-sep-level-up-your-cap-skills-by-learning-how-to-use-the-cds-repl&quot;&gt;27 Sep: Level up your CAP skills by learning how to use the cds REPL&lt;/h3&gt;
&lt;p&gt;This is a talk I&#39;m giving on Sat 27 Sep at &lt;a href=&quot;https://sitporto.com&quot;&gt;SAP Inside Track Porto&lt;/a&gt;, PT, following the AI and SAP HANA Cloud CodeJam the day before.&lt;/p&gt;
&lt;p&gt;Abstract: The cds repl (REPL stands for Read Evaluate Print Loop) is an extremely powerful and versatile tool for every CAP Node.js developer. In this session, you&#39;ll become acquainted with it, get a feel for what it&#39;s like, how to wield its powers, and more. No experience required, this will be a live session with no slides.&lt;/p&gt;
&lt;h3 id=&quot;08-oct-sap-fiori-elements-flexible-programming-model&quot;&gt;08 Oct: SAP Fiori elements flexible programming model&lt;/h3&gt;
&lt;p&gt;This is an SAP CodeJam &lt;a href=&quot;https://community.sap.com/t5/sap-codejam/sap-fiori-elements-flexible-programming-model-birmingham-uk/ev-p/14210332&quot;&gt;on Wed 08 Oct in Birmingham, UK&lt;/a&gt;, led by my lovely colleague Nico Schoenteich and assisted by me.&lt;/p&gt;
&lt;h3 id=&quot;10-oct-service-integration-with-sap-cloud-application-programming-model&quot;&gt;10 Oct: Service integration with SAP Cloud Application Programming Model&lt;/h3&gt;
&lt;p&gt;This is an SAP CodeJam &lt;a href=&quot;https://community.sap.com/t5/sap-codejam/service-integration-with-the-sap-cloud-application-programming-model-munich/ec-p/14212922&quot;&gt;on Fri 10 Oct in Munich, DE&lt;/a&gt;, led by me.&lt;/p&gt;
&lt;h3 id=&quot;11-oct-cap-node-js-features-for-local-development&quot;&gt;11 Oct: CAP Node.js features for local development&lt;/h3&gt;
&lt;p&gt;This is a talk on Sat 11 Oct at &lt;a href=&quot;https://community.sap.com/t5/m%C3%BCnchen-blog-posts/sap-inside-track-munich-2025-call-for-speakers-sitmuc25/ba-p/14161947&quot;&gt;SAP Inside Track Munich&lt;/a&gt; DE, following the CAP CodeJam the day before.&lt;/p&gt;
&lt;p&gt;Abstract: There are some great facilities in CAP Node.js for local development, which means rapid iterations and the ability to think local-first without losing sight of the productive context in the cloud. In this session I&#39;ll demonstrate some of these facilities which will make you a valuable asset to any project. No slides, just working live in the terminal and editor.&lt;/p&gt;
&lt;h2 id=&quot;sap-teched&quot;&gt;SAP TechEd&lt;/h2&gt;
&lt;h3 id=&quot;05-nov-draft-day-for-developers-turning-new-technology-into-real-world-wins&quot;&gt;05 Nov: Draft day for developers: Turning new technology into real-world wins&lt;/h3&gt;
&lt;p&gt;I&#39;ll &lt;a href=&quot;https://www.sap.com/events/teched/berlin/flow/sap/te25/speaker-catalog-inperson/page/dj-adams&quot;&gt;be at SAP TechEd&lt;/a&gt;, and I&#39;m honoured to play a part in session &lt;a href=&quot;https://www.sap.com/events/teched/berlin/flow/sap/te25/catalog-inperson/page/catalog/session/1755789361320001c3gG&quot;&gt;KEY101 | Draft day for developers: Turning new technology into real-world wins&lt;/a&gt;, the Developer Keynote on Wed 05 Nov at SAP TechEd in Berlin this year.&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;https://qmacro.org/images/2025/09/teched-speaker.png&quot; alt=&quot;TechEd speaker profile&quot;&gt;&lt;/p&gt;
&lt;p&gt;Abstract: The picks are in, and developers, their tools, and frameworks are first-round talent. Get a front-row seat to SAP&#39;s latest innovations built to accelerate how you code, automate, and scale. Explore how you can use SAP&#39;s newest AI capabilities, generative agents, and enhanced tooling to build faster and smarter with less friction and more impact.&lt;/p&gt;
&lt;h3 id=&quot;05-nov-trivia-competition&quot;&gt;05 Nov: Trivia competition&lt;/h3&gt;
&lt;p&gt;I&#39;ll be running a live trivia competition (&lt;a href=&quot;https://www.sap.com/events/teched/berlin/flow/sap/te25/catalog-inperson/page/catalog/session/1756936085495001SaY9&quot;&gt;CT1288&lt;/a&gt;) on Wed 05 Nov in the Community Theatre.&lt;/p&gt;
&lt;h3 id=&quot;05-nov-learning-by-doing-in-the-cds-repl&quot;&gt;05 Nov: Learning by doing in the cds REPL&lt;/h3&gt;
&lt;p&gt;This is a talk (&lt;a href=&quot;https://www.sap.com/events/teched/berlin/flow/sap/te25/catalog-inperson/page/catalog/session/1756936609129001McHZ&quot;&gt;CT1291&lt;/a&gt;) that I&#39;m giving in the Community Theatre on Wed 05 Nov.&lt;/p&gt;
&lt;p&gt;Abstract: Work through a simple SAP Cloud Application Programming Model (CAP) project, live with your peers, in the cds REPL. Explore as you go and collectively ask each other questions, such as &amp;quot;What will happen if?&amp;quot; &amp;quot;What do you think this will evaluate to?&amp;quot; and &amp;quot;Why does this happen?&amp;quot;&lt;/p&gt;
&lt;h2 id=&quot;ukisug-connect&quot;&gt;UKISUG Connect&lt;/h2&gt;
&lt;h3 id=&quot;30-nov-hands-on-with-the-domain-modelling-language-that-powers-ecc-s-4hana-and-beyond-caps-cds&quot;&gt;30 Nov: Hands-on with the domain modelling language that powers ECC, S/4HANA and beyond - CAP&#39;s CDS&lt;/h3&gt;
&lt;p&gt;This is a hands-on workshop I&#39;m running on the first day of &lt;a href=&quot;https://www.sap.com/uk/events/2025-11-30-uk-pe-ukisug-connect.html&quot;&gt;UKISUG Connect 2025&lt;/a&gt;.&lt;/p&gt;
&lt;p&gt;Abstract: Become acquainted with CAP&#39;s CDS, the common language that binds domain experts, with their key business &amp;amp; process knowledge, to developers. A hands-on-optional session where we&#39;ll explore the language &amp;amp; concepts together and get comfortable with it. (More info is available on the &lt;a href=&quot;https://virtual.oxfordabstracts.com/event/75555/submission/101&quot;&gt;session detail page&lt;/a&gt;).&lt;/p&gt;
&lt;p&gt;See also the blog post &lt;a href=&quot;https://qmacro.org/blog/posts/2025/11/11/hands-on-domain-modelling-with-caps-cds-at-ukisug-connect/&quot;&gt;Hands-on domain modelling with CAP&#39;s CDS at UKISUG Connect&lt;/a&gt;.&lt;/p&gt;
&lt;h3 id=&quot;01-dec-local-first-a-more-efficient-development-strategy-for-extending-with-the-sap-cloud-application-programming-model&quot;&gt;01 Dec: Local-first: A more efficient development strategy for extending with the SAP Cloud Application Programming Model&lt;/h3&gt;
&lt;p&gt;This is a talk in the Technical stream at &lt;a href=&quot;https://www.sap.com/uk/events/2025-11-30-uk-pe-ukisug-connect.html&quot;&gt;UKISUG Connect 2025&lt;/a&gt;.&lt;/p&gt;
&lt;p&gt;Abstract: Today, more than ever, developer efficiency is critical. Join this session to learn of the local-first development affordances that CAP has to offer. No slides, just live coding and (hopefully) some fun! (More info is available on the &lt;a href=&quot;https://virtual.oxfordabstracts.com/event/75555/submission/127&quot;&gt;session detail page&lt;/a&gt;).&lt;/p&gt;
</content>
  </entry>
  <entry>
    <title>Auto formatting extensionless Bash scripts in Neovim</title>
    <link href="https://qmacro.org/blog/posts/2025/09/01/auto-formatting-extensionless-bash-scripts-in-neovim/" />
    <updated>2025-09-01T00:00:00Z</updated>
    <id>https://qmacro.org/blog/posts/2025/09/01/auto-formatting-extensionless-bash-scripts-in-neovim/</id>
    <content type="html">&lt;h2 id=&quot;tl-dr&quot;&gt;TL;DR&lt;/h2&gt;
&lt;p&gt;The Bash language server is easy to install and has support for &lt;code&gt;shfmt&lt;/code&gt; which in turn has support for Editorconfig settings.&lt;/p&gt;
&lt;p&gt;For shell scripts without extensions, Editorconfig is no good, except if you use &lt;code&gt;shfmt&lt;/code&gt;&#39;s special support in the form of &lt;code&gt;[[shell]]&lt;/code&gt; or &lt;code&gt;[[bash]]&lt;/code&gt; section globs.&lt;/p&gt;
&lt;p&gt;But that&#39;s non-standard, and when invoked via the Bash language server, doesn&#39;t work. However, you can get it to work by using a wrapper script that strips off options in the call to &lt;code&gt;shfmt&lt;/code&gt; with the result that these special Editorconfig sections are recognised.&lt;/p&gt;
&lt;h2 id=&quot;background&quot;&gt;Background&lt;/h2&gt;
&lt;p&gt;In my continuing quest to &lt;a href=&quot;https://qmacro.org/blog/posts/2025/06/10/a-modern-and-clean-neovim-setup-for-cap-node-js-configuration-and-diagnostics/&quot;&gt;build out a cleaner and leaner Neovim configuration&lt;/a&gt; I turned my attention recently to improving my Bash script editing experience. For Bash there are plenty of facilities that fit into my Personal Development Environment, including &lt;code&gt;shellcheck&lt;/code&gt; and &lt;code&gt;shfmt&lt;/code&gt;, both of which I have been using for quite a while (see &lt;a href=&quot;https://qmacro.org/blog/posts/2020/10/05/improving-my-shell-scripting/&quot;&gt;Improving my shell scripting&lt;/a&gt;).&lt;/p&gt;
&lt;p&gt;I decided to give the &lt;a href=&quot;https://github.com/bash-lsp/bash-language-server&quot;&gt;Bash language server&lt;/a&gt; a try. It&#39;s a super easy setup &lt;a href=&quot;https://github.com/bash-lsp/bash-language-server?tab=readme-ov-file#neovim&quot;&gt;for Neovim 0.11+&lt;/a&gt; and the &lt;a href=&quot;https://github.com/bash-lsp/bash-language-server?tab=readme-ov-file#shfmt-integration&quot;&gt;integration with shfmt&lt;/a&gt; was a feature that caught my eye in particular. See &lt;a href=&quot;https://qmacro.org/blog/posts/2025/09/01/auto-formatting-extensionless-bash-scripts-in-neovim/#appendix-c-neovim-lsp-configuration-for-the-bash-language-server&quot;&gt;Appendix C&lt;/a&gt; for the setup configuration details.&lt;/p&gt;
&lt;p&gt;Add to this a desire to also more consciously embrace &lt;a href=&quot;https://editorconfig.org/&quot;&gt;Editorconfig&lt;/a&gt;, especially given &lt;a href=&quot;https://github.com/mvdan/sh/blob/master/cmd/shfmt/shfmt.1.scd#description&quot;&gt;shfmt&#39;s support for that&lt;/a&gt;, and I was set for a great experience.&lt;/p&gt;
&lt;h2 id=&quot;the-perfect-storm&quot;&gt;The perfect storm&lt;/h2&gt;
&lt;p&gt;I am of the opinion that the names of shell scripts that are written to be executed on the command line should not have extensions. This follows a &lt;a href=&quot;https://google.github.io/styleguide/shellguide.html#s2.1-file-extensions&quot;&gt;specific guideline&lt;/a&gt; in the &lt;a href=&quot;https://google.github.io/styleguide/shellguide.html&quot;&gt;Google Shell Style Guide&lt;/a&gt;. Interpretation of shell script file[type]s is based on the &lt;a href=&quot;https://en.wikipedia.org/wiki/Shebang_(Unix)&quot;&gt;shebang&lt;/a&gt;.&lt;/p&gt;
&lt;p&gt;This approach, combined with the Bash language server, its support for &lt;code&gt;shfmt&lt;/code&gt;, and a custom part of &lt;code&gt;shfmt&lt;/code&gt;&#39;s support for Editorconfig, turned out to be a small but perfect storm:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Editorconfig&#39;s approach and configuration (&lt;a href=&quot;https://spec.editorconfig.org/&quot;&gt;specification&lt;/a&gt;) is based on file extensions only and there is no generic provision for specifying editor settings for files without extensions&lt;/li&gt;
&lt;li&gt;As the extensionless shell script is such a common phenomenon, support for Editorconfig within &lt;code&gt;shfmt&lt;/code&gt; has been extended to allow for special &lt;a href=&quot;https://spec.editorconfig.org/#glob-expressions&quot;&gt;section names&lt;/a&gt; in Editorconfig configuration files so that such shell scripts can be matched more generically; this support is described in the &lt;a href=&quot;https://github.com/mvdan/sh/blob/master/cmd/shfmt/shfmt.1.scd#examples&quot;&gt;Examples&lt;/a&gt; section in &lt;code&gt;shfmt&lt;/code&gt;&#39;s documentation thus:
&lt;blockquote&gt;
&lt;p&gt;&amp;quot;EditorConfig sections may also use &lt;code&gt;[[shell]]&lt;/code&gt; or &lt;code&gt;[[bash]]&lt;/code&gt; to match any shell or bash scripts, which is particularly useful when scripts use a shebang but no extension. Note that this feature is outside of the EditorConfig spec and may be changed in the future.&amp;quot;&lt;/p&gt;
&lt;/blockquote&gt;
&lt;/li&gt;
&lt;li&gt;While it&#39;s great to have &lt;a href=&quot;https://github.com/bash-lsp/bash-language-server?tab=readme-ov-file#shfmt-integration&quot;&gt;support for shfmt&lt;/a&gt; in the Bash language server, this support does not include this non-standard (but insanely useful) &lt;code&gt;[[bash]]&lt;/code&gt; style facility for Editorconfig configuration.&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;Consequently, when editing shell scripts with extensionless filenames using Neovim with the Bash language server configured and &lt;code&gt;shfmt&lt;/code&gt; installed&lt;a href=&quot;https://qmacro.org/blog/posts/2025/09/01/auto-formatting-extensionless-bash-scripts-in-neovim/#footnotes&quot;&gt;&lt;sup&gt;1&lt;/sup&gt;&lt;/a&gt;
I got a very odd and confusing experience.&lt;/p&gt;
&lt;p&gt;&lt;a name=&quot;example-of-the-issue&quot;&gt;&lt;/a&gt;&lt;/p&gt;
&lt;h2 id=&quot;example-of-the-issue&quot;&gt;Example of the issue&lt;/h2&gt;
&lt;p&gt;Here&#39;s an example, based on three test files called &lt;code&gt;a&lt;/code&gt;, &lt;code&gt;b&lt;/code&gt; and &lt;code&gt;fixup&lt;/code&gt;, and these (reduced) Editorconfig settings in my &lt;code&gt;.editorconfig&lt;/code&gt; file:&lt;/p&gt;
&lt;pre class=&quot;language-toml&quot; tabindex=&quot;0&quot;&gt;&lt;code class=&quot;language-toml&quot;&gt;&lt;span class=&quot;token key property&quot;&gt;root&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token boolean&quot;&gt;true&lt;/span&gt;

&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;*&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;
&lt;span class=&quot;token key property&quot;&gt;indent_style&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;=&lt;/span&gt; tab

&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;token table class-name&quot;&gt;bash&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;
&lt;span class=&quot;token key property&quot;&gt;indent_size&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;2&lt;/span&gt;
&lt;span class=&quot;token key property&quot;&gt;indent_style&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;=&lt;/span&gt; space
&lt;span class=&quot;token key property&quot;&gt;switch_case_indent&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token boolean&quot;&gt;true&lt;/span&gt;
&lt;span class=&quot;token key property&quot;&gt;binary_next_line&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token boolean&quot;&gt;true&lt;/span&gt;
&lt;span class=&quot;token key property&quot;&gt;space_redirects&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token boolean&quot;&gt;true&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;&lt;em&gt;On the command line&lt;/em&gt;, running &lt;code&gt;shfmt&lt;/code&gt;&lt;a href=&quot;https://qmacro.org/blog/posts/2025/09/01/auto-formatting-extensionless-bash-scripts-in-neovim/#footnotes&quot;&gt;&lt;sup&gt;2&lt;/sup&gt;&lt;/a&gt; on each of these three files produced the expected results, in that all were formatted according to the &lt;code&gt;shfmt&lt;/code&gt;-specific settings in that &lt;code&gt;[[bash]]&lt;/code&gt; section plus of course indented with 2 spaces.&lt;/p&gt;
&lt;p&gt;&lt;em&gt;Within Neovim&lt;/em&gt;, via the Bash language server&lt;a href=&quot;https://qmacro.org/blog/posts/2025/09/01/auto-formatting-extensionless-bash-scripts-in-neovim/#footnotes&quot;&gt;&lt;sup&gt;3&lt;/sup&gt;&lt;/a&gt;, with shell script files &lt;code&gt;a&lt;/code&gt; and &lt;code&gt;b&lt;/code&gt; everything seemed to work fine and my Bash scripts were indented appropriately with 2 spaces. When I then started to work on real shell scripts such as the one called &lt;code&gt;fixup&lt;/code&gt;, things didn&#39;t work the same, and the indentation was done with tabs, not spaces (the horror!).&lt;/p&gt;
&lt;p&gt;Yes, you guessed it, this was because in standard Editorconfig procedure, the &lt;code&gt;[bash]&lt;/code&gt; part of the &lt;code&gt;[[bash]]&lt;/code&gt; section heading is considered a sequence of characters &lt;code&gt;b&lt;/code&gt;, &lt;code&gt;a&lt;/code&gt;, &lt;code&gt;s&lt;/code&gt; and &lt;code&gt;h&lt;/code&gt;, matching files of those single-character names; and as &lt;code&gt;fixup&lt;/code&gt; was not matched with that sequence, that section (containing &lt;code&gt;indent_style = space&lt;/code&gt;) didn&#39;t apply, and so &lt;code&gt;indent_style = tab&lt;/code&gt; prevailed.&lt;/p&gt;
&lt;p&gt;This is unfortunate, but is not really anyone&#39;s fault.&lt;/p&gt;
&lt;h2 id=&quot;bash-language-server-shfmt-and-editorconfig&quot;&gt;Bash language server, shfmt and Editorconfig&lt;/h2&gt;
&lt;p&gt;I dug in to see what was happening in the Bash language server.&lt;/p&gt;
&lt;p&gt;In preparing to call &lt;code&gt;shfmt&lt;/code&gt;, properties appropriate for the file in question are determined from the Editorconfig configuration. The &lt;a href=&quot;https://www.npmjs.com/package/editorconfig&quot;&gt;editorconfig&lt;/a&gt; NPM package is used for this determination, and the custom &lt;code&gt;shfmt&lt;/code&gt; extension to allow for &lt;code&gt;[[bash]]&lt;/code&gt; and &lt;code&gt;[[shell]]&lt;/code&gt; does not exist in that package.&lt;/p&gt;
&lt;p&gt;There are generic configuration properties such as &lt;code&gt;indent_style&lt;/code&gt;, and &lt;code&gt;shfmt&lt;/code&gt;-specific ones such as &lt;code&gt;switch_case_indent&lt;/code&gt;. If there are any &lt;code&gt;shfmt&lt;/code&gt;-specific ones then the Editorconfig configuration is used. Otherwise, the language server configuration is used. This reflects the approach taken by &lt;code&gt;shfmt&lt;/code&gt; itself in using either Editorconfig or its own command line flags, but not both (as we&#39;ll see in the next section).&lt;/p&gt;
&lt;p&gt;The configuration is then turned into a series of explicit &lt;code&gt;shfmt&lt;/code&gt; command line options, in particular (but not exclusively) from the &lt;a href=&quot;https://github.com/mvdan/sh/blob/master/cmd/shfmt/shfmt.1.scd#printer-flags&quot;&gt;Printer flags&lt;/a&gt; group. For example, on surfacing a &lt;code&gt;binary_next_line = true&lt;/code&gt; setting in &lt;code&gt;.editorconfig&lt;/code&gt; it will generate an equivalent &lt;code&gt;-bn&lt;/code&gt; flag to pass in the call to &lt;code&gt;shfmt&lt;/code&gt;.&lt;/p&gt;
&lt;p&gt;Then the Bash language server invokes &lt;code&gt;shfmt&lt;/code&gt; passing these generated options, plus the &lt;code&gt;--filename&lt;/code&gt; option to specify the full pathname of the file being formatted.&lt;/p&gt;
&lt;h3 id=&quot;example-for-script-called-fixup&quot;&gt;Example for script called &#39;fixup&#39;&lt;/h3&gt;
&lt;p&gt;Here&#39;s an example of that for the script called &lt;code&gt;fixup&lt;/code&gt; for which the &lt;code&gt;editorconfig&lt;/code&gt; package does &lt;em&gt;not&lt;/em&gt; match the &lt;code&gt;[[bash]]&lt;/code&gt; section. This is what&#39;s invoked:&lt;/p&gt;
&lt;pre class=&quot;language-shell&quot; tabindex=&quot;0&quot;&gt;&lt;code class=&quot;language-shell&quot;&gt;shfmt &lt;span class=&quot;token parameter variable&quot;&gt;--filename&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;/home/dj/test/fixup &lt;span class=&quot;token parameter variable&quot;&gt;-i0&lt;/span&gt; &lt;span class=&quot;token parameter variable&quot;&gt;-ln&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;auto -&lt;/code&gt;&lt;/pre&gt;
&lt;ul&gt;
&lt;li&gt;the &lt;code&gt;-i0&lt;/code&gt; comes from a default driven by the basic details sent in the request from Neovim&#39;s LSP client, which includes &lt;code&gt;insertSpaces = false&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;the &lt;code&gt;-ln=auto&lt;/code&gt; comes from &lt;a href=&quot;https://github.com/bash-lsp/bash-language-server/blob/main/server/src/config.ts&quot;&gt;a default in the Bash language server itself&lt;/a&gt; for &lt;code&gt;languageDialect&lt;/code&gt; (see also &lt;a href=&quot;https://qmacro.org/blog/posts/2025/09/01/auto-formatting-extensionless-bash-scripts-in-neovim/#appendix-a-mason-info-for-bash-language-server&quot;&gt;Appendix A&lt;/a&gt;)&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id=&quot;example-for-script-called-a&quot;&gt;Example for script called &#39;a&#39;&lt;/h3&gt;
&lt;p&gt;Here&#39;s another example of what the Bash language server ultimately invokes for the script called &lt;code&gt;a&lt;/code&gt; which (by chance) &lt;em&gt;was&lt;/em&gt; matched by the &lt;code&gt;[[bash]]&lt;/code&gt; section:&lt;/p&gt;
&lt;pre class=&quot;language-shell&quot; tabindex=&quot;0&quot;&gt;&lt;code class=&quot;language-shell&quot;&gt;shfmt &lt;span class=&quot;token parameter variable&quot;&gt;--filename&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;/home/dj/test/a &lt;span class=&quot;token parameter variable&quot;&gt;-i&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;2&lt;/span&gt; &lt;span class=&quot;token parameter variable&quot;&gt;-bn&lt;/span&gt; &lt;span class=&quot;token parameter variable&quot;&gt;-ci&lt;/span&gt; &lt;span class=&quot;token parameter variable&quot;&gt;-sr&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;
&lt;ul&gt;
&lt;li&gt;these options come from the &lt;code&gt;indent_size&lt;/code&gt;, &lt;code&gt;binary_next_line&lt;/code&gt;, &lt;code&gt;switch_case_indent&lt;/code&gt; and &lt;code&gt;space_redirects&lt;/code&gt; Editorconfig properties in the &lt;code&gt;[[bash]]&lt;/code&gt; section&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id=&quot;between-a-rock-and-a-hard-place&quot;&gt;Between a rock and a hard place&lt;/h2&gt;
&lt;p&gt;As mentioned in the previous section, the Bash language server&#39;s approach takes its cue from the &lt;a href=&quot;https://github.com/mvdan/sh/blob/master/cmd/shfmt/shfmt.1.scd#description&quot;&gt;equivalent approach&lt;/a&gt; of &lt;code&gt;shfmt&lt;/code&gt; itself:&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;&amp;quot;If any EditorConfig files are found, they will be used to apply formatting options. If any parser or printer flags are given to the tool, no EditorConfig formatting options will be used. A default like -i=0 can be used for this purpose.&amp;quot;&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;In other words, &lt;em&gt;either&lt;/em&gt; Editorconfig (only), or no Editorconfig.&lt;/p&gt;
&lt;p&gt;But to effect this, Bash language server invokes &lt;code&gt;shfmt&lt;/code&gt; with explicit options for &lt;em&gt;both&lt;/em&gt; cases (where there&#39;s a match, and where there isn&#39;t). This can be seen directly in the two example invocations above.&lt;/p&gt;
&lt;p&gt;I want to manage my formatting in my &lt;code&gt;.editorconfig&lt;/code&gt; file(s), but if I want the Editorconfig settings to be honoured when formatting my shell scripts, I need to give them names that I can match with the Editorconfig section name globs, for example by giving them extensions. I don&#39;t want to do that.&lt;/p&gt;
&lt;p&gt;I want the Bash language server to invoke &lt;code&gt;shfmt&lt;/code&gt; without any &lt;a href=&quot;https://github.com/mvdan/sh/blob/master/cmd/shfmt/shfmt.1.scd#parser-flags&quot;&gt;parser&lt;/a&gt; or &lt;a href=&quot;https://github.com/mvdan/sh/blob/master/cmd/shfmt/shfmt.1.scd#printer-flags&quot;&gt;printer&lt;/a&gt; options so that &lt;code&gt;shfmt&lt;/code&gt; itself, with its special &lt;code&gt;[[bash]]&lt;/code&gt; processing ability (rather than the Bash language server with the standard &lt;code&gt;editorconfig&lt;/code&gt; package) parses the Editorconfig settings. This would effectively bypass any Bash language server logic for &lt;code&gt;shfmt&lt;/code&gt; and just let &lt;code&gt;shfmt&lt;/code&gt; do its thing, with (or without) an &lt;code&gt;.editorconfig&lt;/code&gt; file present.&lt;/p&gt;
&lt;h2 id=&quot;forcing-the-effect&quot;&gt;Forcing the effect&lt;/h2&gt;
&lt;p&gt;To begin with, I debugged what was going on (see the &lt;a href=&quot;https://qmacro.org/blog/posts/2025/09/01/auto-formatting-extensionless-bash-scripts-in-neovim/#useful-debugging-approaches&quot;&gt;Useful debugging approaches&lt;/a&gt; section) and found that the options for &lt;code&gt;shfmt&lt;/code&gt; were being determined and marshalled in &lt;a href=&quot;https://github.com/bash-lsp/bash-language-server/blob/6e419dad6fb07bcf269101c8ffe0d47fd11b14db/server/src/shfmt/index.ts&quot;&gt;server/src/shfmt/index.ts&lt;/a&gt; (yay for open source!):&lt;/p&gt;
&lt;pre class=&quot;language-typescript&quot; tabindex=&quot;0&quot;&gt;&lt;code class=&quot;language-typescript&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;private&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;async&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;runShfmt&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;
  document&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; TextDocument&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
  formatOptions&lt;span class=&quot;token operator&quot;&gt;?&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token constant&quot;&gt;LSP&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;FormattingOptions &lt;span class=&quot;token operator&quot;&gt;|&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;null&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
  shfmtConfig&lt;span class=&quot;token operator&quot;&gt;?&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; Record&lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;token builtin&quot;&gt;string&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token builtin&quot;&gt;string&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;|&lt;/span&gt; &lt;span class=&quot;token builtin&quot;&gt;boolean&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;|&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;null&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token builtin&quot;&gt;Promise&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;token builtin&quot;&gt;string&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
  &lt;span class=&quot;token keyword&quot;&gt;const&lt;/span&gt; args &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;await&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;this&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;getShfmtArguments&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;document&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;uri&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; formatOptions&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; shfmtConfig&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
  &lt;span class=&quot;token operator&quot;&gt;...&lt;/span&gt;
  &lt;span class=&quot;token keyword&quot;&gt;const&lt;/span&gt; proc &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;&lt;span class=&quot;token builtin&quot;&gt;Promise&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;resolve&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; reject&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&gt;&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;const&lt;/span&gt; proc &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;spawn&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;this&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;executablePath&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;...&lt;/span&gt;args&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&#39;-&#39;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt; cwd&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;this&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;cwd &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
    &lt;span class=&quot;token operator&quot;&gt;...&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;Using brute force&lt;a href=&quot;https://qmacro.org/blog/posts/2025/09/01/auto-formatting-extensionless-bash-scripts-in-neovim/#footnotes&quot;&gt;&lt;sup&gt;4&lt;/sup&gt;&lt;/a&gt; I simply truncated &lt;code&gt;args&lt;/code&gt; to &lt;code&gt;[]&lt;/code&gt;, removing the call to &lt;code&gt;this.getShfmtArguments&lt;/code&gt;, and everything worked as planned - &lt;code&gt;shfmt&lt;/code&gt; was called without any options at all, with the result that &lt;code&gt;shfmt&lt;/code&gt; did the right thing, finding and using the appropriate Editorconfig settings, for all Bash files.&lt;/p&gt;
&lt;p&gt;I didn&#39;t want to have to make this modification each time I installed the Bash language server, nor do I think it appropriate to suggest as a modification upstream. So I decided to wrap the call to &lt;code&gt;shfmt&lt;/code&gt;.&lt;/p&gt;
&lt;h3 id=&quot;wrapping-shfmt-to-strip-off-the-options&quot;&gt;Wrapping shfmt to strip off the options&lt;/h3&gt;
&lt;p&gt;The Bash language server &lt;a href=&quot;https://github.com/bash-lsp/bash-language-server/blob/main/server/src/config.ts&quot;&gt;configuration&lt;/a&gt; includes a section specifically for &lt;code&gt;shfmt&lt;/code&gt; (see &lt;a href=&quot;https://qmacro.org/blog/posts/2025/09/01/auto-formatting-extensionless-bash-scripts-in-neovim/#appendix-b-configuration-for-bash-language-server&quot;&gt;Appendix B&lt;/a&gt;). I can use the &lt;code&gt;shfmt.path&lt;/code&gt; configuration option to specify an alternate path for the executable, pointing to a simple shell script that removes all the options passed, except for a couple of generic ones.&lt;/p&gt;
&lt;p&gt;Here&#39;s the script, called &lt;code&gt;shfmt-wrapper&lt;/code&gt;, placed in &lt;code&gt;~/.local/bin/&lt;/code&gt; which is listed first in my &lt;code&gt;PATH&lt;/code&gt; environment variable:&lt;/p&gt;
&lt;pre class=&quot;language-bash&quot; tabindex=&quot;0&quot;&gt;&lt;code class=&quot;language-bash&quot;&gt;&lt;span class=&quot;token shebang important&quot;&gt;#!/usr/bin/env bash&lt;/span&gt;

&lt;span class=&quot;token builtin class-name&quot;&gt;declare&lt;/span&gt; &lt;span class=&quot;token parameter variable&quot;&gt;-a&lt;/span&gt; shfmtargs
&lt;span class=&quot;token keyword&quot;&gt;for&lt;/span&gt; &lt;span class=&quot;token for-or-select variable&quot;&gt;i&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;in&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;&lt;span class=&quot;token variable&quot;&gt;$@&lt;/span&gt;&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;do&lt;/span&gt;
  &lt;span class=&quot;token keyword&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt; &lt;span class=&quot;token variable&quot;&gt;$i&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;==&lt;/span&gt; &lt;span class=&quot;token parameter variable&quot;&gt;--filename&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;* &lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;||&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt; &lt;span class=&quot;token variable&quot;&gt;$i&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;==&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;-&quot;&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;then&lt;/span&gt;
    &lt;span class=&quot;token assign-left variable&quot;&gt;shfmtargs&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;&lt;span class=&quot;token variable&quot;&gt;${shfmtargs&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;@&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;}&lt;/span&gt;&quot;&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;&lt;span class=&quot;token variable&quot;&gt;$i&lt;/span&gt;&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
  &lt;span class=&quot;token keyword&quot;&gt;fi&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;done&lt;/span&gt;
shfmt &lt;span class=&quot;token string&quot;&gt;&quot;&lt;span class=&quot;token variable&quot;&gt;${shfmtargs&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;@&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;}&lt;/span&gt;&quot;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;All it does is take the options passed to it, removes all but the &lt;code&gt;--filename=...&lt;/code&gt; and &lt;code&gt;-&lt;/code&gt; ones, and then calls the actual &lt;code&gt;shfmt&lt;/code&gt; with what&#39;s left.&lt;/p&gt;
&lt;p&gt;And with the &lt;code&gt;shfmt.path&lt;/code&gt; option (see &lt;a href=&quot;https://qmacro.org/blog/posts/2025/09/01/auto-formatting-extensionless-bash-scripts-in-neovim/#appendix-c-neovim-lsp-configuration-for-the-bash-language-server&quot;&gt;Appendix C&lt;/a&gt;) I then told the Bash language server to use this wrapper when invoking &lt;code&gt;shfmt&lt;/code&gt;.&lt;/p&gt;
&lt;p&gt;Therefore, because no parser or printer flags are ever present in the &lt;code&gt;shfmt&lt;/code&gt; option list, &lt;code&gt;shfmt&lt;/code&gt; will use the Editorconfig configuration, interpreting it using the custom support for &lt;code&gt;[[bash]]&lt;/code&gt; or &lt;code&gt;[[shell]]&lt;/code&gt; sections.&lt;/p&gt;
&lt;p&gt;The result is that this section of my &lt;code&gt;.editorconfig&lt;/code&gt; file is interpreted as I intend:&lt;/p&gt;
&lt;pre class=&quot;language-toml&quot; tabindex=&quot;0&quot;&gt;&lt;code class=&quot;language-toml&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;token table class-name&quot;&gt;bash&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;
&lt;span class=&quot;token key property&quot;&gt;indent_size&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;2&lt;/span&gt;
&lt;span class=&quot;token key property&quot;&gt;indent_style&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;=&lt;/span&gt; space
&lt;span class=&quot;token key property&quot;&gt;switch_case_indent&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token boolean&quot;&gt;true&lt;/span&gt;
&lt;span class=&quot;token key property&quot;&gt;binary_next_line&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token boolean&quot;&gt;true&lt;/span&gt;
&lt;span class=&quot;token key property&quot;&gt;space_redirects&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token boolean&quot;&gt;true&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;and my extensionless Bash script files are formatted appropriately. Not with tabs, and no &lt;code&gt;shfmt&lt;/code&gt;-specific configuration, but as I have described in configuration.&lt;/p&gt;
&lt;p&gt;Great!&lt;/p&gt;
&lt;p&gt;This is of course a bit hacky, but I think it is within the boundaries of &amp;quot;small pieces, loosely joined&amp;quot; and doesn&#39;t require any modification to any non-user-serviceable parts.&lt;/p&gt;
&lt;p&gt;&lt;a name=&quot;useful-debugging-approaches&quot;&gt;&lt;/a&gt;&lt;/p&gt;
&lt;h2 id=&quot;useful-debugging-approaches&quot;&gt;Useful debugging approaches&lt;/h2&gt;
&lt;p&gt;In working out what was going on, I used various tools and settings to help me. Here&#39;s a quick list of those, mostly to remind my future self.&lt;/p&gt;
&lt;h3 id=&quot;the-editorconfig-cli&quot;&gt;The editorconfig CLI&lt;/h3&gt;
&lt;p&gt;The &lt;a href=&quot;https://www.npmjs.com/package/editorconfig&quot;&gt;editorconfig&lt;/a&gt; package, which I installed globally for these investigations with &lt;code&gt;npm i -g editorconfig&lt;/code&gt;, also sports a CLI which can be used to show the &amp;quot;effective configuration&amp;quot;, given a filename. Taking the &lt;code&gt;.editorconfig&lt;/code&gt; file contents in the &lt;a href=&quot;https://qmacro.org/blog/posts/2025/09/01/auto-formatting-extensionless-bash-scripts-in-neovim/#example-of-the-issue&quot;&gt;example of the issue&lt;/a&gt; shown earlier, here&#39;s what is output ...&lt;/p&gt;
&lt;p&gt;for the shell script file named &lt;code&gt;a&lt;/code&gt;:&lt;/p&gt;
&lt;pre class=&quot;language-shell&quot; tabindex=&quot;0&quot;&gt;&lt;code class=&quot;language-shell&quot;&gt;$ editorconfig a
&lt;span class=&quot;token assign-left variable&quot;&gt;indent_style&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;space
&lt;span class=&quot;token assign-left variable&quot;&gt;indent_size&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;2&lt;/span&gt;
&lt;span class=&quot;token assign-left variable&quot;&gt;switch_case_indent&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;true
&lt;span class=&quot;token assign-left variable&quot;&gt;binary_next_line&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;true
&lt;span class=&quot;token assign-left variable&quot;&gt;space_redirects&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;true
&lt;span class=&quot;token assign-left variable&quot;&gt;tab_width&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;2&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;and for the shell script file named &lt;code&gt;fixup&lt;/code&gt;:&lt;/p&gt;
&lt;pre class=&quot;language-shell&quot; tabindex=&quot;0&quot;&gt;&lt;code class=&quot;language-shell&quot;&gt;$ editorconfig fixup
&lt;span class=&quot;token assign-left variable&quot;&gt;indent_style&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;tab
&lt;span class=&quot;token assign-left variable&quot;&gt;indent_size&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;tab&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;Thus I can see first hand what the Bash language server would receive from the &lt;code&gt;editorconfig&lt;/code&gt; module, given a filename and some Editorconfig configuration.&lt;/p&gt;
&lt;h3 id=&quot;language-server-logging&quot;&gt;Language server logging&lt;/h3&gt;
&lt;p&gt;Logs are emitted at various points in the Bash language server&#39;s operation, as I could see from browsing the &lt;a href=&quot;https://github.com/bash-lsp/bash-language-server/tree/main/server/src&quot;&gt;server source code&lt;/a&gt;.&lt;/p&gt;
&lt;p&gt;For example, the &lt;a href=&quot;https://github.com/bash-lsp/bash-language-server/blob/main/server/src/shfmt/index.ts&quot;&gt;shfmt support&lt;/a&gt; has many logging lines, including this one:&lt;/p&gt;
&lt;pre class=&quot;language-typescript&quot; tabindex=&quot;0&quot;&gt;&lt;code class=&quot;language-typescript&quot;&gt;logger&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;debug&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;
  &lt;span class=&quot;token template-string&quot;&gt;&lt;span class=&quot;token template-punctuation string&quot;&gt;`&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;Shfmt: found .editorconfig properties: &lt;/span&gt;&lt;span class=&quot;token interpolation&quot;&gt;&lt;span class=&quot;token interpolation-punctuation punctuation&quot;&gt;${&lt;/span&gt;&lt;span class=&quot;token constant&quot;&gt;JSON&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;stringify&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;
    editorconfigProperties&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
  &lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token interpolation-punctuation punctuation&quot;&gt;}&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token template-punctuation string&quot;&gt;`&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;In the &lt;a href=&quot;https://github.com/bash-lsp/bash-language-server/blob/main/server/src/config.ts&quot;&gt;configuration section&lt;/a&gt; I could see that it was probably possible to set my desired logging level with the environment variable &lt;code&gt;BASH_IDE_LOG_LEVEL&lt;/code&gt;.&lt;/p&gt;
&lt;p&gt;But it turns out that the idea is that settings can be specified in the LSP configuration, and the setting property &amp;quot;path&amp;quot; is what&#39;s actually shown in the &lt;a href=&quot;https://qmacro.org/blog/posts/2025/09/01/auto-formatting-extensionless-bash-scripts-in-neovim/#appendix-a-mason-info-for-bash-language-server&quot;&gt;Mason info&lt;/a&gt;, starting with &lt;code&gt;bashIde&lt;/code&gt; as the first path section. I didn&#39;t find that in the Bash language server README or configuration section, perhaps I should have known that implicitly, or known to look elsewhere for it.&lt;/p&gt;
&lt;p&gt;Anyway, once I figured that out, I could set my desired level like this (also shown in &lt;a href=&quot;https://qmacro.org/blog/posts/2025/09/01/auto-formatting-extensionless-bash-scripts-in-neovim/appendix-c-neovim-lsp-configuration-for-the-bash-language-server&quot;&gt;Appendix C&lt;/a&gt;):&lt;/p&gt;
&lt;pre class=&quot;language-lua&quot; tabindex=&quot;0&quot;&gt;&lt;code class=&quot;language-lua&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
  cmd &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&#39;bash-language-server&#39;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&#39;start&#39;&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
  filetypes &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&#39;bash&#39;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&#39;sh&#39;&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
  settings &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    bashIde &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
      logLevel &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&#39;debug&#39;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
      shfmt &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
        path &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; vim&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;fn&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;expand&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&#39;$HOME&#39;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;..&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&#39;/dotfiles/scripts/shfmt-wrapper&#39;&lt;/span&gt;
      &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
  &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;Where does this log output from the Bash language server show up? Well, now I figured it out, it&#39;s obvious - it&#39;s all collected in Neovim&#39;s general LSP log file at &lt;code&gt;~/.local/state/nvim/lsp.log&lt;/code&gt;.&lt;/p&gt;
&lt;p&gt;However, any debug level log output from the Bash language server will only show up there if the general Neovim language server logging level is high enough. Even after adding the &lt;code&gt;logLevel = &#39;debug&#39;&lt;/code&gt; configuration above, nothing showed up ... until I realised I had this in my &lt;code&gt;~/.config/nvim/init.lua&lt;/code&gt;:&lt;/p&gt;
&lt;pre class=&quot;language-lua&quot; tabindex=&quot;0&quot;&gt;&lt;code class=&quot;language-lua&quot;&gt;&lt;span class=&quot;token comment&quot;&gt;-- LSP logging&lt;/span&gt;
vim&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;lsp&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;set_log_level&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;WARN&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;Setting this to &lt;code&gt;DEBUG&lt;/code&gt;, either by changing the value in the &lt;code&gt;init.lua&lt;/code&gt; file itself, or simply on the fly with:&lt;/p&gt;
&lt;pre class=&quot;language-shell&quot; tabindex=&quot;0&quot;&gt;&lt;code class=&quot;language-shell&quot;&gt;:lua vim.lsp.set_log_level&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;DEBUG&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;does the trick, and output like this appears in the &lt;code&gt;lsp.log&lt;/code&gt; file:&lt;/p&gt;
&lt;pre class=&quot;language-log&quot; tabindex=&quot;0&quot;&gt;&lt;code class=&quot;language-log&quot;&gt;&lt;span class=&quot;token level debug keyword&quot;&gt;DEBUG&lt;/span&gt; &lt;span class=&quot;token property&quot;&gt;Shfmt:&lt;/span&gt; found &lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;editorconfig properties&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;indent_style&quot;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;tab&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;indent_size&quot;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;tab&quot;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;}&lt;/span&gt;&#39;
&lt;span class=&quot;token level debug keyword&quot;&gt;DEBUG&lt;/span&gt; &lt;span class=&quot;token property&quot;&gt;Shfmt:&lt;/span&gt; no shfmt properties found in &lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;editorconfig &lt;span class=&quot;token operator&quot;&gt;-&lt;/span&gt; using language server shfmt config&quot;
&lt;span class=&quot;token level debug keyword&quot;&gt;DEBUG&lt;/span&gt; &lt;span class=&quot;token property&quot;&gt;Shfmt:&lt;/span&gt; running &lt;span class=&quot;token string&quot;&gt;&quot;/home/dj/.local/bin/shfmt-wrapper --filename=/tmp/formatting/fixup -i=0 -ln=auto&quot;&lt;/span&gt;&#39;&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;&lt;a name=&quot;appendix-a-mason-info-for-the-bash-language-server&quot;&gt;&lt;/a&gt;&lt;/p&gt;
&lt;h2 id=&quot;appendix-a-mason-info-for-the-bash-language-server&quot;&gt;Appendix A - Mason info for the Bash language server&lt;/h2&gt;
&lt;pre class=&quot;language-text&quot; tabindex=&quot;0&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;Language Filter: press &lt;C-f&gt; to apply filter

Installed (1)
  â— bash-language-server
    A language server for Bash.

    installed version 5.6.0
    installed purl    pkg:npm/bash-language-server@5.6.0
    homepage          https://github.com/bash-lsp/bash-language-server
    languages         Bash, Csh, Ksh, Sh, Zsh
    categories        LSP
    executables       bash-language-server

    â†“ LSP server configuration schema (press enter to collapse)
      This is a read-only overview of the settings this server accepts.
      Note that some settings might not apply to neovim.

      â†’ bashIde.backgroundAnalysisMaxFiles    default: 500
      â†’ bashIde.enableSourceErrorDiagnostics  default: false
      â†’ bashIde.explainshellEndpoint          default: &quot;&quot;
      â†’ bashIde.globPattern                   default: &quot;**/*@(.sh|.inc|.bash|.command)&quot;
      â†’ bashIde.includeAllWorkspaceSymbols    default: false
      â†’ bashIde.logLevel                      default: &quot;info&quot;
      â†’ bashIde.shellcheckArguments           default: &quot;&quot;
      â†’ bashIde.shellcheckPath                default: &quot;shellcheck&quot;
      â†’ bashIde.shfmt.binaryNextLine          default: false
      â†’ bashIde.shfmt.caseIndent              default: false
      â†’ bashIde.shfmt.funcNextLine            default: false
      â†’ bashIde.shfmt.ignoreEditorconfig      default: false
      â†’ bashIde.shfmt.keepPadding             default: false
      â†’ bashIde.shfmt.languageDialect         default: &quot;auto&quot;
      â†’ bashIde.shfmt.path                    default: &quot;shfmt&quot;
      â†’ bashIde.shfmt.simplifyCode            default: false
      â†’ bashIde.shfmt.spaceRedirects          default: false&lt;/C-f&gt;&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;&lt;a name=&quot;appendix-b-configuation-for-bash-language-server&quot;&gt;&lt;/a&gt;&lt;/p&gt;
&lt;h2 id=&quot;appendix-b-configuration-for-bash-language-server&quot;&gt;Appendix B - Configuration for Bash language server&lt;/h2&gt;
&lt;pre class=&quot;language-javascript&quot; tabindex=&quot;0&quot;&gt;&lt;code class=&quot;language-javascript&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;const&lt;/span&gt; rawConfig &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
  &lt;span class=&quot;token literal-property property&quot;&gt;backgroundAnalysisMaxFiles&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;toNumber&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;process&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;env&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token constant&quot;&gt;BACKGROUND_ANALYSIS_MAX_FILES&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
  &lt;span class=&quot;token literal-property property&quot;&gt;enableSourceErrorDiagnostics&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;toBoolean&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;process&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;env&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token constant&quot;&gt;ENABLE_SOURCE_ERROR_DIAGNOSTICS&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
  &lt;span class=&quot;token literal-property property&quot;&gt;explainshellEndpoint&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; process&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;env&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token constant&quot;&gt;EXPLAINSHELL_ENDPOINT&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
  &lt;span class=&quot;token literal-property property&quot;&gt;globPattern&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; process&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;env&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token constant&quot;&gt;GLOB_PATTERN&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
  &lt;span class=&quot;token literal-property property&quot;&gt;includeAllWorkspaceSymbols&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;toBoolean&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;process&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;env&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token constant&quot;&gt;INCLUDE_ALL_WORKSPACE_SYMBOLS&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
  &lt;span class=&quot;token literal-property property&quot;&gt;logLevel&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; process&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;env&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;token constant&quot;&gt;LOG_LEVEL_ENV_VAR&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
  &lt;span class=&quot;token literal-property property&quot;&gt;shellcheckArguments&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; process&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;env&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token constant&quot;&gt;SHELLCHECK_ARGUMENTS&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
  &lt;span class=&quot;token literal-property property&quot;&gt;shellcheckPath&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; process&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;env&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token constant&quot;&gt;SHELLCHECK_PATH&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
  &lt;span class=&quot;token literal-property property&quot;&gt;shfmt&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;token literal-property property&quot;&gt;path&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; process&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;env&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token constant&quot;&gt;SHFMT_PATH&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
    &lt;span class=&quot;token literal-property property&quot;&gt;ignoreEditorconfig&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;toBoolean&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;process&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;env&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token constant&quot;&gt;SHFMT_IGNORE_EDITORCONFIG&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
    &lt;span class=&quot;token literal-property property&quot;&gt;languageDialect&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; process&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;env&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token constant&quot;&gt;SHFMT_LANGUAGE_DIALECT&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
    &lt;span class=&quot;token literal-property property&quot;&gt;binaryNextLine&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;toBoolean&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;process&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;env&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token constant&quot;&gt;SHFMT_BINARY_NEXT_LINE&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
    &lt;span class=&quot;token literal-property property&quot;&gt;caseIndent&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;toBoolean&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;process&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;env&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token constant&quot;&gt;SHFMT_CASE_INDENT&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
    &lt;span class=&quot;token literal-property property&quot;&gt;funcNextLine&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;toBoolean&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;process&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;env&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token constant&quot;&gt;SHFMT_FUNC_NEXT_LINE&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
    &lt;span class=&quot;token literal-property property&quot;&gt;keepPadding&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;toBoolean&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;process&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;env&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token constant&quot;&gt;SHFMT_KEEP_PADDING&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
    &lt;span class=&quot;token literal-property property&quot;&gt;simplifyCode&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;toBoolean&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;process&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;env&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token constant&quot;&gt;SHFMT_SIMPLIFY_CODE&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
    &lt;span class=&quot;token literal-property property&quot;&gt;spaceRedirects&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;toBoolean&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;process&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;env&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token constant&quot;&gt;SHFMT_SPACE_REDIRECTS&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
  &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;&lt;a name=&quot;appendix-c-neovim-lsp-configuration-for-the-bash-language-server&quot;&gt;&lt;/a&gt;&lt;/p&gt;
&lt;h2 id=&quot;appendix-c-neovim-lsp-configuration-for-the-bash-language-server&quot;&gt;Appendix C - Neovim LSP configuration for the Bash language server&lt;/h2&gt;
&lt;p&gt;To add the Bash language server to &lt;a href=&quot;https://qmacro.org/blog/posts/2025/06/10/a-modern-and-clean-neovim-setup-for-cap-node-js-configuration-and-diagnostics/&quot;&gt;my Neovim 0.11+ setup&lt;/a&gt; and configure it, all I needed was to create a new configuration file &lt;code&gt;~/.config/nvim/lsp/bash.lua&lt;/code&gt;:&lt;/p&gt;
&lt;pre class=&quot;language-lua&quot; tabindex=&quot;0&quot;&gt;&lt;code class=&quot;language-lua&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
  cmd &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&#39;bash-language-server&#39;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&#39;start&#39;&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
  filetypes &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&#39;bash&#39;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&#39;sh&#39;&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
  settings &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    bashIde &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
      logLevel &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&#39;debug&#39;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
      shfmt &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
        path &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; vim&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;fn&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;expand&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&#39;$HOME&#39;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;..&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&#39;/dotfiles/scripts/shfmt-wrapper&#39;&lt;/span&gt;
      &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
  &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;(The settings will be explained in the course of this post.)&lt;/p&gt;
&lt;p&gt;Then it was just a matter of enabling the server in the list in my main &lt;code&gt;~/config/nvim/init.lua&lt;/code&gt; file:&lt;/p&gt;
&lt;pre class=&quot;language-lua&quot; tabindex=&quot;0&quot;&gt;&lt;code class=&quot;language-lua&quot;&gt;vim&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;lsp&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;enable&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
  &lt;span class=&quot;token string&quot;&gt;&#39;javascript&#39;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
  &lt;span class=&quot;token string&quot;&gt;&#39;cds&#39;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
  &lt;span class=&quot;token string&quot;&gt;&#39;markdown&#39;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
  &lt;span class=&quot;token string&quot;&gt;&#39;dockerfile&#39;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
  &lt;span class=&quot;token string&quot;&gt;&#39;lua&#39;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
  &lt;span class=&quot;token string&quot;&gt;&#39;bash&#39;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token comment&quot;&gt;-- here&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;&lt;a name=&quot;footnotes&quot;&gt;&lt;/a&gt;&lt;/p&gt;
&lt;h2 id=&quot;footnotes&quot;&gt;Footnotes&lt;/h2&gt;
&lt;ol&gt;
&lt;li&gt;as well as &lt;code&gt;shellcheck&lt;/code&gt; which &lt;a href=&quot;https://github.com/bash-lsp/bash-language-server?tab=readme-ov-file#dependencies&quot;&gt;is also supported&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;version &lt;a href=&quot;https://github.com/mvdan/sh/releases/tag/v3.8.0&quot;&gt;3.8.0&lt;/a&gt; or higher, as that is when support for Editorconfig sections such as &lt;code&gt;[[shell]]&lt;/code&gt; &lt;a href=&quot;https://github.com/mvdan/sh/issues/664&quot;&gt;was introduced&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;https://github.com/qmacro/dotfiles/blob/57c7f38e64ef1f59b9c41f6155b0fa350eb030b7/config/nvim/init.lua#L14-L23&quot;&gt;configured&lt;/a&gt; through a &lt;code&gt;BufWritePre&lt;/code&gt; event based call to &lt;code&gt;vim.lsp.buf.format&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;it was actually in the &lt;a href=&quot;https://github.com/mason-org/mason.nvim&quot;&gt;Mason&lt;/a&gt; installed and managed location at &lt;code&gt;~/.local/share/nvim/mason/packages/bash-language-server/node_modules/bash-language-server/out/shfmt/index.js&lt;/code&gt;, i.e. the transpiled JavaScript equivalent file&lt;/li&gt;
&lt;/ol&gt;
</content>
  </entry>
</feed>